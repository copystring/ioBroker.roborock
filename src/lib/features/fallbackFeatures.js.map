{"version":3,"file":"fallbackFeatures.js","sourceRoot":"","sources":["fallbackFeatures.ts"],"names":[],"mappings":"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","sourcesContent":["// src/lib/features/fallback_features.ts\r\nimport { BaseDeviceFeatures, FeatureDependencies } from \"./baseDeviceFeatures\";\r\nimport { BaseVacuumFeatures } from \"./vacuum/baseVacuumFeatures\"; // Import Vacuum-Basis\r\nimport { Feature } from \"./features.enum\";\r\n\r\n// --- Generic fallback ---\r\nexport class FallbackBaseFeatures extends BaseDeviceFeatures {\r\n\tconstructor(deps: FeatureDependencies, duid: string, robotModel: string) {\r\n\t\tsuper(deps, duid, robotModel, { staticFeatures: [] });\r\n\t}\r\n\r\n\t// --- Implementation of abstract methods ---\r\n\tprotected registerFeatures(): void {\r\n\t\tthis.deps.log.warn(`[${this.duid}] Using fallback feature registration. No specific features registered.`);\r\n\t\t// No features to register in the generic fallback\r\n\t}\r\n\r\n\tprotected _getDynamicFeatures(): Set<Feature> {\r\n\t\tthis.deps.log.warn(`[${this.duid}] Using fallback _getDynamicFeatures. Returning empty set.`);\r\n\t\treturn new Set<Feature>(); // Fallback returns no dynamic features\r\n\t}\r\n\r\n\tpublic async processDockType(dockType: number): Promise<void> {\r\n\t\tthis.deps.log.warn(`[${this.duid}] Using fallback processDockType for dock type ${dockType}. No actions taken.`);\r\n\t\t// Fallback does nothing with dock type\r\n\t}\r\n\r\n\tpublic async detectAndApplyRuntimeFeatures(): Promise<boolean> {\r\n\t\tthis.deps.log.warn(`[${this.duid}] Using fallback detectAndApplyRuntimeFeatures. No features detected.`);\r\n\t\treturn false; // Fallback does no runtime detection\r\n\t}\r\n\r\n\tpublic getCommonConsumable(attribute: string | number): { unit?: string } | undefined {\r\n\t\tthis.deps.log.warn(`[${this.duid}] Fallback: getCommonConsumable called for ${attribute}, returning undefined.`);\r\n\t\treturn undefined;\r\n\t}\r\n\r\n\tpublic isResetableConsumable(consumable: string): boolean {\r\n\t\tthis.deps.log.warn(`[${this.duid}] Fallback: isResetableConsumable called for ${consumable}, returning false.`);\r\n\t\treturn false;\r\n\t}\r\n\r\n\tpublic getCommonDeviceStates(attribute: string | number): { states?: Record<any, any>; unit?: string; type?: ioBroker.CommonType | undefined } | undefined {\r\n\t\tthis.deps.log.warn(`[${this.duid}] Fallback: getCommonDeviceStates called for ${attribute}, returning undefined.`);\r\n\t\treturn undefined;\r\n\t}\r\n\r\n\tpublic getCommonCleaningInfo(attribute: string | number): { unit?: string } | undefined {\r\n\t\tthis.deps.log.warn(`[${this.duid}] Fallback: getCommonCleaningInfo called for ${attribute}, returning undefined.`);\r\n\t\treturn undefined;\r\n\t}\r\n\r\n\tpublic getCommonCleaningRecords(attribute: string | number): { unit?: string } | undefined {\r\n\t\tthis.deps.log.warn(`[${this.duid}] Fallback: getCommonCleaningRecords called for ${attribute}, returning undefined.`);\r\n\t\treturn undefined;\r\n\t}\r\n\r\n\tpublic getFirmwareFeatureName(featureID: string | number): string {\r\n\t\tthis.deps.log.warn(`[${this.duid}] Fallback: getFirmwareFeatureName called for ${featureID}, returning default.`);\r\n\t\treturn `FeatureID_${featureID}`; // Default fallback response\r\n\t}\r\n}\r\n\r\n// --- Specific Vacuum Fallback ---\r\nexport class FallbackVacuumFeatures extends BaseVacuumFeatures {\r\n\tconstructor(deps: FeatureDependencies, duid: string, robotModel: string) {\r\n\t\tsuper(deps, duid, robotModel, { staticFeatures: [] }); // Start with no static features\r\n\t\tthis.deps.log.warn(`[${this.duid}] Using FallbackVacuumFeatures for model ${robotModel}. Runtime detection and base vacuum features active.`);\r\n\t}\r\n\t// No overrides needed here. It inherits:\r\n\t// - registerFeatures (from BaseVacuumFeatures, registers all known vacuum feature implementations)\r\n\t// - _getDynamicFeatures (from BaseVacuumFeatures, tries to detect vacuum bitfields)\r\n\t// - detectAndApplyRuntimeFeatures (from BaseVacuumFeatures, tries runtime detection based on status)\r\n\t// - processDockType (from BaseVacuumFeatures)\r\n\t// - All the getter implementations (getCommonConsumable etc. from BaseVacuumFeatures)\r\n}\r\n\r\n// --- Example for future fallbacks ---\r\n// export class FallbackWashingMachineFeatures extends BaseWashingMachineFeatures {\r\n//     constructor(deps: FeatureDependencies, duid: string, robotModel: string) {\r\n//         super(deps, duid, robotModel, { staticFeatures: [] });\r\n//         this.deps.log.warn(`[${this.duid}] Using FallbackWashingMachineFeatures for model ${robotModel}.`);\r\n//     }\r\n//     // Implement specific fallback logic for washing machines here if needed\r\n// }\r\n"]}