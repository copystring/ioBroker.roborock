var Zr={value:()=>{}};function je(){for(var t=0,e=arguments.length,n={},r;t<e;++t){if(!(r=arguments[t]+"")||r in n||/[\s.]/.test(r))throw new Error("illegal type: "+r);n[r]=[]}return new Ut(n)}function Ut(t){this._=t}function Xr(t,e){return t.trim().split(/^|\s+/).map(function(n){var r="",i=n.indexOf(".");if(i>=0&&(r=n.slice(i+1),n=n.slice(0,i)),n&&!e.hasOwnProperty(n))throw new Error("unknown type: "+n);return{type:n,name:r}})}Ut.prototype=je.prototype={constructor:Ut,on:function(t,e){var n=this._,r=Xr(t+"",n),i,a=-1,o=r.length;if(arguments.length<2){for(;++a<o;)if((i=(t=r[a]).type)&&(i=Wr(n[i],t.name)))return i;return}if(e!=null&&typeof e!="function")throw new Error("invalid callback: "+e);for(;++a<o;)if(i=(t=r[a]).type)n[i]=Ve(n[i],t.name,e);else if(e==null)for(i in n)n[i]=Ve(n[i],t.name,null);return this},copy:function(){var t={},e=this._;for(var n in e)t[n]=e[n].slice();return new Ut(t)},call:function(t,e){if((i=arguments.length-2)>0)for(var n=new Array(i),r=0,i,a;r<i;++r)n[r]=arguments[r+2];if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(a=this._[t],r=0,i=a.length;r<i;++r)a[r].value.apply(e,n)},apply:function(t,e,n){if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(var r=this._[t],i=0,a=r.length;i<a;++i)r[i].value.apply(e,n)}};function Wr(t,e){for(var n=0,r=t.length,i;n<r;++n)if((i=t[n]).name===e)return i.value}function Ve(t,e,n){for(var r=0,i=t.length;r<i;++r)if(t[r].name===e){t[r]=Zr,t=t.slice(0,r).concat(t.slice(r+1));break}return n!=null&&t.push({name:e,value:n}),t}var pt=je;var Vt="http://www.w3.org/1999/xhtml",Se={svg:"http://www.w3.org/2000/svg",xhtml:Vt,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function it(t){var e=t+="",n=e.indexOf(":");return n>=0&&(e=t.slice(0,n))!=="xmlns"&&(t=t.slice(n+1)),Se.hasOwnProperty(e)?{space:Se[e],local:t}:t}function Fr(t){return function(){var e=this.ownerDocument,n=this.namespaceURI;return n===Vt&&e.documentElement.namespaceURI===Vt?e.createElement(t):e.createElementNS(n,t)}}function Ur(t){return function(){return this.ownerDocument.createElementNS(t.space,t.local)}}function jt(t){var e=it(t);return(e.local?Ur:Fr)(e)}function Vr(){}function gt(t){return t==null?Vr:function(){return this.querySelector(t)}}function Qe(t){typeof t!="function"&&(t=gt(t));for(var e=this._groups,n=e.length,r=new Array(n),i=0;i<n;++i)for(var a=e[i],o=a.length,s=r[i]=new Array(o),l,u,c=0;c<o;++c)(l=a[c])&&(u=t.call(l,l.__data__,c,a))&&("__data__"in l&&(u.__data__=l.__data__),s[c]=u);return new B(r,this._parents)}function Ee(t){return t==null?[]:Array.isArray(t)?t:Array.from(t)}function jr(){return[]}function St(t){return t==null?jr:function(){return this.querySelectorAll(t)}}function Qr(t){return function(){return Ee(t.apply(this,arguments))}}function Ke(t){typeof t=="function"?t=Qr(t):t=St(t);for(var e=this._groups,n=e.length,r=[],i=[],a=0;a<n;++a)for(var o=e[a],s=o.length,l,u=0;u<s;++u)(l=o[u])&&(r.push(t.call(l,l.__data__,u,o)),i.push(l));return new B(r,i)}function Et(t){return function(){return this.matches(t)}}function Qt(t){return function(e){return e.matches(t)}}var Kr=Array.prototype.find;function Jr(t){return function(){return Kr.call(this.children,t)}}function qr(){return this.firstElementChild}function Je(t){return this.select(t==null?qr:Jr(typeof t=="function"?t:Qt(t)))}var $r=Array.prototype.filter;function ti(){return Array.from(this.children)}function ei(t){return function(){return $r.call(this.children,t)}}function qe(t){return this.selectAll(t==null?ti:ei(typeof t=="function"?t:Qt(t)))}function $e(t){typeof t!="function"&&(t=Et(t));for(var e=this._groups,n=e.length,r=new Array(n),i=0;i<n;++i)for(var a=e[i],o=a.length,s=r[i]=[],l,u=0;u<o;++u)(l=a[u])&&t.call(l,l.__data__,u,a)&&s.push(l);return new B(r,this._parents)}function Kt(t){return new Array(t.length)}function tn(){return new B(this._enter||this._groups.map(Kt),this._parents)}function Tt(t,e){this.ownerDocument=t.ownerDocument,this.namespaceURI=t.namespaceURI,this._next=null,this._parent=t,this.__data__=e}Tt.prototype={constructor:Tt,appendChild:function(t){return this._parent.insertBefore(t,this._next)},insertBefore:function(t,e){return this._parent.insertBefore(t,e)},querySelector:function(t){return this._parent.querySelector(t)},querySelectorAll:function(t){return this._parent.querySelectorAll(t)}};function en(t){return function(){return t}}function ni(t,e,n,r,i,a){for(var o=0,s,l=e.length,u=a.length;o<u;++o)(s=e[o])?(s.__data__=a[o],r[o]=s):n[o]=new Tt(t,a[o]);for(;o<l;++o)(s=e[o])&&(i[o]=s)}function ri(t,e,n,r,i,a,o){var s,l,u=new Map,c=e.length,p=a.length,f=new Array(c),g;for(s=0;s<c;++s)(l=e[s])&&(f[s]=g=o.call(l,l.__data__,s,e)+"",u.has(g)?i[s]=l:u.set(g,l));for(s=0;s<p;++s)g=o.call(t,a[s],s,a)+"",(l=u.get(g))?(r[s]=l,l.__data__=a[s],u.delete(g)):n[s]=new Tt(t,a[s]);for(s=0;s<c;++s)(l=e[s])&&u.get(f[s])===l&&(i[s]=l)}function ii(t){return t.__data__}function nn(t,e){if(!arguments.length)return Array.from(this,ii);var n=e?ri:ni,r=this._parents,i=this._groups;typeof t!="function"&&(t=en(t));for(var a=i.length,o=new Array(a),s=new Array(a),l=new Array(a),u=0;u<a;++u){var c=r[u],p=i[u],f=p.length,g=oi(t.call(c,c&&c.__data__,u,r)),y=g.length,w=s[u]=new Array(y),S=o[u]=new Array(y),C=l[u]=new Array(f);n(c,p,w,S,C,g,e);for(var O=0,N=0,d,k;O<y;++O)if(d=w[O]){for(O>=N&&(N=O+1);!(k=S[N])&&++N<y;);d._next=k||null}}return o=new B(o,r),o._enter=s,o._exit=l,o}function oi(t){return typeof t=="object"&&"length"in t?t:Array.from(t)}function rn(){return new B(this._exit||this._groups.map(Kt),this._parents)}function on(t,e,n){var r=this.enter(),i=this,a=this.exit();return typeof t=="function"?(r=t(r),r&&(r=r.selection())):r=r.append(t+""),e!=null&&(i=e(i),i&&(i=i.selection())),n==null?a.remove():n(a),r&&i?r.merge(i).order():i}function an(t){for(var e=t.selection?t.selection():t,n=this._groups,r=e._groups,i=n.length,a=r.length,o=Math.min(i,a),s=new Array(i),l=0;l<o;++l)for(var u=n[l],c=r[l],p=u.length,f=s[l]=new Array(p),g,y=0;y<p;++y)(g=u[y]||c[y])&&(f[y]=g);for(;l<i;++l)s[l]=n[l];return new B(s,this._parents)}function sn(){for(var t=this._groups,e=-1,n=t.length;++e<n;)for(var r=t[e],i=r.length-1,a=r[i],o;--i>=0;)(o=r[i])&&(a&&o.compareDocumentPosition(a)^4&&a.parentNode.insertBefore(o,a),a=o);return this}function ln(t){t||(t=ai);function e(p,f){return p&&f?t(p.__data__,f.__data__):!p-!f}for(var n=this._groups,r=n.length,i=new Array(r),a=0;a<r;++a){for(var o=n[a],s=o.length,l=i[a]=new Array(s),u,c=0;c<s;++c)(u=o[c])&&(l[c]=u);l.sort(e)}return new B(i,this._parents).order()}function ai(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}function un(){var t=arguments[0];return arguments[0]=this,t.apply(null,arguments),this}function cn(){return Array.from(this)}function hn(){for(var t=this._groups,e=0,n=t.length;e<n;++e)for(var r=t[e],i=0,a=r.length;i<a;++i){var o=r[i];if(o)return o}return null}function fn(){let t=0;for(let e of this)++t;return t}function pn(){return!this.node()}function gn(t){for(var e=this._groups,n=0,r=e.length;n<r;++n)for(var i=e[n],a=0,o=i.length,s;a<o;++a)(s=i[a])&&t.call(s,s.__data__,a,i);return this}function si(t){return function(){this.removeAttribute(t)}}function li(t){return function(){this.removeAttributeNS(t.space,t.local)}}function ui(t,e){return function(){this.setAttribute(t,e)}}function ci(t,e){return function(){this.setAttributeNS(t.space,t.local,e)}}function hi(t,e){return function(){var n=e.apply(this,arguments);n==null?this.removeAttribute(t):this.setAttribute(t,n)}}function fi(t,e){return function(){var n=e.apply(this,arguments);n==null?this.removeAttributeNS(t.space,t.local):this.setAttributeNS(t.space,t.local,n)}}function mn(t,e){var n=it(t);if(arguments.length<2){var r=this.node();return n.local?r.getAttributeNS(n.space,n.local):r.getAttribute(n)}return this.each((e==null?n.local?li:si:typeof e=="function"?n.local?fi:hi:n.local?ci:ui)(n,e))}function Jt(t){return t.ownerDocument&&t.ownerDocument.defaultView||t.document&&t||t.defaultView}function pi(t){return function(){this.style.removeProperty(t)}}function gi(t,e,n){return function(){this.style.setProperty(t,e,n)}}function mi(t,e,n){return function(){var r=e.apply(this,arguments);r==null?this.style.removeProperty(t):this.style.setProperty(t,r,n)}}function dn(t,e,n){return arguments.length>1?this.each((e==null?pi:typeof e=="function"?mi:gi)(t,e,n??"")):lt(this.node(),t)}function lt(t,e){return t.style.getPropertyValue(e)||Jt(t).getComputedStyle(t,null).getPropertyValue(e)}function di(t){return function(){delete this[t]}}function Ai(t,e){return function(){this[t]=e}}function Ii(t,e){return function(){var n=e.apply(this,arguments);n==null?delete this[t]:this[t]=n}}function An(t,e){return arguments.length>1?this.each((e==null?di:typeof e=="function"?Ii:Ai)(t,e)):this.node()[t]}function In(t){return t.trim().split(/^|\s+/)}function Te(t){return t.classList||new Cn(t)}function Cn(t){this._node=t,this._names=In(t.getAttribute("class")||"")}Cn.prototype={add:function(t){var e=this._names.indexOf(t);e<0&&(this._names.push(t),this._node.setAttribute("class",this._names.join(" ")))},remove:function(t){var e=this._names.indexOf(t);e>=0&&(this._names.splice(e,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(t){return this._names.indexOf(t)>=0}};function yn(t,e){for(var n=Te(t),r=-1,i=e.length;++r<i;)n.add(e[r])}function bn(t,e){for(var n=Te(t),r=-1,i=e.length;++r<i;)n.remove(e[r])}function Ci(t){return function(){yn(this,t)}}function yi(t){return function(){bn(this,t)}}function bi(t,e){return function(){(e.apply(this,arguments)?yn:bn)(this,t)}}function xn(t,e){var n=In(t+"");if(arguments.length<2){for(var r=Te(this.node()),i=-1,a=n.length;++i<a;)if(!r.contains(n[i]))return!1;return!0}return this.each((typeof e=="function"?bi:e?Ci:yi)(n,e))}function xi(){this.textContent=""}function vi(t){return function(){this.textContent=t}}function wi(t){return function(){var e=t.apply(this,arguments);this.textContent=e??""}}function vn(t){return arguments.length?this.each(t==null?xi:(typeof t=="function"?wi:vi)(t)):this.node().textContent}function _i(){this.innerHTML=""}function ki(t){return function(){this.innerHTML=t}}function Si(t){return function(){var e=t.apply(this,arguments);this.innerHTML=e??""}}function wn(t){return arguments.length?this.each(t==null?_i:(typeof t=="function"?Si:ki)(t)):this.node().innerHTML}function Ei(){this.nextSibling&&this.parentNode.appendChild(this)}function _n(){return this.each(Ei)}function Ti(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function kn(){return this.each(Ti)}function Sn(t){var e=typeof t=="function"?t:jt(t);return this.select(function(){return this.appendChild(e.apply(this,arguments))})}function Mi(){return null}function En(t,e){var n=typeof t=="function"?t:jt(t),r=e==null?Mi:typeof e=="function"?e:gt(e);return this.select(function(){return this.insertBefore(n.apply(this,arguments),r.apply(this,arguments)||null)})}function Pi(){var t=this.parentNode;t&&t.removeChild(this)}function Tn(){return this.each(Pi)}function Bi(){var t=this.cloneNode(!1),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function Ni(){var t=this.cloneNode(!0),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function Mn(t){return this.select(t?Ni:Bi)}function Pn(t){return arguments.length?this.property("__data__",t):this.node().__data__}function Ri(t){return function(e){t.call(this,e,this.__data__)}}function Oi(t){return t.trim().split(/^|\s+/).map(function(e){var n="",r=e.indexOf(".");return r>=0&&(n=e.slice(r+1),e=e.slice(0,r)),{type:e,name:n}})}function zi(t){return function(){var e=this.__on;if(e){for(var n=0,r=-1,i=e.length,a;n<i;++n)a=e[n],(!t.type||a.type===t.type)&&a.name===t.name?this.removeEventListener(a.type,a.listener,a.options):e[++r]=a;++r?e.length=r:delete this.__on}}}function Gi(t,e,n){return function(){var r=this.__on,i,a=Ri(e);if(r){for(var o=0,s=r.length;o<s;++o)if((i=r[o]).type===t.type&&i.name===t.name){this.removeEventListener(i.type,i.listener,i.options),this.addEventListener(i.type,i.listener=a,i.options=n),i.value=e;return}}this.addEventListener(t.type,a,n),i={type:t.type,name:t.name,value:e,listener:a,options:n},r?r.push(i):this.__on=[i]}}function Bn(t,e,n){var r=Oi(t+""),i,a=r.length,o;if(arguments.length<2){var s=this.node().__on;if(s){for(var l=0,u=s.length,c;l<u;++l)for(i=0,c=s[l];i<a;++i)if((o=r[i]).type===c.type&&o.name===c.name)return c.value}return}for(s=e?Gi:zi,i=0;i<a;++i)this.each(s(r[i],e,n));return this}function Nn(t,e,n){var r=Jt(t),i=r.CustomEvent;typeof i=="function"?i=new i(e,n):(i=r.document.createEvent("Event"),n?(i.initEvent(e,n.bubbles,n.cancelable),i.detail=n.detail):i.initEvent(e,!1,!1)),t.dispatchEvent(i)}function Di(t,e){return function(){return Nn(this,t,e)}}function Hi(t,e){return function(){return Nn(this,t,e.apply(this,arguments))}}function Rn(t,e){return this.each((typeof e=="function"?Hi:Di)(t,e))}function*On(){for(var t=this._groups,e=0,n=t.length;e<n;++e)for(var r=t[e],i=0,a=r.length,o;i<a;++i)(o=r[i])&&(yield o)}var Me=[null];function B(t,e){this._groups=t,this._parents=e}function zn(){return new B([[document.documentElement]],Me)}function Li(){return this}B.prototype=zn.prototype={constructor:B,select:Qe,selectAll:Ke,selectChild:Je,selectChildren:qe,filter:$e,data:nn,enter:tn,exit:rn,join:on,merge:an,selection:Li,order:sn,sort:ln,call:un,nodes:cn,node:hn,size:fn,empty:pn,each:gn,attr:mn,style:dn,property:An,classed:xn,text:vn,html:wn,raise:_n,lower:kn,append:Sn,insert:En,remove:Tn,clone:Mn,datum:Pn,on:Bn,dispatch:Rn,[Symbol.iterator]:On};var ot=zn;function _(t){return typeof t=="string"?new B([[document.querySelector(t)]],[document.documentElement]):new B([[t]],Me)}function Gn(t){let e;for(;e=t.sourceEvent;)t=e;return t}function Y(t,e){if(t=Gn(t),e===void 0&&(e=t.currentTarget),e){var n=e.ownerSVGElement||e;if(n.createSVGPoint){var r=n.createSVGPoint();return r.x=t.clientX,r.y=t.clientY,r=r.matrixTransform(e.getScreenCTM().inverse()),[r.x,r.y]}if(e.getBoundingClientRect){var i=e.getBoundingClientRect();return[t.clientX-i.left-e.clientLeft,t.clientY-i.top-e.clientTop]}}return[t.pageX,t.pageY]}var Dn={passive:!1},mt={capture:!0,passive:!1};function qt(t){t.stopImmediatePropagation()}function ut(t){t.preventDefault(),t.stopImmediatePropagation()}function Mt(t){var e=t.document.documentElement,n=_(t).on("dragstart.drag",ut,mt);"onselectstart"in e?n.on("selectstart.drag",ut,mt):(e.__noselect=e.style.MozUserSelect,e.style.MozUserSelect="none")}function Pt(t,e){var n=t.document.documentElement,r=_(t).on("dragstart.drag",null);e&&(r.on("click.drag",ut,mt),setTimeout(function(){r.on("click.drag",null)},0)),"onselectstart"in n?r.on("selectstart.drag",null):(n.style.MozUserSelect=n.__noselect,delete n.__noselect)}var Bt=t=>()=>t;function Nt(t,{sourceEvent:e,subject:n,target:r,identifier:i,active:a,x:o,y:s,dx:l,dy:u,dispatch:c}){Object.defineProperties(this,{type:{value:t,enumerable:!0,configurable:!0},sourceEvent:{value:e,enumerable:!0,configurable:!0},subject:{value:n,enumerable:!0,configurable:!0},target:{value:r,enumerable:!0,configurable:!0},identifier:{value:i,enumerable:!0,configurable:!0},active:{value:a,enumerable:!0,configurable:!0},x:{value:o,enumerable:!0,configurable:!0},y:{value:s,enumerable:!0,configurable:!0},dx:{value:l,enumerable:!0,configurable:!0},dy:{value:u,enumerable:!0,configurable:!0},_:{value:c}})}Nt.prototype.on=function(){var t=this._.on.apply(this._,arguments);return t===this._?this:t};function Yi(t){return!t.ctrlKey&&!t.button}function Zi(){return this.parentNode}function Xi(t,e){return e??{x:t.x,y:t.y}}function Wi(){return navigator.maxTouchPoints||"ontouchstart"in this}function $t(){var t=Yi,e=Zi,n=Xi,r=Wi,i={},a=pt("start","drag","end"),o=0,s,l,u,c,p=0;function f(d){d.on("mousedown.drag",g).filter(r).on("touchstart.drag",S).on("touchmove.drag",C,Dn).on("touchend.drag touchcancel.drag",O).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function g(d,k){if(!(c||!t.call(this,d,k))){var E=N(this,e.call(this,d,k),d,k,"mouse");E&&(_(d.view).on("mousemove.drag",y,mt).on("mouseup.drag",w,mt),Mt(d.view),qt(d),u=!1,s=d.clientX,l=d.clientY,E("start",d))}}function y(d){if(ut(d),!u){var k=d.clientX-s,E=d.clientY-l;u=k*k+E*E>p}i.mouse("drag",d)}function w(d){_(d.view).on("mousemove.drag mouseup.drag",null),Pt(d.view,u),ut(d),i.mouse("end",d)}function S(d,k){if(t.call(this,d,k)){var E=d.changedTouches,T=e.call(this,d,k),R=E.length,D,W;for(D=0;D<R;++D)(W=N(this,T,d,k,E[D].identifier,E[D]))&&(qt(d),W("start",d,E[D]))}}function C(d){var k=d.changedTouches,E=k.length,T,R;for(T=0;T<E;++T)(R=i[k[T].identifier])&&(ut(d),R("drag",d,k[T]))}function O(d){var k=d.changedTouches,E=k.length,T,R;for(c&&clearTimeout(c),c=setTimeout(function(){c=null},500),T=0;T<E;++T)(R=i[k[T].identifier])&&(qt(d),R("end",d,k[T]))}function N(d,k,E,T,R,D){var W=a.copy(),H=Y(D||E,k),Q,st,h;if((h=n.call(d,new Nt("beforestart",{sourceEvent:E,target:f,identifier:R,active:o,x:H[0],y:H[1],dx:0,dy:0,dispatch:W}),T))!=null)return Q=h.x-H[0]||0,st=h.y-H[1]||0,function A(m,I,b){var x=H,v;switch(m){case"start":i[R]=A,v=o++;break;case"end":delete i[R],--o;case"drag":H=Y(b||I,k),v=o;break}W.call(m,d,new Nt(m,{sourceEvent:I,subject:h,target:f,identifier:R,active:v,x:H[0]+Q,y:H[1]+st,dx:H[0]-x[0],dy:H[1]-x[1],dispatch:W}),T)}}return f.filter=function(d){return arguments.length?(t=typeof d=="function"?d:Bt(!!d),f):t},f.container=function(d){return arguments.length?(e=typeof d=="function"?d:Bt(d),f):e},f.subject=function(d){return arguments.length?(n=typeof d=="function"?d:Bt(d),f):n},f.touchable=function(d){return arguments.length?(r=typeof d=="function"?d:Bt(!!d),f):r},f.on=function(){var d=a.on.apply(a,arguments);return d===a?f:d},f.clickDistance=function(d){return arguments.length?(p=(d=+d)*d,f):Math.sqrt(p)},f}function te(t,e,n){t.prototype=e.prototype=n,n.constructor=t}function Pe(t,e){var n=Object.create(t.prototype);for(var r in e)n[r]=e[r];return n}function zt(){}var Rt=.7,re=1/Rt,bt="\\s*([+-]?\\d+)\\s*",Ot="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",nt="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",Fi=/^#([0-9a-f]{3,8})$/,Ui=new RegExp(`^rgb\\(${bt},${bt},${bt}\\)$`),Vi=new RegExp(`^rgb\\(${nt},${nt},${nt}\\)$`),ji=new RegExp(`^rgba\\(${bt},${bt},${bt},${Ot}\\)$`),Qi=new RegExp(`^rgba\\(${nt},${nt},${nt},${Ot}\\)$`),Ki=new RegExp(`^hsl\\(${Ot},${nt},${nt}\\)$`),Ji=new RegExp(`^hsla\\(${Ot},${nt},${nt},${Ot}\\)$`),Hn={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};te(zt,ct,{copy(t){return Object.assign(new this.constructor,this,t)},displayable(){return this.rgb().displayable()},hex:Ln,formatHex:Ln,formatHex8:qi,formatHsl:$i,formatRgb:Yn,toString:Yn});function Ln(){return this.rgb().formatHex()}function qi(){return this.rgb().formatHex8()}function $i(){return Vn(this).formatHsl()}function Yn(){return this.rgb().formatRgb()}function ct(t){var e,n;return t=(t+"").trim().toLowerCase(),(e=Fi.exec(t))?(n=e[1].length,e=parseInt(e[1],16),n===6?Zn(e):n===3?new X(e>>8&15|e>>4&240,e>>4&15|e&240,(e&15)<<4|e&15,1):n===8?ee(e>>24&255,e>>16&255,e>>8&255,(e&255)/255):n===4?ee(e>>12&15|e>>8&240,e>>8&15|e>>4&240,e>>4&15|e&240,((e&15)<<4|e&15)/255):null):(e=Ui.exec(t))?new X(e[1],e[2],e[3],1):(e=Vi.exec(t))?new X(e[1]*255/100,e[2]*255/100,e[3]*255/100,1):(e=ji.exec(t))?ee(e[1],e[2],e[3],e[4]):(e=Qi.exec(t))?ee(e[1]*255/100,e[2]*255/100,e[3]*255/100,e[4]):(e=Ki.exec(t))?Fn(e[1],e[2]/100,e[3]/100,1):(e=Ji.exec(t))?Fn(e[1],e[2]/100,e[3]/100,e[4]):Hn.hasOwnProperty(t)?Zn(Hn[t]):t==="transparent"?new X(NaN,NaN,NaN,0):null}function Zn(t){return new X(t>>16&255,t>>8&255,t&255,1)}function ee(t,e,n,r){return r<=0&&(t=e=n=NaN),new X(t,e,n,r)}function to(t){return t instanceof zt||(t=ct(t)),t?(t=t.rgb(),new X(t.r,t.g,t.b,t.opacity)):new X}function xt(t,e,n,r){return arguments.length===1?to(t):new X(t,e,n,r??1)}function X(t,e,n,r){this.r=+t,this.g=+e,this.b=+n,this.opacity=+r}te(X,xt,Pe(zt,{brighter(t){return t=t==null?re:Math.pow(re,t),new X(this.r*t,this.g*t,this.b*t,this.opacity)},darker(t){return t=t==null?Rt:Math.pow(Rt,t),new X(this.r*t,this.g*t,this.b*t,this.opacity)},rgb(){return this},clamp(){return new X(At(this.r),At(this.g),At(this.b),ie(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:Xn,formatHex:Xn,formatHex8:eo,formatRgb:Wn,toString:Wn}));function Xn(){return`#${dt(this.r)}${dt(this.g)}${dt(this.b)}`}function eo(){return`#${dt(this.r)}${dt(this.g)}${dt(this.b)}${dt((isNaN(this.opacity)?1:this.opacity)*255)}`}function Wn(){let t=ie(this.opacity);return`${t===1?"rgb(":"rgba("}${At(this.r)}, ${At(this.g)}, ${At(this.b)}${t===1?")":`, ${t})`}`}function ie(t){return isNaN(t)?1:Math.max(0,Math.min(1,t))}function At(t){return Math.max(0,Math.min(255,Math.round(t)||0))}function dt(t){return t=At(t),(t<16?"0":"")+t.toString(16)}function Fn(t,e,n,r){return r<=0?t=e=n=NaN:n<=0||n>=1?t=e=NaN:e<=0&&(t=NaN),new q(t,e,n,r)}function Vn(t){if(t instanceof q)return new q(t.h,t.s,t.l,t.opacity);if(t instanceof zt||(t=ct(t)),!t)return new q;if(t instanceof q)return t;t=t.rgb();var e=t.r/255,n=t.g/255,r=t.b/255,i=Math.min(e,n,r),a=Math.max(e,n,r),o=NaN,s=a-i,l=(a+i)/2;return s?(e===a?o=(n-r)/s+(n<r)*6:n===a?o=(r-e)/s+2:o=(e-n)/s+4,s/=l<.5?a+i:2-a-i,o*=60):s=l>0&&l<1?0:o,new q(o,s,l,t.opacity)}function jn(t,e,n,r){return arguments.length===1?Vn(t):new q(t,e,n,r??1)}function q(t,e,n,r){this.h=+t,this.s=+e,this.l=+n,this.opacity=+r}te(q,jn,Pe(zt,{brighter(t){return t=t==null?re:Math.pow(re,t),new q(this.h,this.s,this.l*t,this.opacity)},darker(t){return t=t==null?Rt:Math.pow(Rt,t),new q(this.h,this.s,this.l*t,this.opacity)},rgb(){var t=this.h%360+(this.h<0)*360,e=isNaN(t)||isNaN(this.s)?0:this.s,n=this.l,r=n+(n<.5?n:1-n)*e,i=2*n-r;return new X(Be(t>=240?t-240:t+120,i,r),Be(t,i,r),Be(t<120?t+240:t-120,i,r),this.opacity)},clamp(){return new q(Un(this.h),ne(this.s),ne(this.l),ie(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){let t=ie(this.opacity);return`${t===1?"hsl(":"hsla("}${Un(this.h)}, ${ne(this.s)*100}%, ${ne(this.l)*100}%${t===1?")":`, ${t})`}`}}));function Un(t){return t=(t||0)%360,t<0?t+360:t}function ne(t){return Math.max(0,Math.min(1,t||0))}function Be(t,e,n){return(t<60?e+(n-e)*t/60:t<180?n:t<240?e+(n-e)*(240-t)/60:e)*255}function Ne(t,e,n,r,i){var a=t*t,o=a*t;return((1-3*t+3*a-o)*e+(4-6*a+3*o)*n+(1+3*t+3*a-3*o)*r+o*i)/6}function Qn(t){var e=t.length-1;return function(n){var r=n<=0?n=0:n>=1?(n=1,e-1):Math.floor(n*e),i=t[r],a=t[r+1],o=r>0?t[r-1]:2*i-a,s=r<e-1?t[r+2]:2*a-i;return Ne((n-r/e)*e,o,i,a,s)}}function Kn(t){var e=t.length;return function(n){var r=Math.floor(((n%=1)<0?++n:n)*e),i=t[(r+e-1)%e],a=t[r%e],o=t[(r+1)%e],s=t[(r+2)%e];return Ne((n-r/e)*e,i,a,o,s)}}var Re=t=>()=>t;function no(t,e){return function(n){return t+n*e}}function ro(t,e,n){return t=Math.pow(t,n),e=Math.pow(e,n)-t,n=1/n,function(r){return Math.pow(t+r*e,n)}}function Jn(t){return(t=+t)==1?oe:function(e,n){return n-e?ro(e,n,t):Re(isNaN(e)?n:e)}}function oe(t,e){var n=e-t;return n?no(t,n):Re(isNaN(t)?e:t)}var ae=(function t(e){var n=Jn(e);function r(i,a){var o=n((i=xt(i)).r,(a=xt(a)).r),s=n(i.g,a.g),l=n(i.b,a.b),u=oe(i.opacity,a.opacity);return function(c){return i.r=o(c),i.g=s(c),i.b=l(c),i.opacity=u(c),i+""}}return r.gamma=t,r})(1);function qn(t){return function(e){var n=e.length,r=new Array(n),i=new Array(n),a=new Array(n),o,s;for(o=0;o<n;++o)s=xt(e[o]),r[o]=s.r||0,i[o]=s.g||0,a[o]=s.b||0;return r=t(r),i=t(i),a=t(a),s.opacity=1,function(l){return s.r=r(l),s.g=i(l),s.b=a(l),s+""}}}var oo=qn(Qn),ao=qn(Kn);function V(t,e){return t=+t,e=+e,function(n){return t*(1-n)+e*n}}var ze=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,Oe=new RegExp(ze.source,"g");function so(t){return function(){return t}}function lo(t){return function(e){return t(e)+""}}function Ge(t,e){var n=ze.lastIndex=Oe.lastIndex=0,r,i,a,o=-1,s=[],l=[];for(t=t+"",e=e+"";(r=ze.exec(t))&&(i=Oe.exec(e));)(a=i.index)>n&&(a=e.slice(n,a),s[o]?s[o]+=a:s[++o]=a),(r=r[0])===(i=i[0])?s[o]?s[o]+=i:s[++o]=i:(s[++o]=null,l.push({i:o,x:V(r,i)})),n=Oe.lastIndex;return n<e.length&&(a=e.slice(n),s[o]?s[o]+=a:s[++o]=a),s.length<2?l[0]?lo(l[0].x):so(e):(e=l.length,function(u){for(var c=0,p;c<e;++c)s[(p=l[c]).i]=p.x(u);return s.join("")})}var $n=180/Math.PI,se={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function De(t,e,n,r,i,a){var o,s,l;return(o=Math.sqrt(t*t+e*e))&&(t/=o,e/=o),(l=t*n+e*r)&&(n-=t*l,r-=e*l),(s=Math.sqrt(n*n+r*r))&&(n/=s,r/=s,l/=s),t*r<e*n&&(t=-t,e=-e,l=-l,o=-o),{translateX:i,translateY:a,rotate:Math.atan2(e,t)*$n,skewX:Math.atan(l)*$n,scaleX:o,scaleY:s}}var le;function tr(t){let e=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(t+"");return e.isIdentity?se:De(e.a,e.b,e.c,e.d,e.e,e.f)}function er(t){return t==null?se:(le||(le=document.createElementNS("http://www.w3.org/2000/svg","g")),le.setAttribute("transform",t),(t=le.transform.baseVal.consolidate())?(t=t.matrix,De(t.a,t.b,t.c,t.d,t.e,t.f)):se)}function nr(t,e,n,r){function i(u){return u.length?u.pop()+" ":""}function a(u,c,p,f,g,y){if(u!==p||c!==f){var w=g.push("translate(",null,e,null,n);y.push({i:w-4,x:V(u,p)},{i:w-2,x:V(c,f)})}else(p||f)&&g.push("translate("+p+e+f+n)}function o(u,c,p,f){u!==c?(u-c>180?c+=360:c-u>180&&(u+=360),f.push({i:p.push(i(p)+"rotate(",null,r)-2,x:V(u,c)})):c&&p.push(i(p)+"rotate("+c+r)}function s(u,c,p,f){u!==c?f.push({i:p.push(i(p)+"skewX(",null,r)-2,x:V(u,c)}):c&&p.push(i(p)+"skewX("+c+r)}function l(u,c,p,f,g,y){if(u!==p||c!==f){var w=g.push(i(g)+"scale(",null,",",null,")");y.push({i:w-4,x:V(u,p)},{i:w-2,x:V(c,f)})}else(p!==1||f!==1)&&g.push(i(g)+"scale("+p+","+f+")")}return function(u,c){var p=[],f=[];return u=t(u),c=t(c),a(u.translateX,u.translateY,c.translateX,c.translateY,p,f),o(u.rotate,c.rotate,p,f),s(u.skewX,c.skewX,p,f),l(u.scaleX,u.scaleY,c.scaleX,c.scaleY,p,f),u=c=null,function(g){for(var y=-1,w=f.length,S;++y<w;)p[(S=f[y]).i]=S.x(g);return p.join("")}}}var He=nr(tr,"px, ","px)","deg)"),Le=nr(er,", ",")",")");var uo=1e-12;function rr(t){return((t=Math.exp(t))+1/t)/2}function co(t){return((t=Math.exp(t))-1/t)/2}function ho(t){return((t=Math.exp(2*t))-1)/(t+1)}var Ye=(function t(e,n,r){function i(a,o){var s=a[0],l=a[1],u=a[2],c=o[0],p=o[1],f=o[2],g=c-s,y=p-l,w=g*g+y*y,S,C;if(w<uo)C=Math.log(f/u)/e,S=function(T){return[s+T*g,l+T*y,u*Math.exp(e*T*C)]};else{var O=Math.sqrt(w),N=(f*f-u*u+r*w)/(2*u*n*O),d=(f*f-u*u-r*w)/(2*f*n*O),k=Math.log(Math.sqrt(N*N+1)-N),E=Math.log(Math.sqrt(d*d+1)-d);C=(E-k)/e,S=function(T){var R=T*C,D=rr(k),W=u/(n*O)*(D*ho(e*R+k)-co(k));return[s+W*g,l+W*y,u*D/rr(e*R+k)]}}return S.duration=C*1e3*e/Math.SQRT2,S}return i.rho=function(a){var o=Math.max(.001,+a),s=o*o,l=s*s;return t(o,s,l)},i})(Math.SQRT2,2,4);var vt=0,Dt=0,Gt=0,or=1e3,ue,Ht,ce=0,It=0,he=0,Lt=typeof performance=="object"&&performance.now?performance:Date,ar=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(t){setTimeout(t,17)};function Zt(){return It||(ar(fo),It=Lt.now()+he)}function fo(){It=0}function Yt(){this._call=this._time=this._next=null}Yt.prototype=fe.prototype={constructor:Yt,restart:function(t,e,n){if(typeof t!="function")throw new TypeError("callback is not a function");n=(n==null?Zt():+n)+(e==null?0:+e),!this._next&&Ht!==this&&(Ht?Ht._next=this:ue=this,Ht=this),this._call=t,this._time=n,Ze()},stop:function(){this._call&&(this._call=null,this._time=1/0,Ze())}};function fe(t,e,n){var r=new Yt;return r.restart(t,e,n),r}function sr(){Zt(),++vt;for(var t=ue,e;t;)(e=It-t._time)>=0&&t._call.call(void 0,e),t=t._next;--vt}function ir(){It=(ce=Lt.now())+he,vt=Dt=0;try{sr()}finally{vt=0,go(),It=0}}function po(){var t=Lt.now(),e=t-ce;e>or&&(he-=e,ce=t)}function go(){for(var t,e=ue,n,r=1/0;e;)e._call?(r>e._time&&(r=e._time),t=e,e=e._next):(n=e._next,e._next=null,e=t?t._next=n:ue=n);Ht=t,Ze(r)}function Ze(t){if(!vt){Dt&&(Dt=clearTimeout(Dt));var e=t-It;e>24?(t<1/0&&(Dt=setTimeout(ir,t-Lt.now()-he)),Gt&&(Gt=clearInterval(Gt))):(Gt||(ce=Lt.now(),Gt=setInterval(po,or)),vt=1,ar(ir))}}function pe(t,e,n){var r=new Yt;return e=e==null?0:+e,r.restart(i=>{r.stop(),t(i+e)},e,n),r}var mo=pt("start","end","cancel","interrupt"),Ao=[],cr=0,lr=1,me=2,ge=3,ur=4,de=5,Xt=6;function ht(t,e,n,r,i,a){var o=t.__transition;if(!o)t.__transition={};else if(n in o)return;Io(t,n,{name:e,index:r,group:i,on:mo,tween:Ao,time:a.time,delay:a.delay,duration:a.duration,ease:a.ease,timer:null,state:cr})}function Wt(t,e){var n=G(t,e);if(n.state>cr)throw new Error("too late; already scheduled");return n}function L(t,e){var n=G(t,e);if(n.state>ge)throw new Error("too late; already running");return n}function G(t,e){var n=t.__transition;if(!n||!(n=n[e]))throw new Error("transition not found");return n}function Io(t,e,n){var r=t.__transition,i;r[e]=n,n.timer=fe(a,0,n.time);function a(u){n.state=lr,n.timer.restart(o,n.delay,n.time),n.delay<=u&&o(u-n.delay)}function o(u){var c,p,f,g;if(n.state!==lr)return l();for(c in r)if(g=r[c],g.name===n.name){if(g.state===ge)return pe(o);g.state===ur?(g.state=Xt,g.timer.stop(),g.on.call("interrupt",t,t.__data__,g.index,g.group),delete r[c]):+c<e&&(g.state=Xt,g.timer.stop(),g.on.call("cancel",t,t.__data__,g.index,g.group),delete r[c])}if(pe(function(){n.state===ge&&(n.state=ur,n.timer.restart(s,n.delay,n.time),s(u))}),n.state=me,n.on.call("start",t,t.__data__,n.index,n.group),n.state===me){for(n.state=ge,i=new Array(f=n.tween.length),c=0,p=-1;c<f;++c)(g=n.tween[c].value.call(t,t.__data__,n.index,n.group))&&(i[++p]=g);i.length=p+1}}function s(u){for(var c=u<n.duration?n.ease.call(null,u/n.duration):(n.timer.restart(l),n.state=de,1),p=-1,f=i.length;++p<f;)i[p].call(t,c);n.state===de&&(n.on.call("end",t,t.__data__,n.index,n.group),l())}function l(){n.state=Xt,n.timer.stop(),delete r[e];for(var u in r)return;delete t.__transition}}function ft(t,e){var n=t.__transition,r,i,a=!0,o;if(n){e=e==null?null:e+"";for(o in n){if((r=n[o]).name!==e){a=!1;continue}i=r.state>me&&r.state<de,r.state=Xt,r.timer.stop(),r.on.call(i?"interrupt":"cancel",t,t.__data__,r.index,r.group),delete n[o]}a&&delete t.__transition}}function hr(t){return this.each(function(){ft(this,t)})}function Co(t,e){var n,r;return function(){var i=L(this,t),a=i.tween;if(a!==n){r=n=a;for(var o=0,s=r.length;o<s;++o)if(r[o].name===e){r=r.slice(),r.splice(o,1);break}}i.tween=r}}function yo(t,e,n){var r,i;if(typeof n!="function")throw new Error;return function(){var a=L(this,t),o=a.tween;if(o!==r){i=(r=o).slice();for(var s={name:e,value:n},l=0,u=i.length;l<u;++l)if(i[l].name===e){i[l]=s;break}l===u&&i.push(s)}a.tween=i}}function fr(t,e){var n=this._id;if(t+="",arguments.length<2){for(var r=G(this.node(),n).tween,i=0,a=r.length,o;i<a;++i)if((o=r[i]).name===t)return o.value;return null}return this.each((e==null?Co:yo)(n,t,e))}function wt(t,e,n){var r=t._id;return t.each(function(){var i=L(this,r);(i.value||(i.value={}))[e]=n.apply(this,arguments)}),function(i){return G(i,r).value[e]}}function Ae(t,e){var n;return(typeof e=="number"?V:e instanceof ct?ae:(n=ct(e))?(e=n,ae):Ge)(t,e)}function bo(t){return function(){this.removeAttribute(t)}}function xo(t){return function(){this.removeAttributeNS(t.space,t.local)}}function vo(t,e,n){var r,i=n+"",a;return function(){var o=this.getAttribute(t);return o===i?null:o===r?a:a=e(r=o,n)}}function wo(t,e,n){var r,i=n+"",a;return function(){var o=this.getAttributeNS(t.space,t.local);return o===i?null:o===r?a:a=e(r=o,n)}}function _o(t,e,n){var r,i,a;return function(){var o,s=n(this),l;return s==null?void this.removeAttribute(t):(o=this.getAttribute(t),l=s+"",o===l?null:o===r&&l===i?a:(i=l,a=e(r=o,s)))}}function ko(t,e,n){var r,i,a;return function(){var o,s=n(this),l;return s==null?void this.removeAttributeNS(t.space,t.local):(o=this.getAttributeNS(t.space,t.local),l=s+"",o===l?null:o===r&&l===i?a:(i=l,a=e(r=o,s)))}}function pr(t,e){var n=it(t),r=n==="transform"?Le:Ae;return this.attrTween(t,typeof e=="function"?(n.local?ko:_o)(n,r,wt(this,"attr."+t,e)):e==null?(n.local?xo:bo)(n):(n.local?wo:vo)(n,r,e))}function So(t,e){return function(n){this.setAttribute(t,e.call(this,n))}}function Eo(t,e){return function(n){this.setAttributeNS(t.space,t.local,e.call(this,n))}}function To(t,e){var n,r;function i(){var a=e.apply(this,arguments);return a!==r&&(n=(r=a)&&Eo(t,a)),n}return i._value=e,i}function Mo(t,e){var n,r;function i(){var a=e.apply(this,arguments);return a!==r&&(n=(r=a)&&So(t,a)),n}return i._value=e,i}function gr(t,e){var n="attr."+t;if(arguments.length<2)return(n=this.tween(n))&&n._value;if(e==null)return this.tween(n,null);if(typeof e!="function")throw new Error;var r=it(t);return this.tween(n,(r.local?To:Mo)(r,e))}function Po(t,e){return function(){Wt(this,t).delay=+e.apply(this,arguments)}}function Bo(t,e){return e=+e,function(){Wt(this,t).delay=e}}function mr(t){var e=this._id;return arguments.length?this.each((typeof t=="function"?Po:Bo)(e,t)):G(this.node(),e).delay}function No(t,e){return function(){L(this,t).duration=+e.apply(this,arguments)}}function Ro(t,e){return e=+e,function(){L(this,t).duration=e}}function dr(t){var e=this._id;return arguments.length?this.each((typeof t=="function"?No:Ro)(e,t)):G(this.node(),e).duration}function Oo(t,e){if(typeof e!="function")throw new Error;return function(){L(this,t).ease=e}}function Ar(t){var e=this._id;return arguments.length?this.each(Oo(e,t)):G(this.node(),e).ease}function zo(t,e){return function(){var n=e.apply(this,arguments);if(typeof n!="function")throw new Error;L(this,t).ease=n}}function Ir(t){if(typeof t!="function")throw new Error;return this.each(zo(this._id,t))}function Cr(t){typeof t!="function"&&(t=Et(t));for(var e=this._groups,n=e.length,r=new Array(n),i=0;i<n;++i)for(var a=e[i],o=a.length,s=r[i]=[],l,u=0;u<o;++u)(l=a[u])&&t.call(l,l.__data__,u,a)&&s.push(l);return new Z(r,this._parents,this._name,this._id)}function yr(t){if(t._id!==this._id)throw new Error;for(var e=this._groups,n=t._groups,r=e.length,i=n.length,a=Math.min(r,i),o=new Array(r),s=0;s<a;++s)for(var l=e[s],u=n[s],c=l.length,p=o[s]=new Array(c),f,g=0;g<c;++g)(f=l[g]||u[g])&&(p[g]=f);for(;s<r;++s)o[s]=e[s];return new Z(o,this._parents,this._name,this._id)}function Go(t){return(t+"").trim().split(/^|\s+/).every(function(e){var n=e.indexOf(".");return n>=0&&(e=e.slice(0,n)),!e||e==="start"})}function Do(t,e,n){var r,i,a=Go(e)?Wt:L;return function(){var o=a(this,t),s=o.on;s!==r&&(i=(r=s).copy()).on(e,n),o.on=i}}function br(t,e){var n=this._id;return arguments.length<2?G(this.node(),n).on.on(t):this.each(Do(n,t,e))}function Ho(t){return function(){var e=this.parentNode;for(var n in this.__transition)if(+n!==t)return;e&&e.removeChild(this)}}function xr(){return this.on("end.remove",Ho(this._id))}function vr(t){var e=this._name,n=this._id;typeof t!="function"&&(t=gt(t));for(var r=this._groups,i=r.length,a=new Array(i),o=0;o<i;++o)for(var s=r[o],l=s.length,u=a[o]=new Array(l),c,p,f=0;f<l;++f)(c=s[f])&&(p=t.call(c,c.__data__,f,s))&&("__data__"in c&&(p.__data__=c.__data__),u[f]=p,ht(u[f],e,n,f,u,G(c,n)));return new Z(a,this._parents,e,n)}function wr(t){var e=this._name,n=this._id;typeof t!="function"&&(t=St(t));for(var r=this._groups,i=r.length,a=[],o=[],s=0;s<i;++s)for(var l=r[s],u=l.length,c,p=0;p<u;++p)if(c=l[p]){for(var f=t.call(c,c.__data__,p,l),g,y=G(c,n),w=0,S=f.length;w<S;++w)(g=f[w])&&ht(g,e,n,w,f,y);a.push(f),o.push(c)}return new Z(a,o,e,n)}var Lo=ot.prototype.constructor;function _r(){return new Lo(this._groups,this._parents)}function Yo(t,e){var n,r,i;return function(){var a=lt(this,t),o=(this.style.removeProperty(t),lt(this,t));return a===o?null:a===n&&o===r?i:i=e(n=a,r=o)}}function kr(t){return function(){this.style.removeProperty(t)}}function Zo(t,e,n){var r,i=n+"",a;return function(){var o=lt(this,t);return o===i?null:o===r?a:a=e(r=o,n)}}function Xo(t,e,n){var r,i,a;return function(){var o=lt(this,t),s=n(this),l=s+"";return s==null&&(l=s=(this.style.removeProperty(t),lt(this,t))),o===l?null:o===r&&l===i?a:(i=l,a=e(r=o,s))}}function Wo(t,e){var n,r,i,a="style."+e,o="end."+a,s;return function(){var l=L(this,t),u=l.on,c=l.value[a]==null?s||(s=kr(e)):void 0;(u!==n||i!==c)&&(r=(n=u).copy()).on(o,i=c),l.on=r}}function Sr(t,e,n){var r=(t+="")=="transform"?He:Ae;return e==null?this.styleTween(t,Yo(t,r)).on("end.style."+t,kr(t)):typeof e=="function"?this.styleTween(t,Xo(t,r,wt(this,"style."+t,e))).each(Wo(this._id,t)):this.styleTween(t,Zo(t,r,e),n).on("end.style."+t,null)}function Fo(t,e,n){return function(r){this.style.setProperty(t,e.call(this,r),n)}}function Uo(t,e,n){var r,i;function a(){var o=e.apply(this,arguments);return o!==i&&(r=(i=o)&&Fo(t,o,n)),r}return a._value=e,a}function Er(t,e,n){var r="style."+(t+="");if(arguments.length<2)return(r=this.tween(r))&&r._value;if(e==null)return this.tween(r,null);if(typeof e!="function")throw new Error;return this.tween(r,Uo(t,e,n??""))}function Vo(t){return function(){this.textContent=t}}function jo(t){return function(){var e=t(this);this.textContent=e??""}}function Tr(t){return this.tween("text",typeof t=="function"?jo(wt(this,"text",t)):Vo(t==null?"":t+""))}function Qo(t){return function(e){this.textContent=t.call(this,e)}}function Ko(t){var e,n;function r(){var i=t.apply(this,arguments);return i!==n&&(e=(n=i)&&Qo(i)),e}return r._value=t,r}function Mr(t){var e="text";if(arguments.length<1)return(e=this.tween(e))&&e._value;if(t==null)return this.tween(e,null);if(typeof t!="function")throw new Error;return this.tween(e,Ko(t))}function Pr(){for(var t=this._name,e=this._id,n=Ie(),r=this._groups,i=r.length,a=0;a<i;++a)for(var o=r[a],s=o.length,l,u=0;u<s;++u)if(l=o[u]){var c=G(l,e);ht(l,t,n,u,o,{time:c.time+c.delay+c.duration,delay:0,duration:c.duration,ease:c.ease})}return new Z(r,this._parents,t,n)}function Br(){var t,e,n=this,r=n._id,i=n.size();return new Promise(function(a,o){var s={value:o},l={value:function(){--i===0&&a()}};n.each(function(){var u=L(this,r),c=u.on;c!==t&&(e=(t=c).copy(),e._.cancel.push(s),e._.interrupt.push(s),e._.end.push(l)),u.on=e}),i===0&&a()})}var Jo=0;function Z(t,e,n,r){this._groups=t,this._parents=e,this._name=n,this._id=r}function Nr(t){return ot().transition(t)}function Ie(){return++Jo}var at=ot.prototype;Z.prototype=Nr.prototype={constructor:Z,select:vr,selectAll:wr,selectChild:at.selectChild,selectChildren:at.selectChildren,filter:Cr,merge:yr,selection:_r,transition:Pr,call:at.call,nodes:at.nodes,node:at.node,size:at.size,empty:at.empty,each:at.each,on:br,attr:pr,attrTween:gr,style:Sr,styleTween:Er,text:Tr,textTween:Mr,remove:xr,tween:fr,delay:mr,duration:dr,ease:Ar,easeVarying:Ir,end:Br,[Symbol.iterator]:at[Symbol.iterator]};function Ce(t){return((t*=2)<=1?t*t*t:(t-=2)*t*t+2)/2}var qo={time:null,delay:0,duration:250,ease:Ce};function $o(t,e){for(var n;!(n=t.__transition)||!(n=n[e]);)if(!(t=t.parentNode))throw new Error(`transition ${e} not found`);return n}function Rr(t){var e,n;t instanceof Z?(e=t._id,t=t._name):(e=Ie(),(n=qo).time=Zt(),t=t==null?null:t+"");for(var r=this._groups,i=r.length,a=0;a<i;++a)for(var o=r[a],s=o.length,l,u=0;u<s;++u)(l=o[u])&&ht(l,t,e,u,o,n||$o(l,e));return new Z(r,this._parents,t,e)}ot.prototype.interrupt=hr;ot.prototype.transition=Rr;var{abs:kh,max:Sh,min:Eh}=Math;function Or(t){return[+t[0],+t[1]]}function ta(t){return[Or(t[0]),Or(t[1])]}var Th={name:"x",handles:["w","e"].map(Xe),input:function(t,e){return t==null?null:[[+t[0],e[0][1]],[+t[1],e[1][1]]]},output:function(t){return t&&[t[0][0],t[1][0]]}},Mh={name:"y",handles:["n","s"].map(Xe),input:function(t,e){return t==null?null:[[e[0][0],+t[0]],[e[1][0],+t[1]]]},output:function(t){return t&&[t[0][1],t[1][1]]}},Ph={name:"xy",handles:["n","w","e","s","nw","ne","sw","se"].map(Xe),input:function(t){return t==null?null:ta(t)},output:function(t){return t}};function Xe(t){return{type:t}}var Ft=t=>()=>t;function We(t,{sourceEvent:e,target:n,transform:r,dispatch:i}){Object.defineProperties(this,{type:{value:t,enumerable:!0,configurable:!0},sourceEvent:{value:e,enumerable:!0,configurable:!0},target:{value:n,enumerable:!0,configurable:!0},transform:{value:r,enumerable:!0,configurable:!0},_:{value:i}})}function tt(t,e,n){this.k=t,this.x=e,this.y=n}tt.prototype={constructor:tt,scale:function(t){return t===1?this:new tt(this.k*t,this.x,this.y)},translate:function(t,e){return t===0&e===0?this:new tt(this.k,this.x+this.k*t,this.y+this.k*e)},apply:function(t){return[t[0]*this.k+this.x,t[1]*this.k+this.y]},applyX:function(t){return t*this.k+this.x},applyY:function(t){return t*this.k+this.y},invert:function(t){return[(t[0]-this.x)/this.k,(t[1]-this.y)/this.k]},invertX:function(t){return(t-this.x)/this.k},invertY:function(t){return(t-this.y)/this.k},rescaleX:function(t){return t.copy().domain(t.range().map(this.invertX,this).map(t.invert,t))},rescaleY:function(t){return t.copy().domain(t.range().map(this.invertY,this).map(t.invert,t))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};var Ct=new tt(1,0,0);yt.prototype=tt.prototype;function yt(t){for(;!t.__zoom;)if(!(t=t.parentNode))return Ct;return t.__zoom}function ye(t){t.stopImmediatePropagation()}function _t(t){t.preventDefault(),t.stopImmediatePropagation()}function ea(t){return(!t.ctrlKey||t.type==="wheel")&&!t.button}function na(){var t=this;return t instanceof SVGElement?(t=t.ownerSVGElement||t,t.hasAttribute("viewBox")?(t=t.viewBox.baseVal,[[t.x,t.y],[t.x+t.width,t.y+t.height]]):[[0,0],[t.width.baseVal.value,t.height.baseVal.value]]):[[0,0],[t.clientWidth,t.clientHeight]]}function zr(){return this.__zoom||Ct}function ra(t){return-t.deltaY*(t.deltaMode===1?.05:t.deltaMode?1:.002)*(t.ctrlKey?10:1)}function ia(){return navigator.maxTouchPoints||"ontouchstart"in this}function oa(t,e,n){var r=t.invertX(e[0][0])-n[0][0],i=t.invertX(e[1][0])-n[1][0],a=t.invertY(e[0][1])-n[0][1],o=t.invertY(e[1][1])-n[1][1];return t.translate(i>r?(r+i)/2:Math.min(0,r)||Math.max(0,i),o>a?(a+o)/2:Math.min(0,a)||Math.max(0,o))}function be(){var t=ea,e=na,n=oa,r=ra,i=ia,a=[0,1/0],o=[[-1/0,-1/0],[1/0,1/0]],s=250,l=Ye,u=pt("start","zoom","end"),c,p,f,g=500,y=150,w=0,S=10;function C(h){h.property("__zoom",zr).on("wheel.zoom",R,{passive:!1}).on("mousedown.zoom",D).on("dblclick.zoom",W).filter(i).on("touchstart.zoom",H).on("touchmove.zoom",Q).on("touchend.zoom touchcancel.zoom",st).style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}C.transform=function(h,A,m,I){var b=h.selection?h.selection():h;b.property("__zoom",zr),h!==b?k(h,A,m,I):b.interrupt().each(function(){E(this,arguments).event(I).start().zoom(null,typeof A=="function"?A.apply(this,arguments):A).end()})},C.scaleBy=function(h,A,m,I){C.scaleTo(h,function(){var b=this.__zoom.k,x=typeof A=="function"?A.apply(this,arguments):A;return b*x},m,I)},C.scaleTo=function(h,A,m,I){C.transform(h,function(){var b=e.apply(this,arguments),x=this.__zoom,v=m==null?d(b):typeof m=="function"?m.apply(this,arguments):m,M=x.invert(v),P=typeof A=="function"?A.apply(this,arguments):A;return n(N(O(x,P),v,M),b,o)},m,I)},C.translateBy=function(h,A,m,I){C.transform(h,function(){return n(this.__zoom.translate(typeof A=="function"?A.apply(this,arguments):A,typeof m=="function"?m.apply(this,arguments):m),e.apply(this,arguments),o)},null,I)},C.translateTo=function(h,A,m,I,b){C.transform(h,function(){var x=e.apply(this,arguments),v=this.__zoom,M=I==null?d(x):typeof I=="function"?I.apply(this,arguments):I;return n(Ct.translate(M[0],M[1]).scale(v.k).translate(typeof A=="function"?-A.apply(this,arguments):-A,typeof m=="function"?-m.apply(this,arguments):-m),x,o)},I,b)};function O(h,A){return A=Math.max(a[0],Math.min(a[1],A)),A===h.k?h:new tt(A,h.x,h.y)}function N(h,A,m){var I=A[0]-m[0]*h.k,b=A[1]-m[1]*h.k;return I===h.x&&b===h.y?h:new tt(h.k,I,b)}function d(h){return[(+h[0][0]+ +h[1][0])/2,(+h[0][1]+ +h[1][1])/2]}function k(h,A,m,I){h.on("start.zoom",function(){E(this,arguments).event(I).start()}).on("interrupt.zoom end.zoom",function(){E(this,arguments).event(I).end()}).tween("zoom",function(){var b=this,x=arguments,v=E(b,x).event(I),M=e.apply(b,x),P=m==null?d(M):typeof m=="function"?m.apply(b,x):m,U=Math.max(M[1][0]-M[0][0],M[1][1]-M[0][1]),z=b.__zoom,F=typeof A=="function"?A.apply(b,x):A,K=l(z.invert(P).concat(U/z.k),F.invert(P).concat(U/F.k));return function(J){if(J===1)J=F;else{var rt=K(J),ke=U/rt[2];J=new tt(ke,P[0]-rt[0]*ke,P[1]-rt[1]*ke)}v.zoom(null,J)}})}function E(h,A,m){return!m&&h.__zooming||new T(h,A)}function T(h,A){this.that=h,this.args=A,this.active=0,this.sourceEvent=null,this.extent=e.apply(h,A),this.taps=0}T.prototype={event:function(h){return h&&(this.sourceEvent=h),this},start:function(){return++this.active===1&&(this.that.__zooming=this,this.emit("start")),this},zoom:function(h,A){return this.mouse&&h!=="mouse"&&(this.mouse[1]=A.invert(this.mouse[0])),this.touch0&&h!=="touch"&&(this.touch0[1]=A.invert(this.touch0[0])),this.touch1&&h!=="touch"&&(this.touch1[1]=A.invert(this.touch1[0])),this.that.__zoom=A,this.emit("zoom"),this},end:function(){return--this.active===0&&(delete this.that.__zooming,this.emit("end")),this},emit:function(h){var A=_(this.that).datum();u.call(h,this.that,new We(h,{sourceEvent:this.sourceEvent,target:C,type:h,transform:this.that.__zoom,dispatch:u}),A)}};function R(h,...A){if(!t.apply(this,arguments))return;var m=E(this,A).event(h),I=this.__zoom,b=Math.max(a[0],Math.min(a[1],I.k*Math.pow(2,r.apply(this,arguments)))),x=Y(h);if(m.wheel)(m.mouse[0][0]!==x[0]||m.mouse[0][1]!==x[1])&&(m.mouse[1]=I.invert(m.mouse[0]=x)),clearTimeout(m.wheel);else{if(I.k===b)return;m.mouse=[x,I.invert(x)],ft(this),m.start()}_t(h),m.wheel=setTimeout(v,y),m.zoom("mouse",n(N(O(I,b),m.mouse[0],m.mouse[1]),m.extent,o));function v(){m.wheel=null,m.end()}}function D(h,...A){if(f||!t.apply(this,arguments))return;var m=h.currentTarget,I=E(this,A,!0).event(h),b=_(h.view).on("mousemove.zoom",P,!0).on("mouseup.zoom",U,!0),x=Y(h,m),v=h.clientX,M=h.clientY;Mt(h.view),ye(h),I.mouse=[x,this.__zoom.invert(x)],ft(this),I.start();function P(z){if(_t(z),!I.moved){var F=z.clientX-v,K=z.clientY-M;I.moved=F*F+K*K>w}I.event(z).zoom("mouse",n(N(I.that.__zoom,I.mouse[0]=Y(z,m),I.mouse[1]),I.extent,o))}function U(z){b.on("mousemove.zoom mouseup.zoom",null),Pt(z.view,I.moved),_t(z),I.event(z).end()}}function W(h,...A){if(t.apply(this,arguments)){var m=this.__zoom,I=Y(h.changedTouches?h.changedTouches[0]:h,this),b=m.invert(I),x=m.k*(h.shiftKey?.5:2),v=n(N(O(m,x),I,b),e.apply(this,A),o);_t(h),s>0?_(this).transition().duration(s).call(k,v,I,h):_(this).call(C.transform,v,I,h)}}function H(h,...A){if(t.apply(this,arguments)){var m=h.touches,I=m.length,b=E(this,A,h.changedTouches.length===I).event(h),x,v,M,P;for(ye(h),v=0;v<I;++v)M=m[v],P=Y(M,this),P=[P,this.__zoom.invert(P),M.identifier],b.touch0?!b.touch1&&b.touch0[2]!==P[2]&&(b.touch1=P,b.taps=0):(b.touch0=P,x=!0,b.taps=1+!!c);c&&(c=clearTimeout(c)),x&&(b.taps<2&&(p=P[0],c=setTimeout(function(){c=null},g)),ft(this),b.start())}}function Q(h,...A){if(this.__zooming){var m=E(this,A).event(h),I=h.changedTouches,b=I.length,x,v,M,P;for(_t(h),x=0;x<b;++x)v=I[x],M=Y(v,this),m.touch0&&m.touch0[2]===v.identifier?m.touch0[0]=M:m.touch1&&m.touch1[2]===v.identifier&&(m.touch1[0]=M);if(v=m.that.__zoom,m.touch1){var U=m.touch0[0],z=m.touch0[1],F=m.touch1[0],K=m.touch1[1],J=(J=F[0]-U[0])*J+(J=F[1]-U[1])*J,rt=(rt=K[0]-z[0])*rt+(rt=K[1]-z[1])*rt;v=O(v,Math.sqrt(J/rt)),M=[(U[0]+F[0])/2,(U[1]+F[1])/2],P=[(z[0]+K[0])/2,(z[1]+K[1])/2]}else if(m.touch0)M=m.touch0[0],P=m.touch0[1];else return;m.zoom("touch",n(N(v,M,P),m.extent,o))}}function st(h,...A){if(this.__zooming){var m=E(this,A).event(h),I=h.changedTouches,b=I.length,x,v;for(ye(h),f&&clearTimeout(f),f=setTimeout(function(){f=null},g),x=0;x<b;++x)v=I[x],m.touch0&&m.touch0[2]===v.identifier?delete m.touch0:m.touch1&&m.touch1[2]===v.identifier&&delete m.touch1;if(m.touch1&&!m.touch0&&(m.touch0=m.touch1,delete m.touch1),m.touch0)m.touch0[1]=this.__zoom.invert(m.touch0[0]);else if(m.end(),m.taps===2&&(v=Y(v,this),Math.hypot(p[0]-v[0],p[1]-v[1])<S)){var M=_(this).on("dblclick.zoom");M&&M.apply(this,arguments)}}}return C.wheelDelta=function(h){return arguments.length?(r=typeof h=="function"?h:Ft(+h),C):r},C.filter=function(h){return arguments.length?(t=typeof h=="function"?h:Ft(!!h),C):t},C.touchable=function(h){return arguments.length?(i=typeof h=="function"?h:Ft(!!h),C):i},C.extent=function(h){return arguments.length?(e=typeof h=="function"?h:Ft([[+h[0][0],+h[0][1]],[+h[1][0],+h[1][1]]]),C):e},C.scaleExtent=function(h){return arguments.length?(a[0]=+h[0],a[1]=+h[1],C):[a[0],a[1]]},C.translateExtent=function(h){return arguments.length?(o[0][0]=+h[0][0],o[1][0]=+h[1][0],o[0][1]=+h[0][1],o[1][1]=+h[1][1],C):[[o[0][0],o[0][1]],[o[1][0],o[1][1]]]},C.constrain=function(h){return arguments.length?(n=h,C):n},C.duration=function(h){return arguments.length?(s=+h,C):s},C.interpolate=function(h){return arguments.length?(l=h,C):l},C.on=function(){var h=u.on.apply(u,arguments);return h===u?C:h},C.clickDistance=function(h){return arguments.length?(w=(h=+h)*h,C):Math.sqrt(w)},C.tapDistance=function(h){return arguments.length?(S=+h,C):S},C}function sa(t){let{x:e,y:n,minX:r,minY:i,sizeY:a,resolution:o,scale:s}=t,l=(e-r)/o+.5,u=a-(n-i)/o-.5;return{x:l*s,y:u*s}}function la(t){let{x:e,y:n,minX:r,minY:i,sizeY:a,resolution:o,scale:s}=t,l=e/s,u=n/s,c=(l-.5)*o+r,p=(a-u-.5)*o+i;return{x:c,y:p}}var kt=50,Gr=3;function xe(t,e){if(!e)return{x:0,y:0};let n=(e.imageHeight||e.mapMaxY||1024)/e.scaleFactor,r=e.left*kt,i=e.topMap*kt,a=la({x:t.x,y:t.y,minX:r,minY:i,sizeY:n,resolution:kt,scale:e.scaleFactor});return{x:Math.round(a.x),y:Math.round(a.y)}}function Fe(t,e){if(!e)return{x:0,y:0};let n=(e.imageHeight||e.mapMaxY||1024)/Gr,r=e.left*kt,i=e.topMap*kt;return sa({x:t.x,y:t.y,minX:r,minY:i,sizeY:n,resolution:kt,scale:Gr})}function ve(t,e,n,r,i,a){if(n===-1||i==="")i+=`M${t},${e}`;else{let o=(t-n)**2+(e-r)**2>a;i+=o?`M${t},${e}`:`L${t},${e}`}return[i,t,e]}function we(t,e,n){return(!n||!t.length||t[t.length-1].length===0)&&t.push([]),t[t.length-1].push(e),e}function Dr(t,e,n,r,i){let a="",o="",s="",l="",u=[[]],c=[[]],p=[[]],f=[[]],g=-1,y=-1,w=-1,S=-1,C=-1,O=-1,N=-1,d=-1,k=null,E=null,T=null,R=null,D=10*r*(10*r),W=Math.min(t.length,e.length);for(let Q=0;Q<W;Q++){let st=t[Q],h=n(st,i),A=h.x,m=h.y,I=e[Q],b=(I>>1&1)===1||(I>>3&1)===1,x=(I>>2&1)===1,v=(I&1)===1,M=g,P=k,U=w,z=E,F=C,K=T;g=-1,k=null,w=-1,E=null,C=-1,T=null,b?([o,w,S]=ve(A,m,U,S,o,D),E=we(c,h,z)):x?([s,C,O]=ve(A,m,F,O,s,D),T=we(p,h,K)):([a,g,y]=ve(A,m,M,y,a,D),k=we(u,h,P)),v?([l,N,d]=ve(A,m,N,d,l,D),R=we(f,h,R)):(N=-1,R=null)}let H=Q=>Q.filter(st=>st.length>0);return{mainPathD:a,backwashPathD:o,pureCleanPathD:s,mopPathD:l,mainPath:H(u),backwashPath:H(c),pureCleanPath:H(p),mopPath:H(f)}}var _e=class{_socket=null;_isConnected=!1;_disconnectedSince=null;_connCallbacks={};_isAuthDone=!1;_type="socket.io";_reconnectInterval=1e4;_reloadInterval=30;_isSecure=!1;_useStorage=!1;_objects=null;_authPromise=null;_resolveAuth=()=>{};_rejectAuth=()=>{};namespace="vis.0";user="";_connectInterval=null;_countInterval=null;_timer=null;_lastTimer=0;constructor(e){e?.useStorage&&(this._useStorage=!0)}init(e,n,r){if(this._connCallbacks=n,this._authPromise=new Promise((o,s)=>{this._resolveAuth=o,this._rejectAuth=s}),typeof socketNamespace<"u"&&(this.namespace=socketNamespace),e=e||{},e.name||(e.name=this.namespace),(document.URL.split("/local/")[1]||typeof socketUrl>"u"&&!e.connLink||typeof socketUrl<"u"&&socketUrl==="local")&&(this._type="local"),this._type==="local"){this._isConnected=!0,this._isAuthDone=!0,this._connCallbacks.onConnChange&&this._connCallbacks.onConnChange(!0),typeof app<"u"&&app.onConnChange(!0),this._resolveAuth(!0);return}if(typeof io>"u"){console.error("socket.io not loaded!");return}let i=e.connLink||window.localStorage.getItem("connLink");!i&&typeof socketUrl<"u"&&(i=socketUrl),e.socketSession=e.socketSession||(typeof socketSession<"u"?socketSession:"nokey"),e.socketForceWebSockets===void 0&&typeof socketForceWebSockets<"u"&&(e.socketForceWebSockets=socketForceWebSockets);let a;i?(a=i,i[0]===":"&&(a=`${location.protocol}//${location.hostname}${i}`)):a=`${location.protocol}//${location.host}`,this._socket=io.connect(a,{query:"key="+e.socketSession,"reconnection limit":1e4,"max reconnection attempts":1/0,reconnection:!1,upgrade:!e.socketForceWebSockets,rememberUpgrade:e.socketForceWebSockets,transports:e.socketForceWebSockets?["websocket"]:void 0}),this._socket.on("connect",()=>this._onSocketConnect(e,r)),this._socket.on("reauthenticate",()=>this._onSocketReauthenticate()),this._socket.on("connect_error",()=>this._onSocketConnectError(e)),this._socket.on("disconnect",()=>this._onSocketDisconnect(e)),this._socket.on("reconnect",()=>this._onSocketReconnect()),this._socket.on("objectChange",(o,s)=>this._onSocketObjectChange(o,s)),this._socket.on("stateChange",(o,s)=>this._onSocketStateChange(o,s)),this._socket.on("permissionError",o=>this._onSocketPermissionError(o))}_onSocketConnect(e,n){if(this._disconnectedSince){let a=new Date().getTime()-this._disconnectedSince;console.log(`was offline for ${a/1e3}s`),this._reloadInterval&&a>this._reloadInterval*1e3&&window.location.reload(),this._disconnectedSince=null}this._connectInterval&&(clearInterval(this._connectInterval),this._connectInterval=null),this._countInterval&&(clearInterval(this._countInterval),this._countInterval=null);let r=document.getElementById("server-disconnect");r&&(r.style.display="none"),this._socket.emit("name",e.name),console.log(new Date().toISOString()+" Connected => authenticate");let i=setTimeout(()=>{console.error("No answer from server"),window.location.reload()},3e3);this._socket.emit("authenticate",(a,o)=>{clearTimeout(i),console.log(new Date().toISOString()+" Authenticated: "+a),a?this._onAuth(n,o):(console.log("permissionError"),this._rejectAuth(new Error("Permission Error")))})}_onAuth(e,n){if(this._isAuthDone=!0,this._isSecure=n,this._isSecure&&(this._lastTimer=new Date().getTime(),this._monitor()),e&&this._socket.emit("subscribeObjects","*"),this._isConnected===!0){this._resolveAuth(!0);return}this._isConnected=!0,this._connCallbacks.onConnChange&&setTimeout(()=>{this._socket.emit("authEnabled",(r,i)=>{this.user=i,this._connCallbacks.onConnChange(this._isConnected),typeof app<"u"&&app.onConnChange(this._isConnected)})},0),this._resolveAuth(!0)}_onSocketReauthenticate(){this._connCallbacks.onConnChange&&(this._connCallbacks.onConnChange(!1),typeof app<"u"&&app.onConnChange(!1)),console.warn("reauthenticate"),window.location.reload()}_onSocketConnectError(e){typeof $<"u"&&$(".splash-screen-text").css("color","#002951"),this.reconnect(e)}_onSocketDisconnect(e){if(this._disconnectedSince=new Date().getTime(),this._isConnected=!1,this._authPromise=new Promise((n,r)=>{this._resolveAuth=n,this._rejectAuth=r}),this._connCallbacks.onConnChange)setTimeout(()=>{let n=document.getElementById("server-disconnect");n&&(n.style.display=""),this._connCallbacks.onConnChange(this._isConnected),typeof app<"u"&&app.onConnChange(this._isConnected)},5e3);else{let n=document.getElementById("server-disconnect");n&&(n.style.display="")}this.reconnect(e)}_onSocketReconnect(){let e=new Date().getTime()-(this._disconnectedSince||0);console.log(`was offline for ${e/1e3}s`),this._reloadInterval&&e>this._reloadInterval*1e3&&window.location.reload()}_onSocketObjectChange(e,n){this._useStorage&&typeof storage<"u",this._connCallbacks.onObjectChange&&this._connCallbacks.onObjectChange(e,n)}_onSocketStateChange(e,n){!e||n===null||typeof n!="object"||this._connCallbacks.onUpdate&&this._connCallbacks.onUpdate(e,n)}_onSocketPermissionError(e){this._connCallbacks.onError?this._connCallbacks.onError(e):console.log("permissionError",e)}async _checkReady(e){if(this._type==="local")return!0;if(!this._authPromise)throw console.error(`Connection not initialized. Call .init() first for ${e}`),new Error("Connection not initialized");if(await this._authPromise,!this._isConnected)throw console.log(`No connection for ${e}`),new Error("No connection");if(this._socket===null)throw console.log(`socket.io not initialized for ${e}`),new Error("Socket.io not initialized");if(!this._isAuthDone)throw console.warn(`Auth not done for ${e}. Race condition?`),new Error("Authentication not complete");return!0}getType=()=>this._type;getIsConnected=()=>this._isConnected;getIsLoginRequired=()=>this._isSecure;getUser=()=>this.user;setReloadTimeout=e=>{this._reloadInterval=parseInt(e,10)};setReconnectInterval=e=>{this._reconnectInterval=parseInt(e,10)};reconnect(e){(!e.mayReconnect||e.mayReconnect())&&!this._connectInterval&&(this._connectInterval=setInterval(()=>{console.log("Trying connect..."),this._socket.connect()},this._reconnectInterval))}async getVersion(){return await this._checkReady("getVersion"),new Promise(e=>{this._socket.emit("getVersion",(n,r)=>{e(r)})})}async sendTo(e,n,r){return await this._checkReady("sendTo"),new Promise((i,a)=>{this._socket.emit("sendTo",e,n,r,o=>{o&&o.error?a(new Error(o.error)):i(o)})})}async getObjectView(e,n,r){return await this._checkReady("getObjectView"),new Promise((i,a)=>{this._socket.emit("getObjectView",e,n,r,(o,s)=>{o?a(o):i(s)})})}async getObject(e){return await this._checkReady("getObject"),new Promise((n,r)=>{this._socket.emit("getObject",e,(i,a)=>{i?r(i):n(a)})})}async getStates(e){return this._type==="local"?{}:(await this._checkReady("getStates"),new Promise((n,r)=>{this._socket.emit("getStates",e,(i,a)=>{i||!a?r(i||"Authentication required"):n(a)})}))}async subscribeState(e){return await this._checkReady("subscribeState"),new Promise(n=>{this._socket.emit("subscribe",e,()=>{n()})})}async unsubscribeState(e){return await this._checkReady("unsubscribeState"),new Promise(n=>{this._socket.emit("unsubscribe",e,()=>{n()})})}async getObjects(e=!1){if(this._useStorage&&e){if(typeof storage<"u"){let n=this._objects||storage.get("objects");if(n)return n}else if(this._objects)return this._objects}await this._checkReady("getObjects");try{let[n,r]=await new Promise(u=>{this._socket.emit("getObjects",(c,p)=>u([c,p]))});if(n)throw n;let i=await this.getObjectView("system","enum",{startkey:"enum.",endkey:"enum.\u9999"}),a={};for(let u of i.rows)r[u.id]=u.value,a[u.id]=u.value;let o=await this.getObjectView("system","instance",{startkey:"system.adapter.",endkey:"system.adapter.\u9999"});for(let u of o.rows)r[u.id]=u.value;let s=await this.getObjectView("system","channel",{startkey:"",endkey:"\u9999"});for(let u of s.rows)r[u.id]=u.value;let l=await this.getObjectView("system","device",{startkey:"",endkey:"\u9999"});for(let u of l.rows)r[u.id]=u.value;return this._useStorage&&(this._fillChildren(r),this._objects=r,typeof storage<"u"&&(storage.set("objects",r),storage.set("enums",a),storage.set("timeSync",new Date().getTime()))),r}catch(n){throw console.error("Error in getObjects:",n),n}}async readFile(e,n=!1){if(this._type==="local")try{let i=storage.get(e);return{data:i?JSON.parse(i):null}}catch(i){throw i}if(await this._checkReady("readFile"),!n&&typeof app<"u")return new Promise((i,a)=>{app.readLocalFile(e.replace(/^\/vis\.0\//,""),(o,s,l)=>{o?a(o):i({data:s,mimeType:l})})});let r=this.namespace;if(e[0]==="/"){let i=e.split("/");r=i[1],i.splice(0,2),e=i.join("/")}return new Promise((i,a)=>{this._socket.emit("readFile",r,e,(o,s,l)=>{o?a(o):i({data:s,mimeType:l})})})}_monitor(){if(this._timer)return;let e=new Date().getTime();this._reloadInterval&&e-this._lastTimer>this._reloadInterval*1e3?window.location.reload():this._lastTimer=e,this._timer=setTimeout(()=>{this._timer=null,this._monitor()},1e4)}_fillChildren(e){let n=Object.keys(e).sort();for(let r=0;r<n.length;r++){let i=n[r];if(e[i].common){let a=r+1,o=[],s=i.length+1,l=i+".";for(;a<n.length&&n[a].substring(0,s)===l;)o.push(n[a++]);e[i].children=o}}}};var Hr="data:image/png;base64,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AAAOVWlUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4KPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iWE1QIENvcmUgNC40LjAtRXhpdjIiPgogPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4KICA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIgogICAgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iCiAgICB4bWxuczpzdEV2dD0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL3NUeXBlL1Jlc291cmNlRXZlbnQjIgogICAgeG1sbnM6ZGM9Imh0dHA6Ly9wdXJsLm9yZy9kYy9lbGVtZW50cy8xLjEvIgogICAgeG1sbnM6R0lNUD0iaHR0cDovL3d3dy5naW1wLm9yZy94bXAvIgogICAgeG1sbnM6dGlmZj0iaHR0cDovL25zLmFkb2JlLmNvbS90aWZmLzEuMC8iCiAgICB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iCiAgIHhtcE1NOkRvY3VtZW50SUQ9ImdpbXA6ZG9jaWQ6Z2ltcDplODk0ZjlkMy1iNjZlLTQ1ODQtODY0MS0zMGI5MTk2ZDM2NTQiCiAgIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6YjM1MWM4ODEtZmQwYi00MjlkLWExZDMtNjkwOTFiNWE1YzYxIgogICB4bXBNTTpPcmlnaW5hbERvY3VtZW50SUQ9InhtcC5kaWQ6YTZlMmNkZTctOGZhZC00ZDVhLWI5N2UtY2VhZTc0NWNmYjVmIgogICBkYzpGb3JtYXQ9ImltYWdlL3BuZyIKICAgR0lNUDpBUEk9IjIuMCIKICAgR0lNUDpQbGF0Zm9ybT0iV2luZG93cyIKICAgR0lNUDpUaW1lU3RhbXA9IjE2NzczNjQ5MzQzNDYyMjgiCiAgIEdJTVA6VmVyc2lvbj0iMi4xMC4zMiIKICAgdGlmZjpPcmllbnRhdGlvbj0iMSIKICAgeG1wOkNyZWF0b3JUb29sPSJHSU1QIDIuMTAiCiAgIHhtcDpNZXRhZGF0YURhdGU9IjIwMjM6MDI6MjVUMjM6NDI6MTIrMDE6MDAiCiAgIHhtcDpNb2RpZnlEYXRlPSIyMDIzOjAyOjI1VDIzOjQyOjEyKzAxOjAwIj4KICAgPHhtcE1NOkhpc3Rvcnk+CiAgICA8cmRmOlNlcT4KICAgICA8cmRmOmxpCiAgICAgIHN0RXZ0OmFjdGlvbj0ic2F2ZWQiCiAgICAgIHN0RXZ0OmNoYW5nZWQ9Ii8iCiAgICAgIHN0RXZ0Omluc3RhbmNlSUQ9InhtcC5paWQ6MjcxYWIyOGQtODExMy00NWRiLWJkMjQtNGJkOTJjZjk5NThmIgogICAgICBzdEV2dDpzb2Z0d2FyZUFnZW50PSJHaW1wIDIuMTAgKFdpbmRvd3MpIgogICAgICBzdEV2dDp3aGVuPSIyMDIzLTAyLTI1VDIzOjI1OjIzIi8+CiAgICAgPHJkZjpsaQogICAgICBzdEV2dDphY3Rpb249InNhdmVkIgogICAgICBzdEV2dDpjaGFuZ2VkPSIvIgogICAgICBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOjA4MjZiNWE2LTgwZjctNDU2My1hY2UwLThjMTMzYjQyZmZhNCIKICAgICAgc3RFdnQ6c29mdHdhcmVBZ2VudD0iR2ltcCAyLjEwIChXaW5kb3dzKSIKICAgICAgc3RFdnQ6d2hlbj0iMjAyMy0wMi0yNVQyMzo0MjoxNCIvPgogICAgPC9yZGY6U2VxPgogICA8L3htcE1NOkhpc3Rvcnk+CiAgPC9yZGY6RGVzY3JpcHRpb24+CiA8L3JkZjpSREY+CjwveDp4bXBtZXRhPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgCjw/eHBhY2tldCBlbmQ9InciPz6W+nyxAAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH5wIZFioOADz0AgAAAyVJREFUaN7tmr9uE0EQhz8ncmKSwglQkMSCIg0URMgFFUUkZARyj1DeIhQuIsQj0LqnJHkBK6FJ5QK5IIpBsuhiWVEiOY7y3/INxaybBOE9+27vbPknjWSfd2fmu/Xt7c4djDXWWGMNkRLhupcJ4CnwHHgNrADLwLxp0AT+AD+B78Ae8BsS3pCdR5kCeQPyA+QExAORHuaZtj9M36lhgX0FsmMB2Mt21Fd8QVMgGyA3AcB27cb4TMUNdgbkG0gnQNiudYzvmbjA3gPZDAH0tm1qrGhhJ0C+Wk5Kg5pnYk1ECfwB5NoBbNeuNWY0sPdBjhzCdu1IY7uFTYAUI4DtWlFzcAf8CKQeIXBdc/CvfieAt8Cinw6ZDBQKUC5Do6FWLuuxTMZ3/EWTg7MRrvgZkXxepFIR8Ty5I8/T3/J536NccQW7CHJpm9jKikitJj1Vq2lbH8CXmkv4wDk/y8dSSaxVKvleduZcXMNPgEmbhrkcZLP2jrNZ7WOpSZNL6MBztvvopSVIp+0dp9Pax8defs4F8LQtcCoFyaS942RS+/gAnnYBfAaITcOrK2i37R2329rHdjIxuYQOfAJYlWDqdWi17B23WtrHUp7JJfRZejVGs/SqC+CHIBcxuA9faC5uFh97MVhp7blcWq77XfBnMiKFgki5LNJoqJXLeiyT6WsDse4SeBnkPMLd0rnm4G63dAhUIyy1VE0OroATZ8BWhMBbJgenVY95kNMI/s6nGrs/DVABTDSBYgSjWzSxIynkPQNpOhzdpsbsXwPWeBO/gJLDM1wyMSMtxi+AtByMbktjDaYgqviH5lqWMM+qiXFIPCQLIMchju5xEKMbNPRaiMBrxE8yC7IbAuyu+o6lJAvSDhC2rT5jLfkU0IPxjvqKvWQOZD8A4H31NRSSFwNuH8/Vx9BIEuZlFK/PJ/0bjh+HBgI91eesvTtE72jdgX4McuAD9kD7DLXkvWVZ90bbjoTkc49bVUfbjIxkFmT7P8DbMV5N9Q39AKT6D9iq/jaSkpe39s4tPTbSknfmdYVL/exWEdzcZQL4aL58GcKXwccaa6yx3Okve0d25MUPGTcAAAAASUVORK5CYII=",Lr="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAMAAADXqc3KAAAAdVBMVEUAAAA44Yo44Yo44Yo44Yo44Yo44Yo44Yo44Yp26q844Yr///9767Kv89DG9t2g8Md26q5C44/5/vvz/fjY+ei19NNV5ZtJ45T2/fmY78KP7r1v6atq6Kjs/PPi+u7e+uvM9+Gb8MSS7r+H7bhm6KVh56JZ5p3ZkKITAAAACnRSTlMABTr188xpJ4aepd0A4wAAANZJREFUKM9VklmCgzAMQwkQYCSmLKWl2+zL/Y9YcIUL7wvkJHIUJyKkVcyy+JIGCZILGF//QLEqlTmMdsBEXi56igfH/QVGqvXSu49+1KftCbn+dtxB5LOPfNGQNRaKaQNkTJ46OMGczZg8wJB/9TB+J3nFkyqJMp44vBrnWYhJJmOn/5uVzAotV/zACnbUtTbOpHcQzVx8kxw6mavdpYP90dsNcE5k6xd8RoIb2Xgk6xAbfm5C9NiHtxGiXD/U2P96UJunrS/LOeV2GG4wfBi241P5+NwBnAEUFx9FUdUAAAAASUVORK5CYII=",Yr="data:image/png;base64,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";var j=3,et={ROBOT_SIZE_BASE:5,CHARGER_SIZE_BASE:3,OBSTACLE_RADIUS_BASE:3,ZONE_STROKE_BASE:1.5,ZONE_HANDLE_RADIUS_BASE:5,PIN_WIDTH_BASE:29,PIN_HEIGHT_BASE:24,PIN_Y_OFFSET_BASE:5,PATH_MOP_WIDTH_BASE:6.5,PATH_MAIN_WIDTH_RATIO_BASE:.8,PATH_BACKWASH_WIDTH_BASE:.5},ua={"-99":"99",0:"0",1:"1",2:"2",3:"3",4:"3",5:"5_cn",9:"9",10:"10",18:"18",25:"25",26:"26",27:"26",34:"10",42:"18",48:"48",49:"49",50:"50",51:"51",54:"54",65:"65",67:"67",69:"69",70:"70",99:"99"},Ue=class{connection;instanceId="";currentRobotDuid=null;onStateChange=null;currentMapSubscriptions=[];map;mapImage;mapMinX=0;mapMinY=0;mapSizeX=0;mapSizeY=0;mapMaxY=0;goToTarget=!1;zoomLevel=.55;image=new Image;initialTransform;svg;svgContainer;mainGroup;mapImageElement;carpetGroup;pathGroup;mopPathGroup;backwashPathGroup;pureCleanPathGroup;chargerGroup;robotGroup;roomNameGroup;zoneGroup;obstacleGroup;pinGroup;zoom;wheelZoom=1;minZoom=.1;maxZoom=10;popupTimeout=null;popupX=0;popupY=0;selectedObstacleID;model=null;robotModels={};rects=[];zones=[];rectCounter=0;popup;popupImage;triangle;largePhoto;largePhotoImage;largePhotoBBox;robotSelect;deleteButton;addButton;startButton;pauseButton;stopButton;dockButton;goToButton;resetZoomButton;constructor(){this.connection=new _e,this.svg=_(null),this.svgContainer=_(null),this.mainGroup=_(null),this.mapImageElement=_(null),this.carpetGroup=_(null),this.pathGroup=_(null),this.mopPathGroup=_(null),this.backwashPathGroup=_(null),this.pureCleanPathGroup=_(null),this.chargerGroup=_(null),this.robotGroup=_(null),this.roomNameGroup=_(null),this.zoneGroup=_(null),this.obstacleGroup=_(null),this.pinGroup=_(null),this.zoom=be()}async init(){this.bindDomElements(),this.setupD3(),this.setupConnection(),this.bindUiEvents()}bindDomElements(){let e=n=>{let r=document.getElementById(n);if(!r)throw new Error(`Missing DOM element: ${n}`);return r};this.popup=e("popup"),this.popupImage=e("popup-image"),this.triangle=e("triangle"),this.largePhoto=e("largePhoto"),this.largePhotoImage=e("largePhoto-image"),this.largePhotoBBox=e("largePhoto-bbox"),this.robotSelect=e("robotSelect"),this.deleteButton=e("deleteButton"),this.addButton=e("addButton"),this.startButton=e("startButton"),this.pauseButton=e("pauseButton"),this.stopButton=e("stopButton"),this.dockButton=e("dockButton"),this.goToButton=e("goToButton"),this.resetZoomButton=e("resetZoomButton")}setupD3(){this.svgContainer=_("#mapSvgContainer"),this.svg=_("#mapSvg"),this.mainGroup=this.svg.append("g").attr("class","main-group"),this.mapImageElement=this.mainGroup.append("image").attr("class","map-image"),this.carpetGroup=this.mainGroup.append("g").attr("class","carpet"),this.mopPathGroup=this.mainGroup.append("g").attr("class","mop-paths").style("opacity",.18),this.pathGroup=this.mainGroup.append("g").attr("class","paths").style("opacity",.5),this.backwashPathGroup=this.mainGroup.append("g").attr("class","backwash-paths").style("opacity",.2),this.pureCleanPathGroup=this.mainGroup.append("g").attr("class","pure-clean-paths"),this.chargerGroup=this.mainGroup.append("g").attr("class","charger"),this.obstacleGroup=this.mainGroup.append("g").attr("class","obstacles"),this.zoneGroup=this.mainGroup.append("g").attr("class","zones"),this.robotGroup=this.mainGroup.append("g").attr("class","robot"),this.pinGroup=this.mainGroup.append("g").attr("class","pins"),this.roomNameGroup=this.mainGroup.append("g").attr("class","room-names"),this.pinGroup.append("image").attr("class","goto-pin").attr("href",Hr).attr("width",29).attr("height",24).style("opacity",0).style("display","none").style("pointer-events","none"),this.zoom=be().scaleExtent([this.minZoom,this.maxZoom]).on("zoom",e=>this.handleZoom(e)),this.svgContainer.call(this.zoom)}setupConnection(){let e=this.getQueryParam("instance");if(e===null){document.body.innerHTML="<h1>Error: No instance specified in URL.</h1>";return}this.instanceId=`roborock.${e}`;let n={onConnChange:async i=>{i&&this.fetchRobotList()},onUpdate:(i,a)=>{this.onStateChange&&this.onStateChange(i,a)},onError:i=>{console.error("Connection error:",i)}},r=`${window.location.protocol}//${window.location.hostname}:${window.location.port}`;this.connection.init({name:this.instanceId,connLink:r},n,!0)}fetchRobotList(){let e=`${this.instanceId}.Devices.`,n=`${this.instanceId}.Devices.\u9999`;this.connection.getObjectView("system","device",{startkey:e,endkey:n}).then(r=>{let i=[];if(r&&r.rows&&r.rows.forEach(o=>{let s=o.id.split("."),l=s[s.length-1],u=o.value&&o.value.common&&o.value.common.name?o.value.common.name:l,c=o.value?.native?.model||o.value?.native?.deviceInfo?.model||null;l&&(i.push({duid:l,name:u}),c&&(this.robotModels[l]=c))}),i.length===0){let o=this.getQueryParam("instance");if(o){this.robotSelect.innerHTML="";let s=document.createElement("option");s.value=o,s.text=`Roborock (Instance ${o})`,this.robotSelect.appendChild(s),this.currentRobotDuid=o,this.setupSocketListeners(o)}return}if(this.robotSelect.innerHTML="",i.forEach(o=>{let s=document.createElement("option");s.value=o.duid,s.text=o.name,this.robotSelect.appendChild(s)}),i.length>0){let o=i[0].duid;this.currentRobotDuid=o,this.robotSelect.value=o,this.setupSocketListeners(o)}let a=`${this.instanceId}.HomeData`;this.connection.getStates([a]).then(o=>{let s=o[a];if(s&&s.val)try{let l=typeof s.val=="string"?JSON.parse(s.val):s.val,u={};l.products&&l.products.forEach(p=>{p.id&&p.model&&(u[p.id]=p.model)});let c=p=>{p&&p.forEach(f=>{f.duid&&f.productId&&u[f.productId]&&(this.robotModels[f.duid]=u[f.productId])})};c(l.devices),c(l.receivedDevices),this.currentRobotDuid&&this.robotModels[this.currentRobotDuid]&&(this.model=this.robotModels[this.currentRobotDuid],this.map&&this.map.OBSTACLES2&&this.drawObstacles(this.map.OBSTACLES2))}catch(l){console.error("Failed to parse HomeData:",l)}})}).catch(r=>console.error("Error fetching robot list:",r))}setupSocketListeners(e){this.onStateChange&&this.currentMapSubscriptions.length>0&&(this.currentMapSubscriptions.forEach(i=>{this.connection.unsubscribeState(i)}),this.currentMapSubscriptions=[]),this.map=void 0,this.mapImage=void 0,this.mapImageElement.attr("href",null),this.carpetGroup.selectAll("*").remove(),this.obstacleGroup.selectAll("*").remove(),this.pinGroup.select("image.goto-pin").style("display","none").style("opacity",0),this.robotGroup.selectAll("*").remove(),this.chargerGroup.selectAll("*").remove(),this.roomNameGroup.selectAll("*").remove(),this.pathGroup.selectAll("*").remove(),this.mopPathGroup.selectAll("*").remove(),this.backwashPathGroup.selectAll("*").remove(),this.pureCleanPathGroup.selectAll("*").remove(),this.rects=[],this.drawZones(),this.deleteButton.disabled=!0,this.addButton.disabled=!1;let n=`${this.instanceId}.Devices.${e}.map.mapBase64Clean`,r=`${this.instanceId}.Devices.${e}.map.mapData`;this.currentMapSubscriptions=[n,r],this.onStateChange=(i,a)=>{if(!a||!a.val){i===n&&this.mapImageElement.attr("href",null),i===r&&(this.map=void 0,this.robotGroup.selectAll("*").remove());return}switch(i){case n:this.pinGroup.select("image.goto-pin").style("display","none").style("opacity",0),this.drawBackgroundImage(a.val);break;case r:try{this.map=typeof a.val=="string"?JSON.parse(a.val):a.val,this.map&&this.map.IMAGE&&(this.mapImage=this.map.IMAGE,this.updateMapImageSize(),this.drawRobotAndCharger(this.map.ROBOT_POSITION,this.map.CHARGER_LOCATION),this.drawPaths(this.map.PATH,this.map.MOP_PATH),this.drawObstacles(this.map.OBSTACLES2),this.drawRoomNames(this.map.IMAGE.segments.list),this.drawCarpet(this.map.CARPET_MAP))}catch(o){console.error("Failed to parse map data JSON:",a.val,o)}break}},this.connection.subscribeState(n),this.connection.subscribeState(r),this.connection.getStates([n,r]).then(i=>{this.onStateChange&&(this.robotModels[e]&&(this.model=this.robotModels[e]),this.onStateChange(n,i[n]),this.onStateChange(r,i[r]))})}updateMapImageSize(){if(!this.image.naturalWidth||!this.image.naturalHeight)return;let e=this.image.naturalWidth,n=this.image.naturalHeight;this.mapImageElement.attr("href",this.image.src).attr("width",e).attr("height",n).attr("transform",null).style("image-rendering","pixelated")}drawBackgroundImage(e){if(!e){this.mapImageElement.attr("href",null);return}this.image.src=e,this.image.onload=()=>{let n=document.createElement("canvas"),r=n.getContext("2d",{willReadFrequently:!0});if(!r)return;n.width=this.image.width,n.height=this.image.height,r.imageSmoothingEnabled=!1,r.drawImage(this.image,0,0);let i=0;this.mapMaxY=0,this.mapMinX=this.image.width,this.mapMinY=this.image.height;let o=r.getImageData(0,0,this.image.width,this.image.height).data;for(let g=0;g<o.length;g+=4)if(o[g+3]>50){let w=g/4%this.image.width,S=Math.floor(g/4/this.image.width);w<this.mapMinX&&(this.mapMinX=w),w>i&&(i=w),S<this.mapMinY&&(this.mapMinY=S),S>this.mapMaxY&&(this.mapMaxY=S)}this.mapMinX>i&&(this.mapMinX=0,i=this.image.width,this.mapMinY=0,this.mapMaxY=this.image.height),this.mapSizeX=i-this.mapMinX,this.mapSizeY=this.mapMaxY-this.mapMinY,this.mapSizeX<=0&&(this.mapSizeX=this.image.width),this.mapSizeY<=0&&(this.mapSizeY=this.image.height),this.updateMapImageSize(),this.carpetGroup.attr("transform",null);let s=parseFloat(this.svg.attr("width"))||800,l=parseFloat(this.svg.attr("height"))||600,u=s/l;this.mapSizeX/this.mapSizeY>u?this.zoomLevel=this.roundTwoDecimals(s*.95/this.mapSizeX):this.zoomLevel=this.roundTwoDecimals(l*.95/this.mapSizeY),this.zoomLevel<.1&&(this.zoomLevel=.1);let p=this.mapMinX+this.mapSizeX/2,f=this.mapMinY+this.mapSizeY/2;this.initialTransform=Ct.translate(s/2,l/2).scale(this.zoomLevel).translate(-p,-f),this.svgContainer.call(this.zoom.transform,this.initialTransform),this.map&&(this.drawRobotAndCharger(this.map.ROBOT_POSITION,this.map.CHARGER_LOCATION),this.drawPaths(this.map.PATH,this.map.MOP_PATH),this.drawObstacles(this.map.OBSTACLES2),this.drawRoomNames(this.map.IMAGE.segments.list),this.drawCarpet(this.map.CARPET_MAP))}}drawRobotAndCharger(e,n){if(this.robotGroup.selectAll("image.robot").remove(),this.chargerGroup.selectAll("image.charger").remove(),!e&&!n)return;let r=this.getMapParams();if(!r)return;let i=this.rescaler.chargerSize(),a=this.rescaler.robotSize(),o=n?[n]:[],s=this.chargerGroup.selectAll("image.charger").data(o);s.exit().remove(),s.enter().append("image").attr("class","charger").attr("href",Lr).merge(s).attr("width",i).attr("height",i).attr("x",c=>this.robotToSvg({x:c.position[0],y:c.position[1]},r).x-i/2).attr("y",c=>this.robotToSvg({x:c.position[0],y:c.position[1]},r).y-i/2);let l=e?[e]:[],u=this.robotGroup.selectAll("image.robot").data(l);u.exit().remove(),u.enter().append("image").attr("class","robot").attr("href",Yr).merge(u).attr("width",a).attr("height",a).attr("transform",c=>{let p=this.robotToSvg({x:c.position[0],y:c.position[1]},r),f=-(c.angle??0)+90;return`translate(${p.x}, ${p.y}) rotate(${f}) translate(${-a/2}, ${-a/2})`})}drawRoomNames(e){let n=this.getMapParams();if(!n||!e){this.roomNameGroup.selectAll("text.room-name").remove();return}let r=12,i=2.5,a=this.roomNameGroup.selectAll("text.room-name").data(e,o=>o.id);a.exit().remove(),a.enter().append("text").attr("class","room-name").attr("text-anchor","middle").attr("dominant-baseline","middle").style("fill","#000").style("stroke","white").style("pointer-events","none").style("font-weight","900").style("font-size",`${r}px`).style("stroke-width",`${i}px`).style("paint-order","stroke").attr("shape-rendering","geometricPrecision").merge(a).text(o=>o.name).attr("x",o=>o.center&&typeof o.center[0]=="number"&&!isNaN(o.center[0])?this.robotToSvg({x:o.center[0],y:o.center[1]},n).x:-1e3).attr("y",o=>o.center&&typeof o.center[1]=="number"&&!isNaN(o.center[1])?this.robotToSvg({x:o.center[0],y:o.center[1]},n).y:-1e3)}drawPaths(e,n){let r=this.getMapParams();if(!r||!e?.points||!n){this.pathGroup.selectAll("*").remove(),this.mopPathGroup.selectAll("*").remove(),this.backwashPathGroup.selectAll("*").remove(),this.pureCleanPathGroup.selectAll("*").remove();return}let i=j,a=Dr(e.points,n,(g,y)=>this.robotToSvg({x:g[0],y:g[1]},y),i,r),o=this.rescaler.pathMopWidth(),s=this.rescaler.pathMainWidth(),l=this.rescaler.pathBackwashWidth(),u=this.pathGroup.selectAll("path.main-path").data(a.mainPathD?[a.mainPathD]:[]);u.exit().remove(),u.enter().append("path").attr("class","main-path").merge(u).attr("d",g=>g).style("fill","none").style("stroke","rgba(255,255,255,1.0)").style("stroke-width",`${s}px`).style("stroke-linecap","round").style("stroke-linejoin","round");let c=this.backwashPathGroup.selectAll("path.backwash-path").data(a.backwashPathD?[a.backwashPathD]:[]);c.exit().remove(),c.enter().append("path").attr("class","backwash-path").merge(c).attr("d",g=>g).style("fill","none").style("stroke","rgba(255,255,255,1.0)").style("stroke-width",`${l}px`).style("stroke-dasharray","4, 8").style("stroke-linecap","round").style("stroke-linejoin","round");let p=this.pureCleanPathGroup.selectAll("path.pure-clean-path").data(a.pureCleanPathD?[a.pureCleanPathD]:[]);p.exit().remove(),p.enter().append("path").attr("class","pure-clean-path").merge(p).attr("d",g=>g).style("fill","none").style("stroke","rgba(255,255,255,1.0)").style("stroke-width",`${l}px`).style("stroke-linecap","round").style("stroke-linejoin","round");let f=this.mopPathGroup.selectAll("path.mop-path").data(a.mopPathD?[a.mopPathD]:[]);f.exit().remove(),f.enter().append("path").attr("class","mop-path").merge(f).attr("d",g=>g).style("fill","none").style("stroke","rgba(255,255,255,1.0)").style("stroke-width",`${o}px`).style("stroke-linecap","round").style("stroke-linejoin","round")}drawObstacles(e){let n=this.getMapParams();if(!n||!e){this.obstacleGroup.selectAll(".obstacle-group").remove();return}let r=this.rescaler.scale()*et.OBSTACLE_RADIUS_BASE,i=r*1.1,a=r*1.8,o=this.obstacleGroup.selectAll(".obstacle-group").data(e);o.exit().remove();let s=o.enter().append("g").attr("class","obstacle-group").style("cursor","default").on("click",(u,c)=>{if(!this.currentRobotDuid)return;u.stopPropagation(),this.selectedObstacleID=c[6];let p={x:c[0],y:c[1]},f=Fe(p,n);this.popupX=f.x,this.popupY=f.y,this.popupTimeout&&clearTimeout(this.popupTimeout),this.connection.sendTo(this.instanceId,"get_obstacle_image",{obstacleId:this.selectedObstacleID,duid:this.currentRobotDuid,type:1}).then(g=>{if(g&&g.image){let y=g.image;typeof y=="string"&&!y.startsWith("data:image/")&&(y="data:image/png;base64,"+y),this.popupImage.src=y,this.popup.style.display="block",this.triangle.style.display="block",this.updatePopupPosition(),this.popupTimeout=window.setTimeout(()=>{this.popup.style.display="none",this.triangle.style.display="none",this.popupTimeout=null},3e3)}else g&&g.data&&g.version}).catch(g=>console.error("Error getting obstacle image:",g)),this.updatePopupPosition()});s.append("circle").attr("class","obstacle-bg").attr("r",i).attr("fill","rgba(100, 100, 100, 0.2)").attr("stroke","white").attr("stroke-width",.5),s.append("image").attr("class","obstacle-icon").attr("width",a).attr("height",a).attr("x",-a/2).attr("y",-a/2).on("error",function(){_(this).attr("href","assets/default/drawable-mdpi/projects_comroborocktanos_resources_obstacle_new_p18.png")});let l=s.merge(o);l.attr("transform",u=>{let c=this.robotToSvg({x:u[0]+25,y:u[1]+25},n);return`translate(${c.x}, ${c.y})`}),l.select("image").attr("href",u=>{let c=u[2],p=ua[c]||"18";return`assets/${this.model||"default"}/drawable-mdpi/projects_comroborocktanos_resources_obstacle_new_p${p}.png`})}drawCarpet(e){if(!e||!this.mapImage||!this.mapImage.dimensions){this.carpetGroup.selectAll("*").remove();return}let n=this.mapImage.dimensions.width,r=this.mapImage.dimensions.height,i=3,a=[],o=0,s=0;e.forEach(c=>{let p=c%n,f=Math.floor(c/n),g=r-f-1,y=p*j+o,w=g*j+s;for(let S=0;S<j;S++)for(let C=0;C<j;C++)(S+C)%i===2&&a.push(`M${y+S} ${w+C}h1v1h-1z`)});let l=a.join(""),u=this.carpetGroup.selectAll("path.carpet-path").data([l]);u.exit().remove(),u.enter().append("path").attr("class","carpet-path").style("fill","rgba(0, 0, 0, 0.4)").attr("shape-rendering","crispEdges").merge(u).attr("d",c=>c)}drawZones(){let e=$t().on("start",o=>{let s=o.sourceEvent.target.closest("g.zone");s&&_(s).raise().style("cursor","grabbing"),this.deleteButton.disabled=!1}).on("drag",(o,s)=>{if(!this.mapImage)return;let l=this.mapMinX,u=this.mapMinY,c=this.mapMinX+this.mapSizeX,p=this.mapMinY+this.mapSizeY,f=Math.max(l,s.x+o.dx),g=Math.max(u,s.y+o.dy);f+s.width>c&&(f=c-s.width),g+s.height>p&&(g=p-s.height),s.x=f,s.y=g;let y=o.sourceEvent.target.closest("g.zone");y&&_(y).attr("transform",`translate(${s.x}, ${s.y})`)}).on("end",o=>{let s=o.sourceEvent.target.closest("g.zone");s&&_(s).style("cursor","move"),this.updateRobotZones()}),n=$t().on("start",o=>{o.sourceEvent.stopPropagation();let s=o.sourceEvent.target;s&&_(s).raise()}).on("drag",(o,s)=>{if(!this.mapImage)return;let l=this.mapMinX+this.mapSizeX,u=this.mapMinY+this.mapSizeY,c=Math.max(s.width+o.dx,20),p=Math.max(s.height+o.dy,20);s.x+c>l&&(c=l-s.x),s.y+p>u&&(p=u-s.y),s.width=c,s.height=p;let f=o.sourceEvent.target;if(f){let g=_(f.parentNode);g.select("rect").attr("width",s.width).attr("height",s.height),g.select("circle.zone-handle").attr("cx",s.width).attr("cy",s.height)}}).on("end",()=>this.updateRobotZones()),r=this.zoneGroup.selectAll("g.zone").data(this.rects,o=>o.id);r.exit().remove();let i=r.enter().append("g").attr("class","zone").call(e);i.append("rect").attr("class","zone-rect").attr("x",0).attr("y",0).style("stroke-width",this.rescaler.zoneStrokeWidth()),i.append("circle").attr("class","zone-handle").attr("r",this.rescaler.zoneHandleRadius()).call(n);let a=r.merge(i);a.attr("transform",o=>`translate(${o.x}, ${o.y})`),a.select("rect").attr("width",o=>o.width).attr("height",o=>o.height).style("stroke-width",this.rescaler.zoneStrokeWidth()),a.select("circle.zone-handle").attr("cx",o=>o.width).attr("cy",o=>o.height).attr("r",this.rescaler.zoneHandleRadius())}updateRobotZones(){let e=this.getMapParams();if(!e)return;let n=document.getElementById("cleanCount");this.zones=[];let r=parseInt(n.value)||1;for(let i of this.rects){let a={x:i.x,y:i.y},o={x:i.x+i.width,y:i.y+i.height},s=xe(a,e),l=xe(o,e);this.zones.push([Math.min(s.x,l.x),Math.min(s.y,l.y),Math.max(s.x,l.x),Math.max(s.y,l.y),r])}}updatePopupPosition(){if(this.popup.style.display==="block"&&this.popupX!==void 0&&this.popupY!==void 0){let e=yt(this.svgContainer.node()),n=this.worldToSvgCoords(this.popupX,this.popupY),r=e.apply([n.x,n.y]);this.popup.style.left=`${r[0]}px`,this.popup.style.top=`${r[1]}px`}}handleZoom(e){let n=e.transform;this.mainGroup.attr("transform",n),this.wheelZoom=n.k,this.zoneGroup.selectAll("rect.zone-rect").style("stroke-width",this.rescaler.zoneStrokeWidth()),this.zoneGroup.selectAll("circle.zone-handle").attr("r",this.rescaler.zoneHandleRadius());let r=this.rescaler.robotSize();this.robotGroup.selectAll("image.robot").attr("width",r).attr("height",r).attr("transform",l=>{let u=this.getMapParams();if(!u)return"";let c=this.robotToSvg({x:l.position[0],y:l.position[1]},u),p=-(l.angle??0)+90;return`translate(${c.x}, ${c.y}) rotate(${p}) translate(${-r/2}, ${-r/2})`});let i=this.rescaler.chargerSize();this.chargerGroup.selectAll("image.charger").attr("width",i).attr("height",i).attr("x",l=>{let u=this.getMapParams();return u?this.robotToSvg({x:l.position[0],y:l.position[1]},u).x-i/2:0}).attr("y",l=>{let u=this.getMapParams();return u?this.robotToSvg({x:l.position[0],y:l.position[1]},u).y-i/2:0}),this.pathGroup.selectAll("path.main-path").style("stroke-width",`${this.rescaler.pathMainWidth()}px`),this.backwashPathGroup.selectAll("path.backwash-path").style("stroke-width",`${this.rescaler.pathBackwashWidth()}px`),this.mopPathGroup.selectAll("path.mop-path").style("stroke-width",`${this.rescaler.pathMopWidth()}px`),this.pureCleanPathGroup.selectAll("path.pure-clean-path").style("stroke-width",`${this.rescaler.pathBackwashWidth()}px`);let a=this.rescaler.pinWidth(),o=this.rescaler.pinHeight(),s=this.rescaler.pinYOffset();this.pinGroup.selectAll("image.goto-pin").attr("width",a).attr("height",o).attr("x",function(){let l=_(this).attr("data-center-x");return(parseFloat(l)||0)-a/2}).attr("y",function(){let l=_(this).attr("data-center-y");return(parseFloat(l)||0)-(o-s)}),this.updatePopupPosition()}getMapParams(){return!this.mapImage||!this.mapImage.dimensions||this.mapMaxY===void 0?null:{scaleFactor:j,left:this.mapImage.position.left,topMap:this.mapImage.position.top,mapMaxY:this.mapMaxY,imageHeight:this.mapImage.dimensions.height,imageWidth:this.mapImage.dimensions.width}}screenToWorldCoords(e,n){if(this.mapMinX===void 0||this.mapMinY===void 0)return{x:0,y:0};let i=yt(this.svgContainer.node()).invert([e,n]);return{x:i[0],y:i[1]}}worldToSvgCoords(e,n){return{x:e,y:n}}robotToSvg(e,n){let r=Fe(e,n);return this.worldToSvgCoords(r.x,r.y)}roundTwoDecimals(e){return Math.round(e*100)/100}getQueryParam(e){return new URLSearchParams(window.location.search).get(e)}bindUiEvents(){this.robotSelect.addEventListener("change",()=>{let e=this.robotSelect.value;e&&e!==this.currentRobotDuid&&(this.currentRobotDuid=e,this.setupSocketListeners(e))}),this.deleteButton.addEventListener("click",()=>{this.rects.length>0&&(this.rects.pop(),this.drawZones(),this.rects.length<5&&(this.addButton.disabled=!1),this.rects.length<1&&(this.deleteButton.disabled=!0))}),this.addButton.addEventListener("click",()=>{if(this.goToTarget){this.goToTarget=!1,this.svg.style("cursor","grab"),this.svgContainer.on("mousemove.gototarget",null),this.svgContainer.on("click.gototarget",null),this.pinGroup.select("image.goto-pin").style("display","none").style("opacity",0),this.goToButton.textContent="GoTo Point";return}let e=parseFloat(this.svg.attr("width")),n=parseFloat(this.svg.attr("height")),r=this.screenToWorldCoords(e/2,n/2),i=this.getMapParams();i&&(this.rects.push({id:this.rectCounter++,x:r.x-25*i.scaleFactor,y:r.y-25*i.scaleFactor,width:50*i.scaleFactor,height:50*i.scaleFactor}),this.drawZones(),this.rects.length>0&&(this.deleteButton.disabled=!1),this.rects.length>4&&(this.addButton.disabled=!0),this.updateRobotZones())}),this.startButton.addEventListener("click",()=>{if(!this.currentRobotDuid)return;this.updateRobotZones();let e=this.zones.length>0?"app_zoned_clean":"app_start",n=this.zones.length>0?{zones:this.zones,duid:this.currentRobotDuid}:{duid:this.currentRobotDuid};this.connection.sendTo(this.instanceId,e,n).catch(r=>console.error("Error sending command:",r)),this.rects=[],this.drawZones(),this.deleteButton.disabled=!0,this.addButton.disabled=!1,this.startButton.style.display="none",this.pauseButton.style.display="inline-block"}),this.pauseButton.addEventListener("click",()=>{this.currentRobotDuid&&(this.connection.sendTo(this.instanceId,"app_pause",{duid:this.currentRobotDuid}),this.startButton.style.display="inline-block",this.pauseButton.style.display="none")}),this.stopButton.addEventListener("click",()=>{this.currentRobotDuid&&(this.connection.sendTo(this.instanceId,"app_stop",{duid:this.currentRobotDuid}),this.startButton.style.display="inline-block",this.pauseButton.style.display="none")}),this.dockButton.addEventListener("click",()=>{this.currentRobotDuid&&this.connection.sendTo(this.instanceId,"app_charge",{duid:this.currentRobotDuid})}),this.goToButton.addEventListener("click",()=>{if(this.goToTarget){this.goToTarget=!1,this.svg.style("cursor","grab"),this.svgContainer.on("mousemove.gototarget",null),this.svgContainer.on("click.gototarget",null),this.pinGroup.select("image.goto-pin").style("display","none").style("opacity",0),this.goToButton.textContent="GoTo Point";return}this.goToTarget=!0,this.svg.style("cursor","none"),this.goToButton.textContent="Cancel";let e=yt(this.svgContainer.node()),n=parseFloat(this.svg.attr("width")),r=parseFloat(this.svg.attr("height")),[i,a]=e.invert([n/2,r/2]),o=this.rescaler.pinWidth(),s=this.rescaler.pinHeight(),l=this.rescaler.pinYOffset(),u=this.pinGroup.select("image.goto-pin");u.style("display","block").style("opacity",.7).attr("data-center-x",i).attr("data-center-y",a).attr("x",i-o/2).attr("y",a-(s-l)),this.svgContainer.on("mousemove.gototarget",c=>{let[p,f]=Y(c,this.mainGroup.node()),g=this.rescaler.pinWidth(),y=this.rescaler.pinHeight(),w=this.rescaler.pinYOffset();u.attr("data-center-x",p).attr("data-center-y",f).attr("x",p-g/2).attr("y",f-(y-w))}),this.svgContainer.on("click.gototarget",c=>{c.stopImmediatePropagation();let p=this.getMapParams();if(!this.currentRobotDuid||!p)return;let[f,g]=Y(c,this.mainGroup.node()),S=xe({x:f,y:g},p);this.connection.sendTo(this.instanceId,"app_goto_target",{points:[S.x,S.y],duid:this.currentRobotDuid}),u.style("opacity",1),this.goToTarget=!1,this.svg.style("cursor","grab"),this.svgContainer.on("mousemove.gototarget",null),this.svgContainer.on("click.gototarget",null),this.goToButton.textContent="GoTo Point"})}),this.resetZoomButton.addEventListener("click",()=>{this.initialTransform&&this.svgContainer.transition().duration(750).call(this.zoom.transform,this.initialTransform)}),this.popupImage.addEventListener("click",()=>{this.largePhoto.style.display="block",this.popup.style.display="none",this.triangle.style.display="none",this.popupTimeout&&clearTimeout(this.popupTimeout),this.popupTimeout=null,!(!this.currentRobotDuid||!this.selectedObstacleID)&&(this.largePhotoImage.src="",this.largePhotoBBox.style.display="none",this.connection.sendTo(this.instanceId,"get_obstacle_image",{obstacleId:this.selectedObstacleID,duid:this.currentRobotDuid,type:0}).then(e=>{if(e&&e.image){let n=e.image;typeof n=="string"&&!n.startsWith("data:image/")&&(n="data:image/png;base64,"+n),this.largePhotoImage.onload=()=>{if(e.bbox){let r=e.bbox,i=this.largePhotoImage.clientWidth,a=this.largePhotoImage.clientHeight;if(r.imageWidth>0&&r.imageHeight>0){let o=i/r.imageWidth,s=a/r.imageHeight;this.largePhotoBBox.style.left=r.x*o+"px",this.largePhotoBBox.style.top=r.y*s+"px",this.largePhotoBBox.style.width=r.w*o+"px",this.largePhotoBBox.style.height=r.h*s+"px",this.largePhotoBBox.style.display="block"}}},this.largePhotoImage.src=n.replace(/\s/g,"")}}).catch(e=>console.error("Error getting large obstacle image:",e)))}),this.largePhoto.addEventListener("click",()=>{this.largePhoto.style.display="none"})}get rescaler(){return{scale:()=>j,robotSize:()=>j*et.ROBOT_SIZE_BASE,chargerSize:()=>j*et.CHARGER_SIZE_BASE,zoneStrokeWidth:()=>et.ZONE_STROKE_BASE/this.wheelZoom,zoneHandleRadius:()=>et.ZONE_HANDLE_RADIUS_BASE/this.wheelZoom,pinWidth:()=>et.PIN_WIDTH_BASE/this.wheelZoom,pinHeight:()=>et.PIN_HEIGHT_BASE/this.wheelZoom,pinYOffset:()=>et.PIN_Y_OFFSET_BASE/this.wheelZoom,pathMopWidth:()=>et.PATH_MOP_WIDTH_BASE*j,pathMainWidth:()=>Math.max(1,j*et.PATH_MAIN_WIDTH_RATIO_BASE),pathBackwashWidth:()=>et.PATH_BACKWASH_WIDTH_BASE*j}}};window.onload=async()=>{new Ue().init().catch(e=>console.error("Failed to initialize Map Application:",e))};
//# sourceMappingURL=map.js.map
