{"version":3,"file":"coords.js","sourceRoot":"","sources":["../src/www/coords.ts"],"names":[],"mappings":"AAAA,oBAAoB;AAEpB,wDAAwD;AACxD,MAAM,YAAY,GAAG,EAAE,CAAC;AAexB;;;GAGG;AACH,MAAM,UAAU,wBAAwB,CAAC,UAAiB,EAAE,MAAiB;IAC5E,IAAI,CAAC,MAAM;QAAE,OAAO,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC;IAEnC,6CAA6C;IAC7C,MAAM,MAAM,GAAG,IAAI,CAAC,KAAK,CAAC,CAAC,UAAU,CAAC,CAAC,GAAG,MAAM,CAAC,WAAW,GAAG,MAAM,CAAC,IAAI,CAAC,GAAG,YAAY,CAAC,CAAC;IAE5F,iEAAiE;IACjE,MAAM,MAAM,GAAG,IAAI,CAAC,KAAK,CAAC,CAAC,MAAM,CAAC,WAAW,GAAG,MAAM,CAAC,WAAW,GAAG,MAAM,CAAC,MAAM,GAAG,UAAU,CAAC,CAAC,GAAG,MAAM,CAAC,WAAW,CAAC,GAAG,YAAY,CAAC,CAAC;IAExI,OAAO,EAAE,CAAC,EAAE,MAAM,EAAE,CAAC,EAAE,MAAM,EAAE,CAAC;AACjC,CAAC;AAED;;;GAGG;AACH,MAAM,UAAU,wBAAwB,CAAC,UAAiB,EAAE,MAAiB;IAC5E,IAAI,CAAC,MAAM;QAAE,OAAO,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC;IAEnC,wCAAwC;IACxC,MAAM,MAAM,GAAG,CAAC,UAAU,CAAC,CAAC,GAAG,YAAY,GAAG,MAAM,CAAC,IAAI,CAAC,GAAG,MAAM,CAAC,WAAW,CAAC;IAEhF,mEAAmE;IACnE,MAAM,MAAM,GAAG,CAAC,MAAM,CAAC,WAAW,GAAG,MAAM,CAAC,WAAW,GAAG,MAAM,CAAC,MAAM,GAAG,UAAU,CAAC,CAAC,GAAG,YAAY,CAAC,GAAG,MAAM,CAAC,WAAW,CAAC;IAE5H,OAAO,EAAE,CAAC,EAAE,MAAM,EAAE,CAAC,EAAE,MAAM,EAAE,CAAC;AACjC,CAAC","sourcesContent":["// src/www/coords.ts\r\n\r\n// The true physical scale (50mm/pixel) used by Roborock\r\nconst MM_PER_PIXEL = 50;\r\n\r\ninterface Point {\r\n\tx: number;\r\n\ty: number;\r\n}\r\n\r\n// Map parameters required for the calculations\r\ninterface MapParams {\r\n\tscaleFactor: number; // Config scale (e.g., 8) - used for visual scaling only\r\n\tleft: number; // Unscaled Pixel Offset X\r\n\ttopMap: number; // Unscaled Pixel Offset Y\r\n\timageHeight: number; // Unscaled Pixel Height\r\n}\r\n\r\n/**\r\n * Converts LOCAL \"world\" pixel coordinates (px, Y-down) back to ROBOT coordinates (mm).\r\n * Used for Click-Tests, GoTo, and Zones.\r\n */\r\nexport function localCoordsToRobotCoords(localPoint: Point, params: MapParams): Point {\r\n\tif (!params) return { x: 0, y: 0 };\r\n\r\n\t// X-Axis: (Unscaled Pixel X + Offset X) * 50\r\n\tconst robotX = Math.round((localPoint.x / params.scaleFactor + params.left) * MM_PER_PIXEL);\r\n\r\n\t// Y-Axis (Inverted Logic): ((H_px / s) + top_px - Y_px / s) * 50\r\n\tconst robotY = Math.round((params.imageHeight / params.scaleFactor + params.topMap - localPoint.y / params.scaleFactor) * MM_PER_PIXEL);\r\n\r\n\treturn { x: robotX, y: robotY };\r\n}\r\n\r\n/**\r\n * Converts ROBOT coordinates (mm) to LOCAL \"world\" pixel coordinates (px, Y-down).\r\n * This is used to DRAW things on the map.\r\n */\r\nexport function robotCoordsToLocalCoords(robotPoint: Point, params: MapParams): Point {\r\n\tif (!params) return { x: 0, y: 0 };\r\n\r\n\t// X-Axis: (mm / 50 - Offset px) * scale\r\n\tconst worldX = (robotPoint.x / MM_PER_PIXEL - params.left) * params.scaleFactor;\r\n\r\n\t// Y-Axis (Inverted Logic): ((H_px / s) + top_px - Y_mm/50) * scale\r\n\tconst worldY = (params.imageHeight / params.scaleFactor + params.topMap - robotPoint.y / MM_PER_PIXEL) * params.scaleFactor;\r\n\r\n\treturn { x: worldX, y: worldY };\r\n}\r\n"]}