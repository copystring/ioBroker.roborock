{"version":3,"file":"conn.js","sourceRoot":"","sources":["../src/www/conn.ts"],"names":[],"mappings":"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","sourcesContent":["//\r\n// conn.ts\r\n//\r\n\"use strict\";\r\n\r\n/* jshint browser:true */\r\n/* global document, console, session, window, location, setTimeout, clearTimeout, io, $, socketNamespace, socketUrl, socketSession, storage, socketForceWebSockets, app */\r\n/* jshint -W097 */ // jshint strict:false\r\n\r\n// Globale Variablen aus den <script>-Tags deklarieren, damit TypeScript sie kennt\r\ndeclare var io: any; // Besser: npm install @types/socket.io-client\r\ndeclare var $: any; // Besser: npm install @types/jquery\r\ndeclare var session: { get: (key: string) => any };\r\ndeclare var storage: { get: (key: string) => any; set: (key: string, val: any) => void; empty: () => void };\r\ndeclare var socketNamespace: string | undefined;\r\ndeclare var socketUrl: string | undefined;\r\ndeclare var socketSession: string | undefined;\r\ndeclare var socketForceWebSockets: boolean | undefined;\r\ndeclare var app: {\r\n\tonConnChange: (isConnected: boolean) => void;\r\n\treadLocalFile: (filename: string, callback: (err: any, data: string | null, mimeType?: string) => void) => void;\r\n};\r\n\r\n// --- TypeScript-Interfaces ---\r\n\r\ninterface ConnOptions {\r\n\tname?: string;\r\n\tconnLink?: string;\r\n\tsocketSession?: string;\r\n\tsocketForceWebSockets?: boolean;\r\n\tmayReconnect?: () => boolean;\r\n}\r\n\r\ninterface ConnCallbacks {\r\n\tonConnChange?: (isConnected: boolean) => void;\r\n\tonUpdate?: (id: string, state: any) => void; // ioBroker.State\r\n\tonRefresh?: ((...args: any[]) => any) | null;\r\n\tonAuth?: ((...args: any[]) => any) | null;\r\n\tonCommand?: (instance: string, command: string, data: any) => any;\r\n\tonError?: (err: any) => void;\r\n\tonObjectChange?: (id: string, obj: any) => void;\r\n}\r\n\r\n/**\r\n * Moderne, klassenbasierte und Promise-basierte Version von servConn.\r\n */\r\nexport class Connection {\r\n\t// Private Eigenschaften\r\n\tprivate _socket: any = null; // Typ SocketIOClient.Socket\r\n\tprivate _isConnected: boolean = false;\r\n\tprivate _disconnectedSince: number | null = null;\r\n\tprivate _connCallbacks: ConnCallbacks = {};\r\n\tprivate _isAuthDone: boolean = false;\r\n\tprivate _type: string = \"socket.io\";\r\n\tprivate _reconnectInterval: number = 10000;\r\n\tprivate _reloadInterval: number = 30;\r\n\tprivate _isSecure: boolean = false;\r\n\tprivate _defaultMode: number = 0x644;\r\n\tprivate _useStorage: boolean = false;\r\n\tprivate _objects: Record<string, any> | null = null;\r\n\tprivate _enums: Record<string, any> | null = null;\r\n\r\n\t// Auth-Promise: Methoden, die eine Auth erfordern, warten auf dieses Promise.\r\n\tprivate _authPromise: Promise<boolean> | null = null;\r\n\tprivate _resolveAuth: (value: boolean) => void = () => {};\r\n\tprivate _rejectAuth: (reason?: any) => void = () => {};\r\n\r\n\t// Öffentliche Eigenschaften\r\n\tpublic namespace: string = \"vis.0\";\r\n\tpublic user: string = \"\";\r\n\r\n\t// Interne Timer\r\n\tprivate _connectInterval: any = null;\r\n\tprivate _countInterval: any = null;\r\n\tprivate _timer: any = null;\r\n\tprivate _lastTimer: number = 0;\r\n\r\n\tconstructor(options?: { useStorage?: boolean }) {\r\n\t\tif (options?.useStorage) {\r\n\t\t\tthis._useStorage = true;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Initialisiert die Verbindung und startet den Authentifizierungsprozess.\r\n\t */\r\n\tpublic init(connOptions: ConnOptions, connCallbacks: ConnCallbacks, objectsRequired: boolean) {\r\n\t\tthis._connCallbacks = connCallbacks;\r\n\r\n\t\t// Das Promise erstellen, auf das alle API-Aufrufe warten\r\n\t\tthis._authPromise = new Promise((resolve, reject) => {\r\n\t\t\tthis._resolveAuth = resolve;\r\n\t\t\tthis._rejectAuth = reject;\r\n\t\t});\r\n\r\n\t\tif (typeof socketNamespace !== \"undefined\") {\r\n\t\t\tthis.namespace = socketNamespace;\r\n\t\t}\r\n\t\tconnOptions = connOptions || {};\r\n\t\tif (!connOptions.name) {\r\n\t\t\tconnOptions.name = this.namespace;\r\n\t\t}\r\n\r\n\t\t// --- Logik zur Bestimmung des Verbindungstyps (local vs. socket.io) ---\r\n\t\tif (document.URL.split(\"/local/\")[1] || (typeof socketUrl === \"undefined\" && !connOptions.connLink) || (typeof socketUrl !== \"undefined\" && socketUrl === \"local\")) {\r\n\t\t\tthis._type = \"local\";\r\n\t\t}\r\n\r\n\t\t// --- Verbindung herstellen ---\r\n\t\tif (this._type === \"local\") {\r\n\t\t\tthis._isConnected = true;\r\n\t\t\tthis._isAuthDone = true;\r\n\t\t\tif (this._connCallbacks.onConnChange) this._connCallbacks.onConnChange(true);\r\n\t\t\tif (typeof app !== \"undefined\") app.onConnChange(true);\r\n\t\t\tthis._resolveAuth(true); // Auth-Promise auflösen\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif (typeof io === \"undefined\") {\r\n\t\t\tconsole.error(\"socket.io not loaded!\");\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tlet connLink = connOptions.connLink || window.localStorage.getItem(\"connLink\");\r\n\t\tif (!connLink && typeof socketUrl !== \"undefined\") connLink = socketUrl;\r\n\r\n\t\tconnOptions.socketSession = connOptions.socketSession || (typeof socketSession !== \"undefined\" ? socketSession : \"nokey\");\r\n\r\n\t\tif (connOptions.socketForceWebSockets === undefined && typeof socketForceWebSockets !== \"undefined\") {\r\n\t\t\tconnOptions.socketForceWebSockets = socketForceWebSockets;\r\n\t\t}\r\n\r\n\t\tlet url: string;\r\n\t\tif (connLink) {\r\n\t\t\turl = connLink;\r\n\t\t\tif (connLink[0] === \":\") {\r\n\t\t\t\turl = `${location.protocol}//${location.hostname}${connLink}`;\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\turl = `${location.protocol}//${location.host}`;\r\n\t\t}\r\n\r\n\t\tthis._socket = io.connect(url, {\r\n\t\t\tquery: \"key=\" + connOptions.socketSession,\r\n\t\t\t\"reconnection limit\": 10000,\r\n\t\t\t\"max reconnection attempts\": Infinity,\r\n\t\t\treconnection: false,\r\n\t\t\tupgrade: !connOptions.socketForceWebSockets,\r\n\t\t\trememberUpgrade: connOptions.socketForceWebSockets,\r\n\t\t\ttransports: connOptions.socketForceWebSockets ? [\"websocket\"] : undefined,\r\n\t\t});\r\n\r\n\t\t// --- Socket-Listener registrieren ---\r\n\t\tthis._socket.on(\"connect\", () => this._onSocketConnect(connOptions, objectsRequired));\r\n\t\tthis._socket.on(\"reauthenticate\", () => this._onSocketReauthenticate());\r\n\t\tthis._socket.on(\"connect_error\", () => this._onSocketConnectError(connOptions));\r\n\t\tthis._socket.on(\"disconnect\", () => this._onSocketDisconnect(connOptions));\r\n\t\tthis._socket.on(\"reconnect\", () => this._onSocketReconnect());\r\n\t\tthis._socket.on(\"objectChange\", (id: string, obj: any) => this._onSocketObjectChange(id, obj));\r\n\t\tthis._socket.on(\"stateChange\", (id: string, state: any) => this._onSocketStateChange(id, state));\r\n\t\tthis._socket.on(\"permissionError\", (err: any) => this._onSocketPermissionError(err));\r\n\t}\r\n\r\n\t// --- Private Socket-Handler ---\r\n\r\n\tprivate _onSocketConnect(connOptions: ConnOptions, objectsRequired: boolean) {\r\n\t\tif (this._disconnectedSince) {\r\n\t\t\tconst offlineTime = new Date().getTime() - this._disconnectedSince;\r\n\t\t\tconsole.log(`was offline for ${offlineTime / 1000}s`);\r\n\t\t\tif (this._reloadInterval && offlineTime > this._reloadInterval * 1000) {\r\n\t\t\t\twindow.location.reload();\r\n\t\t\t}\r\n\t\t\tthis._disconnectedSince = null;\r\n\t\t}\r\n\r\n\t\tif (this._connectInterval) {\r\n\t\t\tclearInterval(this._connectInterval);\r\n\t\t\tthis._connectInterval = null;\r\n\t\t}\r\n\t\tif (this._countInterval) {\r\n\t\t\tclearInterval(this._countInterval);\r\n\t\t\tthis._countInterval = null;\r\n\t\t}\r\n\t\tconst elem = document.getElementById(\"server-disconnect\");\r\n\t\tif (elem) elem.style.display = \"none\";\r\n\r\n\t\tthis._socket.emit(\"name\", connOptions.name);\r\n\t\tconsole.log(new Date().toISOString() + \" Connected => authenticate\");\r\n\r\n\t\tconst wait = setTimeout(() => {\r\n\t\t\tconsole.error(\"No answer from server\");\r\n\t\t\twindow.location.reload();\r\n\t\t}, 3000);\r\n\r\n\t\tthis._socket.emit(\"authenticate\", (isOk: boolean, isSecure: boolean) => {\r\n\t\t\tclearTimeout(wait);\r\n\t\t\tconsole.log(new Date().toISOString() + \" Authenticated: \" + isOk);\r\n\t\t\tif (isOk) {\r\n\t\t\t\tthis._onAuth(objectsRequired, isSecure);\r\n\t\t\t} else {\r\n\t\t\t\tconsole.log(\"permissionError\");\r\n\t\t\t\tthis._rejectAuth(new Error(\"Permission Error\"));\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\tprivate _onAuth(objectsRequired: boolean, isSecure: boolean) {\r\n\t\t// *** DEIN WICHTIGER FIX ***\r\n\t\t// Setzt den Auth-Status, bevor Befehle verarbeitet werden.\r\n\t\tthis._isAuthDone = true;\r\n\r\n\t\tthis._isSecure = isSecure;\r\n\r\n\t\tif (this._isSecure) {\r\n\t\t\tthis._lastTimer = new Date().getTime();\r\n\t\t\tthis._monitor();\r\n\t\t}\r\n\r\n\t\tif (objectsRequired) this._socket.emit(\"subscribeObjects\", \"*\");\r\n\r\n\t\tif (this._isConnected === true) {\r\n\t\t\t// Verhindert doppeltes Feuern bei Reconnect\r\n\t\t\tthis._resolveAuth(true); // Auth-Promise trotzdem auflösen\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tthis._isConnected = true;\r\n\t\tif (this._connCallbacks.onConnChange) {\r\n\t\t\tsetTimeout(() => {\r\n\t\t\t\tthis._socket.emit(\"authEnabled\", (auth: boolean, user: string) => {\r\n\t\t\t\t\tthis.user = user;\r\n\t\t\t\t\tthis._connCallbacks.onConnChange!(this._isConnected);\r\n\t\t\t\t\tif (typeof app !== \"undefined\") app.onConnChange(this._isConnected);\r\n\t\t\t\t});\r\n\t\t\t}, 0);\r\n\t\t}\r\n\r\n\t\t// Alle wartenden API-Aufrufe (await _checkReady) freigeben\r\n\t\tthis._resolveAuth(true);\r\n\t}\r\n\r\n\tprivate _onSocketReauthenticate() {\r\n\t\tif (this._connCallbacks.onConnChange) {\r\n\t\t\tthis._connCallbacks.onConnChange(false);\r\n\t\t\tif (typeof app !== \"undefined\") app.onConnChange(false);\r\n\t\t}\r\n\t\tconsole.warn(\"reauthenticate\");\r\n\t\twindow.location.reload();\r\n\t}\r\n\r\n\tprivate _onSocketConnectError(connOptions: ConnOptions) {\r\n\t\tif (typeof $ !== \"undefined\") {\r\n\t\t\t$(\".splash-screen-text\").css(\"color\", \"#002951\");\r\n\t\t}\r\n\t\tthis.reconnect(connOptions);\r\n\t}\r\n\r\n\tprivate _onSocketDisconnect(connOptions: ConnOptions) {\r\n\t\tthis._disconnectedSince = new Date().getTime();\r\n\t\tthis._isConnected = false;\r\n\r\n\t\t// Erstelle ein neues, ungelöstes Promise für die nächste Verbindung\r\n\t\tthis._authPromise = new Promise((resolve, reject) => {\r\n\t\t\tthis._resolveAuth = resolve;\r\n\t\t\tthis._rejectAuth = reject;\r\n\t\t});\r\n\r\n\t\tif (this._connCallbacks.onConnChange) {\r\n\t\t\tsetTimeout(() => {\r\n\t\t\t\tconst elem = document.getElementById(\"server-disconnect\");\r\n\t\t\t\tif (elem) elem.style.display = \"\";\r\n\t\t\t\tthis._connCallbacks.onConnChange!(this._isConnected);\r\n\t\t\t\tif (typeof app !== \"undefined\") app.onConnChange(this._isConnected);\r\n\t\t\t}, 5000);\r\n\t\t} else {\r\n\t\t\tconst elem = document.getElementById(\"server-disconnect\");\r\n\t\t\tif (elem) elem.style.display = \"\";\r\n\t\t}\r\n\t\tthis.reconnect(connOptions);\r\n\t}\r\n\r\n\tprivate _onSocketReconnect() {\r\n\t\tconst offlineTime = new Date().getTime() - (this._disconnectedSince || 0);\r\n\t\tconsole.log(`was offline for ${offlineTime / 1000}s`);\r\n\t\tif (this._reloadInterval && offlineTime > this._reloadInterval * 1000) {\r\n\t\t\twindow.location.reload();\r\n\t\t}\r\n\t}\r\n\r\n\tprivate _onSocketObjectChange(id: string, obj: any) {\r\n\t\tif (this._useStorage && typeof storage !== \"undefined\") {\r\n\t\t\t// ... (storage logic) ...\r\n\t\t}\r\n\t\tif (this._connCallbacks.onObjectChange) {\r\n\t\t\tthis._connCallbacks.onObjectChange(id, obj);\r\n\t\t}\r\n\t}\r\n\r\n\tprivate _onSocketStateChange(id: string, state: any) {\r\n\t\tif (!id || state === null || typeof state !== \"object\") return;\r\n\r\n\t\t// ... (original stateChange logic for commands) ...\r\n\r\n\t\tif (this._connCallbacks.onUpdate) {\r\n\t\t\tthis._connCallbacks.onUpdate(id, state);\r\n\t\t}\r\n\t}\r\n\r\n\tprivate _onSocketPermissionError(err: any) {\r\n\t\tif (this._connCallbacks.onError) {\r\n\t\t\tthis._connCallbacks.onError(err);\r\n\t\t} else {\r\n\t\t\tconsole.log(\"permissionError\", err);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Prüft, ob die Verbindung initialisiert und authentifiziert ist.\r\n\t * Wartet auf das Auth-Promise.\r\n\t */\r\n\tprivate async _checkReady(commandName: string): Promise<boolean> {\r\n\t\tif (this._type === \"local\") {\r\n\t\t\treturn true; // Im lokalen Modus immer bereit\r\n\t\t}\r\n\r\n\t\tif (!this._authPromise) {\r\n\t\t\tconsole.error(`Connection not initialized. Call .init() first for ${commandName}`);\r\n\t\t\tthrow new Error(\"Connection not initialized\");\r\n\t\t}\r\n\r\n\t\t// Wartet, bis _onAuth() _resolveAuth(true) aufgerufen hat.\r\n\t\tawait this._authPromise;\r\n\r\n\t\t// Zusätzliche Prüfungen (ersetzt _checkConnection)\r\n\t\tif (!this._isConnected) {\r\n\t\t\tconsole.log(`No connection for ${commandName}`);\r\n\t\t\tthrow new Error(\"No connection\");\r\n\t\t}\r\n\t\tif (this._socket === null) {\r\n\t\t\tconsole.log(`socket.io not initialized for ${commandName}`);\r\n\t\t\tthrow new Error(\"Socket.io not initialized\");\r\n\t\t}\r\n\r\n\t\t// *** DEIN WICHTIGER FIX ***\r\n\t\t// Wir prüfen _isAuthDone, das in _onAuth gesetzt wird.\r\n\t\tif (!this._isAuthDone) {\r\n\t\t\tconsole.warn(`Auth not done for ${commandName}. Race condition?`);\r\n\t\t\tthrow new Error(\"Authentication not complete\");\r\n\t\t}\r\n\r\n\t\treturn true;\r\n\t}\r\n\r\n\t// --- Öffentliche API-Methoden (jetzt mit async/await) ---\r\n\r\n\tpublic getType = () => this._type;\r\n\tpublic getIsConnected = () => this._isConnected;\r\n\tpublic getIsLoginRequired = () => this._isSecure;\r\n\tpublic getUser = () => this.user;\r\n\r\n\tpublic setReloadTimeout = (timeout: number) => {\r\n\t\tthis._reloadInterval = parseInt(timeout as any, 10);\r\n\t};\r\n\tpublic setReconnectInterval = (interval: number) => {\r\n\t\tthis._reconnectInterval = parseInt(interval as any, 10);\r\n\t};\r\n\r\n\tpublic reconnect(connOptions: ConnOptions) {\r\n\t\tif ((!connOptions.mayReconnect || connOptions.mayReconnect()) && !this._connectInterval) {\r\n\t\t\tthis._connectInterval = setInterval(() => {\r\n\t\t\t\tconsole.log(\"Trying connect...\");\r\n\t\t\t\tthis._socket.connect();\r\n\t\t\t\t// ... (restliche reconnect-Logik mit jQuery) ...\r\n\t\t\t}, this._reconnectInterval);\r\n\t\t\t// ...\r\n\t\t}\r\n\t}\r\n\r\n\tpublic async getVersion(): Promise<string> {\r\n\t\tawait this._checkReady(\"getVersion\");\r\n\t\treturn new Promise((resolve) => {\r\n\t\t\tthis._socket.emit(\"getVersion\", (err: any, version: string) => {\r\n\t\t\t\tresolve(version);\r\n\t\t\t});\r\n\t\t});\r\n\t}\r\n\r\n\t/**\r\n\t * Sendet einen Befehl an eine Adapterinstanz.\r\n\t * (Deine hinzugefügte Funktion)\r\n\t */\r\n\tpublic async sendTo(adapterInstance: string, command: string, message: any): Promise<any> {\r\n\t\tawait this._checkReady(\"sendTo\");\r\n\t\treturn new Promise((resolve, reject) => {\r\n\t\t\tthis._socket.emit(\"sendTo\", adapterInstance, command, message, (result: any) => {\r\n\t\t\t\tif (result && result.error) {\r\n\t\t\t\t\treject(new Error(result.error));\r\n\t\t\t\t} else {\r\n\t\t\t\t\tresolve(result);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t});\r\n\t}\r\n\r\n\t/**\r\n\t * Frägt Objekte basierend auf einer View ab.\r\n\t * (Deine hinzugefügte Funktion)\r\n\t */\r\n\tpublic async getObjectView(design: string, search: string, params: any): Promise<{ rows: any[] }> {\r\n\t\tawait this._checkReady(\"getObjectView\");\r\n\t\treturn new Promise((resolve, reject) => {\r\n\t\t\tthis._socket.emit(\"getObjectView\", design, search, params, (err: any, res: any) => {\r\n\t\t\t\tif (err) {\r\n\t\t\t\t\treject(err);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tresolve(res);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t});\r\n\t}\r\n\r\n    /**\r\n     * Liest ein einzelnes Objekt aus der ioBroker-Datenbank.\r\n     */\r\n    public async getObject(id: string): Promise<any> {\r\n        await this._checkReady(\"getObject\"); // Warten, bis Auth abgeschlossen ist\r\n        return new Promise((resolve, reject) => {\r\n            this._socket.emit(\"getObject\", id, (err: any, obj: any) => {\r\n                if (err) {\r\n                    reject(err);\r\n                } else {\r\n                    resolve(obj);\r\n                }\r\n            });\r\n        });\r\n    }\r\n\r\n\tpublic async getStates(IDs: string[] | null): Promise<Record<string, any>> {\r\n\t\tif (this._type === \"local\") return {};\r\n\r\n\t\tawait this._checkReady(\"getStates\");\r\n\r\n\t\treturn new Promise((resolve, reject) => {\r\n\t\t\tthis._socket.emit(\"getStates\", IDs, (err: any, data: any) => {\r\n\t\t\t\tif (err || !data) {\r\n\t\t\t\t\treject(err || \"Authentication required\");\r\n\t\t\t\t} else {\r\n\t\t\t\t\tresolve(data);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t});\r\n\t}\r\n\r\n\r\n\t/**\r\n\t * Abonniert einen bestimmten State (oder ein Muster) beim Server.\r\n\t */\r\n\tpublic async subscribeState(id: string): Promise<void> {\r\n\t\tawait this._checkReady(\"subscribeState\"); // Warten, bis Auth abgeschlossen ist\r\n\t\treturn new Promise((resolve) => {\r\n\t\t\t// console.log(`[conn] Subscribing to ${id}`);\r\n\t\t\tthis._socket.emit(\"subscribe\", id, () => {\r\n\t\t\t\tresolve();\r\n\t\t\t});\r\n\t\t});\r\n\t}\r\n\r\n\t/**\r\n\t * Kündigt das Abonnement für einen bestimmten State (oder ein Muster) beim Server.\r\n\t */\r\n\tpublic async unsubscribeState(id: string): Promise<void> {\r\n\t\tawait this._checkReady(\"unsubscribeState\"); // Warten, bis Auth abgeschlossen ist\r\n\t\treturn new Promise((resolve) => {\r\n\t\t\t// console.log(`[conn] Unsubscribing from ${id}`);\r\n\t\t\tthis._socket.emit(\"unsubscribe\", id, () => {\r\n\t\t\t\tresolve();\r\n\t\t\t});\r\n\t\t});\r\n\t}\r\n\r\n\t/**\r\n\t * Liest alle Objekte, Enums, Adapter, Kanäle und Geräte.\r\n\t * Flacht die Callback-Hölle mit async/await ab.\r\n\t */\r\n\tpublic async getObjects(useCache: boolean = false): Promise<Record<string, any>> {\r\n\t\tif (this._useStorage && useCache) {\r\n\t\t\tif (typeof storage !== \"undefined\") {\r\n\t\t\t\tconst objects = this._objects || storage.get(\"objects\");\r\n\t\t\t\tif (objects) return objects;\r\n\t\t\t} else if (this._objects) {\r\n\t\t\t\treturn this._objects;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tawait this._checkReady(\"getObjects\");\r\n\r\n\t\ttry {\r\n\t\t\t// 1. Hole Hauptobjekte\r\n\t\t\tconst [err, data] = await new Promise<[any, Record<string, any>]>((resolve) => {\r\n\t\t\t\tthis._socket.emit(\"getObjects\", (err: any, data: any) => resolve([err, data]));\r\n\t\t\t});\r\n\t\t\tif (err) throw err;\r\n\r\n\t\t\t// 2. Hole Enums\r\n\t\t\tconst enumsRes = await this.getObjectView(\"system\", \"enum\", { startkey: \"enum.\", endkey: \"enum.\\u9999\" });\r\n\t\t\tconst enums: Record<string, any> = {};\r\n\t\t\tfor (const row of enumsRes.rows) {\r\n\t\t\t\tdata[row.id] = row.value;\r\n\t\t\t\tenums[row.id] = row.value;\r\n\t\t\t}\r\n\r\n\t\t\t// 3. Hole Adapter-Instanzen\r\n\t\t\tconst adaptersRes = await this.getObjectView(\"system\", \"instance\", { startkey: \"system.adapter.\", endkey: \"system.adapter.\\u9999\" });\r\n\t\t\tfor (const row of adaptersRes.rows) {\r\n\t\t\t\tdata[row.id] = row.value;\r\n\t\t\t}\r\n\r\n\t\t\t// Default-Modus ermitteln\r\n\t\t\tif (data[`system.adapter.${this.namespace}`]?.native?.defaultFileMode) {\r\n\t\t\t\tthis._defaultMode = data[`system.adapter.${this.namespace}`].native.defaultFileMode;\r\n\t\t\t}\r\n\r\n\t\t\t// 4. Hole Kanäle\r\n\t\t\tconst channelsRes = await this.getObjectView(\"system\", \"channel\", { startkey: \"\", endkey: \"\\u9999\" });\r\n\t\t\tfor (const row of channelsRes.rows) {\r\n\t\t\t\tdata[row.id] = row.value;\r\n\t\t\t}\r\n\r\n\t\t\t// 5. Hole Geräte\r\n\t\t\tconst devicesRes = await this.getObjectView(\"system\", \"device\", { startkey: \"\", endkey: \"\\u9999\" });\r\n\t\t\tfor (const row of devicesRes.rows) {\r\n\t\t\t\tdata[row.id] = row.value;\r\n\t\t\t}\r\n\r\n\t\t\t// Speichern, wenn Caching genutzt wird\r\n\t\t\tif (this._useStorage) {\r\n\t\t\t\tthis._fillChildren(data);\r\n\t\t\t\tthis._objects = data;\r\n\t\t\t\tthis._enums = enums;\r\n\t\t\t\tif (typeof storage !== \"undefined\") {\r\n\t\t\t\t\tstorage.set(\"objects\", data);\r\n\t\t\t\t\tstorage.set(\"enums\", enums);\r\n\t\t\t\t\tstorage.set(\"timeSync\", new Date().getTime());\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\treturn data;\r\n\t\t} catch (error) {\r\n\t\t\tconsole.error(\"Error in getObjects:\", error);\r\n\t\t\tthrow error;\r\n\t\t}\r\n\t}\r\n\r\n\t// ... (Hier die restlichen Methoden wie readFile, writeFile, getChildren etc.\r\n\t//      nach demselben Muster in async/await umwandeln) ...\r\n\r\n\t// Beispiel für readFile:\r\n\tpublic async readFile(filename: string, isRemote: boolean = false): Promise<{ data: any; mimeType?: string }> {\r\n\t\tif (this._type === \"local\") {\r\n\t\t\ttry {\r\n\t\t\t\tconst data = storage.get(filename);\r\n\t\t\t\treturn { data: data ? JSON.parse(data) : null };\r\n\t\t\t} catch (err) {\r\n\t\t\t\tthrow err;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tawait this._checkReady(\"readFile\");\r\n\r\n\t\tif (!isRemote && typeof app !== \"undefined\") {\r\n\t\t\treturn new Promise((resolve, reject) => {\r\n\t\t\t\tapp.readLocalFile(filename.replace(/^\\/vis\\.0\\//, \"\"), (err, data, mimeType) => {\r\n\t\t\t\t\tif (err) reject(err);\r\n\t\t\t\t\telse resolve({ data, mimeType });\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tlet adapter = this.namespace;\r\n\t\tif (filename[0] === \"/\") {\r\n\t\t\tconst p = filename.split(\"/\");\r\n\t\t\tadapter = p[1];\r\n\t\t\tp.splice(0, 2);\r\n\t\t\tfilename = p.join(\"/\");\r\n\t\t}\r\n\r\n\t\treturn new Promise((resolve, reject) => {\r\n\t\t\tthis._socket.emit(\"readFile\", adapter, filename, (err: any, data: any, mimeType: string) => {\r\n\t\t\t\tif (err) reject(err);\r\n\t\t\t\telse resolve({ data, mimeType });\r\n\t\t\t});\r\n\t\t});\r\n\t}\r\n\r\n\t// --- Private Hilfsfunktionen ---\r\n\r\n\tprivate _monitor() {\r\n\t\tif (this._timer) return;\r\n\t\tconst ts = new Date().getTime();\r\n\t\tif (this._reloadInterval && ts - this._lastTimer > this._reloadInterval * 1000) {\r\n\t\t\twindow.location.reload();\r\n\t\t} else {\r\n\t\t\tthis._lastTimer = ts;\r\n\t\t}\r\n\t\tthis._timer = setTimeout(() => {\r\n\t\t\tthis._timer = null;\r\n\t\t\tthis._monitor();\r\n\t\t}, 10000);\r\n\t}\r\n\r\n\tprivate _fillChildren(objects: Record<string, any>) {\r\n\t\tconst items = Object.keys(objects).sort();\r\n\t\tfor (let i = 0; i < items.length; i++) {\r\n\t\t\tconst id = items[i];\r\n\t\t\tif (objects[id].common) {\r\n\t\t\t\tlet j = i + 1;\r\n\t\t\t\tconst children: string[] = [];\r\n\t\t\t\tconst len = id.length + 1;\r\n\t\t\t\tconst name = id + \".\";\r\n\t\t\t\twhile (j < items.length && items[j].substring(0, len) === name) {\r\n\t\t\t\t\tchildren.push(items[j++]);\r\n\t\t\t\t}\r\n\t\t\t\tobjects[id].children = children;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n"]}