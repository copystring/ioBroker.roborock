{"version":3,"file":"map.js","sourceRoot":"","sources":["../src/www/map.ts"],"names":[],"mappings":"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","sourcesContent":["import { Connection } from \"./conn.js\";\nimport * as d3 from \"d3\";\nimport { IMG_GO_TO_PIN, IMG_CHARGER, IMG_ROBOT_ORIGINAL } from \"./images.js\";\nimport { localCoordsToRobotCoords, robotCoordsToLocalCoords } from \"./coords.js\";\nimport { processPaths, type PathResult } from \"./pathProcessor.js\";\n\n// Interfaces\n// -----------------------------------------------------------------------------\n\ninterface MapData {\n\tIMAGE: {\n\t\tposition: { left: number; top: number };\n\t\tdimensions: { height: number; width: number };\n\t\tsegments: {\n\t\t\tlist: SegmentInfo[];\n\t\t};\n\t};\n\tROBOT_POSITION?: PositionBlock;\n\tCHARGER_LOCATION?: PositionBlock;\n\tPATH?: PathBlock;\n\tMOP_PATH?: number[];\n\tOBSTACLES2?: Array<[number, number, ...any]>;\n\tCARPET_MAP?: number[];\n}\n\ninterface PositionBlock {\n\tposition: [number, number];\n\tangle: number;\n}\n\ninterface PathBlock {\n\tcurrent_angle: number;\n\tpoints: [number, number][];\n}\n\ninterface SegmentInfo {\n\tid: number;\n\tname: string;\n\tcenter: [number, number]; // Robot coordinates\n}\n\ninterface Robot {\n\tduid: string;\n\tname: string;\n}\n\ninterface Point {\n\tx: number;\n\ty: number;\n}\n\ninterface Rect {\n\tid: number; // Unique ID for D3 data binding\n\tx: number;\n\ty: number;\n\twidth: number;\n\theight: number;\n}\n\ninterface ConnCallbacks {\n\tonConnChange?: (isConnected: boolean) => void;\n\tonUpdate?: (id: string, state: any | null | undefined) => void;\n\tonRefresh?: ((...args: any[]) => any) | null;\n\tonAuth?: ((...args: any[]) => any) | null;\n\tonCommand?: (instance: string, command: string, data: any) => any;\n\tonError?: (err: any) => void;\n\tonObjectChange?: (id: string, obj: any) => void;\n}\n\ninterface MapParams {\n\tscaleFactor: number;\n\tleft: number;\n\ttopMap: number;\n\tmapMaxY: number;\n\timageHeight: number;\n\timageWidth: number;\n}\n\n// -----------------------------------------------------------------------------\n// Constants\n// -----------------------------------------------------------------------------\n\nconst VISUAL_BLOCK_SIZE = 3; // Scale factor for visualization\nconst UI_CONSTANTS = {\n\tROBOT_SIZE_BASE: 5,\n\tCHARGER_SIZE_BASE: 3,\n\tOBSTACLE_RADIUS_BASE: 3,\n\tZONE_STROKE_BASE: 1.5,\n\tZONE_HANDLE_RADIUS_BASE: 5,\n\tPIN_WIDTH_BASE: 29,\n\tPIN_HEIGHT_BASE: 24,\n\tPIN_Y_OFFSET_BASE: 5,\n\tPATH_MOP_WIDTH_BASE: 6.5,\n\tPATH_MAIN_WIDTH_RATIO_BASE: 0.5,\n\tPATH_BACKWASH_WIDTH_BASE: 0.5,\n};\n\n// -----------------------------------------------------------------------------\n// Map Application Class\n// -----------------------------------------------------------------------------\n\nclass MapApplication {\n\t// State\n\tprivate connection: Connection;\n\tprivate instanceId: string = \"\";\n\tprivate currentRobotDuid: string | null = null;\n\tprivate onStateChange: ((id: string, state: any | null | undefined) => void) | null = null;\n\tprivate currentMapSubscriptions: string[] = [];\n\n\t// Map Data\n\tprivate map: MapData | undefined;\n\tprivate mapImage: MapData[\"IMAGE\"] | undefined;\n\tprivate mapMinX: number = 0;\n\tprivate mapMinY: number = 0;\n\tprivate mapSizeX: number = 0;\n\tprivate mapSizeY: number = 0;\n\tprivate mapMaxY: number = 0;\n\tprivate goToTarget = false;\n\tprivate zoomLevel = 0.55;\n\n\t// D3 & SVG State\n\tprivate image = new Image();\n\tprivate initialTransform: d3.ZoomTransform | undefined;\n\tprivate svg: d3.Selection<d3.BaseType, unknown, HTMLElement, any>;\n\tprivate svgContainer: d3.Selection<d3.BaseType, unknown, HTMLElement, any>;\n\tprivate mainGroup: d3.Selection<SVGGElement, unknown, HTMLElement, any>;\n\tprivate mapImageElement: d3.Selection<SVGImageElement, unknown, HTMLElement, any>;\n\n\t// Layers\n\tprivate carpetGroup: d3.Selection<SVGGElement, unknown, HTMLElement, any>;\n\tprivate pathGroup: d3.Selection<SVGGElement, unknown, HTMLElement, any>;\n\tprivate mopPathGroup: d3.Selection<SVGGElement, unknown, HTMLElement, any>;\n\tprivate backwashPathGroup: d3.Selection<SVGGElement, unknown, HTMLElement, any>;\n\tprivate pureCleanPathGroup: d3.Selection<SVGGElement, unknown, HTMLElement, any>;\n\n\t// Element Groups\n\tprivate chargerGroup: d3.Selection<SVGGElement, unknown, HTMLElement, any>;\n\tprivate robotGroup: d3.Selection<SVGGElement, unknown, HTMLElement, any>;\n\tprivate roomNameGroup: d3.Selection<SVGGElement, unknown, HTMLElement, any>;\n\tprivate zoneGroup: d3.Selection<SVGGElement, unknown, HTMLElement, any>;\n\tprivate obstacleGroup: d3.Selection<SVGGElement, unknown, HTMLElement, any>;\n\tprivate pinGroup: d3.Selection<SVGGElement, unknown, HTMLElement, any>;\n\tprivate zoom: d3.ZoomBehavior<Element, unknown>;\n\n\tprivate wheelZoom = 1;\n\tprivate readonly minZoom = 0.1;\n\tprivate readonly maxZoom = 10;\n\n\t// UI Interaction State\n\tprivate popupTimeout: number | null = null;\n\tprivate popupX: number = 0;\n\tprivate popupY: number = 0;\n\tprivate selectedObstacleID: any;\n\tprivate rects: Rect[] = [];\n\tprivate zones: number[][] = [];\n\tprivate rectCounter = 0;\n\n\t// DOM Elements\n\tprivate popup!: HTMLElement;\n\tprivate popupImage!: HTMLImageElement;\n\tprivate triangle!: HTMLElement;\n\tprivate largePhoto!: HTMLElement;\n\tprivate largePhotoImage!: HTMLImageElement;\n\tprivate robotSelect!: HTMLSelectElement;\n\tprivate deleteButton!: HTMLButtonElement;\n\tprivate addButton!: HTMLButtonElement;\n\tprivate startButton!: HTMLButtonElement;\n\tprivate pauseButton!: HTMLButtonElement;\n\tprivate stopButton!: HTMLButtonElement;\n\tprivate dockButton!: HTMLButtonElement;\n\tprivate goToButton!: HTMLButtonElement;\n\tprivate resetZoomButton!: HTMLButtonElement;\n\n\tconstructor() {\n\t\tthis.connection = new Connection();\n\t\t// Initialize D3 selections with empty selections initially or in init()\n\t\t// We will initialize them properly in init() after DOM is ready\n\t\tthis.svg = d3.select(null) as any;\n\t\tthis.svgContainer = d3.select(null) as any;\n\t\tthis.mainGroup = d3.select(null) as any;\n\t\tthis.mapImageElement = d3.select(null) as any;\n\t\tthis.carpetGroup = d3.select(null) as any;\n\t\tthis.pathGroup = d3.select(null) as any;\n\t\tthis.mopPathGroup = d3.select(null) as any;\n\t\tthis.backwashPathGroup = d3.select(null) as any;\n\t\tthis.pureCleanPathGroup = d3.select(null) as any;\n\t\tthis.chargerGroup = d3.select(null) as any;\n\t\tthis.robotGroup = d3.select(null) as any;\n\t\tthis.roomNameGroup = d3.select(null) as any;\n\t\tthis.zoneGroup = d3.select(null) as any;\n\t\tthis.obstacleGroup = d3.select(null) as any;\n\t\tthis.pinGroup = d3.select(null) as any;\n\t\tthis.zoom = d3.zoom();\n\t}\n\n\tpublic async init() {\n\t\tthis.bindDomElements();\n\t\tthis.setupD3();\n\t\tthis.setupConnection();\n\t\tthis.bindUiEvents();\n\t}\n\n\tprivate bindDomElements() {\n\t\tconst getElement = <T extends HTMLElement>(id: string): T => {\n\t\t\tconst el = document.getElementById(id);\n\t\t\tif (!el) throw new Error(`Missing DOM element: ${id}`);\n\t\t\treturn el as T;\n\t\t};\n\n\t\tthis.popup = getElement(\"popup\");\n\t\tthis.popupImage = getElement(\"popup-image\");\n\t\tthis.triangle = getElement(\"triangle\");\n\t\tthis.largePhoto = getElement(\"largePhoto\");\n\t\tthis.largePhotoImage = getElement(\"largePhoto-image\");\n\t\tthis.robotSelect = getElement(\"robotSelect\");\n\t\tthis.deleteButton = getElement(\"deleteButton\");\n\t\tthis.addButton = getElement(\"addButton\");\n\t\tthis.startButton = getElement(\"startButton\");\n\t\tthis.pauseButton = getElement(\"pauseButton\");\n\t\tthis.stopButton = getElement(\"stopButton\");\n\t\tthis.dockButton = getElement(\"dockButton\");\n\t\tthis.goToButton = getElement(\"goToButton\");\n\t\tthis.resetZoomButton = getElement(\"resetZoomButton\");\n\t}\n\n\tprivate setupD3() {\n\t\tthis.svgContainer = d3.select(\"#mapSvgContainer\");\n\t\tthis.svg = d3.select(\"#mapSvg\");\n\t\tthis.mainGroup = this.svg.append(\"g\").attr(\"class\", \"main-group\");\n\t\tthis.mapImageElement = this.mainGroup.append(\"image\").attr(\"class\", \"map-image\");\n\n\t\t// Add carpet layer (Vector SVG)\n\t\tthis.carpetGroup = this.mainGroup.append(\"g\").attr(\"class\", \"carpet\");\n\n\t\tthis.mopPathGroup = this.mainGroup\n\t\t\t.append(\"g\")\n\t\t\t.attr(\"class\", \"mop-paths\")\n\t\t\t.style(\"opacity\", 0.18);\n\t\tthis.pathGroup = this.mainGroup\n\t\t\t.append(\"g\")\n\t\t\t.attr(\"class\", \"paths\")\n\t\t\t.style(\"opacity\", 0.5);\n\t\tthis.backwashPathGroup = this.mainGroup\n\t\t\t.append(\"g\")\n\t\t\t.attr(\"class\", \"backwash-paths\")\n\t\t\t.style(\"opacity\", 0.2);\n\t\tthis.pureCleanPathGroup = this.mainGroup\n\t\t\t.append(\"g\")\n\t\t\t.attr(\"class\", \"pure-clean-paths\");\n\n\t\tthis.chargerGroup = this.mainGroup.append(\"g\").attr(\"class\", \"charger\");\n\t\tthis.obstacleGroup = this.mainGroup.append(\"g\").attr(\"class\", \"obstacles\");\n\t\tthis.zoneGroup = this.mainGroup.append(\"g\").attr(\"class\", \"zones\");\n\t\tthis.robotGroup = this.mainGroup.append(\"g\").attr(\"class\", \"robot\");\n\t\tthis.pinGroup = this.mainGroup.append(\"g\").attr(\"class\", \"pins\");\n\t\tthis.roomNameGroup = this.mainGroup.append(\"g\").attr(\"class\", \"room-names\");\n\n\t\tthis.pinGroup\n\t\t\t.append(\"image\")\n\t\t\t.attr(\"class\", \"goto-pin\")\n\t\t\t.attr(\"href\", IMG_GO_TO_PIN)\n\t\t\t.attr(\"width\", 29)\n\t\t\t.attr(\"height\", 24)\n\t\t\t.style(\"opacity\", 0)\n\t\t\t.style(\"display\", \"none\")\n\t\t\t.style(\"pointer-events\", \"none\");\n\n\t\tthis.zoom = d3\n\t\t\t.zoom()\n\t\t\t.scaleExtent([this.minZoom, this.maxZoom])\n\t\t\t.on(\"zoom\", (event: any) => this.handleZoom(event));\n\n\t\tthis.svgContainer.call(this.zoom as any);\n\t}\n\n\tprivate setupConnection() {\n\t\tconst instance = this.getQueryParam(\"instance\");\n\t\tif (instance === null) {\n\t\t\tdocument.body.innerHTML = \"<h1>Error: No instance specified in URL.</h1>\";\n\t\t\treturn;\n\t\t}\n\t\tthis.instanceId = `roborock.${instance}`;\n\n\t\tconst connCallbacks: ConnCallbacks = {\n\t\t\tonConnChange: async (isConnected: boolean) => {\n\t\t\t\tif (isConnected) {\n\t\t\t\t\tthis.fetchRobotList();\n\t\t\t\t}\n\t\t\t},\n\t\t\tonUpdate: (id, state) => {\n\t\t\t\tif (this.onStateChange) this.onStateChange(id, state as any);\n\t\t\t},\n\t\t\tonError: (err) => {\n\t\t\t\tconsole.error(\"Connection error:\", err);\n\t\t\t},\n\t\t};\n\n\t\tconst socketUrl = `${window.location.protocol}//${window.location.hostname}:${window.location.port}`;\n\t\tthis.connection.init({ name: this.instanceId, connLink: socketUrl }, connCallbacks, true);\n\t}\n\n\tprivate fetchRobotList() {\n\t\tconst startKey = `${this.instanceId}.Devices.`;\n\t\tconst endKey = `${this.instanceId}.Devices.\\u9999`;\n\n\t\tthis.connection\n\t\t\t.getObjectView(\"system\", \"device\", { startkey: startKey, endkey: endKey })\n\t\t\t.then((res: { rows: { id: string; value: any }[] }) => {\n\t\t\t\tconst robots: Robot[] = [];\n\t\t\t\tif (res && res.rows) {\n\t\t\t\t\tres.rows.forEach((row) => {\n\t\t\t\t\t\tconst idParts = row.id.split(\".\");\n\t\t\t\t\t\tconst duid = idParts[idParts.length - 1];\n\t\t\t\t\t\tconst name = row.value && row.value.common && row.value.common.name ? row.value.common.name : duid;\n\t\t\t\t\t\tif (duid) robots.push({ duid: duid, name: name });\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\tif (robots.length === 0) {\n\t\t\t\t\tconst instanceDuid = this.getQueryParam(\"instance\");\n\t\t\t\t\tif (instanceDuid) {\n\t\t\t\t\t\tthis.robotSelect.innerHTML = \"\";\n\t\t\t\t\t\tconst option = document.createElement(\"option\");\n\t\t\t\t\t\toption.value = instanceDuid;\n\t\t\t\t\t\toption.text = `Roborock (Instance ${instanceDuid})`;\n\t\t\t\t\t\tthis.robotSelect.appendChild(option);\n\t\t\t\t\t\tthis.currentRobotDuid = instanceDuid;\n\t\t\t\t\t\tthis.setupSocketListeners(instanceDuid);\n\t\t\t\t\t}\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tthis.robotSelect.innerHTML = \"\";\n\t\t\t\trobots.forEach((robot: Robot) => {\n\t\t\t\t\tconst option = document.createElement(\"option\");\n\t\t\t\t\toption.value = robot.duid;\n\t\t\t\t\toption.text = robot.name;\n\t\t\t\t\tthis.robotSelect.appendChild(option);\n\t\t\t\t});\n\n\t\t\t\tif (robots.length > 0) {\n\t\t\t\t\tconst duid = robots[0].duid;\n\t\t\t\t\tthis.currentRobotDuid = duid;\n\t\t\t\t\tthis.robotSelect.value = duid;\n\t\t\t\t\tthis.setupSocketListeners(duid);\n\t\t\t\t}\n\t\t\t})\n\t\t\t.catch((err) => console.error(\"Error fetching robot list:\", err));\n\t}\n\n\tprivate setupSocketListeners(duid: string) {\n\t\tif (this.onStateChange && this.currentMapSubscriptions.length > 0) {\n\t\t\tthis.currentMapSubscriptions.forEach((id) => {\n\t\t\t\tthis.connection.unsubscribeState(id);\n\t\t\t});\n\t\t\tthis.currentMapSubscriptions = [];\n\t\t}\n\n\t\tthis.map = undefined;\n\t\tthis.mapImage = undefined;\n\t\tthis.mapImageElement.attr(\"href\", null);\n\t\tthis.carpetGroup.selectAll(\"*\").remove();\n\t\tthis.obstacleGroup.selectAll(\"*\").remove();\n\t\tthis.pinGroup.select(\"image.goto-pin\").style(\"display\", \"none\").style(\"opacity\", 0);\n\t\tthis.robotGroup.selectAll(\"*\").remove();\n\t\tthis.chargerGroup.selectAll(\"*\").remove();\n\t\tthis.roomNameGroup.selectAll(\"*\").remove();\n\t\tthis.pathGroup.selectAll(\"*\").remove();\n\t\tthis.mopPathGroup.selectAll(\"*\").remove();\n\t\tthis.backwashPathGroup.selectAll(\"*\").remove();\n\t\tthis.pureCleanPathGroup.selectAll(\"*\").remove();\n\t\tthis.rects = [];\n\t\tthis.drawZones();\n\t\tthis.deleteButton.disabled = true;\n\t\tthis.addButton.disabled = false;\n\n\t\tconst mapBase64StateId = `${this.instanceId}.Devices.${duid}.map.mapBase64Clean`;\n\t\tconst mapDataStateId = `${this.instanceId}.Devices.${duid}.map.mapData`;\n\t\tthis.currentMapSubscriptions = [mapBase64StateId, mapDataStateId];\n\n\t\tthis.onStateChange = (id: string, state: any | null | undefined) => {\n\t\t\tif (!state || !state.val) {\n\t\t\t\tif (id === mapBase64StateId) {\n\t\t\t\t\tthis.mapImageElement.attr(\"href\", null);\n\t\t\t\t}\n\t\t\t\tif (id === mapDataStateId) {\n\t\t\t\t\tthis.map = undefined;\n\t\t\t\t\tthis.robotGroup.selectAll(\"*\").remove();\n\t\t\t\t}\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tswitch (id) {\n\t\t\t\tcase mapBase64StateId:\n\t\t\t\t\tthis.pinGroup.select(\"image.goto-pin\").style(\"display\", \"none\").style(\"opacity\", 0);\n\t\t\t\t\tthis.drawBackgroundImage(state.val as string);\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase mapDataStateId:\n\t\t\t\t\ttry {\n\t\t\t\t\t\tthis.map = typeof state.val === \"string\" ? JSON.parse(state.val) : state.val;\n\t\t\t\t\t\tif (this.map && this.map.IMAGE) {\n\t\t\t\t\t\t\tthis.mapImage = this.map.IMAGE;\n\t\t\t\t\t\t\tthis.updateMapImageSize();\n\t\t\t\t\t\t\tthis.drawRobotAndCharger(this.map.ROBOT_POSITION, this.map.CHARGER_LOCATION);\n\t\t\t\t\t\t\tthis.drawPaths(this.map.PATH, this.map.MOP_PATH);\n\t\t\t\t\t\t\tthis.drawObstacles(this.map.OBSTACLES2);\n\t\t\t\t\t\t\tthis.drawRoomNames(this.map.IMAGE.segments.list);\n\t\t\t\t\t\t\tthis.drawCarpet(this.map.CARPET_MAP);\n\t\t\t\t\t\t}\n\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\tconsole.error(\"Failed to parse map data JSON:\", state.val, e);\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t};\n\n\t\tthis.connection.subscribeState(mapBase64StateId);\n\t\tthis.connection.subscribeState(mapDataStateId);\n\n\t\tthis.connection.getStates([mapBase64StateId, mapDataStateId]).then((states: Record<string, any | null | undefined>) => {\n\t\t\tif (!this.onStateChange) return;\n\t\t\tthis.onStateChange(mapBase64StateId, states[mapBase64StateId]);\n\t\t\tthis.onStateChange(mapDataStateId, states[mapDataStateId]);\n\t\t});\n\t}\n\t// -----------------------------------------------------------------------------\n\t// Drawing Methods\n\t// -----------------------------------------------------------------------------\n\n\tprivate updateMapImageSize() {\n\t\tif (!this.image.naturalWidth || !this.image.naturalHeight) return;\n\n\t\t// Use natural size of the image (1:1 scale)\n\t\tconst displayWidth = this.image.naturalWidth;\n\t\tconst displayHeight = this.image.naturalHeight;\n\n\t\tthis.mapImageElement\n\t\t\t.attr(\"href\", this.image.src)\n\t\t\t.attr(\"width\", displayWidth)\n\t\t\t.attr(\"height\", displayHeight)\n\t\t\t.attr(\"transform\", null)\n\t\t\t.style(\"image-rendering\", \"pixelated\");\n\t}\n\n\tprivate drawBackgroundImage(mapBase64: string) {\n\t\tif (!mapBase64) {\n\t\t\tthis.mapImageElement.attr(\"href\", null);\n\t\t\treturn;\n\t\t}\n\n\t\tthis.image.src = mapBase64;\n\t\tthis.image.onload = () => {\n\t\t\tconst tempCanvas = document.createElement(\"canvas\");\n\t\t\tconst tempCtx = tempCanvas.getContext(\"2d\", { willReadFrequently: true });\n\t\t\tif (!tempCtx) return;\n\n\t\t\ttempCanvas.width = this.image.width;\n\t\t\ttempCanvas.height = this.image.height;\n\t\t\ttempCtx.imageSmoothingEnabled = false;\n\t\t\ttempCtx.drawImage(this.image, 0, 0);\n\n\t\t\tlet mapMaxX = 0;\n\t\t\tthis.mapMaxY = 0;\n\t\t\tthis.mapMinX = this.image.width;\n\t\t\tthis.mapMinY = this.image.height;\n\n\t\t\tconst imageData = tempCtx.getImageData(0, 0, this.image.width, this.image.height);\n\t\t\tconst pixels = imageData.data;\n\t\t\tfor (let i = 0; i < pixels.length; i += 4) {\n\t\t\t\tconst alpha = pixels[i + 3];\n\t\t\t\tif (alpha > 50) {\n\t\t\t\t\tconst x = (i / 4) % this.image.width;\n\t\t\t\t\tconst y = Math.floor(i / 4 / this.image.width);\n\t\t\t\t\tif (x < this.mapMinX) this.mapMinX = x;\n\t\t\t\t\tif (x > mapMaxX) mapMaxX = x;\n\t\t\t\t\tif (y < this.mapMinY) this.mapMinY = y;\n\t\t\t\t\tif (y > this.mapMaxY) this.mapMaxY = y;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (this.mapMinX > mapMaxX) {\n\t\t\t\tthis.mapMinX = 0;\n\t\t\t\tmapMaxX = this.image.width;\n\t\t\t\tthis.mapMinY = 0;\n\t\t\t\tthis.mapMaxY = this.image.height;\n\t\t\t}\n\n\t\t\t// Calculate content dimensions based on detected pixels\n\t\t\tthis.mapSizeX = mapMaxX - this.mapMinX;\n\t\t\tthis.mapSizeY = this.mapMaxY - this.mapMinY;\n\n\t\t\t// Sanity check\n\t\t\tif (this.mapSizeX <= 0) this.mapSizeX = this.image.width;\n\t\t\tif (this.mapSizeY <= 0) this.mapSizeY = this.image.height;\n\n\t\t\tthis.updateMapImageSize();\n\n\t\t\tthis.carpetGroup.attr(\"transform\", null);\n\n\t\t\tconst svgWidth = parseFloat(this.svg.attr(\"width\")) || 800;\n\t\t\tconst svgHeight = parseFloat(this.svg.attr(\"height\")) || 600;\n\n\t\t\t// Zoom-to-fit calculations\n\t\t\tconst aspectRatio = svgWidth / svgHeight;\n\t\t\tconst contentAspectRatio = this.mapSizeX / this.mapSizeY;\n\n\t\t\tif (contentAspectRatio > aspectRatio) {\n\t\t\t\tthis.zoomLevel = this.roundTwoDecimals((svgWidth * 0.95) / this.mapSizeX); // 95% fit\n\t\t\t} else {\n\t\t\t\tthis.zoomLevel = this.roundTwoDecimals((svgHeight * 0.95) / this.mapSizeY);\n\t\t\t}\n\n\t\t\tif (this.zoomLevel < 0.1) this.zoomLevel = 0.1;\n\n\t\t\t// Center the content within the SVG\n\t\t\tconst contentCenterX = this.mapMinX + this.mapSizeX / 2;\n\t\t\tconst contentCenterY = this.mapMinY + this.mapSizeY / 2;\n\n\t\t\tthis.initialTransform = d3.zoomIdentity\n\t\t\t\t.translate(svgWidth / 2, svgHeight / 2)\n\t\t\t\t.scale(this.zoomLevel)\n\t\t\t\t.translate(-contentCenterX, -contentCenterY);\n\n\t\t\tthis.svgContainer.call(this.zoom.transform as any, this.initialTransform);\n\n\t\t\tif (this.map) {\n\t\t\t\tthis.drawRobotAndCharger(this.map.ROBOT_POSITION, this.map.CHARGER_LOCATION);\n\t\t\t\tthis.drawPaths(this.map.PATH, this.map.MOP_PATH);\n\t\t\t\tthis.drawObstacles(this.map.OBSTACLES2);\n\t\t\t\tthis.drawRoomNames(this.map.IMAGE.segments.list);\n\t\t\t\tthis.drawCarpet(this.map.CARPET_MAP);\n\t\t\t}\n\t\t};\n\t}\n\n\tprivate drawRobotAndCharger(robotPos?: PositionBlock, chargerPos?: PositionBlock) {\n\t\tthis.robotGroup.selectAll(\"image.robot\").remove();\n\t\tthis.chargerGroup.selectAll(\"image.charger\").remove();\n\n\t\tif (!robotPos && !chargerPos) return;\n\n\t\tconst params = this.getMapParams();\n\t\tif (!params) return;\n\n\t\tconst scaledChargerSize = this.rescaler.chargerSize();\n\t\tconst scaledRobotSize = this.rescaler.robotSize();\n\n\t\t// Charger\n\t\tconst chargerData = chargerPos ? [chargerPos] : [];\n\t\tconst charger = this.chargerGroup.selectAll(\"image.charger\").data(chargerData);\n\t\tcharger.exit().remove();\n\t\tcharger\n\t\t\t.enter()\n\t\t\t.append(\"image\")\n\t\t\t.attr(\"class\", \"charger\")\n\t\t\t.attr(\"href\", IMG_CHARGER)\n\t\t\t.merge(charger as any)\n\t\t\t.attr(\"width\", scaledChargerSize)\n\t\t\t.attr(\"height\", scaledChargerSize)\n\t\t\t.attr(\"x\", (d) => this.robotToSvg({ x: d.position[0], y: d.position[1] }, params).x - scaledChargerSize / 2)\n\t\t\t.attr(\"y\", (d) => this.robotToSvg({ x: d.position[0], y: d.position[1] }, params).y - scaledChargerSize / 2);\n\n\t\t// Robot\n\t\tconst robotData = robotPos ? [robotPos] : [];\n\t\tconst robot = this.robotGroup.selectAll(\"image.robot\").data(robotData);\n\t\trobot.exit().remove();\n\t\trobot\n\t\t\t.enter()\n\t\t\t.append(\"image\")\n\t\t\t.attr(\"class\", \"robot\")\n\t\t\t.attr(\"href\", IMG_ROBOT_ORIGINAL)\n\t\t\t.merge(robot as any)\n\t\t\t.attr(\"width\", scaledRobotSize)\n\t\t\t.attr(\"height\", scaledRobotSize)\n\t\t\t.attr(\"transform\", (d) => {\n\t\t\t\tconst svgCoords = this.robotToSvg({ x: d.position[0], y: d.position[1] }, params);\n\t\t\t\tconst angle = -(d.angle ?? 0) + 90;\n\t\t\t\treturn `translate(${svgCoords.x}, ${svgCoords.y}) rotate(${angle}) translate(${-scaledRobotSize / 2}, ${-scaledRobotSize / 2})`;\n\t\t\t});\n\t}\n\n\tprivate drawRoomNames(segmentsList: SegmentInfo[]) {\n\t\tconst params = this.getMapParams();\n\t\tif (!params || !segmentsList) {\n\t\t\tthis.roomNameGroup.selectAll(\"text.room-name\").remove();\n\t\t\treturn;\n\t\t}\n\t\tconst baseFontSize = 12;\n\t\tconst baseStrokeWidth = 2.5;\n\n\t\tconst textElements = this.roomNameGroup.selectAll(\"text.room-name\").data(segmentsList, (d: any) => d.id);\n\t\ttextElements.exit().remove();\n\t\ttextElements\n\t\t\t.enter()\n\t\t\t.append(\"text\")\n\t\t\t.attr(\"class\", \"room-name\")\n\t\t\t.attr(\"text-anchor\", \"middle\")\n\t\t\t.attr(\"dominant-baseline\", \"middle\")\n\t\t\t.style(\"fill\", \"#000\")\n\t\t\t.style(\"stroke\", \"white\")\n\t\t\t.style(\"pointer-events\", \"none\")\n\t\t\t.style(\"font-weight\", \"900\")\n\t\t\t.style(\"font-size\", `${baseFontSize}px`)\n\t\t\t.style(\"stroke-width\", `${baseStrokeWidth}px`)\n\t\t\t.style(\"paint-order\", \"stroke\")\n\t\t\t.attr(\"shape-rendering\", \"geometricPrecision\")\n\t\t\t.merge(textElements as any)\n\t\t\t.text((d) => d.name)\n\t\t\t.attr(\"x\", (d) => {\n\t\t\t\tif (d.center && typeof d.center[0] === \"number\" && !isNaN(d.center[0]))\n\t\t\t\t\treturn this.robotToSvg({ x: d.center[0], y: d.center[1] }, params).x;\n\t\t\t\treturn -1000;\n\t\t\t})\n\t\t\t.attr(\"y\", (d) => {\n\t\t\t\tif (d.center && typeof d.center[1] === \"number\" && !isNaN(d.center[1]))\n\t\t\t\t\treturn this.robotToSvg({ x: d.center[0], y: d.center[1] }, params).y;\n\t\t\t\treturn -1000;\n\t\t\t});\n\t}\n\n\tprivate drawPaths(pathData?: PathBlock, mopData?: number[]) {\n\t\tconst params = this.getMapParams();\n\t\tif (!params || !pathData?.points || !mopData) {\n\t\t\tthis.pathGroup.selectAll(\"*\").remove();\n\t\t\tthis.mopPathGroup.selectAll(\"*\").remove();\n\t\t\tthis.backwashPathGroup.selectAll(\"*\").remove();\n\t\t\tthis.pureCleanPathGroup.selectAll(\"*\").remove();\n\t\t\treturn;\n\t\t}\n\n\t\tconst scale = VISUAL_BLOCK_SIZE;\n\n\t\tconst paths: PathResult = processPaths(\n\t\t\tpathData.points,\n\t\t\tmopData,\n\t\t\t(robotPoint, p) => this.robotToSvg({ x: robotPoint[0], y: robotPoint[1] }, p),\n\t\t\tscale,\n\t\t\tparams\n\t\t);\n\n\t\tconst scaledMopWidth = this.rescaler.pathMopWidth();\n\t\tconst scaledPathWidth = this.rescaler.pathMainWidth();\n\t\tconst scaledBackwashWidth = this.rescaler.pathBackwashWidth();\n\n\t\t// 1. Main Path\n\t\tconst mainPath = this.pathGroup.selectAll(\"path.main-path\").data(paths.mainPathD ? [paths.mainPathD] : []);\n\t\tmainPath.exit().remove();\n\t\tmainPath\n\t\t\t.enter()\n\t\t\t.append(\"path\")\n\t\t\t.attr(\"class\", \"main-path\")\n\t\t\t.merge(mainPath as any)\n\t\t\t.attr(\"d\", (d) => d)\n\t\t\t.style(\"fill\", \"none\")\n\t\t\t.style(\"stroke\", \"rgba(255,255,255,1.0)\")\n\t\t\t.style(\"stroke-width\", `${scaledPathWidth}px`)\n\t\t\t.style(\"stroke-linecap\", \"round\")\n\t\t\t.style(\"stroke-linejoin\", \"round\");\n\n\t\t// 2. Backwash Path\n\t\tconst backwashPath = this.backwashPathGroup.selectAll(\"path.backwash-path\").data(paths.backwashPathD ? [paths.backwashPathD] : []);\n\t\tbackwashPath.exit().remove();\n\t\tbackwashPath\n\t\t\t.enter()\n\t\t\t.append(\"path\")\n\t\t\t.attr(\"class\", \"backwash-path\")\n\t\t\t.merge(backwashPath as any)\n\t\t\t.attr(\"d\", (d) => d)\n\t\t\t.style(\"fill\", \"none\")\n\t\t\t.style(\"stroke\", \"rgba(255,255,255,1.0)\")\n\t\t\t.style(\"stroke-width\", `${scaledBackwashWidth}px`)\n\t\t\t.style(\"stroke-dasharray\", `${4}, ${8}`)\n\t\t\t.style(\"stroke-linecap\", \"round\")\n\t\t\t.style(\"stroke-linejoin\", \"round\");\n\n\t\t// 3. PureClean Path\n\t\tconst pureCleanPath = this.pureCleanPathGroup.selectAll(\"path.pure-clean-path\").data(paths.pureCleanPathD ? [paths.pureCleanPathD] : []);\n\t\tpureCleanPath.exit().remove();\n\t\tpureCleanPath\n\t\t\t.enter()\n\t\t\t.append(\"path\")\n\t\t\t.attr(\"class\", \"pure-clean-path\")\n\t\t\t.merge(pureCleanPath as any)\n\t\t\t.attr(\"d\", (d) => d)\n\t\t\t.style(\"fill\", \"none\")\n\t\t\t.style(\"stroke\", \"rgba(255,255,255,1.0)\")\n\t\t\t.style(\"stroke-width\", `${scaledBackwashWidth}px`)\n\t\t\t.style(\"stroke-linecap\", \"round\")\n\t\t\t.style(\"stroke-linejoin\", \"round\");\n\n\t\t// 4. Mop Path\n\t\tconst mopPath = this.mopPathGroup.selectAll(\"path.mop-path\").data(paths.mopPathD ? [paths.mopPathD] : []);\n\t\tmopPath.exit().remove();\n\t\tmopPath\n\t\t\t.enter()\n\t\t\t.append(\"path\")\n\t\t\t.attr(\"class\", \"mop-path\")\n\t\t\t.merge(mopPath as any)\n\t\t\t.attr(\"d\", (d) => d)\n\t\t\t.style(\"fill\", \"none\")\n\t\t\t.style(\"stroke\", \"rgba(255,255,255,1.0)\")\n\t\t\t.style(\"stroke-width\", `${scaledMopWidth}px`)\n\t\t\t.style(\"stroke-linecap\", \"round\")\n\t\t\t.style(\"stroke-linejoin\", \"round\");\n\t}\n\n\tprivate drawObstacles(obstaclesData?: Array<[number, number, ...any]>) {\n\t\tconst params = this.getMapParams();\n\t\tif (!params || !obstaclesData) {\n\t\t\tthis.obstacleGroup.selectAll(\".obstacle-group\").remove();\n\t\t\treturn;\n\t\t}\n\t\tconst fixedRadius = this.rescaler.scale() * UI_CONSTANTS.OBSTACLE_RADIUS_BASE;\n\t\tconst bgRadius = fixedRadius * 1.1;\n\t\tconst imageSize = fixedRadius * 1.8;\n\n\t\tconst OBSTACLE_MAPPING: Record<number, string> = {\n\t\t\t\"-99\": \"99\",\n\t\t\t0: \"0\",\n\t\t\t1: \"1\",\n\t\t\t2: \"2\",\n\t\t\t3: \"3\",\n\t\t\t4: \"3\",\n\t\t\t5: \"5_cn\",\n\t\t\t9: \"9\",\n\t\t\t10: \"10\",\n\t\t\t18: \"18\",\n\t\t\t25: \"25\",\n\t\t\t26: \"26\",\n\t\t\t27: \"26\",\n\t\t\t34: \"10\",\n\t\t\t42: \"18\",\n\t\t\t48: \"48\",\n\t\t\t49: \"49\",\n\t\t\t50: \"50\",\n\t\t\t51: \"51\",\n\t\t\t54: \"54\",\n\t\t\t65: \"65\",\n\t\t\t67: \"67\",\n\t\t\t69: \"69\",\n\t\t\t70: \"70\",\n\t\t\t99: \"99\",\n\t\t};\n\n\t\tconst groups = this.obstacleGroup.selectAll(\".obstacle-group\").data(obstaclesData);\n\n\t\tgroups.exit().remove();\n\n\t\tconst enterGroups = groups\n\t\t\t.enter()\n\t\t\t.append(\"g\")\n\t\t\t.attr(\"class\", \"obstacle-group\")\n\t\t\t.style(\"cursor\", \"default\")\n\t\t\t.on(\"click\", (event: MouseEvent, d: any) => {\n\t\t\t\tif (!this.currentRobotDuid) return;\n\t\t\t\tevent.stopPropagation();\n\t\t\t\tthis.selectedObstacleID = d[6];\n\t\t\t\tconst robotPoint = { x: d[0], y: d[1] };\n\t\t\t\tconst worldPoint = robotCoordsToLocalCoords(robotPoint, params!);\n\t\t\t\tthis.popupX = worldPoint.x;\n\t\t\t\tthis.popupY = worldPoint.y;\n\n\t\t\t\tif (this.popupTimeout) clearTimeout(this.popupTimeout);\n\n\t\t\t\tthis.connection\n\t\t\t\t\t.sendTo(this.instanceId, \"get_obstacle_image\", { obstacleId: this.selectedObstacleID, duid: this.currentRobotDuid, type: 1 })\n\t\t\t\t\t.then((response) => {\n\t\t\t\t\t\tif (response && (response as any).image) {\n\t\t\t\t\t\t\tlet imageData = (response as any).image as string;\n\t\t\t\t\t\t\tif (typeof imageData === \"string\" && !imageData.startsWith(\"data:image/\")) imageData = \"data:image/png;base64,\" + imageData;\n\t\t\t\t\t\t\tthis.popupImage.src = imageData;\n\t\t\t\t\t\t\tthis.popup.style.display = \"block\";\n\t\t\t\t\t\t\tthis.triangle.style.display = \"block\";\n\t\t\t\t\t\t\tthis.updatePopupPosition();\n\t\t\t\t\t\t\tthis.popupTimeout = window.setTimeout(() => {\n\t\t\t\t\t\t\t\tthis.popup.style.display = \"none\";\n\t\t\t\t\t\t\t\tthis.triangle.style.display = \"none\";\n\t\t\t\t\t\t\t\tthis.popupTimeout = null;\n\t\t\t\t\t\t\t}, 3000);\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t\t.catch((err) => console.error(\"Error getting obstacle image:\", err));\n\t\t\t\tthis.updatePopupPosition();\n\t\t\t});\n\n\t\tenterGroups\n\t\t\t.append(\"circle\")\n\t\t\t.attr(\"class\", \"obstacle-bg\")\n\t\t\t.attr(\"r\", bgRadius)\n\t\t\t.attr(\"fill\", \"rgba(100, 100, 100, 0.2)\") // More transparent\n\t\t\t.attr(\"stroke\", \"white\")\n\t\t\t.attr(\"stroke-width\", 0.5); // Thinner border\n\n\t\tenterGroups\n\t\t\t.append(\"image\")\n\t\t\t.attr(\"class\", \"obstacle-icon\")\n\t\t\t.attr(\"width\", imageSize)\n\t\t\t.attr(\"height\", imageSize)\n\t\t\t.attr(\"x\", -imageSize / 2)\n\t\t\t.attr(\"y\", -imageSize / 2)\n\t\t\t.on(\"error\", function () {\n\t\t\t\td3.select(this).attr(\"href\", \"images/projects_comroborocktanos_resources_obstacle_new_p18.png\");\n\t\t\t});\n\n\t\tconst allGroups = enterGroups.merge(groups as any);\n\n\t\tallGroups.attr(\"transform\", (d: any) => {\n\t\t\tconst pos = this.robotToSvg({ x: d[0] + 25, y: d[1] + 25 }, params); // Added +25 offset for obstacle center?\n\t\t\treturn `translate(${pos.x}, ${pos.y})`;\n\t\t});\n\n\t\tallGroups\n\t\t\t.select(\"image\")\n\t\t\t.attr(\"href\", (d: any) => {\n\t\t\t\tconst type = d[2];\n\t\t\t\tconst suffix = OBSTACLE_MAPPING[type] || \"18\";\n\t\t\t\treturn `images/projects_comroborocktanos_resources_obstacle_new_p${suffix}.png`;\n\t\t\t});\n\t}\n\n\tprivate drawCarpet(carpetMap?: number[]) {\n\t\tif (!carpetMap || !this.mapImage || !this.mapImage.dimensions) {\n\t\t\tthis.carpetGroup.selectAll(\"*\").remove();\n\t\t\treturn;\n\t\t}\n\n\t\t// mapData provides UNSCALED dimensions (raw grid size)\n\t\t// We do NOT divide by VISUAL_BLOCK_SIZE here because dimensions IS the grid size.\n\t\tconst gridWidth = this.mapImage.dimensions.width;\n\t\tconst gridHeight = this.mapImage.dimensions.height;\n\t\tconst stride = 3;\n\n\t\tconst pathCoords: string[] = [];\n\n\t\t// Consistent Offsets with Coords.ts\n\t\t// For grid-based elements (Carpet), we align to the grid cell (0,0), not the center (1.5, 1.5).\n\t\t// Paths use 1.5 to be in the center of the cell. Carpets fill the cell.\n\t\tconst offsetX = 0;\n\t\tconst offsetY = 0;\n\n\t\tcarpetMap.forEach((px) => {\n\t\t\tconst col = px % gridWidth;\n\t\t\tconst row = Math.floor(px / gridWidth);\n\t\t\tconst invertedRow = gridHeight - row - 1;\n\n\t\t\tconst baseX = col * VISUAL_BLOCK_SIZE + offsetX;\n\t\t\tconst baseY = invertedRow * VISUAL_BLOCK_SIZE + offsetY;\n\n\t\t\tfor (let dx = 0; dx < VISUAL_BLOCK_SIZE; dx++) {\n\t\t\t\tfor (let dy = 0; dy < VISUAL_BLOCK_SIZE; dy++) {\n\t\t\t\t\tif ((dx + dy) % stride === 2) {\n\t\t\t\t\t\tpathCoords.push(`M${baseX + dx} ${baseY + dy}h1v1h-1z`);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tconst combinedPathData = pathCoords.join(\"\");\n\n\t\tconst pathSelection = this.carpetGroup.selectAll(\"path.carpet-path\").data([combinedPathData]);\n\t\tpathSelection.exit().remove();\n\t\tpathSelection\n\t\t\t.enter()\n\t\t\t.append(\"path\")\n\t\t\t.attr(\"class\", \"carpet-path\")\n\t\t\t.style(\"fill\", \"rgba(0, 0, 0, 0.4)\")\n\t\t\t.attr(\"shape-rendering\", \"crispEdges\")\n\t\t\t.merge(pathSelection as any)\n\t\t\t.attr(\"d\", (d) => d);\n\t}\n\n\tprivate drawZones() {\n\t\tconst dragHandler = d3\n\t\t\t.drag<SVGGElement, Rect>()\n\t\t\t.on(\"start\", (event: any) => {\n\t\t\t\tconst element = event.sourceEvent.target.closest(\"g.zone\");\n\t\t\t\tif (element) d3.select(element).raise().style(\"cursor\", \"grabbing\");\n\t\t\t\tthis.deleteButton.disabled = false;\n\t\t\t})\n\t\t\t.on(\"drag\", (event: any, d: Rect) => {\n\t\t\t\tif (!this.mapImage) return;\n\t\t\t\tconst minBoundX = this.mapMinX,\n\t\t\t\t\tminBoundY = this.mapMinY,\n\t\t\t\t\tmaxBoundX = this.mapMinX + this.mapSizeX,\n\t\t\t\t\tmaxBoundY = this.mapMinY + this.mapSizeY;\n\t\t\t\tlet newX = Math.max(minBoundX, d.x + event.dx);\n\t\t\t\tlet newY = Math.max(minBoundY, d.y + event.dy);\n\t\t\t\tif (newX + d.width > maxBoundX) newX = maxBoundX - d.width;\n\t\t\t\tif (newY + d.height > maxBoundY) newY = maxBoundY - d.height;\n\t\t\t\td.x = newX;\n\t\t\t\td.y = newY;\n\t\t\t\tconst element = event.sourceEvent.target.closest(\"g.zone\");\n\t\t\t\tif (element) d3.select(element).attr(\"transform\", `translate(${d.x}, ${d.y})`);\n\t\t\t})\n\t\t\t.on(\"end\", (event: any) => {\n\t\t\t\tconst element = event.sourceEvent.target.closest(\"g.zone\");\n\t\t\t\tif (element) d3.select(element).style(\"cursor\", \"move\");\n\t\t\t\tthis.updateRobotZones();\n\t\t\t});\n\n\t\tconst resizeHandler = d3\n\t\t\t.drag<SVGCircleElement, Rect>()\n\t\t\t.on(\"start\", (event: any) => {\n\t\t\t\tevent.sourceEvent.stopPropagation();\n\t\t\t\tconst element = event.sourceEvent.target;\n\t\t\t\tif (element) d3.select(element).raise();\n\t\t\t})\n\t\t\t.on(\"drag\", (event: any, d: Rect) => {\n\t\t\t\tif (!this.mapImage) return;\n\t\t\t\tconst maxBoundX = this.mapMinX + this.mapSizeX,\n\t\t\t\t\tmaxBoundY = this.mapMinY + this.mapSizeY;\n\t\t\t\tlet newWidth = Math.max(d.width + event.dx, 20);\n\t\t\t\tlet newHeight = Math.max(d.height + event.dy, 20);\n\t\t\t\tif (d.x + newWidth > maxBoundX) newWidth = maxBoundX - d.x;\n\t\t\t\tif (d.y + newHeight > maxBoundY) newHeight = maxBoundY - d.y;\n\t\t\t\td.width = newWidth;\n\t\t\t\td.height = newHeight;\n\t\t\t\tconst element = event.sourceEvent.target;\n\t\t\t\tif (element) {\n\t\t\t\t\tconst parentGroup = d3.select(element.parentNode as SVGGElement);\n\t\t\t\t\tparentGroup.select(\"rect\").attr(\"width\", d.width).attr(\"height\", d.height);\n\t\t\t\t\tparentGroup.select(\"circle.zone-handle\").attr(\"cx\", d.width).attr(\"cy\", d.height);\n\t\t\t\t}\n\t\t\t})\n\t\t\t.on(\"end\", () => this.updateRobotZones());\n\n\t\tconst selection = this.zoneGroup.selectAll(\"g.zone\").data(this.rects, (d: any) => d.id);\n\t\tselection.exit().remove();\n\t\tconst enterGroup = selection.enter().append(\"g\").attr(\"class\", \"zone\").call(dragHandler as any);\n\t\tenterGroup.append(\"rect\").attr(\"class\", \"zone-rect\").attr(\"x\", 0).attr(\"y\", 0).style(\"stroke-width\", this.rescaler.zoneStrokeWidth());\n\t\tenterGroup.append(\"circle\").attr(\"class\", \"zone-handle\").attr(\"r\", this.rescaler.zoneHandleRadius()).call(resizeHandler as any);\n\t\tconst mergedSelection = selection.merge(enterGroup as any);\n\t\tmergedSelection.attr(\"transform\", (d: Rect) => `translate(${d.x}, ${d.y})`);\n\t\tmergedSelection\n\t\t\t.select(\"rect\")\n\t\t\t.attr(\"width\", (d: Rect) => d.width)\n\t\t\t.attr(\"height\", (d: Rect) => d.height)\n\t\t\t.style(\"stroke-width\", this.rescaler.zoneStrokeWidth());\n\t\tmergedSelection\n\t\t\t.select(\"circle.zone-handle\")\n\t\t\t.attr(\"cx\", (d: Rect) => d.width)\n\t\t\t.attr(\"cy\", (d: Rect) => d.height)\n\t\t\t.attr(\"r\", this.rescaler.zoneHandleRadius());\n\t}\n\n\t// -----------------------------------------------------------------------------\n\t// Helper Methods\n\t// -----------------------------------------------------------------------------\n\n\tprivate updateRobotZones() {\n\t\tconst params = this.getMapParams();\n\t\tif (!params) return;\n\t\tconst cleanCountInput = document.getElementById(\"cleanCount\") as HTMLInputElement;\n\t\tthis.zones = [];\n\t\tconst cleanCount = parseInt(cleanCountInput.value) || 1;\n\t\tfor (const rect of this.rects) {\n\t\t\tconst p1 = { x: rect.x, y: rect.y };\n\t\t\tconst p2 = { x: rect.x + rect.width, y: rect.y + rect.height };\n\t\t\tconst coords1 = localCoordsToRobotCoords(p1, params);\n\t\t\tconst coords2 = localCoordsToRobotCoords(p2, params);\n\t\t\tthis.zones.push([\n\t\t\t\tMath.min(coords1.x, coords2.x),\n\t\t\t\tMath.min(coords1.y, coords2.y),\n\t\t\t\tMath.max(coords1.x, coords2.x),\n\t\t\t\tMath.max(coords1.y, coords2.y),\n\t\t\t\tcleanCount,\n\t\t\t]);\n\t\t}\n\t\tconsole.log(\"Zones updated:\", JSON.stringify(this.zones));\n\t}\n\n\tprivate updatePopupPosition() {\n\t\tif (this.popup.style.display === \"block\" && this.popupX !== undefined && this.popupY !== undefined) {\n\t\t\tconst transform = d3.zoomTransform(this.svgContainer.node() as Element);\n\t\t\tconst svgCoords = this.worldToSvgCoords(this.popupX, this.popupY);\n\t\t\tconst screenCoords = transform.apply([svgCoords.x, svgCoords.y]);\n\t\t\tthis.popup.style.left = `${screenCoords[0]}px`;\n\t\t\tthis.popup.style.top = `${screenCoords[1]}px`;\n\t\t}\n\t}\n\n\tprivate handleZoom(event: any) {\n\t\tconst transform = event.transform;\n\t\tthis.mainGroup.attr(\"transform\", transform);\n\t\tthis.wheelZoom = transform.k;\n\n\t\tthis.zoneGroup.selectAll(\"rect.zone-rect\").style(\"stroke-width\", this.rescaler.zoneStrokeWidth());\n\t\tthis.zoneGroup.selectAll(\"circle.zone-handle\").attr(\"r\", this.rescaler.zoneHandleRadius());\n\n\t\tconst scaledRobotSize = this.rescaler.robotSize();\n\t\tthis.robotGroup\n\t\t\t.selectAll(\"image.robot\")\n\t\t\t.attr(\"width\", scaledRobotSize)\n\t\t\t.attr(\"height\", scaledRobotSize)\n\t\t\t.attr(\"transform\", (d: any) => {\n\t\t\t\tconst params = this.getMapParams();\n\t\t\t\tif (!params) return \"\";\n\t\t\t\tconst svgCoords = this.robotToSvg({ x: d.position[0], y: d.position[1] }, params);\n\t\t\t\tconst angle = -(d.angle ?? 0) + 90;\n\t\t\t\treturn `translate(${svgCoords.x}, ${svgCoords.y}) rotate(${angle}) translate(${-scaledRobotSize / 2}, ${-scaledRobotSize / 2})`;\n\t\t\t});\n\n\t\tconst scaledChargerSize = this.rescaler.chargerSize();\n\t\tthis.chargerGroup\n\t\t\t.selectAll(\"image.charger\")\n\t\t\t.attr(\"width\", scaledChargerSize)\n\t\t\t.attr(\"height\", scaledChargerSize)\n\t\t\t.attr(\"x\", (d: any) => {\n\t\t\t\tconst params = this.getMapParams();\n\t\t\t\tif (!params) return 0;\n\t\t\t\treturn this.robotToSvg({ x: d.position[0], y: d.position[1] }, params).x - scaledChargerSize / 2;\n\t\t\t})\n\t\t\t.attr(\"y\", (d: any) => {\n\t\t\t\tconst params = this.getMapParams();\n\t\t\t\tif (!params) return 0;\n\t\t\t\treturn this.robotToSvg({ x: d.position[0], y: d.position[1] }, params).y - scaledChargerSize / 2;\n\t\t\t});\n\n\t\tthis.pathGroup.selectAll(\"path.main-path\").style(\"stroke-width\", `${this.rescaler.pathMainWidth()}px`);\n\t\tthis.backwashPathGroup.selectAll(\"path.backwash-path\").style(\"stroke-width\", `${this.rescaler.pathBackwashWidth()}px`);\n\t\tthis.mopPathGroup.selectAll(\"path.mop-path\").style(\"stroke-width\", `${this.rescaler.pathMopWidth()}px`);\n\t\tthis.pureCleanPathGroup.selectAll(\"path.pure-clean-path\").style(\"stroke-width\", `${this.rescaler.pathBackwashWidth()}px`);\n\n\t\tconst scaledPinWidth = this.rescaler.pinWidth();\n\t\tconst scaledPinHeight = this.rescaler.pinHeight();\n\t\tconst scaledPinYOffset = this.rescaler.pinYOffset();\n\t\tthis.pinGroup\n\t\t\t.selectAll(\"image.goto-pin\")\n\t\t\t.attr(\"width\", scaledPinWidth)\n\t\t\t.attr(\"height\", scaledPinHeight)\n\t\t\t.attr(\"x\", function () {\n\t\t\t\tconst centerX = d3.select(this).attr(\"data-center-x\");\n\t\t\t\treturn (parseFloat(centerX) || 0) - scaledPinWidth / 2;\n\t\t\t})\n\t\t\t.attr(\"y\", function () {\n\t\t\t\tconst centerY = d3.select(this).attr(\"data-center-y\");\n\t\t\t\treturn (parseFloat(centerY) || 0) - (scaledPinHeight - scaledPinYOffset);\n\t\t\t});\n\n\t\tthis.updatePopupPosition();\n\t}\n\n\tprivate getMapParams(): MapParams | null {\n\t\tif (!this.mapImage || !this.mapImage.dimensions || this.mapMaxY === undefined) {\n\t\t\treturn null;\n\t\t}\n\t\treturn {\n\t\t\tscaleFactor: VISUAL_BLOCK_SIZE,\n\t\t\tleft: this.mapImage.position.left,\n\t\t\ttopMap: this.mapImage.position.top,\n\t\t\tmapMaxY: this.mapMaxY,\n\t\t\timageHeight: this.mapImage.dimensions.height,\n\t\t\timageWidth: this.mapImage.dimensions.width,\n\t\t};\n\t}\n\n\tprivate screenToWorldCoords(x: number, y: number): Point {\n\t\tif (this.mapMinX === undefined || this.mapMinY === undefined) return { x: 0, y: 0 };\n\t\tconst transform = d3.zoomTransform(this.svgContainer.node() as Element);\n\t\tconst inverted = transform.invert([x, y]);\n\t\treturn { x: inverted[0], y: inverted[1] };\n\t}\n\n\tprivate worldToSvgCoords(x: number, y: number): Point {\n\t\t// Since we no longer translate the background image (it sits at 0,0),\n\t\t// we should not subtract mapMinX from the coordinates.\n\t\t// However, World Coordinates (from coords.ts) are 0-based relative to the Grid.\n\t\t// And the Image starts at Grid 0.\n\t\t// So WorldX = SvgX.\n\t\treturn { x: x, y: y };\n\t}\n\n\tprivate robotToSvg(robotPoint: Point, params: any): Point {\n\t\tconst worldPoint = robotCoordsToLocalCoords(robotPoint, params);\n\t\treturn this.worldToSvgCoords(worldPoint.x, worldPoint.y);\n\t}\n\n\tprivate roundTwoDecimals(number: number): number {\n\t\treturn Math.round(number * 100) / 100;\n\t}\n\n\tprivate getQueryParam(param: string): string | null {\n\t\tconst urlParams = new URLSearchParams(window.location.search);\n\t\treturn urlParams.get(param);\n\t}\n\n\tprivate bindUiEvents() {\n\t\tthis.robotSelect.addEventListener(\"change\", () => {\n\t\t\tconst newDuid = this.robotSelect.value;\n\t\t\tif (newDuid && newDuid !== this.currentRobotDuid) {\n\t\t\t\tthis.currentRobotDuid = newDuid;\n\t\t\t\tthis.setupSocketListeners(newDuid);\n\t\t\t}\n\t\t});\n\n\t\tthis.deleteButton.addEventListener(\"click\", () => {\n\t\t\tif (this.rects.length > 0) {\n\t\t\t\tthis.rects.pop();\n\t\t\t\tthis.drawZones();\n\t\t\t\tif (this.rects.length < 5) this.addButton.disabled = false;\n\t\t\t\tif (this.rects.length < 1) this.deleteButton.disabled = true;\n\t\t\t}\n\t\t});\n\n\t\tthis.addButton.addEventListener(\"click\", () => {\n\t\t\tif (this.goToTarget) {\n\t\t\t\tthis.goToTarget = false;\n\t\t\t\tthis.svg.style(\"cursor\", \"grab\");\n\t\t\t\tthis.svgContainer.on(\"mousemove.gototarget\", null);\n\t\t\t\tthis.svgContainer.on(\"click.gototarget\", null);\n\t\t\t\tthis.pinGroup.select(\"image.goto-pin\").style(\"display\", \"none\").style(\"opacity\", 0);\n\t\t\t\tthis.goToButton.textContent = \"GoTo Point\";\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tconst svgWidth = parseFloat(this.svg.attr(\"width\"));\n\t\t\tconst svgHeight = parseFloat(this.svg.attr(\"height\"));\n\t\t\tconst centerWorld = this.screenToWorldCoords(svgWidth / 2, svgHeight / 2);\n\t\t\tconst params = this.getMapParams();\n\t\t\tif (!params) return;\n\n\t\t\tthis.rects.push({\n\t\t\t\tid: this.rectCounter++,\n\t\t\t\tx: centerWorld.x - 25 * params.scaleFactor,\n\t\t\t\ty: centerWorld.y - 25 * params.scaleFactor,\n\t\t\t\twidth: 50 * params.scaleFactor,\n\t\t\t\theight: 50 * params.scaleFactor,\n\t\t\t});\n\t\t\tthis.drawZones();\n\t\t\tif (this.rects.length > 0) this.deleteButton.disabled = false;\n\t\t\tif (this.rects.length > 4) this.addButton.disabled = true;\n\t\t\tthis.updateRobotZones();\n\t\t});\n\n\t\tthis.startButton.addEventListener(\"click\", () => {\n\t\t\tif (!this.currentRobotDuid) return;\n\t\t\tthis.updateRobotZones();\n\t\t\tconst command = this.zones.length > 0 ? \"app_zoned_clean\" : \"app_start\";\n\t\t\tconst parameters = this.zones.length > 0 ? { zones: this.zones, duid: this.currentRobotDuid } : { duid: this.currentRobotDuid };\n\t\t\tthis.connection.sendTo(this.instanceId, command, parameters).catch((err) => console.error(\"Error sending command:\", err));\n\t\t\tthis.rects = [];\n\t\t\tthis.drawZones();\n\t\t\tthis.deleteButton.disabled = true;\n\t\t\tthis.addButton.disabled = false;\n\t\t\tthis.startButton.style.display = \"none\";\n\t\t\tthis.pauseButton.style.display = \"inline-block\";\n\t\t});\n\n\t\tthis.pauseButton.addEventListener(\"click\", () => {\n\t\t\tif (!this.currentRobotDuid) return;\n\t\t\tthis.connection.sendTo(this.instanceId, \"app_pause\", { duid: this.currentRobotDuid });\n\t\t\tthis.startButton.style.display = \"inline-block\";\n\t\t\tthis.pauseButton.style.display = \"none\";\n\t\t});\n\n\t\tthis.stopButton.addEventListener(\"click\", () => {\n\t\t\tif (!this.currentRobotDuid) return;\n\t\t\tthis.connection.sendTo(this.instanceId, \"app_stop\", { duid: this.currentRobotDuid });\n\t\t\tthis.startButton.style.display = \"inline-block\";\n\t\t\tthis.pauseButton.style.display = \"none\";\n\t\t});\n\n\t\tthis.dockButton.addEventListener(\"click\", () => {\n\t\t\tif (!this.currentRobotDuid) return;\n\t\t\tthis.connection.sendTo(this.instanceId, \"app_charge\", { duid: this.currentRobotDuid });\n\t\t});\n\n\t\tthis.goToButton.addEventListener(\"click\", () => {\n\t\t\tif (this.goToTarget) {\n\t\t\t\tthis.goToTarget = false;\n\t\t\t\tthis.svg.style(\"cursor\", \"grab\");\n\t\t\t\tthis.svgContainer.on(\"mousemove.gototarget\", null);\n\t\t\t\tthis.svgContainer.on(\"click.gototarget\", null);\n\t\t\t\tthis.pinGroup.select(\"image.goto-pin\").style(\"display\", \"none\").style(\"opacity\", 0);\n\t\t\t\tthis.goToButton.textContent = \"GoTo Point\";\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tthis.goToTarget = true;\n\t\t\tthis.svg.style(\"cursor\", \"none\");\n\t\t\tthis.goToButton.textContent = \"Cancel\";\n\t\t\tconst transform = d3.zoomTransform(this.svgContainer.node() as Element);\n\t\t\tconst svgWidth = parseFloat(this.svg.attr(\"width\"));\n\t\t\tconst svgHeight = parseFloat(this.svg.attr(\"height\"));\n\t\t\tconst [initialX, initialY] = transform.invert([svgWidth / 2, svgHeight / 2]);\n\t\t\tconst scaledPinWidth = this.rescaler.pinWidth();\n\t\t\tconst scaledPinHeight = this.rescaler.pinHeight();\n\t\t\tconst scaledPinYOffset = this.rescaler.pinYOffset();\n\t\t\tconst pin = this.pinGroup.select(\"image.goto-pin\");\n\t\t\tpin\n\t\t\t\t.style(\"display\", \"block\")\n\t\t\t\t.style(\"opacity\", 0.7)\n\t\t\t\t.attr(\"data-center-x\", initialX)\n\t\t\t\t.attr(\"data-center-y\", initialY)\n\t\t\t\t.attr(\"x\", initialX - scaledPinWidth / 2)\n\t\t\t\t.attr(\"y\", initialY - (scaledPinHeight - scaledPinYOffset));\n\n\t\t\tthis.svgContainer.on(\"mousemove.gototarget\", (event: MouseEvent) => {\n\t\t\t\tconst [mouseX, mouseY] = d3.pointer(event, this.mainGroup.node());\n\t\t\t\tconst scaledW = this.rescaler.pinWidth();\n\t\t\t\tconst scaledH = this.rescaler.pinHeight();\n\t\t\t\tconst scaledOff = this.rescaler.pinYOffset();\n\t\t\t\tpin\n\t\t\t\t\t.attr(\"data-center-x\", mouseX)\n\t\t\t\t\t.attr(\"data-center-y\", mouseY)\n\t\t\t\t\t.attr(\"x\", mouseX - scaledW / 2)\n\t\t\t\t\t.attr(\"y\", mouseY - (scaledH - scaledOff));\n\t\t\t});\n\n\t\t\tthis.svgContainer.on(\"click.gototarget\", (event: MouseEvent) => {\n\t\t\t\tevent.stopImmediatePropagation();\n\t\t\t\tconst params = this.getMapParams();\n\t\t\t\tif (!this.currentRobotDuid || !params) return;\n\t\t\t\tconst [mouseX, mouseY] = d3.pointer(event, this.mainGroup.node());\n\t\t\t\tconst worldX = mouseX;\n\t\t\t\tconst worldY = mouseY;\n\t\t\t\tconst point = localCoordsToRobotCoords({ x: worldX, y: worldY }, params);\n\t\t\t\tthis.connection.sendTo(this.instanceId, \"app_goto_target\", { points: [point.x, point.y], duid: this.currentRobotDuid });\n\t\t\t\tpin.style(\"opacity\", 1.0);\n\t\t\t\tthis.goToTarget = false;\n\t\t\t\tthis.svg.style(\"cursor\", \"grab\");\n\t\t\t\tthis.svgContainer.on(\"mousemove.gototarget\", null);\n\t\t\t\tthis.svgContainer.on(\"click.gototarget\", null);\n\t\t\t\tthis.goToButton.textContent = \"GoTo Point\";\n\t\t\t});\n\t\t});\n\n\t\tthis.resetZoomButton.addEventListener(\"click\", () => {\n\t\t\tif (this.initialTransform) {\n\t\t\t\tthis.svgContainer.transition().duration(750).call(this.zoom.transform as any, this.initialTransform);\n\t\t\t}\n\t\t});\n\n\t\tthis.popupImage.addEventListener(\"click\", () => {\n\t\t\tthis.largePhoto.style.display = \"block\";\n\t\t\tthis.popup.style.display = \"none\";\n\t\t\tthis.triangle.style.display = \"none\";\n\t\t\tif (this.popupTimeout) clearTimeout(this.popupTimeout);\n\t\t\tthis.popupTimeout = null;\n\t\t\tif (!this.currentRobotDuid || !this.selectedObstacleID) return;\n\t\t\tthis.largePhotoImage.src = \"\";\n\t\t\tthis.connection\n\t\t\t\t.sendTo(this.instanceId, \"get_obstacle_image\", { obstacleId: this.selectedObstacleID, duid: this.currentRobotDuid, type: 0 })\n\t\t\t\t.then((response: any) => {\n\t\t\t\t\tif (response && typeof response.image === \"string\") this.largePhotoImage.src = response.image.replace(/\\s/g, \"\");\n\t\t\t\t})\n\t\t\t\t.catch((err) => console.error(\"Error getting large obstacle image:\", err));\n\t\t});\n\n\t\tthis.largePhoto.addEventListener(\"click\", () => {\n\t\t\tthis.largePhoto.style.display = \"none\";\n\t\t});\n\t}\n\n\t// Rescaler Helper\n\tprivate get rescaler() {\n\t\treturn {\n\t\t\tscale: () => VISUAL_BLOCK_SIZE,\n\t\t\trobotSize: () => VISUAL_BLOCK_SIZE * UI_CONSTANTS.ROBOT_SIZE_BASE,\n\t\t\tchargerSize: () => VISUAL_BLOCK_SIZE * UI_CONSTANTS.CHARGER_SIZE_BASE,\n\t\t\tzoneStrokeWidth: () => UI_CONSTANTS.ZONE_STROKE_BASE / this.wheelZoom,\n\t\t\tzoneHandleRadius: () => UI_CONSTANTS.ZONE_HANDLE_RADIUS_BASE / this.wheelZoom,\n\t\t\tpinWidth: () => UI_CONSTANTS.PIN_WIDTH_BASE / this.wheelZoom,\n\t\t\tpinHeight: () => UI_CONSTANTS.PIN_HEIGHT_BASE / this.wheelZoom,\n\t\t\tpinYOffset: () => UI_CONSTANTS.PIN_Y_OFFSET_BASE / this.wheelZoom,\n\t\t\tpathMopWidth: () => UI_CONSTANTS.PATH_MOP_WIDTH_BASE * VISUAL_BLOCK_SIZE,\n\t\t\tpathMainWidth: () => Math.max(1, VISUAL_BLOCK_SIZE * UI_CONSTANTS.PATH_MAIN_WIDTH_RATIO_BASE),\n\t\t\tpathBackwashWidth: () => UI_CONSTANTS.PATH_BACKWASH_WIDTH_BASE * VISUAL_BLOCK_SIZE,\n\t\t};\n\t}\n}\n\n// =================================================================================\n// --- Main Entry Point ---\n// =================================================================================\n\nwindow.onload = async () => {\n\tconst app = new MapApplication();\n\tapp.init().catch((err) => console.error(\"Failed to initialize Map Application:\", err));\n};\n"]}