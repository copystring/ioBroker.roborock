# ğŸ“Ÿ B01 Protocol Documentation

**Status:** ğŸŸ¡ Reverse Engineered / Analyzing
**Protocol Version:** `B01`
**Transport:** ğŸŒ MQTT / Cloud

---

## ğŸ“– 1. Overview
The **B01** protocol is the modern communication standard for Roborock's newer generations (e.g., Q Revo, S8, S7 Max Ultra). It uses a standard `prop.set` / `prop.get` command structure wrapped in an encrypted MQTT payload.

It introduces `service.*` methods for complex actions like specific room cleaning and advanced preference handling.

---

## âš™ï¸ 2. Command Structure

> [!IMPORTANT]
> For a complete list of numerical status codes (Error `500`, State `121`, etc.) and their translations, see the [ğŸ“– Protocol Values & Translations](./Q7/README.md) index.

### ğŸ’¨ 2.1 Suction & Flow (`prop.set`)

| Property | Value | Description | Notes |
| :--- | :--- | :--- | :--- |
| **wind** | `1` | Quiet | Low suction |
| | `2` | Balanced | Standard mode |
| | `3` | Turbo | High power |
| | `4` | Max | Maximum suction |
| | `5` | Custom | Specialized mode |
| **water** | `0` | Off | No water |
| | `1` | Low | |
| | `2` | Medium | |
| | `3` | High | |

### ğŸ§¹ 2.2 Cleaning Preferences

*   **`work_mode`**: `0` = Standard, `1` = Custom, `2` = Silent.
*   **`repeat_state`**: `0` = Single pass, `1` = Double pass.
*   **`carpet_turbo`**: `1` = Enable auto-boost on carpet.
*   **`child_lock`**: `1` = On, `0` = Off.

---

## ğŸ› ï¸ 3. Service Methods (`service.*`)

Complex actions are handled via specific service calls rather than simple property sets.

### ğŸ“ Room Cleaning
**Method:** `service.set_room_clean`
```json
{
  "clean_type": 0,
  "ctrl_value": 1,
  "room_ids": [10, 11] // List of integer Room IDs
}
```

### ğŸŒ™ Quiet Time (DND)
**Method:** `service.set_quiet_time`
```json
{
  "is_open": 1,
  "quiet_begin_time": 1320, // Minutes from midnight (22:00)
  "quiet_end_time": 480     // Minutes from midnight (08:00)
}
```

### ğŸ”‹ Docking Control
*   **Start Recharging:** `service.start_recharge`
*   **Stop Recharging:** `service.stop_recharge`

---

## ğŸ”„ 4. Command Sequence

When changing modes via the App, the following sequence is typically observed:

1.  **Preference Setup:** `service.set_preference_type` (`{"prefer_type": 0}`)
2.  **Action:** `prop.set` (e.g., `{"mode": 2}`)
3.  **Confirmation:** `prop.get` (Push event reflecting the new state)

---

## ğŸ” 5. Technical Notes
*   **Encryption:** Standard Roborock AES-CBC with dynamic salt.
*   **Payload IDs:** `101` (Request), `102` (Response/Push Notification).
*   **Mapping:** `current_map_id` and `map_num` track the active floor.

