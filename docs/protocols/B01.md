# B01 Protocol Documentation

**Status:** Reverse Engineered / Analyzing
**Protocol Version:** B01
**Transport:** MQTT / Cloud

## 1. Overview
The B01 protocol uses a standard `prop.set` / `prop.get` command structure wrapped in an encrypted MQTT payload. It introduces `service.*` methods for complex actions like specific room cleaning and preference handling.

## 2. Command Structure

### 2. Command Structure

> [!NOTE]
> For a complete list of numerical status codes (Error `500`, State `121`, etc.) and their translations, see the [Protocol Values & Translations](./Q7/README.md) index.

### 2.1 Core Cleaning Commands (`prop.set`)
The primary method for controlling the robot's state.

#### Cleaning Modes (`mode`) (Read/Write)
| Value | Description | Notes |
| :--- | :--- | :--- |
| `0` | Quiet | *(Inferred)* |
| `1` | Balanced | Standard cleaning mode |
| `2` | Turbo | High power |
| `3` | Max | Maximum suction |

#### Fan Power / Suction (`wind`) (Read/Write)
| Value | Description | Notes |
| :--- | :--- | :--- |
| `1` | Quiet | |
| `2` | Balanced | |
| `3` | Turbo | |
| `4` | Max | |
| `5` | Custom (or Max+) | Seen in logs |

#### Water Level (`water`) (Read/Write)
| Value | Description |
| :--- | :--- |
| `1` | Low |
| `2` | Medium |
| `3` | High |

#### Other Properties
*   **`repeat_state`**: `0` = Single pass, `1` = Double pass.
*   **`carpet_turbo`**: `1` = Enable auto-boost on carpet.
*   **`child_lock`**: `1` = On, `0` = Off.

### 2.2 Service Methods (`service.*`)
Complex actions are handled via specific service calls.

#### Set Room Cleaning
**Method:** `service.set_room_clean`
```json
{
  "clean_type": 0,
  "ctrl_value": 1,
  "room_ids": [10, 11] // List of integer Room IDs
}
```

#### Set Quiet Time (DND)
**Method:** `service.set_quiet_time`
```json
{
  "is_open": 1,
  "quiet_begin_time": 1320, // Minutes from midnight (e.g. 22:00)
  "quiet_end_time": 480     // Minutes from midnight (e.g. 08:00)
}
```

#### Docking Control
*   **Start Recharging:** `service.start_recharge` (No params)
*   **Stop Recharging:** `service.stop_recharge` (No params)

## 3. Command Sequence
When changing cleaning modes via the App, the following sequence is typically observed:
1.  **Preference Setup:** `service.set_preference_type` (`{"prefer_type": 0}`)
2.  **Action:** `prop.set` (e.g., `{"mode": 2}`)
3.  **Confirmation:** `prop.get` (Push event reflecting the new state)

## 4. Derived Data (Analysis Notes)
*   **Encryption:** Standard RR Salt encryption.
*   **Proto:** `101` (Command), `102` (Response/Push).
*   **Map IDs:** `current_map_id` and `map_num` track the active map.
