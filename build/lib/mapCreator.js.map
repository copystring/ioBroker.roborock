{"version":3,"file":"mapCreator.js","sourceRoot":"","sources":["../../src/lib/mapCreator.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;AAEA,4CAAwH;AACxH,uCAAuC;AACvC,iDAA+D;AAC/D,uCAAuC;AACvC,iDAAmC;AAEnC,uBAAuB;AACvB,qBAAqB;AACrB,uBAAuB;AAEvB,MAAM,MAAM,GAAG,EAAE,CAAC;AAClB,MAAM,aAAa,GAAG,EAAE,CAAC;AAEzB,kDAAkD;AAClD,MAAM,UAAU,GAAG;IAClB,SAAS,EAAE,IAAI;IACf,SAAS,EAAE,IAAI;IACf,SAAS,EAAE,IAAI;IACf,SAAS,EAAE,IAAI;IACf,SAAS,EAAE,SAAS;IACpB,SAAS,EAAE,qBAAqB;CAChC,CAAC;AAEF,6CAA6C;AAC7C,MAAM,aAAa,GAAG;IACrB,KAAK,EAAE,SAAS;IAChB,QAAQ,EAAE,SAAS;IACnB,IAAI,EAAE,uBAAuB;CAC7B,CAAC;AAEF,MAAM,eAAe,GAA2B;IAC/C,CAAC,EAAE,MAAM;IACT,CAAC,EAAE,WAAW;IACd,CAAC,EAAE,UAAU;IACb,CAAC,EAAE,UAAU;IACb,CAAC,EAAE,UAAU;IACb,CAAC,EAAE,aAAa;IAChB,CAAC,EAAE,OAAO;IACV,EAAE,EAAE,QAAQ;IACZ,EAAE,EAAE,SAAS;IACb,EAAE,EAAE,SAAS;IACb,EAAE,EAAE,KAAK;IACT,EAAE,EAAE,KAAK;CACT,CAAC;AAmBF,MAAa,UAAU;IACtB,OAAO,CAAW;IAClB,MAAM,CAAqE;IAE3E,YAAY,OAAiB;QAC5B,IAAI,CAAC,OAAO,GAAG,OAAO,CAAC;QACvB,IAAI,CAAC,MAAM,GAAG;YACb,KAAK,EAAE,aAAa,CAAC,KAAK;YAC1B,QAAQ,EAAE,aAAa,CAAC,QAAQ;YAChC,IAAI,EAAE,aAAa,CAAC,IAAI;YACxB,MAAM,EAAE,IAAI;SACZ,CAAC;IACH,CAAC;IAED,uBAAuB;IACvB,qBAAqB;IACrB,uBAAuB;IAEf,IAAI,CAAC,UAAsB,EAAE,EAAU;QAC9C,OAAO,CAAC,EAAE,GAAG,IAAI,CAAC,OAAO,CAAC,MAAM,CAAC,SAAS,CAAC,GAAG,UAAU,CAAC,KAAK,CAAC;IAChE,CAAC;IAEO,IAAI,CAAC,UAAsB,EAAE,EAAU;QAC9C,OAAO,UAAU,CAAC,MAAM,GAAG,IAAI,CAAC,KAAK,CAAC,EAAE,GAAG,CAAC,UAAU,CAAC,KAAK,GAAG,IAAI,CAAC,OAAO,CAAC,MAAM,CAAC,SAAS,CAAC,CAAC,GAAG,IAAI,CAAC,OAAO,CAAC,MAAM,CAAC,SAAS,GAAG,IAAI,CAAC,OAAO,CAAC,MAAM,CAAC,SAAS,CAAC;IAChK,CAAC;IAEO,cAAc,CAAC,KAAU,EAAE,UAAkB;QACpD,OAAO,CAAC,UAAU,GAAG,KAAK,CAAC,QAAQ,CAAC,IAAI,CAAC,GAAG,IAAI,CAAC,OAAO,CAAC,MAAM,CAAC,SAAS,GAAG,CAAC,CAAC;IAC/E,CAAC;IAEO,cAAc,CAAC,KAAU,EAAE,UAAkB;QACpD,OAAO,CAAC,KAAK,CAAC,UAAU,CAAC,MAAM,GAAG,IAAI,CAAC,OAAO,CAAC,MAAM,CAAC,SAAS,GAAG,KAAK,CAAC,QAAQ,CAAC,GAAG,GAAG,UAAU,CAAC,GAAG,IAAI,CAAC,OAAO,CAAC,MAAM,CAAC,SAAS,GAAG,CAAC,CAAC;IACxI,CAAC;IAED,uBAAuB;IACvB,kBAAkB;IAClB,uBAAuB;IAEf,YAAY,CAAC,GAAU,EAAE,cAAsB;QACtD,MAAM,MAAM,GAAG,IAAA,qBAAY,EAAC,GAAG,CAAC,KAAK,EAAE,GAAG,CAAC,MAAM,CAAC,CAAC;QACnD,MAAM,GAAG,GAAG,MAAM,CAAC,UAAU,CAAC,IAAI,CAAC,CAAC;QACpC,MAAM,WAAW,GAAG,EAAE,CAAC;QACvB,IAAI,cAAc,GAAG,CAAC,CAAC,cAAc,GAAG,WAAW,CAAC,GAAG,IAAI,CAAC,EAAE,CAAC,GAAG,GAAG,CAAC;QACtE,cAAc,GAAG,CAAC,CAAC,cAAc,GAAG,IAAI,CAAC,EAAE,CAAC,GAAG,CAAC,CAAC,GAAG,IAAI,CAAC,EAAE,CAAC,CAAC,GAAG,IAAI,CAAC,EAAE,CAAC;QAExE,GAAG,CAAC,SAAS,CAAC,GAAG,CAAC,KAAK,GAAG,CAAC,EAAE,GAAG,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC;QAC7C,GAAG,CAAC,MAAM,CAAC,CAAC,cAAc,CAAC,CAAC;QAC5B,GAAG,CAAC,SAAS,CAAC,CAAC,GAAG,CAAC,KAAK,GAAG,CAAC,EAAE,CAAC,GAAG,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC;QAC/C,GAAG,CAAC,SAAS,CAAC,GAAG,EAAE,CAAC,EAAE,CAAC,CAAC,CAAC;QAEzB,OAAO,MAAM,CAAC;IACf,CAAC;IAEO,iBAAiB,CAAC,SAAoB,EAAE,EAAU,EAAE,EAAU,EAAE,EAAU,EAAE,EAAU;QAC7F,MAAM,MAAM,GAAG,SAAS,CAAC,IAAI,CAAC;QAC9B,MAAM,EAAE,GAAG,IAAI,CAAC,GAAG,CAAC,EAAE,GAAG,EAAE,CAAC,CAAC;QAC7B,MAAM,EAAE,GAAG,IAAI,CAAC,GAAG,CAAC,EAAE,GAAG,EAAE,CAAC,CAAC;QAC7B,MAAM,EAAE,GAAG,EAAE,GAAG,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;QAC5B,MAAM,EAAE,GAAG,EAAE,GAAG,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;QAC5B,IAAI,GAAG,GAAG,EAAE,GAAG,EAAE,CAAC;QAElB,OAAO,IAAI,EAAE,CAAC;YACb,IAAI,EAAE,IAAI,CAAC,IAAI,EAAE,GAAG,SAAS,CAAC,KAAK,IAAI,EAAE,IAAI,CAAC,IAAI,EAAE,GAAG,SAAS,CAAC,MAAM,EAAE,CAAC;gBACzE,MAAM,KAAK,GAAG,CAAC,EAAE,GAAG,EAAE,GAAG,SAAS,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC;gBAC9C,MAAM,CAAC,KAAK,CAAC,GAAG,GAAG,CAAC,CAAC,IAAI;gBACzB,MAAM,CAAC,KAAK,GAAG,CAAC,CAAC,GAAG,GAAG,CAAC,CAAC,IAAI;gBAC7B,MAAM,CAAC,KAAK,GAAG,CAAC,CAAC,GAAG,GAAG,CAAC,CAAC,IAAI;gBAC7B,MAAM,CAAC,KAAK,GAAG,CAAC,CAAC,GAAG,GAAG,CAAC,CAAC,4BAA4B;YACtD,CAAC;YAED,IAAI,EAAE,KAAK,EAAE,IAAI,EAAE,KAAK,EAAE;gBAAE,MAAM;YAClC,MAAM,EAAE,GAAG,CAAC,GAAG,GAAG,CAAC;YACnB,IAAI,EAAE,GAAG,CAAC,EAAE,EAAE,CAAC;gBACd,GAAG,IAAI,EAAE,CAAC;gBACV,EAAE,IAAI,EAAE,CAAC;YACV,CAAC;YACD,IAAI,EAAE,GAAG,EAAE,EAAE,CAAC;gBACb,GAAG,IAAI,EAAE,CAAC;gBACV,EAAE,IAAI,EAAE,CAAC;YACV,CAAC;QACF,CAAC;IACF,CAAC;IAED;;OAEG;IACK,oBAAoB,CAAC,aAAuB,EAAE,KAAa,EAAE,MAAc,EAAE,eAAuB;QAC3G,IAAI,cAAc,GAAG,CAAC,CAAC;QACvB,KAAK,MAAM,EAAE,IAAI,aAAa,EAAE,CAAC;YAChC,MAAM,MAAM,GAAG,EAAE,KAAK,EAAE,CAAC;YACzB,IAAI,MAAM,GAAG,cAAc;gBAAE,cAAc,GAAG,MAAM,CAAC;QACtD,CAAC;QACD,MAAM,IAAI,GAAG,IAAI,CAAC,GAAG,CAAC,eAAe,GAAG,CAAC,EAAE,cAAc,GAAG,CAAC,EAAE,aAAa,CAAC,CAAC;QAE9E,MAAM,MAAM,GAAe,KAAK,CAAC,IAAI,CAAC,EAAE,MAAM,EAAE,IAAI,EAAE,EAAE,GAAG,EAAE,CAAC,KAAK,CAAC,IAAI,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,CAAC;QACnF,MAAM,MAAM,GAAG,IAAI,UAAU,CAAC,KAAK,GAAG,MAAM,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,CAAC;QAEvD,KAAK,MAAM,EAAE,IAAI,aAAa,EAAE,CAAC;YAChC,MAAM,UAAU,GAAG,EAAE,GAAG,QAAQ,CAAC;YACjC,MAAM,MAAM,GAAG,EAAE,KAAK,EAAE,CAAC;YACzB,IAAI,UAAU,IAAI,CAAC,IAAI,UAAU,GAAG,MAAM,CAAC,MAAM,IAAI,MAAM,GAAG,IAAI,EAAE,CAAC;gBACpE,MAAM,CAAC,UAAU,CAAC,GAAG,MAAM,CAAC;YAC7B,CAAC;QACF,CAAC;QAED,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,MAAM,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE,CAAC;YACxC,MAAM,IAAI,GAAG,MAAM,CAAC,CAAC,CAAC,CAAC;YACvB,IAAI,IAAI,GAAG,CAAC;gBAAE,SAAS;YAEvB,MAAM,CAAC,GAAG,CAAC,GAAG,KAAK,CAAC;YACpB,MAAM,CAAC,GAAG,IAAI,CAAC,KAAK,CAAC,CAAC,GAAG,KAAK,CAAC,CAAC;YAEhC,IAAI,IAAI,GAAG,IAAI,EAAE,CAAC;gBACjB,MAAM,CAAC,IAAI,CAAC,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC,CAAC,2BAA2B;YACpD,CAAC;YAED,qBAAqB;YACrB,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC;gBACX,MAAM,IAAI,GAAG,MAAM,CAAC,CAAC,GAAG,KAAK,CAAC,CAAC;gBAC/B,IAAI,IAAI,IAAI,CAAC,IAAI,IAAI,KAAK,IAAI,IAAI,IAAI,GAAG,IAAI,IAAI,IAAI,GAAG,IAAI,EAAE,CAAC;oBAC9D,MAAM,CAAC,IAAI,CAAC,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;oBACvB,MAAM,CAAC,IAAI,CAAC,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;gBACxB,CAAC;YACF,CAAC;YACD,sBAAsB;YACtB,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC;gBACX,MAAM,IAAI,GAAG,MAAM,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC;gBAC3B,IAAI,IAAI,IAAI,CAAC,IAAI,IAAI,KAAK,IAAI,IAAI,IAAI,GAAG,IAAI,IAAI,IAAI,GAAG,IAAI,EAAE,CAAC;oBAC9D,MAAM,CAAC,IAAI,CAAC,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;oBACvB,MAAM,CAAC,IAAI,CAAC,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;gBACxB,CAAC;YACF,CAAC;QACF,CAAC;QACD,OAAO,MAAM,CAAC;IACf,CAAC;IAED,uBAAuB;IACvB,sBAAsB;IACtB,uBAAuB;IAEhB,KAAK,CAAC,SAAS,CAAC,OAAY,EAAE,SAA2B,EAAE;QACjE,MAAM,EAAE,WAAW,GAAG,IAAI,EAAE,WAAW,GAAG,IAAI,EAAE,OAAO,GAAG,EAAE,EAAE,GAAG,MAAM,CAAC;QAExE,sBAAsB;QACtB,IAAI,CAAC,OAAO,IAAI,CAAC,OAAO,CAAC,KAAK,IAAI,CAAC,OAAO,CAAC,KAAK,CAAC,UAAU,EAAE,CAAC;YAC7D,IAAI,CAAC,OAAO,CAAC,GAAG,CAAC,IAAI,CAAC,uEAAuE,CAAC,CAAC;YAC/F,OAAO,CAAC,IAAA,qBAAY,EAAC,CAAC,EAAE,CAAC,CAAC,CAAC,SAAS,EAAE,EAAE,IAAA,qBAAY,EAAC,CAAC,EAAE,CAAC,CAAC,CAAC,SAAS,EAAE,CAAC,CAAC;QACzE,CAAC;QAED,+BAA+B;QAC/B,IAAI,OAAO,EAAE,CAAC;YACb,IAAI,OAAO,CAAC,UAAU;gBAAE,IAAI,CAAC,MAAM,CAAC,KAAK,GAAG,OAAO,CAAC,UAAU,CAAC;YAC/D,IAAI,OAAO,CAAC,SAAS;gBAAE,IAAI,CAAC,MAAM,CAAC,QAAQ,GAAG,OAAO,CAAC,SAAS,CAAC;YAChE,IAAI,OAAO,CAAC,SAAS;gBAAE,IAAI,CAAC,MAAM,CAAC,IAAI,GAAG,OAAO,CAAC,SAAS,CAAC;YAC5D,IAAI,CAAC,MAAM,CAAC,MAAM,GAAG,OAAO,CAAC,MAAM,IAAI,IAAI,CAAC;QAC7C,CAAC;QAED,IAAI,cAAc,GAAG,MAAM,CAAC,kBAAkB,CAAC;QAC/C,QAAQ,OAAO,CAAC,KAAK,EAAE,CAAC;YACvB,KAAK,OAAO;gBACX,cAAc,GAAG,MAAM,CAAC,iBAAiB,CAAC;gBAC1C,MAAM;YACP,KAAK,QAAQ;gBACZ,cAAc,GAAG,MAAM,CAAC,UAAU,CAAC;gBACnC,MAAM;YACP,KAAK,MAAM;gBACV,cAAc,GAAG,MAAM,CAAC,QAAQ,CAAC;gBACjC,MAAM;YACP,KAAK,WAAW;gBACf,cAAc,GAAG,MAAM,CAAC,aAAa,CAAC;gBACtC,MAAM;YACP,KAAK,QAAQ;gBACZ,cAAc,GAAG,MAAM,CAAC,WAAW,CAAC;gBACpC,MAAM;QACR,CAAC;QAED,MAAM,CAAC,QAAQ,EAAE,UAAU,EAAE,UAAU,CAAC,GAAG,MAAM,OAAO,CAAC,GAAG,CAAC,CAAC,IAAA,kBAAS,EAAC,cAAc,CAAC,EAAE,IAAA,kBAAS,EAAC,MAAM,CAAC,WAAW,CAAC,EAAE,IAAA,kBAAS,EAAC,MAAM,CAAC,aAAa,CAAC,CAAC,CAAC,CAAC;QAE1J,sBAAsB;QACtB,OAAO,CAAC,KAAK,CAAC,UAAU,CAAC,KAAK,IAAI,IAAI,CAAC,OAAO,CAAC,MAAM,CAAC,SAAS,CAAC;QAChE,OAAO,CAAC,KAAK,CAAC,UAAU,CAAC,MAAM,IAAI,IAAI,CAAC,OAAO,CAAC,MAAM,CAAC,SAAS,CAAC;QAEjE,MAAM,MAAM,GAAG,IAAA,qBAAY,EAAC,OAAO,CAAC,KAAK,CAAC,UAAU,CAAC,KAAK,EAAE,OAAO,CAAC,KAAK,CAAC,UAAU,CAAC,MAAM,CAAC,CAAC;QAC7F,MAAM,GAAG,GAAG,MAAM,CAAC,UAAU,CAAC,IAAI,CAAC,CAAC;QAEpC,IAAI,MAAM,GAAG,CAAC,EACb,OAAO,GAAG,CAAC,EACX,OAAO,GAAG,OAAO,CAAC,KAAK,CAAC,UAAU,CAAC,KAAK,EACxC,MAAM,GAAG,OAAO,CAAC,KAAK,CAAC,UAAU,CAAC,MAAM,CAAC;QAE1C,6BAA6B;QAC7B,IAAI,OAAO,CAAC,KAAK,CAAC,MAAM,CAAC,KAAK,IAAI,OAAO,CAAC,KAAK,CAAC,MAAM,CAAC,KAAK,CAAC,MAAM,GAAG,CAAC,EAAE,CAAC;YACzE,IAAI,OAAO,OAAO,CAAC,KAAK,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC,CAAC,KAAK,QAAQ,EAAE,CAAC;gBACvD,OAAO,GAAG,OAAO,CAAC,KAAK,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC,CAAC,GAAG,OAAO,CAAC,KAAK,CAAC,UAAU,CAAC,KAAK,CAAC;gBACzE,MAAM,GAAG,OAAO,CAAC,KAAK,CAAC,UAAU,CAAC,MAAM,GAAG,CAAC,GAAG,IAAI,CAAC,KAAK,CAAC,OAAO,CAAC,KAAK,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC,CAAC,GAAG,OAAO,CAAC,KAAK,CAAC,UAAU,CAAC,KAAK,CAAC,CAAC;YAC3H,CAAC;YAED,CAAC,OAAO,EAAE,UAAU,CAAC,CAAC,OAAO,CAAC,CAAC,GAAG,EAAE,EAAE;gBACrC,IAAI,CAAC,OAAO,CAAC,KAAK,CAAC,MAAM,CAAC,GAAG,CAAC;oBAAE,OAAO;gBACvC,GAAG,CAAC,SAAS,EAAE,CAAC;gBAChB,OAAO,CAAC,KAAK,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC,OAAO,CAAC,CAAC,EAAE,EAAE,EAAE;oBACxC,MAAM,CAAC,GAAG,IAAI,CAAC,IAAI,CAAC,OAAO,CAAC,KAAK,CAAC,UAAU,EAAE,EAAE,CAAC,CAAC;oBAClD,MAAM,CAAC,GAAG,IAAI,CAAC,IAAI,CAAC,OAAO,CAAC,KAAK,CAAC,UAAU,EAAE,EAAE,CAAC,CAAC;oBAElD,GAAG,CAAC,SAAS,GAAG,GAAG,KAAK,UAAU,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,MAAM,CAAC,MAAM,CAAC,CAAC,CAAC,UAAU,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,MAAM,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,MAAM,CAAC,MAAM,CAAC,CAAC,CAAC,UAAU,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC;oBAE1J,GAAG,CAAC,IAAI,CAAC,CAAC,EAAE,CAAC,EAAE,IAAI,CAAC,OAAO,CAAC,MAAM,CAAC,SAAS,EAAE,IAAI,CAAC,OAAO,CAAC,MAAM,CAAC,SAAS,CAAC,CAAC;oBAE7E,MAAM,GAAG,IAAI,CAAC,GAAG,CAAC,MAAM,EAAE,CAAC,CAAC,CAAC;oBAC7B,OAAO,GAAG,IAAI,CAAC,GAAG,CAAC,OAAO,EAAE,CAAC,CAAC,CAAC;oBAC/B,OAAO,GAAG,IAAI,CAAC,GAAG,CAAC,OAAO,EAAE,CAAC,CAAC,CAAC;oBAC/B,MAAM,GAAG,IAAI,CAAC,GAAG,CAAC,MAAM,EAAE,CAAC,CAAC,CAAC;gBAC9B,CAAC,CAAC,CAAC;gBACH,GAAG,CAAC,IAAI,EAAE,CAAC;YACZ,CAAC,CAAC,CAAC;QACJ,CAAC;QAED,2BAA2B;QAC3B,MAAM,YAAY,GAAwB,EAAE,CAAC;QAE7C,IAAI,OAAO,CAAC,KAAK,CAAC,MAAM,CAAC,QAAQ,IAAI,IAAI,CAAC,MAAM,CAAC,MAAM,EAAE,CAAC;YACzD,gDAAgD;YAChD,OAAO,CAAC,KAAK,CAAC,MAAM,CAAC,QAAQ,CAAC,OAAO,CAAC,CAAC,EAAE,EAAE,EAAE;gBAC5C,MAAM,MAAM,GAAG,EAAE,IAAI,EAAE,CAAC;gBACxB,MAAM,UAAU,GAAG,EAAE,GAAG,QAAQ,CAAC;gBACjC,IAAI,MAAM,IAAI,aAAa;oBAAE,OAAO;gBAEpC,MAAM,CAAC,GAAG,IAAI,CAAC,IAAI,CAAC,OAAO,CAAC,KAAK,CAAC,UAAU,EAAE,UAAU,CAAC,CAAC;gBAC1D,MAAM,CAAC,GAAG,IAAI,CAAC,IAAI,CAAC,OAAO,CAAC,KAAK,CAAC,UAAU,EAAE,UAAU,CAAC,CAAC;gBAE1D,IAAI,CAAC,YAAY,CAAC,MAAM,CAAC,EAAE,CAAC;oBAC3B,YAAY,CAAC,MAAM,CAAC,GAAG,EAAE,MAAM,EAAE,EAAE,EAAE,IAAI,EAAE,CAAC,EAAE,IAAI,EAAE,CAAC,EAAE,IAAI,EAAE,CAAC,EAAE,IAAI,EAAE,CAAC,EAAE,CAAC;gBAC3E,CAAC;gBACD,MAAM,OAAO,GAAG,YAAY,CAAC,MAAM,CAAC,CAAC;gBACrC,OAAO,CAAC,MAAM,CAAC,IAAI,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC;gBAC9B,OAAO,CAAC,IAAI,GAAG,IAAI,CAAC,GAAG,CAAC,OAAO,CAAC,IAAI,EAAE,CAAC,CAAC,CAAC;gBACzC,OAAO,CAAC,IAAI,GAAG,IAAI,CAAC,GAAG,CAAC,OAAO,CAAC,IAAI,EAAE,CAAC,CAAC,CAAC;gBACzC,OAAO,CAAC,IAAI,GAAG,IAAI,CAAC,GAAG,CAAC,OAAO,CAAC,IAAI,EAAE,CAAC,CAAC,CAAC;gBACzC,OAAO,CAAC,IAAI,GAAG,IAAI,CAAC,GAAG,CAAC,OAAO,CAAC,IAAI,EAAE,CAAC,CAAC,CAAC;YAC1C,CAAC,CAAC,CAAC;YAEH,8EAA8E;YAC9E,MAAM,WAAW,GAAG,MAAM,CAAC,IAAI,CAAC,YAAY,CAAC,CAAC,GAAG,CAAC,MAAM,CAAC,CAAC;YAC1D,MAAM,KAAK,GAAG,WAAW,CAAC,MAAM,CAAC,CAAC,CAAC,IAAI,CAAC,GAAG,CAAC,GAAG,WAAW,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;YAChE,MAAM,UAAU,GAAG,aAAa,CAAC;YAEjC,MAAM,eAAe,GAAG,IAAI,CAAC,oBAAoB,CAAC,OAAO,CAAC,KAAK,CAAC,MAAM,CAAC,QAAQ,EAAE,OAAO,CAAC,KAAK,CAAC,UAAU,CAAC,KAAK,EAAE,OAAO,CAAC,KAAK,CAAC,UAAU,CAAC,MAAM,EAAE,KAAK,CAAC,CAAC;YAEzJ,MAAM,WAAW,GAAG,IAAI,KAAK,CAAC,UAAU,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC;YAClD,KAAK,MAAM,MAAM,IAAI,MAAM,CAAC,IAAI,CAAC,YAAY,CAAC,EAAE,CAAC;gBAChD,MAAM,GAAG,GAAG,MAAM,CAAC,MAAM,CAAC,CAAC;gBAC3B,IAAI,GAAG,IAAI,CAAC,IAAI,GAAG,GAAG,UAAU,EAAE,CAAC;oBAClC,WAAW,CAAC,GAAG,CAAC,GAAG,YAAY,CAAC,GAAG,CAAC,CAAC,MAAM,CAAC,MAAM,CAAC;gBACpD,CAAC;YACF,CAAC;YAED,MAAM,YAAY,GAAG,IAAI,KAAK,CAAC,UAAU,GAAG,UAAU,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC;YAChE,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,UAAU,EAAE,CAAC,EAAE,EAAE,CAAC;gBACrC,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,UAAU,EAAE,CAAC,EAAE,EAAE,CAAC;oBACrC,IAAI,eAAe,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,KAAK,CAAC;wBAAE,YAAY,CAAC,CAAC,GAAG,UAAU,GAAG,CAAC,CAAC,GAAG,CAAC,CAAC;gBACzE,CAAC;gBACD,IAAI,WAAW,CAAC,CAAC,CAAC,GAAG,CAAC;oBAAE,YAAY,CAAC,CAAC,GAAG,UAAU,GAAG,CAAC,CAAC,GAAG,CAAC,CAAC;YAC9D,CAAC;YAED,yDAAyD;YACzD,MAAM,QAAQ,GAAG,IAAA,4CAA6B,EAC7C,EAAE,WAAW,EAAE,UAAU,EAAE,YAAY,EAAE,WAAW,EAAE,EACtD,EAAE,QAAQ,EAAE,IAAI,EAAE,CAAC,sEAAsE;aACzF,CAAC;YAEF,yDAAyD;YACzD,MAAM,CAAC,IAAI,CAAC,YAAY,CAAC,CAAC,OAAO,CAAC,CAAC,MAAM,EAAE,EAAE;gBAC5C,MAAM,MAAM,GAAG,MAAM,CAAC,MAAM,CAAC,CAAC;gBAC9B,IAAI,MAAM,GAAG,CAAC,IAAI,MAAM,IAAI,UAAU;oBAAE,OAAO;gBAE/C,MAAM,kBAAkB,GAAG,OAAO,CAAC,wBAAwB,EAAE,QAAQ,CAAC,MAAM,CAAC,CAAC;gBAE9E,IAAI,SAAS,GAAG,QAAQ,CAAC,QAAQ,EAAE,CAAC,MAAM,CAAC,IAAI,SAAS,CAAC;gBACzD,IAAI,kBAAkB,EAAE,CAAC;oBACxB,SAAS,GAAG,MAAM,IAAI,CAAC,IAAI,MAAM,GAAG,UAAU,CAAC,MAAM,CAAC,CAAC,CAAC,UAAU,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,SAAS,CAAC;gBACxF,CAAC;gBAED,GAAG,CAAC,SAAS,GAAG,SAAS,CAAC;gBAC1B,GAAG,CAAC,SAAS,EAAE,CAAC;gBAChB,YAAY,CAAC,MAAM,CAAC,CAAC,MAAM,CAAC,OAAO,CAAC,CAAC,CAAC,EAAE,EAAE;oBACzC,GAAG,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,EAAE,IAAI,CAAC,OAAO,CAAC,MAAM,CAAC,SAAS,EAAE,IAAI,CAAC,OAAO,CAAC,MAAM,CAAC,SAAS,CAAC,CAAC;gBAClF,CAAC,CAAC,CAAC;gBACH,GAAG,CAAC,IAAI,EAAE,CAAC;YACZ,CAAC,CAAC,CAAC;QACJ,CAAC;aAAM,IAAI,OAAO,CAAC,KAAK,CAAC,MAAM,CAAC,QAAQ,EAAE,CAAC;YAC1C,mFAAmF;YACnF,IAAI,MAAM,EAAE,SAAS,CAAC;YACtB,GAAG,CAAC,SAAS,EAAE,CAAC;YAChB,OAAO,CAAC,KAAK,CAAC,MAAM,CAAC,QAAQ,CAAC,OAAO,CAAC,CAAC,EAAE,EAAE,EAAE;gBAC5C,MAAM,GAAG,EAAE,IAAI,EAAE,CAAC;gBAClB,IAAI,OAAO,CAAC,wBAAwB,EAAE,QAAQ,CAAC,MAAM,CAAC,EAAE,CAAC;oBACxD,IAAI,MAAM,KAAK,SAAS,EAAE,CAAC;wBAC1B,GAAG,CAAC,IAAI,EAAE,CAAC;wBACX,GAAG,CAAC,SAAS,EAAE,CAAC;wBAChB,GAAG,CAAC,SAAS,GAAG,MAAM,IAAI,CAAC,IAAI,MAAM,GAAG,UAAU,CAAC,MAAM,CAAC,CAAC,CAAC,UAAU,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,SAAS,CAAC;wBAC3F,SAAS,GAAG,MAAM,CAAC;oBACpB,CAAC;oBACD,EAAE,GAAG,EAAE,GAAG,OAAO,CAAC;oBAClB,GAAG,CAAC,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,OAAO,CAAC,KAAK,CAAC,UAAU,EAAE,EAAE,CAAC,EAAE,IAAI,CAAC,IAAI,CAAC,OAAO,CAAC,KAAK,CAAC,UAAU,EAAE,EAAE,CAAC,EAAE,IAAI,CAAC,OAAO,CAAC,MAAM,CAAC,SAAS,EAAE,IAAI,CAAC,OAAO,CAAC,MAAM,CAAC,SAAS,CAAC,CAAC;gBAC1J,CAAC;YACF,CAAC,CAAC,CAAC;YACH,GAAG,CAAC,IAAI,EAAE,CAAC;QACZ,CAAC;QAED,iBAAiB;QACjB,IAAI,OAAO,CAAC,UAAU,EAAE,CAAC;YACxB,sEAAsE;YACtE,IAAI,OAAO,CAAC,KAAK,CAAC,UAAU,CAAC,KAAK,IAAI,CAAC,IAAI,OAAO,CAAC,KAAK,CAAC,UAAU,CAAC,MAAM,IAAI,CAAC,EAAE,CAAC;gBACjF,IAAI,CAAC,OAAO,CAAC,GAAG,CAAC,KAAK,CAAC,6DAA6D,CAAC,CAAC;YACvF,CAAC;iBAAM,CAAC;gBACP,MAAM,MAAM,GAAG,CAAC,GAAG,IAAI,CAAC,OAAO,CAAC,MAAM,CAAC,SAAS,CAAC;gBACjD,MAAM,SAAS,GAAG,GAAG,CAAC,YAAY,CAAC,CAAC,EAAE,CAAC,EAAE,OAAO,CAAC,KAAK,CAAC,UAAU,CAAC,KAAK,EAAE,OAAO,CAAC,KAAK,CAAC,UAAU,CAAC,MAAM,CAAC,CAAC;gBAE1G,OAAO,CAAC,UAAU,CAAC,OAAO,CAAC,CAAC,EAAE,EAAE,EAAE;oBACjC,MAAM,EAAE,GAAG,IAAI,CAAC,IAAI,CAAC,OAAO,CAAC,KAAK,CAAC,UAAU,EAAE,EAAE,CAAC,GAAG,MAAM,CAAC;oBAC5D,MAAM,EAAE,GAAG,IAAI,CAAC,IAAI,CAAC,OAAO,CAAC,KAAK,CAAC,UAAU,EAAE,EAAE,CAAC,CAAC;oBACnD,MAAM,EAAE,GAAG,EAAE,GAAG,IAAI,CAAC,OAAO,CAAC,MAAM,CAAC,SAAS,GAAG,CAAC,CAAC;oBAClD,MAAM,EAAE,GAAG,EAAE,GAAG,IAAI,CAAC,OAAO,CAAC,MAAM,CAAC,SAAS,GAAG,CAAC,CAAC;oBAClD,IAAI,CAAC,iBAAiB,CAAC,SAAS,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,CAAC,CAAC;gBACnD,CAAC,CAAC,CAAC;gBACH,GAAG,CAAC,YAAY,CAAC,SAAS,EAAE,CAAC,EAAE,CAAC,CAAC,CAAC;YACnC,CAAC;QACF,CAAC;QAED,uBAAuB;QACvB,IAAI,OAAO,CAAC,uBAAuB,EAAE,CAAC,CAAC,CAAC,EAAE,CAAC;YAC1C,OAAO,CAAC,uBAAuB,CAAC,OAAO,CAAC,CAAC,KAAK,EAAE,EAAE;gBACjD,MAAM,CAAC,GAAG,IAAI,CAAC,cAAc,CAAC,OAAO,CAAC,KAAK,EAAE,KAAK,CAAC,CAAC,CAAC,GAAG,EAAE,CAAC,CAAC;gBAC5D,MAAM,CAAC,GAAG,IAAI,CAAC,cAAc,CAAC,OAAO,CAAC,KAAK,EAAE,KAAK,CAAC,CAAC,CAAC,GAAG,EAAE,CAAC,CAAC;gBAC5D,MAAM,CAAC,GAAG,IAAI,CAAC,cAAc,CAAC,OAAO,CAAC,KAAK,EAAE,KAAK,CAAC,CAAC,CAAC,GAAG,EAAE,CAAC,GAAG,CAAC,CAAC;gBAChE,MAAM,CAAC,GAAG,IAAI,CAAC,cAAc,CAAC,OAAO,CAAC,KAAK,EAAE,KAAK,CAAC,CAAC,CAAC,GAAG,EAAE,CAAC,GAAG,CAAC,CAAC;gBAEhE,GAAG,CAAC,SAAS,GAAG,qBAAqB,CAAC;gBACtC,GAAG,CAAC,QAAQ,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,CAAC;gBACzB,GAAG,CAAC,WAAW,GAAG,SAAS,CAAC;gBAC5B,GAAG,CAAC,SAAS,GAAG,CAAC,CAAC;gBAClB,GAAG,CAAC,UAAU,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,CAAC;YAC5B,CAAC,CAAC,CAAC;QACJ,CAAC;QAED,iCAAiC;QACjC,IAAI,CAAC,SAAS,CAAC,GAAG,EAAE,OAAO,CAAC,CAAC;QAE7B,yBAAyB;QACzB,IAAI,OAAO,CAAC,mBAAmB,EAAE,MAAM,EAAE,MAAM,EAAE,CAAC;YACjD,GAAG,CAAC,SAAS,GAAG,CAAC,CAAC,GAAG,IAAI,CAAC,OAAO,CAAC,MAAM,CAAC,SAAS,CAAC,GAAG,CAAC,CAAC;YACxD,GAAG,CAAC,WAAW,GAAG,wBAAwB,CAAC;YAC3C,GAAG,CAAC,WAAW,CAAC,CAAC,CAAC,GAAG,IAAI,CAAC,OAAO,CAAC,MAAM,CAAC,SAAS,EAAE,CAAC,GAAG,IAAI,CAAC,OAAO,CAAC,MAAM,CAAC,SAAS,CAAC,CAAC,CAAC;YACxF,GAAG,CAAC,OAAO,GAAG,OAAO,CAAC;YACtB,GAAG,CAAC,SAAS,EAAE,CAAC;YAEhB,IAAI,KAAK,GAAG,CAAC,CAAC,EACb,KAAK,GAAG,CAAC,CAAC,CAAC;YACZ,OAAO,CAAC,mBAAmB,CAAC,MAAM,CAAC,OAAO,CAAC,CAAC,KAAK,EAAE,KAAK,EAAE,EAAE;gBAC3D,MAAM,CAAC,GAAG,IAAI,CAAC,cAAc,CAAC,OAAO,CAAC,KAAK,EAAE,KAAK,CAAC,CAAC,CAAC,GAAG,EAAE,CAAC,CAAC;gBAC5D,MAAM,CAAC,GAAG,IAAI,CAAC,cAAc,CAAC,OAAO,CAAC,KAAK,EAAE,KAAK,CAAC,CAAC,CAAC,GAAG,EAAE,CAAC,CAAC;gBAE5D,IAAI,KAAK,KAAK,CAAC,EAAE,CAAC;oBACjB,GAAG,CAAC,SAAS,GAAG,wBAAwB,CAAC;oBACzC,GAAG,CAAC,QAAQ,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,GAAG,IAAI,CAAC,OAAO,CAAC,MAAM,CAAC,SAAS,CAAC,GAAG,CAAC,EAAE,CAAC,CAAC,GAAG,IAAI,CAAC,OAAO,CAAC,MAAM,CAAC,SAAS,CAAC,GAAG,CAAC,CAAC,CAAC;oBACrG,GAAG,CAAC,MAAM,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC;gBAClB,CAAC;qBAAM,IAAI,CAAC,KAAK,KAAK,IAAI,CAAC,KAAK,KAAK,EAAE,CAAC;oBACvC,GAAG,CAAC,MAAM,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC;gBAClB,CAAC;gBACD,KAAK,GAAG,CAAC,CAAC;gBACV,KAAK,GAAG,CAAC,CAAC;YACX,CAAC,CAAC,CAAC;YACH,GAAG,CAAC,MAAM,EAAE,CAAC;YACb,GAAG,CAAC,WAAW,CAAC,EAAE,CAAC,CAAC;YACpB,GAAG,CAAC,OAAO,GAAG,MAAM,CAAC;QACtB,CAAC;QAED,yDAAyD;QACzD,IAAI,CAAC,mBAAmB,CAAC,GAAG,EAAE,OAAO,CAAC,CAAC;QAEvC,qBAAqB;QACrB,IAAI,OAAO,CAAC,UAAU,EAAE,CAAC;YACxB,OAAO,CAAC,UAAU,CAAC,OAAO,CAAC,CAAC,QAAQ,EAAE,EAAE;gBACvC,MAAM,IAAI,GAAG,QAAQ,CAAC,CAAC,CAAC,CAAC;gBACzB,MAAM,KAAK,GAAG,eAAe,CAAC,IAAI,CAAC,IAAI,SAAS,CAAC;gBACjD,MAAM,UAAU,GAAG,IAAI,CAAC,KAAK,CAAC,QAAQ,CAAC,CAAC,CAAC,GAAG,GAAG,CAAC,CAAC;gBACjD,MAAM,IAAI,GAAG,KAAK,GAAG,CAAC,eAAe,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,IAAI,UAAU,IAAI,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC;gBAEvE,MAAM,CAAC,GAAG,IAAI,CAAC,cAAc,CAAC,OAAO,CAAC,KAAK,EAAE,QAAQ,CAAC,CAAC,CAAC,GAAG,EAAE,CAAC,CAAC;gBAC/D,MAAM,CAAC,GAAG,IAAI,CAAC,cAAc,CAAC,OAAO,CAAC,KAAK,EAAE,QAAQ,CAAC,CAAC,CAAC,GAAG,EAAE,CAAC,CAAC;gBAE/D,GAAG,CAAC,SAAS,GAAG,KAAK,CAAC;gBACtB,GAAG,CAAC,SAAS,EAAE,CAAC;gBAChB,GAAG,CAAC,GAAG,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,GAAG,IAAI,CAAC,EAAE,CAAC,CAAC;gBACjC,GAAG,CAAC,IAAI,EAAE,CAAC;gBAEX,GAAG,CAAC,IAAI,GAAG,iBAAiB,CAAC;gBAC7B,MAAM,SAAS,GAAG,GAAG,CAAC,WAAW,CAAC,IAAI,CAAC,CAAC,KAAK,CAAC;gBAC9C,MAAM,UAAU,GAAG,EAAE,CAAC;gBACtB,MAAM,OAAO,GAAG,CAAC,CAAC;gBAClB,MAAM,KAAK,GAAG,CAAC,GAAG,SAAS,GAAG,CAAC,GAAG,OAAO,CAAC;gBAC1C,MAAM,KAAK,GAAG,CAAC,GAAG,CAAC,GAAG,OAAO,GAAG,CAAC,CAAC;gBAClC,MAAM,KAAK,GAAG,SAAS,GAAG,CAAC,GAAG,OAAO,CAAC;gBACtC,MAAM,KAAK,GAAG,UAAU,GAAG,OAAO,CAAC;gBAEnC,GAAG,CAAC,SAAS,GAAG,KAAK,CAAC;gBACtB,IAAI,CAAC,SAAS,CAAC,GAAG,EAAE,KAAK,EAAE,KAAK,EAAE,KAAK,EAAE,KAAK,EAAE,CAAC,CAAC,CAAC;gBACnD,GAAG,CAAC,IAAI,EAAE,CAAC;gBAEX,GAAG,CAAC,SAAS,GAAG,OAAO,CAAC;gBACxB,GAAG,CAAC,SAAS,GAAG,QAAQ,CAAC;gBACzB,GAAG,CAAC,YAAY,GAAG,QAAQ,CAAC;gBAC5B,GAAG,CAAC,QAAQ,CAAC,IAAI,EAAE,CAAC,EAAE,CAAC,GAAG,CAAC,GAAG,OAAO,GAAG,UAAU,GAAG,CAAC,CAAC,CAAC;YACzD,CAAC,CAAC,CAAC;QACJ,CAAC;QAED,0BAA0B;QAC1B,IAAI,OAAO,CAAC,cAAc,EAAE,CAAC;YAC5B,MAAM,GAAG,GAAG,OAAO,CAAC,cAAc,CAAC,QAAQ,CAAC;YAC5C,MAAM,KAAK,GAAG,OAAO,CAAC,IAAI,EAAE,aAAa,IAAI,OAAO,CAAC,cAAc,CAAC,KAAK,CAAC;YAE1E,IAAI,GAAG,EAAE,CAAC,CAAC,CAAC,IAAI,GAAG,EAAE,CAAC,CAAC,CAAC,EAAE,CAAC;gBAC1B,MAAM,UAAU,GAAG,IAAI,CAAC,YAAY,CAAC,QAAQ,EAAE,KAAK,CAAC,CAAC;gBACtD,MAAM,CAAC,GAAG,IAAI,CAAC,cAAc,CAAC,OAAO,CAAC,KAAK,EAAE,GAAG,CAAC,CAAC,CAAC,GAAG,EAAE,CAAC,GAAG,QAAQ,CAAC,KAAK,GAAG,CAAC,CAAC;gBAC/E,MAAM,CAAC,GAAG,IAAI,CAAC,cAAc,CAAC,OAAO,CAAC,KAAK,EAAE,GAAG,CAAC,CAAC,CAAC,GAAG,EAAE,CAAC,GAAG,QAAQ,CAAC,MAAM,GAAG,CAAC,CAAC;gBAChF,GAAG,CAAC,SAAS,CAAC,UAAU,EAAE,CAAC,EAAE,CAAC,EAAE,UAAU,CAAC,KAAK,GAAG,CAAC,EAAE,UAAU,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC;YAC9E,CAAC;QACF,CAAC;QAED,IAAI,OAAO,CAAC,WAAW,EAAE,CAAC,CAAC,CAAC,IAAI,OAAO,CAAC,WAAW,EAAE,CAAC,CAAC,CAAC,EAAE,CAAC;YAC1D,GAAG,CAAC,SAAS,CACZ,UAAU,EACV,IAAI,CAAC,cAAc,CAAC,OAAO,CAAC,KAAK,EAAE,OAAO,CAAC,WAAW,CAAC,CAAC,CAAC,GAAG,EAAE,CAAC,GAAG,UAAU,CAAC,KAAK,GAAG,CAAC,EACtF,IAAI,CAAC,cAAc,CAAC,OAAO,CAAC,KAAK,EAAE,OAAO,CAAC,WAAW,CAAC,CAAC,CAAC,GAAG,EAAE,CAAC,GAAG,CAAC,UAAU,CAAC,MAAM,GAAG,CAAC,CAAC,EACzF,UAAU,CAAC,KAAK,EAChB,UAAU,CAAC,MAAM,CACjB,CAAC;QACH,CAAC;QAED,sBAAsB;QACtB,uFAAuF;QACvF,IAAI,YAAY,IAAI,WAAW,EAAE,CAAC;YACjC,MAAM,UAAU,GAAG,IAAI,CAAC,OAAO,CAAC,QAAQ,CAAC,iBAAiB,CAAC,KAAK,CAAC,CAAC;YAElE,MAAM,CAAC,IAAI,CAAC,YAAY,CAAC,CAAC,OAAO,CAAC,CAAC,SAAS,EAAE,EAAE;gBAC/C,MAAM,MAAM,GAAG,QAAQ,CAAC,SAAS,CAAC,CAAC;gBACnC,IAAI,MAAM,KAAK,CAAC;oBAAE,OAAO,CAAC,qBAAqB;gBAE/C,MAAM,OAAO,GAAG,YAAY,CAAC,MAAM,CAAC,CAAC;gBACrC,IAAI,QAAQ,GAAG,EAAE,CAAC;gBAElB,wEAAwE;gBACxE,wEAAwE;gBACxE,MAAM,OAAO,GAAG,WAAW,CAAC,IAAI,CAAC,CAAC,CAAC,EAAE,CAAC,EAAE,EAAE,CAAC,QAAQ,CAAC,EAAE,CAAC,KAAK,MAAM,CAAC,CAAC;gBACpE,IAAI,OAAO,EAAE,CAAC;oBACb,MAAM,MAAM,GAAG,OAAO,CAAC,CAAC,CAAC,CAAC;oBAC1B,MAAM,OAAO,GAAG,UAAU,CAAC,IAAI,CAAC,CAAC,CAAC,EAAE,EAAE,CAAC,MAAM,CAAC,CAAC,CAAC,EAAE,CAAC,KAAK,MAAM,CAAC,MAAM,CAAC,CAAC,CAAC;oBACxE,QAAQ,GAAG,OAAO,EAAE,IAAI,IAAI,EAAE,CAAC;gBAChC,CAAC;gBAED,IAAI,QAAQ,EAAE,CAAC;oBACd,MAAM,OAAO,GAAG,OAAO,CAAC,IAAI,GAAG,CAAC,OAAO,CAAC,IAAI,GAAG,OAAO,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;oBACjE,MAAM,OAAO,GAAG,OAAO,CAAC,IAAI,GAAG,CAAC,OAAO,CAAC,IAAI,GAAG,OAAO,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;oBAEjE,GAAG,CAAC,IAAI,GAAG,QAAQ,IAAI,CAAC,OAAO,CAAC,MAAM,CAAC,SAAS,GAAG,CAAC,UAAU,CAAC;oBAC/D,GAAG,CAAC,SAAS,GAAG,QAAQ,CAAC;oBACzB,GAAG,CAAC,YAAY,GAAG,QAAQ,CAAC;oBAC5B,GAAG,CAAC,SAAS,GAAG,CAAC,CAAC;oBAClB,GAAG,CAAC,WAAW,GAAG,OAAO,CAAC;oBAC1B,GAAG,CAAC,UAAU,CAAC,QAAQ,EAAE,OAAO,EAAE,OAAO,CAAC,CAAC;oBAC3C,GAAG,CAAC,SAAS,GAAG,OAAO,CAAC;oBACxB,GAAG,CAAC,QAAQ,CAAC,QAAQ,EAAE,OAAO,EAAE,OAAO,CAAC,CAAC;gBAC1C,CAAC;YACF,CAAC,CAAC,CAAC;QACJ,CAAC;QAED,oBAAoB;QACpB,MAAM,KAAK,GAAG,OAAO,GAAG,OAAO,GAAG,CAAC,GAAG,MAAM,CAAC;QAC7C,MAAM,KAAK,GAAG,MAAM,GAAG,MAAM,GAAG,CAAC,GAAG,MAAM,CAAC;QAE3C,IAAI,KAAK,IAAI,CAAC,IAAI,KAAK,IAAI,CAAC,IAAI,CAAC,QAAQ,CAAC,KAAK,CAAC,IAAI,CAAC,QAAQ,CAAC,KAAK,CAAC,EAAE,CAAC;YACtE,IAAI,CAAC,OAAO,CAAC,GAAG,CAAC,IAAI,CAAC,sEAAsE,CAAC,CAAC;YAC9F,OAAO,CAAC,MAAM,CAAC,SAAS,EAAE,EAAE,MAAM,CAAC,SAAS,EAAE,CAAC,CAAC;QACjD,CAAC;QAED,MAAM,aAAa,GAAG,IAAA,qBAAY,EAAC,KAAK,EAAE,KAAK,CAAC,CAAC;QACjD,MAAM,UAAU,GAAG,aAAa,CAAC,UAAU,CAAC,IAAI,CAAC,CAAC;QAElD,MAAM,EAAE,GAAG,IAAI,CAAC,GAAG,CAAC,CAAC,EAAE,OAAO,GAAG,MAAM,CAAC,CAAC;QACzC,MAAM,EAAE,GAAG,IAAI,CAAC,GAAG,CAAC,CAAC,EAAE,MAAM,GAAG,MAAM,CAAC,CAAC;QACxC,MAAM,QAAQ,GAAG,MAAM,CAAC,KAAK,GAAG,EAAE,CAAC;QACnC,MAAM,SAAS,GAAG,MAAM,CAAC,MAAM,GAAG,EAAE,CAAC;QAErC,MAAM,UAAU,GAAG,IAAI,CAAC,GAAG,CAAC,KAAK,EAAE,QAAQ,CAAC,CAAC;QAC7C,MAAM,UAAU,GAAG,IAAI,CAAC,GAAG,CAAC,KAAK,EAAE,SAAS,CAAC,CAAC;QAE9C,MAAM,WAAW,GAAG,GAAG,CAAC,YAAY,CAAC,EAAE,EAAE,EAAE,EAAE,UAAU,EAAE,UAAU,CAAC,CAAC;QAErE,UAAU,CAAC,YAAY,CAAC,WAAW,EAAE,CAAC,EAAE,CAAC,CAAC,CAAC;QAE3C,OAAO,CAAC,MAAM,CAAC,SAAS,EAAE,EAAE,aAAa,CAAC,SAAS,EAAE,CAAC,CAAC;IACxD,CAAC;IAED,uBAAuB;IACvB,uBAAuB;IACvB,uBAAuB;IAEf,SAAS,CAAC,GAA6B,EAAE,OAAY;QAC5D,IAAI,CAAC,OAAO,CAAC,IAAI,EAAE,MAAM,IAAI,CAAC,OAAO,CAAC,QAAQ;YAAE,OAAO;QAEvD,MAAM,KAAK,GAAG,IAAI,CAAC,OAAO,CAAC,MAAM,CAAC,SAAS,CAAC;QAC5C,MAAM,MAAM,GAAG,OAAO,CAAC,IAAI,CAAC,MAAM,CAAC;QACnC,MAAM,IAAI,GAAG,OAAO,CAAC,QAAQ,CAAC;QAC9B,MAAM,SAAS,GAAG,CAAC,EAAE,CAAC;QAEtB,wCAAwC;QACxC,GAAG,CAAC,SAAS,GAAG,CAAC,GAAG,KAAK,CAAC;QAC1B,GAAG,CAAC,OAAO,GAAG,OAAO,CAAC;QACtB,GAAG,CAAC,QAAQ,GAAG,OAAO,CAAC;QACvB,GAAG,CAAC,WAAW,GAAG,wBAAwB,CAAC;QAC3C,GAAG,CAAC,SAAS,EAAE,CAAC;QAEhB,IAAI,OAAO,GAAG,CAAC,CAAC,CAAC;QACjB,IAAI,cAAc,GAAG,KAAK,CAAC;QAE3B,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,MAAM,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE,CAAC;YACxC,MAAM,MAAM,GAAG,CAAC,GAAG,SAAS,CAAC;YAC7B,IAAI,IAAI,EAAE,CAAC,MAAM,CAAC,GAAG,CAAC,EAAE,CAAC;gBACxB,MAAM,CAAC,GAAG,IAAI,CAAC,cAAc,CAAC,OAAO,CAAC,KAAK,EAAE,MAAM,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,GAAG,EAAE,CAAC,CAAC;gBAChE,MAAM,CAAC,GAAG,IAAI,CAAC,cAAc,CAAC,OAAO,CAAC,KAAK,EAAE,MAAM,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,GAAG,EAAE,CAAC,CAAC;gBAEhE,IAAI,CAAC,cAAc,EAAE,CAAC;oBACrB,GAAG,CAAC,MAAM,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC;oBACjB,cAAc,GAAG,IAAI,CAAC;gBACvB,CAAC;qBAAM,CAAC;oBACP,IAAI,CAAC,gBAAgB,CAAC,GAAG,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,OAAO,EAAE,MAAM,EAAE,OAAO,CAAC,CAAC;gBAC/D,CAAC;gBACD,OAAO,GAAG,CAAC,CAAC;YACb,CAAC;iBAAM,CAAC;gBACP,cAAc,GAAG,KAAK,CAAC;YACxB,CAAC;QACF,CAAC;QACD,GAAG,CAAC,MAAM,EAAE,CAAC;QAEb,eAAe;QACf,GAAG,CAAC,SAAS,GAAG,IAAI,CAAC,GAAG,CAAC,CAAC,EAAE,KAAK,GAAG,CAAC,CAAC,CAAC;QACvC,GAAG,CAAC,WAAW,GAAG,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC;QACnC,GAAG,CAAC,SAAS,EAAE,CAAC;QAChB,GAAG,CAAC,WAAW,CAAC,EAAE,CAAC,CAAC;QAEpB,OAAO,GAAG,CAAC,CAAC,CAAC;QACb,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,MAAM,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE,CAAC;YACxC,MAAM,GAAG,GAAG,CAAC,GAAG,SAAS,CAAC;YAC1B,MAAM,UAAU,GAAG,GAAG,IAAI,CAAC,IAAI,GAAG,GAAG,IAAI,CAAC,MAAM,IAAI,CAAC,CAAC,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,CAAC,GAAG,CAAC,CAAC,KAAK,CAAC,CAAC;YAEjF,IAAI,CAAC,UAAU,EAAE,CAAC;gBACjB,MAAM,CAAC,GAAG,IAAI,CAAC,cAAc,CAAC,OAAO,CAAC,KAAK,EAAE,MAAM,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,GAAG,EAAE,CAAC,CAAC;gBAChE,MAAM,CAAC,GAAG,IAAI,CAAC,cAAc,CAAC,OAAO,CAAC,KAAK,EAAE,MAAM,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,GAAG,EAAE,CAAC,CAAC;gBAChE,IAAI,CAAC,gBAAgB,CAAC,GAAG,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,OAAO,EAAE,MAAM,EAAE,OAAO,CAAC,CAAC;gBAC9D,OAAO,GAAG,CAAC,CAAC;YACb,CAAC;iBAAM,CAAC;gBACP,OAAO,GAAG,CAAC,CAAC,CAAC;YACd,CAAC;QACF,CAAC;QACD,GAAG,CAAC,MAAM,EAAE,CAAC;QAEb,uBAAuB;QACvB,GAAG,CAAC,SAAS,GAAG,GAAG,GAAG,KAAK,CAAC;QAC5B,GAAG,CAAC,WAAW,GAAG,uBAAuB,CAAC;QAC1C,GAAG,CAAC,WAAW,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC;QACxB,GAAG,CAAC,SAAS,EAAE,CAAC;QAEhB,OAAO,GAAG,CAAC,CAAC,CAAC;QACb,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,MAAM,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE,CAAC;YACxC,MAAM,GAAG,GAAG,CAAC,GAAG,SAAS,CAAC;YAC1B,MAAM,UAAU,GAAG,GAAG,IAAI,CAAC,IAAI,GAAG,GAAG,IAAI,CAAC,MAAM,IAAI,CAAC,CAAC,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,CAAC,GAAG,CAAC,CAAC,KAAK,CAAC,CAAC;YAEjF,IAAI,UAAU,EAAE,CAAC;gBAChB,MAAM,CAAC,GAAG,IAAI,CAAC,cAAc,CAAC,OAAO,CAAC,KAAK,EAAE,MAAM,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,GAAG,EAAE,CAAC,CAAC;gBAChE,MAAM,CAAC,GAAG,IAAI,CAAC,cAAc,CAAC,OAAO,CAAC,KAAK,EAAE,MAAM,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,GAAG,EAAE,CAAC,CAAC;gBAChE,IAAI,CAAC,gBAAgB,CAAC,GAAG,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,OAAO,EAAE,MAAM,EAAE,OAAO,CAAC,CAAC;gBAC9D,OAAO,GAAG,CAAC,CAAC;YACb,CAAC;iBAAM,CAAC;gBACP,OAAO,GAAG,CAAC,CAAC,CAAC;YACd,CAAC;QACF,CAAC;QACD,GAAG,CAAC,MAAM,EAAE,CAAC;QACb,GAAG,CAAC,WAAW,CAAC,EAAE,CAAC,CAAC;IACrB,CAAC;IAEO,gBAAgB,CAAC,GAA6B,EAAE,CAAS,EAAE,CAAS,EAAE,OAAe,EAAE,OAAe,EAAE,MAAkB,EAAE,OAAY;QAC/I,MAAM,KAAK,GAAG,IAAI,CAAC,OAAO,CAAC,MAAM,CAAC,SAAS,CAAC;QAC5C,MAAM,SAAS,GAAG,EAAE,GAAG,KAAK,CAAC;QAE7B,IAAI,OAAO,GAAG,CAAC,EAAE,CAAC;YACjB,GAAG,CAAC,MAAM,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC;QAClB,CAAC;aAAM,CAAC;YACP,MAAM,IAAI,GAAG,MAAM,CAAC,OAAO,CAAC,CAAC;YAC7B,MAAM,EAAE,GAAG,IAAI,CAAC,cAAc,CAAC,OAAO,CAAC,KAAK,EAAE,IAAI,CAAC,CAAC,CAAC,GAAG,EAAE,CAAC,CAAC;YAC5D,MAAM,EAAE,GAAG,IAAI,CAAC,cAAc,CAAC,OAAO,CAAC,KAAK,EAAE,IAAI,CAAC,CAAC,CAAC,GAAG,EAAE,CAAC,CAAC;YAE5D,IAAI,IAAI,CAAC,KAAK,CAAC,CAAC,GAAG,EAAE,EAAE,CAAC,GAAG,EAAE,CAAC,GAAG,SAAS,IAAI,OAAO,KAAK,OAAO,GAAG,CAAC,EAAE,CAAC;gBACvE,GAAG,CAAC,MAAM,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC;YAClB,CAAC;iBAAM,CAAC;gBACP,GAAG,CAAC,MAAM,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC;YAClB,CAAC;QACF,CAAC;IACF,CAAC;IAEO,mBAAmB,CAAC,GAA6B,EAAE,OAAY;QACtE,MAAM,YAAY,GAAG,CAAC,KAAiB,EAAE,IAAY,EAAE,MAAc,EAAE,EAAE;YACxE,IAAI,CAAC,KAAK;gBAAE,OAAO;YACnB,KAAK,CAAC,OAAO,CAAC,CAAC,IAAI,EAAE,EAAE;gBACtB,MAAM,EAAE,GAAG,IAAI,CAAC,cAAc,CAAC,OAAO,CAAC,KAAK,EAAE,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,CAAC,CAAC,EAAE,IAAI,CAAC,CAAC,CAAC,EAAE,IAAI,CAAC,CAAC,CAAC,EAAE,IAAI,CAAC,CAAC,CAAC,CAAC,GAAG,EAAE,CAAC,CAAC;gBACjG,MAAM,EAAE,GAAG,IAAI,CAAC,cAAc,CAAC,OAAO,CAAC,KAAK,EAAE,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,CAAC,CAAC,EAAE,IAAI,CAAC,CAAC,CAAC,EAAE,IAAI,CAAC,CAAC,CAAC,EAAE,IAAI,CAAC,CAAC,CAAC,CAAC,GAAG,EAAE,CAAC,CAAC;gBACjG,MAAM,EAAE,GAAG,IAAI,CAAC,cAAc,CAAC,OAAO,CAAC,KAAK,EAAE,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,CAAC,CAAC,EAAE,IAAI,CAAC,CAAC,CAAC,EAAE,IAAI,CAAC,CAAC,CAAC,EAAE,IAAI,CAAC,CAAC,CAAC,CAAC,GAAG,EAAE,CAAC,CAAC;gBACjG,MAAM,EAAE,GAAG,IAAI,CAAC,cAAc,CAAC,OAAO,CAAC,KAAK,EAAE,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,CAAC,CAAC,EAAE,IAAI,CAAC,CAAC,CAAC,EAAE,IAAI,CAAC,CAAC,CAAC,EAAE,IAAI,CAAC,CAAC,CAAC,CAAC,GAAG,EAAE,CAAC,CAAC;gBAEjG,MAAM,IAAI,GAAG,IAAI,CAAC,GAAG,CAAC,EAAE,EAAE,EAAE,CAAC,CAAC;gBAC9B,MAAM,IAAI,GAAG,IAAI,CAAC,GAAG,CAAC,EAAE,EAAE,EAAE,CAAC,CAAC;gBAC9B,MAAM,IAAI,GAAG,IAAI,CAAC,GAAG,CAAC,EAAE,EAAE,EAAE,CAAC,CAAC;gBAC9B,MAAM,IAAI,GAAG,IAAI,CAAC,GAAG,CAAC,EAAE,EAAE,EAAE,CAAC,CAAC;gBAC9B,MAAM,CAAC,GAAG,IAAI,GAAG,IAAI,CAAC;gBACtB,MAAM,CAAC,GAAG,IAAI,GAAG,IAAI,CAAC;gBAEtB,GAAG,CAAC,SAAS,GAAG,IAAI,CAAC;gBACrB,GAAG,CAAC,QAAQ,CAAC,IAAI,EAAE,IAAI,EAAE,CAAC,EAAE,CAAC,CAAC,CAAC;gBAC/B,GAAG,CAAC,WAAW,GAAG,MAAM,CAAC;gBACzB,GAAG,CAAC,SAAS,GAAG,CAAC,CAAC,GAAG,IAAI,CAAC,OAAO,CAAC,MAAM,CAAC,SAAS,CAAC,GAAG,CAAC,CAAC;gBACxD,GAAG,CAAC,UAAU,CAAC,IAAI,EAAE,IAAI,EAAE,CAAC,EAAE,CAAC,CAAC,CAAC;YAClC,CAAC,CAAC,CAAC;QACJ,CAAC,CAAC;QAEF,YAAY,CAAC,OAAO,CAAC,eAAe,EAAE,sBAAsB,EAAE,oBAAoB,CAAC,CAAC;QACpF,YAAY,CAAC,OAAO,CAAC,WAAW,EAAE,sBAAsB,EAAE,oBAAoB,CAAC,CAAC;QAEhF,IAAI,OAAO,CAAC,aAAa,EAAE,CAAC;YAC3B,GAAG,CAAC,WAAW,GAAG,oBAAoB,CAAC;YACvC,MAAM,SAAS,GAAG,CAAC,GAAG,IAAI,CAAC,OAAO,CAAC,MAAM,CAAC,SAAS,CAAC;YACpD,GAAG,CAAC,SAAS,GAAG,SAAS,CAAC;YAE1B,GAAG,CAAC,SAAS,EAAE,CAAC;YAChB,OAAO,CAAC,aAAa,CAAC,OAAO,CAAC,CAAC,IAAI,EAAE,EAAE;gBACtC,MAAM,MAAM,GAAG,IAAI,CAAC,cAAc,CAAC,OAAO,CAAC,KAAK,EAAE,IAAI,CAAC,CAAC,CAAC,GAAG,EAAE,CAAC,CAAC;gBAChE,MAAM,MAAM,GAAG,IAAI,CAAC,cAAc,CAAC,OAAO,CAAC,KAAK,EAAE,IAAI,CAAC,CAAC,CAAC,GAAG,EAAE,CAAC,CAAC;gBAChE,MAAM,IAAI,GAAG,IAAI,CAAC,cAAc,CAAC,OAAO,CAAC,KAAK,EAAE,IAAI,CAAC,CAAC,CAAC,GAAG,EAAE,CAAC,CAAC;gBAC9D,MAAM,IAAI,GAAG,IAAI,CAAC,cAAc,CAAC,OAAO,CAAC,KAAK,EAAE,IAAI,CAAC,CAAC,CAAC,GAAG,EAAE,CAAC,CAAC;gBAE9D,IAAI,IAAI,GAAG,IAAI,GAAG,MAAM,CAAC;gBACzB,IAAI,IAAI,GAAG,IAAI,GAAG,MAAM,CAAC;gBACzB,MAAM,GAAG,GAAG,IAAI,CAAC,IAAI,CAAC,IAAI,GAAG,IAAI,GAAG,IAAI,GAAG,IAAI,CAAC,CAAC;gBACjD,IAAI,IAAI,GAAG,CAAC;gBACZ,IAAI,IAAI,GAAG,CAAC;gBAEZ,MAAM,cAAc,GAAG,MAAM,GAAG,IAAI,GAAG,CAAC,SAAS,GAAG,CAAC,CAAC,CAAC;gBACvD,MAAM,cAAc,GAAG,MAAM,GAAG,IAAI,GAAG,CAAC,SAAS,GAAG,CAAC,CAAC,CAAC;gBACvD,MAAM,YAAY,GAAG,IAAI,GAAG,IAAI,GAAG,CAAC,SAAS,GAAG,CAAC,CAAC,CAAC;gBACnD,MAAM,YAAY,GAAG,IAAI,GAAG,IAAI,GAAG,CAAC,SAAS,GAAG,CAAC,CAAC,CAAC;gBAEnD,GAAG,CAAC,MAAM,CAAC,cAAc,EAAE,cAAc,CAAC,CAAC;gBAC3C,GAAG,CAAC,MAAM,CAAC,YAAY,EAAE,YAAY,CAAC,CAAC;YACxC,CAAC,CAAC,CAAC;YACH,GAAG,CAAC,MAAM,EAAE,CAAC;QACd,CAAC;IACF,CAAC;IAEO,SAAS,CAAC,GAA6B,EAAE,CAAS,EAAE,CAAS,EAAE,KAAa,EAAE,MAAc,EAAE,MAAc;QACnH,GAAG,CAAC,SAAS,EAAE,CAAC;QAChB,GAAG,CAAC,MAAM,CAAC,CAAC,GAAG,MAAM,EAAE,CAAC,CAAC,CAAC;QAC1B,GAAG,CAAC,MAAM,CAAC,CAAC,GAAG,KAAK,GAAG,MAAM,EAAE,CAAC,CAAC,CAAC;QAClC,GAAG,CAAC,gBAAgB,CAAC,CAAC,GAAG,KAAK,EAAE,CAAC,EAAE,CAAC,GAAG,KAAK,EAAE,CAAC,GAAG,MAAM,CAAC,CAAC;QAC1D,GAAG,CAAC,MAAM,CAAC,CAAC,GAAG,KAAK,EAAE,CAAC,GAAG,MAAM,GAAG,MAAM,CAAC,CAAC;QAC3C,GAAG,CAAC,gBAAgB,CAAC,CAAC,GAAG,KAAK,EAAE,CAAC,GAAG,MAAM,EAAE,CAAC,GAAG,KAAK,GAAG,MAAM,EAAE,CAAC,GAAG,MAAM,CAAC,CAAC;QAC5E,GAAG,CAAC,MAAM,CAAC,CAAC,GAAG,MAAM,EAAE,CAAC,GAAG,MAAM,CAAC,CAAC;QACnC,GAAG,CAAC,gBAAgB,CAAC,CAAC,EAAE,CAAC,GAAG,MAAM,EAAE,CAAC,EAAE,CAAC,GAAG,MAAM,GAAG,MAAM,CAAC,CAAC;QAC5D,GAAG,CAAC,MAAM,CAAC,CAAC,EAAE,CAAC,GAAG,MAAM,CAAC,CAAC;QAC1B,GAAG,CAAC,gBAAgB,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,GAAG,MAAM,EAAE,CAAC,CAAC,CAAC;QAC1C,GAAG,CAAC,SAAS,EAAE,CAAC;IACjB,CAAC;CACD;AAvqBD,gCAuqBC","sourcesContent":["// src/lib/mapCreator.ts\r\nimport { Roborock } from \"../main\";\r\nimport { createCanvas, loadImage, Image, ImageData, type Canvas, type CanvasRenderingContext2D } from \"@napi-rs/canvas\";\r\n// Use the new simplified room coloring\r\nimport { assignRoborockRoomColorsToHex } from \"./roomColoring\";\r\n// Import all images from your new file\r\nimport * as Images from \"./images\";\r\n\r\n// --------------------\r\n// Constants & Config\r\n// --------------------\r\n\r\nconst OFFSET = 60;\r\nconst MAX_BLOCK_NUM = 32;\r\n\r\n// Colors for \"newmap = true\" (Roborock App Style)\r\nconst ORG_COLORS = [\r\n\t\"#C05A41\", // 0\r\n\t\"#4579B5\", // 1\r\n\t\"#017E82\", // 2\r\n\t\"#BD7B00\", // 3\r\n\t\"#434242\", // 4 wall\r\n\t\"#dfdfdf\", // 5 deselected floor\r\n];\r\n\r\n// Colors for \"newmap = false\" (Legacy Style)\r\nconst LEGACY_COLORS = {\r\n\tfloor: \"#23465e\",\r\n\tobstacle: \"#2b2e30\",\r\n\tpath: \"rgba(255,255,255,0.5)\",\r\n};\r\n\r\nconst OBSTACLE_TITLES: Record<number, string> = {\r\n\t0: \"Wire\",\r\n\t1: \"Pet waste\",\r\n\t2: \"Footwear\",\r\n\t3: \"Pedestal\",\r\n\t4: \"Pedestal\",\r\n\t5: \"Power strip\",\r\n\t9: \"Scale\",\r\n\t10: \"Fabric\",\r\n\t18: \"Dustpan\",\r\n\t25: \"Dustpan\",\r\n\t26: \"Bar\",\r\n\t27: \"Bar\",\r\n};\r\n\r\ninterface CanvasMapOptions {\r\n\tselectedMap?: any;\r\n\tmappedRooms?: any;\r\n\toptions?: {\r\n\t\tFLOORCOLOR?: string;\r\n\t\tWALLCOLOR?: string;\r\n\t\tPATHCOLOR?: string;\r\n\t\tnewmap?: boolean;\r\n\t\tROBOT?: string;\r\n\t};\r\n}\r\n\r\ninterface Dimensions {\r\n\twidth: number;\r\n\theight: number;\r\n}\r\n\r\nexport class MapCreator {\r\n\tadapter: Roborock;\r\n\tcolors: { floor: string; obstacle: string; path: string; newmap: boolean };\r\n\r\n\tconstructor(adapter: Roborock) {\r\n\t\tthis.adapter = adapter;\r\n\t\tthis.colors = {\r\n\t\t\tfloor: LEGACY_COLORS.floor,\r\n\t\t\tobstacle: LEGACY_COLORS.obstacle,\r\n\t\t\tpath: LEGACY_COLORS.path,\r\n\t\t\tnewmap: true,\r\n\t\t};\r\n\t}\r\n\r\n\t// --------------------\r\n\t// Coordinate Helpers\r\n\t// --------------------\r\n\r\n\tprivate getX(dimensions: Dimensions, px: number): number {\r\n\t\treturn (px * this.adapter.config.map_scale) % dimensions.width;\r\n\t}\r\n\r\n\tprivate getY(dimensions: Dimensions, px: number): number {\r\n\t\treturn dimensions.height - Math.floor(px / (dimensions.width / this.adapter.config.map_scale)) * this.adapter.config.map_scale - this.adapter.config.map_scale;\r\n\t}\r\n\r\n\tprivate robotXtoPixelX(image: any, robotCoord: number): number {\r\n\t\treturn (robotCoord - image.position.left) * this.adapter.config.map_scale + 1;\r\n\t}\r\n\r\n\tprivate robotYtoPixelY(image: any, robotCoord: number): number {\r\n\t\treturn (image.dimensions.height / this.adapter.config.map_scale + image.position.top - robotCoord) * this.adapter.config.map_scale - 1;\r\n\t}\r\n\r\n\t// --------------------\r\n\t// Drawing Helpers\r\n\t// --------------------\r\n\r\n\tprivate rotateCanvas(img: Image, angleInDegrees: number): Canvas {\r\n\t\tconst canvas = createCanvas(img.width, img.height);\r\n\t\tconst ctx = canvas.getContext(\"2d\");\r\n\t\tconst angleOffset = 90;\r\n\t\tlet angleInRadians = ((angleInDegrees - angleOffset) * Math.PI) / 180;\r\n\t\tangleInRadians = ((angleInRadians + Math.PI) % (2 * Math.PI)) - Math.PI;\r\n\r\n\t\tctx.translate(img.width / 2, img.height / 2);\r\n\t\tctx.rotate(-angleInRadians);\r\n\t\tctx.translate(-img.width / 2, -img.height / 2);\r\n\t\tctx.drawImage(img, 0, 0);\r\n\r\n\t\treturn canvas;\r\n\t}\r\n\r\n\tprivate drawLineBresenham(imageData: ImageData, x1: number, y1: number, x2: number, y2: number) {\r\n\t\tconst pixels = imageData.data;\r\n\t\tconst dx = Math.abs(x2 - x1);\r\n\t\tconst dy = Math.abs(y2 - y1);\r\n\t\tconst sx = x1 < x2 ? 1 : -1;\r\n\t\tconst sy = y1 < y2 ? 1 : -1;\r\n\t\tlet err = dx - dy;\r\n\r\n\t\twhile (true) {\r\n\t\t\tif (x1 >= 0 && x1 < imageData.width && y1 >= 0 && y1 < imageData.height) {\r\n\t\t\t\tconst index = (x1 + y1 * imageData.width) * 4;\r\n\t\t\t\tpixels[index] = 128; // r\r\n\t\t\t\tpixels[index + 1] = 128; // g\r\n\t\t\t\tpixels[index + 2] = 128; // b\r\n\t\t\t\tpixels[index + 3] = 128; // a (semi-transparent gray)\r\n\t\t\t}\r\n\r\n\t\t\tif (x1 === x2 && y1 === y2) break;\r\n\t\t\tconst e2 = 2 * err;\r\n\t\t\tif (e2 > -dy) {\r\n\t\t\t\terr -= dy;\r\n\t\t\t\tx1 += sx;\r\n\t\t\t}\r\n\t\t\tif (e2 < dx) {\r\n\t\t\t\terr += dx;\r\n\t\t\t\ty1 += sy;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Builds the adjacency matrix for room coloring.\r\n\t */\r\n\tprivate buildAdjacencyMatrix(segmentPixels: number[], width: number, height: number, maxIdFromCaller: number): number[][] {\r\n\t\tlet maxSegInPixels = 0;\r\n\t\tfor (const px of segmentPixels) {\r\n\t\t\tconst segnum = px >>> 21;\r\n\t\t\tif (segnum > maxSegInPixels) maxSegInPixels = segnum;\r\n\t\t}\r\n\t\tconst size = Math.max(maxIdFromCaller + 1, maxSegInPixels + 1, MAX_BLOCK_NUM);\r\n\r\n\t\tconst matrix: number[][] = Array.from({ length: size }, () => Array(size).fill(0));\r\n\t\tconst segMap = new Int16Array(width * height).fill(-1);\r\n\r\n\t\tfor (const px of segmentPixels) {\r\n\t\t\tconst pixelIndex = px & 0x1fffff;\r\n\t\t\tconst segnum = px >>> 21;\r\n\t\t\tif (pixelIndex >= 0 && pixelIndex < segMap.length && segnum < size) {\r\n\t\t\t\tsegMap[pixelIndex] = segnum;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfor (let i = 0; i < segMap.length; i++) {\r\n\t\t\tconst segA = segMap[i];\r\n\t\t\tif (segA < 0) continue;\r\n\r\n\t\t\tconst x = i % width;\r\n\t\t\tconst y = Math.floor(i / width);\r\n\r\n\t\t\tif (segA < size) {\r\n\t\t\t\tmatrix[segA][segA] = 1; // Mark segment as existing\r\n\t\t\t}\r\n\r\n\t\t\t// Check top neighbor\r\n\t\t\tif (y > 0) {\r\n\t\t\t\tconst segB = segMap[i - width];\r\n\t\t\t\tif (segB >= 0 && segA !== segB && segA < size && segB < size) {\r\n\t\t\t\t\tmatrix[segA][segB] = 1;\r\n\t\t\t\t\tmatrix[segB][segA] = 1;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t// Check left neighbor\r\n\t\t\tif (x > 0) {\r\n\t\t\t\tconst segB = segMap[i - 1];\r\n\t\t\t\tif (segB >= 0 && segA !== segB && segA < size && segB < size) {\r\n\t\t\t\t\tmatrix[segA][segB] = 1;\r\n\t\t\t\t\tmatrix[segB][segA] = 1;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn matrix;\r\n\t}\r\n\r\n\t// --------------------\r\n\t// Main Map Generation\r\n\t// --------------------\r\n\r\n\tpublic async canvasMap(mapdata: any, params: CanvasMapOptions = {}): Promise<[string, string]> {\r\n\t\tconst { selectedMap = null, mappedRooms = null, options = {} } = params;\r\n\r\n\t\t// --- CRASH GUARD ---\r\n\t\tif (!mapdata || !mapdata.IMAGE || !mapdata.IMAGE.dimensions) {\r\n\t\t\tthis.adapter.log.warn(`[MapCreator] Received invalid or empty map data, cannot generate map.`);\r\n\t\t\treturn [createCanvas(1, 1).toDataURL(), createCanvas(1, 1).toDataURL()];\r\n\t\t}\r\n\r\n\t\t// 1. Configure Colors & Images\r\n\t\tif (options) {\r\n\t\t\tif (options.FLOORCOLOR) this.colors.floor = options.FLOORCOLOR;\r\n\t\t\tif (options.WALLCOLOR) this.colors.obstacle = options.WALLCOLOR;\r\n\t\t\tif (options.PATHCOLOR) this.colors.path = options.PATHCOLOR;\r\n\t\t\tthis.colors.newmap = options.newmap ?? true;\r\n\t\t}\r\n\r\n\t\tlet robotImgSource = Images.IMG_ROBOT_ORIGINAL;\r\n\t\tswitch (options.ROBOT) {\r\n\t\t\tcase \"robot\":\r\n\t\t\t\trobotImgSource = Images.IMG_ROBOT_DEFAULT;\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"robot1\":\r\n\t\t\t\trobotImgSource = Images.IMG_ROBOT1;\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"tank\":\r\n\t\t\t\trobotImgSource = Images.IMG_TANK;\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"spaceship\":\r\n\t\t\t\trobotImgSource = Images.IMG_SPACESHIP;\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"robot2\":\r\n\t\t\t\trobotImgSource = Images.IMG_ROBOT_2;\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\r\n\t\tconst [imgRobot, imgCharger, imgGoToPin] = await Promise.all([loadImage(robotImgSource), loadImage(Images.IMG_CHARGER), loadImage(Images.IMG_GO_TO_PIN)]);\r\n\r\n\t\t// 2. Setup Dimensions\r\n\t\tmapdata.IMAGE.dimensions.width *= this.adapter.config.map_scale;\r\n\t\tmapdata.IMAGE.dimensions.height *= this.adapter.config.map_scale;\r\n\r\n\t\tconst canvas = createCanvas(mapdata.IMAGE.dimensions.width, mapdata.IMAGE.dimensions.height);\r\n\t\tconst ctx = canvas.getContext(\"2d\");\r\n\r\n\t\tlet maxtop = 0,\r\n\t\t\tmaxleft = 0,\r\n\t\t\tminleft = mapdata.IMAGE.dimensions.width,\r\n\t\t\tmintop = mapdata.IMAGE.dimensions.height;\r\n\r\n\t\t// 3. Draw Base Floor & Walls\r\n\t\tif (mapdata.IMAGE.pixels.floor && mapdata.IMAGE.pixels.floor.length > 0) {\r\n\t\t\tif (typeof mapdata.IMAGE.pixels.floor[0] === \"number\") {\r\n\t\t\t\tminleft = mapdata.IMAGE.pixels.floor[0] % mapdata.IMAGE.dimensions.width;\r\n\t\t\t\tmintop = mapdata.IMAGE.dimensions.height - 1 - Math.floor(mapdata.IMAGE.pixels.floor[0] / mapdata.IMAGE.dimensions.width);\r\n\t\t\t}\r\n\r\n\t\t\t[\"floor\", \"obstacle\"].forEach((key) => {\r\n\t\t\t\tif (!mapdata.IMAGE.pixels[key]) return;\r\n\t\t\t\tctx.beginPath();\r\n\t\t\t\tmapdata.IMAGE.pixels[key].forEach((px) => {\r\n\t\t\t\t\tconst x = this.getX(mapdata.IMAGE.dimensions, px);\r\n\t\t\t\t\tconst y = this.getY(mapdata.IMAGE.dimensions, px);\r\n\r\n\t\t\t\t\tctx.fillStyle = key === \"obstacle\" ? (this.colors.newmap ? ORG_COLORS[4] : this.colors.obstacle) : this.colors.newmap ? ORG_COLORS[5] : this.colors.floor;\r\n\r\n\t\t\t\t\tctx.rect(x, y, this.adapter.config.map_scale, this.adapter.config.map_scale);\r\n\r\n\t\t\t\t\tmaxtop = Math.max(maxtop, y);\r\n\t\t\t\t\tmaxleft = Math.max(maxleft, x);\r\n\t\t\t\t\tminleft = Math.min(minleft, x);\r\n\t\t\t\t\tmintop = Math.min(mintop, y);\r\n\t\t\t\t});\r\n\t\t\t\tctx.fill();\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\t// 4. Draw Segments (Rooms)\r\n\t\tconst segmentsData: Record<number, any> = {};\r\n\r\n\t\tif (mapdata.IMAGE.pixels.segments && this.colors.newmap) {\r\n\t\t\t// Step 4.1: Collect pixel data for each segment\r\n\t\t\tmapdata.IMAGE.pixels.segments.forEach((px) => {\r\n\t\t\t\tconst segnum = px >> 21;\r\n\t\t\t\tconst pixelIndex = px & 0x1fffff;\r\n\t\t\t\tif (segnum >= MAX_BLOCK_NUM) return;\r\n\r\n\t\t\t\tconst x = this.getX(mapdata.IMAGE.dimensions, pixelIndex);\r\n\t\t\t\tconst y = this.getY(mapdata.IMAGE.dimensions, pixelIndex);\r\n\r\n\t\t\t\tif (!segmentsData[segnum]) {\r\n\t\t\t\t\tsegmentsData[segnum] = { points: [], minX: x, maxX: x, minY: y, maxY: y };\r\n\t\t\t\t}\r\n\t\t\t\tconst segment = segmentsData[segnum];\r\n\t\t\t\tsegment.points.push({ x, y });\r\n\t\t\t\tsegment.minX = Math.min(segment.minX, x);\r\n\t\t\t\tsegment.maxX = Math.max(segment.maxX, x);\r\n\t\t\t\tsegment.minY = Math.min(segment.minY, y);\r\n\t\t\t\tsegment.maxY = Math.max(segment.maxY, y);\r\n\t\t\t});\r\n\r\n\t\t\t// Step 4.2: Calculate room colors using the (now external) coloring algorithm\r\n\t\t\tconst segmentNums = Object.keys(segmentsData).map(Number);\r\n\t\t\tconst maxId = segmentNums.length ? Math.max(...segmentNums) : 0;\r\n\t\t\tconst matrixSize = MAX_BLOCK_NUM;\r\n\r\n\t\t\tconst adjacencyMatrix = this.buildAdjacencyMatrix(mapdata.IMAGE.pixels.segments, mapdata.IMAGE.dimensions.width, mapdata.IMAGE.dimensions.height, maxId);\r\n\r\n\t\t\tconst pointsCount = new Array(matrixSize).fill(0);\r\n\t\t\tfor (const segStr of Object.keys(segmentsData)) {\r\n\t\t\t\tconst seg = Number(segStr);\r\n\t\t\t\tif (seg >= 0 && seg < matrixSize) {\r\n\t\t\t\t\tpointsCount[seg] = segmentsData[seg].points.length;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tconst neighborInfo = new Array(matrixSize * matrixSize).fill(0);\r\n\t\t\tfor (let i = 0; i < matrixSize; i++) {\r\n\t\t\t\tfor (let j = 0; j < matrixSize; j++) {\r\n\t\t\t\t\tif (adjacencyMatrix[i]?.[j] === 1) neighborInfo[i * matrixSize + j] = 1;\r\n\t\t\t\t}\r\n\t\t\t\tif (pointsCount[i] > 0) neighborInfo[i * matrixSize + i] = 1;\r\n\t\t\t}\r\n\r\n\t\t\t// Use the new simplified 'assignRoborockRoomColorsToHex'\r\n\t\t\tconst coloring = assignRoborockRoomColorsToHex(\r\n\t\t\t\t{ maxBlockNum: matrixSize, neighborInfo, pointsCount },\r\n\t\t\t\t{ oneBased: true } // 'oneBased: true' assumes segment IDs start at 1 (0 is 'no segment')\r\n\t\t\t);\r\n\r\n\t\t\t// Step 4.3: Draw the segments with the calculated colors\r\n\t\t\tObject.keys(segmentsData).forEach((segStr) => {\r\n\t\t\t\tconst segnum = Number(segStr);\r\n\t\t\t\tif (segnum < 0 || segnum >= matrixSize) return;\r\n\r\n\t\t\t\tconst isCurrentlyCleaned = mapdata.CURRENTLY_CLEANED_BLOCKS?.includes(segnum);\r\n\r\n\t\t\t\tlet fillColor = coloring.colorHex?.[segnum] || \"#CCCCCC\";\r\n\t\t\t\tif (isCurrentlyCleaned) {\r\n\t\t\t\t\tfillColor = segnum >= 0 && segnum < ORG_COLORS.length ? ORG_COLORS[segnum] : \"#AA0000\";\r\n\t\t\t\t}\r\n\r\n\t\t\t\tctx.fillStyle = fillColor;\r\n\t\t\t\tctx.beginPath();\r\n\t\t\t\tsegmentsData[segnum].points.forEach((p) => {\r\n\t\t\t\t\tctx.rect(p.x, p.y, this.adapter.config.map_scale, this.adapter.config.map_scale);\r\n\t\t\t\t});\r\n\t\t\t\tctx.fill();\r\n\t\t\t});\r\n\t\t} else if (mapdata.IMAGE.pixels.segments) {\r\n\t\t\t// Fallback for 'newmap = false' or if only actively cleaned blocks should be shown\r\n\t\t\tlet segnum, lastcolor;\r\n\t\t\tctx.beginPath();\r\n\t\t\tmapdata.IMAGE.pixels.segments.forEach((px) => {\r\n\t\t\t\tsegnum = px >> 21;\r\n\t\t\t\tif (mapdata.CURRENTLY_CLEANED_BLOCKS?.includes(segnum)) {\r\n\t\t\t\t\tif (segnum !== lastcolor) {\r\n\t\t\t\t\t\tctx.fill();\r\n\t\t\t\t\t\tctx.beginPath();\r\n\t\t\t\t\t\tctx.fillStyle = segnum >= 0 && segnum < ORG_COLORS.length ? ORG_COLORS[segnum] : \"#CCCCCC\";\r\n\t\t\t\t\t\tlastcolor = segnum;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tpx = px & 0xfffff;\r\n\t\t\t\t\tctx.rect(this.getX(mapdata.IMAGE.dimensions, px), this.getY(mapdata.IMAGE.dimensions, px), this.adapter.config.map_scale, this.adapter.config.map_scale);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tctx.fill();\r\n\t\t}\r\n\r\n\t\t// 5. Draw Carpet\r\n\t\tif (mapdata.CARPET_MAP) {\r\n\t\t\t// Guard against zero-dimension maps (e.g., new or uninitialized maps)\r\n\t\t\tif (mapdata.IMAGE.dimensions.width <= 0 || mapdata.IMAGE.dimensions.height <= 0) {\r\n\t\t\t\tthis.adapter.log.debug(\"[MapCreator] Skipping carpet drawing, map dimensions are 0.\");\r\n\t\t\t} else {\r\n\t\t\t\tconst offset = 8 * this.adapter.config.map_scale;\r\n\t\t\t\tconst imageData = ctx.getImageData(0, 0, mapdata.IMAGE.dimensions.width, mapdata.IMAGE.dimensions.height);\r\n\r\n\t\t\t\tmapdata.CARPET_MAP.forEach((px) => {\r\n\t\t\t\t\tconst x2 = this.getX(mapdata.IMAGE.dimensions, px) - offset;\r\n\t\t\t\t\tconst y1 = this.getY(mapdata.IMAGE.dimensions, px);\r\n\t\t\t\t\tconst x1 = x2 + this.adapter.config.map_scale - 1;\r\n\t\t\t\t\tconst y2 = y1 + this.adapter.config.map_scale - 1;\r\n\t\t\t\t\tthis.drawLineBresenham(imageData, x1, y1, x2, y2);\r\n\t\t\t\t});\r\n\t\t\t\tctx.putImageData(imageData, 0, 0);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// 6. Draw Active Zones\r\n\t\tif (mapdata.CURRENTLY_CLEANED_ZONES?.[0]) {\r\n\t\t\tmapdata.CURRENTLY_CLEANED_ZONES.forEach((coord) => {\r\n\t\t\t\tconst x = this.robotXtoPixelX(mapdata.IMAGE, coord[0] / 50);\r\n\t\t\t\tconst y = this.robotYtoPixelY(mapdata.IMAGE, coord[1] / 50);\r\n\t\t\t\tconst w = this.robotXtoPixelX(mapdata.IMAGE, coord[2] / 50) - x;\r\n\t\t\t\tconst h = this.robotYtoPixelY(mapdata.IMAGE, coord[3] / 50) - y;\r\n\r\n\t\t\t\tctx.fillStyle = \"rgba(46,139,87,0.1)\";\r\n\t\t\t\tctx.fillRect(x, y, w, h);\r\n\t\t\t\tctx.strokeStyle = \"#2e8b57\";\r\n\t\t\t\tctx.lineWidth = 4;\r\n\t\t\t\tctx.strokeRect(x, y, w, h);\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\t// 7. Draw Paths (Mop & Standard)\r\n\t\tthis.drawPaths(ctx, mapdata);\r\n\r\n\t\t// 8. Draw Predicted Path\r\n\t\tif (mapdata.GOTO_PREDICTED_PATH?.points?.length) {\r\n\t\t\tctx.lineWidth = (3 * this.adapter.config.map_scale) / 2;\r\n\t\t\tctx.strokeStyle = \"rgba(255, 255, 255, 1)\";\r\n\t\t\tctx.setLineDash([3 * this.adapter.config.map_scale, 3 * this.adapter.config.map_scale]);\r\n\t\t\tctx.lineCap = \"round\";\r\n\t\t\tctx.beginPath();\r\n\r\n\t\t\tlet lastX = -1,\r\n\t\t\t\tlastY = -1;\r\n\t\t\tmapdata.GOTO_PREDICTED_PATH.points.forEach((coord, index) => {\r\n\t\t\t\tconst x = this.robotXtoPixelX(mapdata.IMAGE, coord[0] / 50);\r\n\t\t\t\tconst y = this.robotYtoPixelY(mapdata.IMAGE, coord[1] / 50);\r\n\r\n\t\t\t\tif (index === 0) {\r\n\t\t\t\t\tctx.fillStyle = \"rgba(255, 255, 255, 1)\";\r\n\t\t\t\t\tctx.fillRect(x, y, (1 * this.adapter.config.map_scale) / 2, (1 * this.adapter.config.map_scale) / 2);\r\n\t\t\t\t\tctx.moveTo(x, y);\r\n\t\t\t\t} else if (x !== lastX || y !== lastY) {\r\n\t\t\t\t\tctx.lineTo(x, y);\r\n\t\t\t\t}\r\n\t\t\t\tlastX = x;\r\n\t\t\t\tlastY = y;\r\n\t\t\t});\r\n\t\t\tctx.stroke();\r\n\t\t\tctx.setLineDash([]);\r\n\t\t\tctx.lineCap = \"butt\";\r\n\t\t}\r\n\r\n\t\t// 9. Draw Forbidden Zones / Virtual Walls / No Mop Zones\r\n\t\tthis.drawRestrictedAreas(ctx, mapdata);\r\n\r\n\t\t// 10. Draw Obstacles\r\n\t\tif (mapdata.OBSTACLES2) {\r\n\t\t\tmapdata.OBSTACLES2.forEach((obstacle) => {\r\n\t\t\t\tconst type = obstacle[2];\r\n\t\t\t\tconst title = OBSTACLE_TITLES[type] || \"Unknown\";\r\n\t\t\t\tconst confidence = Math.round(obstacle[3] / 100);\r\n\t\t\t\tconst text = title + (OBSTACLE_TITLES[type] ? `(${confidence}%)` : \"\");\r\n\r\n\t\t\t\tconst x = this.robotXtoPixelX(mapdata.IMAGE, obstacle[0] / 50);\r\n\t\t\t\tconst y = this.robotYtoPixelY(mapdata.IMAGE, obstacle[1] / 50);\r\n\r\n\t\t\t\tctx.fillStyle = \"red\";\r\n\t\t\t\tctx.beginPath();\r\n\t\t\t\tctx.arc(x, y, 5, 0, 2 * Math.PI);\r\n\t\t\t\tctx.fill();\r\n\r\n\t\t\t\tctx.font = \"14px sans-serif\";\r\n\t\t\t\tconst textWidth = ctx.measureText(text).width;\r\n\t\t\t\tconst textHeight = 14;\r\n\t\t\t\tconst padding = 5;\r\n\t\t\t\tconst rectX = x - textWidth / 2 - padding;\r\n\t\t\t\tconst rectY = y + 5 + padding / 2;\r\n\t\t\t\tconst rectW = textWidth + 2 * padding;\r\n\t\t\t\tconst rectH = textHeight + padding;\r\n\r\n\t\t\t\tctx.fillStyle = \"red\";\r\n\t\t\t\tthis.roundRect(ctx, rectX, rectY, rectW, rectH, 5);\r\n\t\t\t\tctx.fill();\r\n\r\n\t\t\t\tctx.fillStyle = \"white\";\r\n\t\t\t\tctx.textAlign = \"center\";\r\n\t\t\t\tctx.textBaseline = \"middle\";\r\n\t\t\t\tctx.fillText(text, x, y + 5 + padding + textHeight / 2);\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\t// 11. Draw Robot & Target\r\n\t\tif (mapdata.ROBOT_POSITION) {\r\n\t\t\tconst pos = mapdata.ROBOT_POSITION.position;\r\n\t\t\tconst angle = mapdata.PATH?.current_angle ?? mapdata.ROBOT_POSITION.angle;\r\n\r\n\t\t\tif (pos?.[0] && pos?.[1]) {\r\n\t\t\t\tconst imgRotated = this.rotateCanvas(imgRobot, angle);\r\n\t\t\t\tconst x = this.robotXtoPixelX(mapdata.IMAGE, pos[0] / 50) - imgRobot.width / 4;\r\n\t\t\t\tconst y = this.robotYtoPixelY(mapdata.IMAGE, pos[1] / 50) - imgRobot.height / 4;\r\n\t\t\t\tctx.drawImage(imgRotated, x, y, imgRotated.width / 2, imgRotated.height / 2);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (mapdata.GOTO_TARGET?.[0] && mapdata.GOTO_TARGET?.[1]) {\r\n\t\t\tctx.drawImage(\r\n\t\t\t\timgGoToPin,\r\n\t\t\t\tthis.robotXtoPixelX(mapdata.IMAGE, mapdata.GOTO_TARGET[0] / 50) - imgGoToPin.width / 2,\r\n\t\t\t\tthis.robotYtoPixelY(mapdata.IMAGE, mapdata.GOTO_TARGET[1] / 50) - (imgGoToPin.height + 6),\r\n\t\t\t\timgGoToPin.width,\r\n\t\t\t\timgGoToPin.height\r\n\t\t\t);\r\n\t\t}\r\n\r\n\t\t// 12. Draw Room Names\r\n\t\t// This block only runs if we have segment data AND (critically) mappedRooms was passed\r\n\t\tif (segmentsData && mappedRooms) {\r\n\t\t\tconst roomIDsAll = this.adapter.http_api.getMatchedRoomIDs(false);\r\n\r\n\t\t\tObject.keys(segmentsData).forEach((segnumStr) => {\r\n\t\t\t\tconst segnum = parseInt(segnumStr);\r\n\t\t\t\tif (segnum === 0) return; // Skip non-room area\r\n\r\n\t\t\t\tconst segment = segmentsData[segnum];\r\n\t\t\t\tlet roomName = \"\";\r\n\r\n\t\t\t\t// This check is the key: mappedRooms is the result of get_room_mapping.\r\n\t\t\t\t// For history maps, we pass mappedRooms=null, so this block is skipped.\r\n\t\t\t\tconst mapping = mappedRooms.find(([id]) => parseInt(id) === segnum);\r\n\t\t\t\tif (mapping) {\r\n\t\t\t\t\tconst roomID = mapping[1];\r\n\t\t\t\t\tconst roomObj = roomIDsAll.find((r) => String(r.id) === String(roomID));\r\n\t\t\t\t\troomName = roomObj?.name || \"\";\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (roomName) {\r\n\t\t\t\t\tconst centerX = segment.minX + (segment.maxX - segment.minX) / 2;\r\n\t\t\t\t\tconst centerY = segment.minY + (segment.maxY - segment.minY) / 2;\r\n\r\n\t\t\t\t\tctx.font = `bold ${this.adapter.config.map_scale * 6}px Arial`;\r\n\t\t\t\t\tctx.textAlign = \"center\";\r\n\t\t\t\t\tctx.textBaseline = \"middle\";\r\n\t\t\t\t\tctx.lineWidth = 1;\r\n\t\t\t\t\tctx.strokeStyle = \"white\";\r\n\t\t\t\t\tctx.strokeText(roomName, centerX, centerY);\r\n\t\t\t\t\tctx.fillStyle = \"black\";\r\n\t\t\t\t\tctx.fillText(roomName, centerX, centerY);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\t// 13. Crop & Return\r\n\t\tconst cropW = maxleft - minleft + 2 * OFFSET;\r\n\t\tconst cropH = maxtop - mintop + 2 * OFFSET;\r\n\r\n\t\tif (cropW <= 0 || cropH <= 0 || !isFinite(cropW) || !isFinite(cropH)) {\r\n\t\t\tthis.adapter.log.warn(`[MapCreator] Invalid crop dimensions calculated. Returning full map.`);\r\n\t\t\treturn [canvas.toDataURL(), canvas.toDataURL()];\r\n\t\t}\r\n\r\n\t\tconst canvasTrimmed = createCanvas(cropW, cropH);\r\n\t\tconst ctxTrimmed = canvasTrimmed.getContext(\"2d\");\r\n\r\n\t\tconst sx = Math.max(0, minleft - OFFSET);\r\n\t\tconst sy = Math.max(0, mintop - OFFSET);\r\n\t\tconst maxWidth = canvas.width - sx;\r\n\t\tconst maxHeight = canvas.height - sy;\r\n\r\n\t\tconst finalCropW = Math.min(cropW, maxWidth);\r\n\t\tconst finalCropH = Math.min(cropH, maxHeight);\r\n\r\n\t\tconst trimmedData = ctx.getImageData(sx, sy, finalCropW, finalCropH);\r\n\r\n\t\tctxTrimmed.putImageData(trimmedData, 0, 0);\r\n\r\n\t\treturn [canvas.toDataURL(), canvasTrimmed.toDataURL()];\r\n\t}\r\n\r\n\t// --------------------\r\n\t// Sub-drawing Routines\r\n\t// --------------------\r\n\r\n\tprivate drawPaths(ctx: CanvasRenderingContext2D, mapdata: any) {\r\n\t\tif (!mapdata.PATH?.points || !mapdata.MOP_PATH) return;\r\n\r\n\t\tconst scale = this.adapter.config.map_scale;\r\n\t\tconst points = mapdata.PATH.points;\r\n\t\tconst mops = mapdata.MOP_PATH;\r\n\t\tconst mopOffset = -12;\r\n\r\n\t\t// 1. Mop Path (Thick transparent trace)\r\n\t\tctx.lineWidth = 7 * scale;\r\n\t\tctx.lineCap = \"round\";\r\n\t\tctx.lineJoin = \"round\";\r\n\t\tctx.strokeStyle = \"rgba(255,255,255,0.18)\";\r\n\t\tctx.beginPath();\r\n\r\n\t\tlet lastIdx = -1;\r\n\t\tlet segmentStarted = false;\r\n\r\n\t\tfor (let i = 0; i < points.length; i++) {\r\n\t\t\tconst mopIdx = i + mopOffset;\r\n\t\t\tif (mops?.[mopIdx] & 1) {\r\n\t\t\t\tconst x = this.robotXtoPixelX(mapdata.IMAGE, points[i][0] / 50);\r\n\t\t\t\tconst y = this.robotYtoPixelY(mapdata.IMAGE, points[i][1] / 50);\r\n\r\n\t\t\t\tif (!segmentStarted) {\r\n\t\t\t\t\tctx.moveTo(x, y);\r\n\t\t\t\t\tsegmentStarted = true;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.tracePathSegment(ctx, x, y, i, lastIdx, points, mapdata);\r\n\t\t\t\t}\r\n\t\t\t\tlastIdx = i;\r\n\t\t\t} else {\r\n\t\t\t\tsegmentStarted = false;\r\n\t\t\t}\r\n\t\t}\r\n\t\tctx.stroke();\r\n\r\n\t\t// 2. Main Line\r\n\t\tctx.lineWidth = Math.max(1, scale / 2);\r\n\t\tctx.strokeStyle = this.colors.path;\r\n\t\tctx.beginPath();\r\n\t\tctx.setLineDash([]);\r\n\r\n\t\tlastIdx = -1;\r\n\t\tfor (let i = 0; i < points.length; i++) {\r\n\t\t\tconst idx = i + mopOffset;\r\n\t\t\tconst isBackwash = idx >= 0 && idx < mops.length && ((mops[idx] >> 3) & 1) === 1;\r\n\r\n\t\t\tif (!isBackwash) {\r\n\t\t\t\tconst x = this.robotXtoPixelX(mapdata.IMAGE, points[i][0] / 50);\r\n\t\t\t\tconst y = this.robotYtoPixelY(mapdata.IMAGE, points[i][1] / 50);\r\n\t\t\t\tthis.tracePathSegment(ctx, x, y, i, lastIdx, points, mapdata);\r\n\t\t\t\tlastIdx = i;\r\n\t\t\t} else {\r\n\t\t\t\tlastIdx = -1;\r\n\t\t\t}\r\n\t\t}\r\n\t\tctx.stroke();\r\n\r\n\t\t// 3. Backwash (Dashed)\r\n\t\tctx.lineWidth = 0.5 * scale;\r\n\t\tctx.strokeStyle = \"rgba(255,255,255,0.2)\";\r\n\t\tctx.setLineDash([4, 8]);\r\n\t\tctx.beginPath();\r\n\r\n\t\tlastIdx = -1;\r\n\t\tfor (let i = 0; i < points.length; i++) {\r\n\t\t\tconst idx = i + mopOffset;\r\n\t\t\tconst isBackwash = idx >= 0 && idx < mops.length && ((mops[idx] >> 3) & 1) === 1;\r\n\r\n\t\t\tif (isBackwash) {\r\n\t\t\t\tconst x = this.robotXtoPixelX(mapdata.IMAGE, points[i][0] / 50);\r\n\t\t\t\tconst y = this.robotYtoPixelY(mapdata.IMAGE, points[i][1] / 50);\r\n\t\t\t\tthis.tracePathSegment(ctx, x, y, i, lastIdx, points, mapdata);\r\n\t\t\t\tlastIdx = i;\r\n\t\t\t} else {\r\n\t\t\t\tlastIdx = -1;\r\n\t\t\t}\r\n\t\t}\r\n\t\tctx.stroke();\r\n\t\tctx.setLineDash([]);\r\n\t}\r\n\r\n\tprivate tracePathSegment(ctx: CanvasRenderingContext2D, x: number, y: number, currIdx: number, lastIdx: number, points: number[][], mapdata: any) {\r\n\t\tconst scale = this.adapter.config.map_scale;\r\n\t\tconst threshold = 10 * scale;\r\n\r\n\t\tif (lastIdx < 0) {\r\n\t\t\tctx.moveTo(x, y);\r\n\t\t} else {\r\n\t\t\tconst last = points[lastIdx];\r\n\t\t\tconst lx = this.robotXtoPixelX(mapdata.IMAGE, last[0] / 50);\r\n\t\t\tconst ly = this.robotYtoPixelY(mapdata.IMAGE, last[1] / 50);\r\n\r\n\t\t\tif (Math.hypot(x - lx, y - ly) > threshold || currIdx !== lastIdx + 1) {\r\n\t\t\t\tctx.moveTo(x, y);\r\n\t\t\t} else {\r\n\t\t\t\tctx.lineTo(x, y);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tprivate drawRestrictedAreas(ctx: CanvasRenderingContext2D, mapdata: any) {\r\n\t\tconst drawRectArea = (zones: number[][], fill: string, stroke: string) => {\r\n\t\t\tif (!zones) return;\r\n\t\t\tzones.forEach((zone) => {\r\n\t\t\t\tconst x1 = this.robotXtoPixelX(mapdata.IMAGE, Math.min(zone[0], zone[2], zone[4], zone[6]) / 50);\r\n\t\t\t\tconst y1 = this.robotYtoPixelY(mapdata.IMAGE, Math.max(zone[1], zone[3], zone[5], zone[7]) / 50);\r\n\t\t\t\tconst x2 = this.robotXtoPixelX(mapdata.IMAGE, Math.max(zone[0], zone[2], zone[4], zone[6]) / 50);\r\n\t\t\t\tconst y2 = this.robotYtoPixelY(mapdata.IMAGE, Math.min(zone[1], zone[3], zone[5], zone[7]) / 50);\r\n\r\n\t\t\t\tconst minX = Math.min(x1, x2);\r\n\t\t\t\tconst minY = Math.min(y1, y2);\r\n\t\t\t\tconst maxX = Math.max(x1, x2);\r\n\t\t\t\tconst maxY = Math.max(y1, y2);\r\n\t\t\t\tconst w = maxX - minX;\r\n\t\t\t\tconst h = maxY - minY;\r\n\r\n\t\t\t\tctx.fillStyle = fill;\r\n\t\t\t\tctx.fillRect(minX, minY, w, h);\r\n\t\t\t\tctx.strokeStyle = stroke;\r\n\t\t\t\tctx.lineWidth = (1 * this.adapter.config.map_scale) / 2;\r\n\t\t\t\tctx.strokeRect(minX, minY, w, h);\r\n\t\t\t});\r\n\t\t};\r\n\r\n\t\tdrawRectArea(mapdata.FORBIDDEN_ZONES, \"rgba(255, 0, 0, 0.5)\", \"rgba(255, 0, 0, 1)\");\r\n\t\tdrawRectArea(mapdata.NO_MOP_ZONE, \"rgba(0, 0, 255, 0.5)\", \"rgba(0, 0, 255, 1)\");\r\n\r\n\t\tif (mapdata.VIRTUAL_WALLS) {\r\n\t\t\tctx.strokeStyle = \"rgba(255, 0, 0, 1)\";\r\n\t\t\tconst lineWidth = 1 * this.adapter.config.map_scale;\r\n\t\t\tctx.lineWidth = lineWidth;\r\n\r\n\t\t\tctx.beginPath();\r\n\t\t\tmapdata.VIRTUAL_WALLS.forEach((wall) => {\r\n\t\t\t\tconst startX = this.robotXtoPixelX(mapdata.IMAGE, wall[0] / 50);\r\n\t\t\t\tconst startY = this.robotYtoPixelY(mapdata.IMAGE, wall[1] / 50);\r\n\t\t\t\tconst endX = this.robotXtoPixelX(mapdata.IMAGE, wall[2] / 50);\r\n\t\t\t\tconst endY = this.robotYtoPixelY(mapdata.IMAGE, wall[3] / 50);\r\n\r\n\t\t\t\tlet vecX = endX - startX;\r\n\t\t\t\tlet vecY = endY - startY;\r\n\t\t\t\tconst len = Math.sqrt(vecX * vecX + vecY * vecY);\r\n\t\t\t\tvecX /= len;\r\n\t\t\t\tvecY /= len;\r\n\r\n\t\t\t\tconst adjustedStartX = startX + vecX * (lineWidth / 2);\r\n\t\t\t\tconst adjustedStartY = startY + vecY * (lineWidth / 2);\r\n\t\t\t\tconst adjustedEndX = endX - vecX * (lineWidth / 2);\r\n\t\t\t\tconst adjustedEndY = endY - vecY * (lineWidth / 2);\r\n\r\n\t\t\t\tctx.moveTo(adjustedStartX, adjustedStartY);\r\n\t\t\t\tctx.lineTo(adjustedEndX, adjustedEndY);\r\n\t\t\t});\r\n\t\t\tctx.stroke();\r\n\t\t}\r\n\t}\r\n\r\n\tprivate roundRect(ctx: CanvasRenderingContext2D, x: number, y: number, width: number, height: number, radius: number) {\r\n\t\tctx.beginPath();\r\n\t\tctx.moveTo(x + radius, y);\r\n\t\tctx.lineTo(x + width - radius, y);\r\n\t\tctx.quadraticCurveTo(x + width, y, x + width, y + radius);\r\n\t\tctx.lineTo(x + width, y + height - radius);\r\n\t\tctx.quadraticCurveTo(x + width, y + height, x + width - radius, y + height);\r\n\t\tctx.lineTo(x + radius, y + height);\r\n\t\tctx.quadraticCurveTo(x, y + height, x, y + height - radius);\r\n\t\tctx.lineTo(x, y + radius);\r\n\t\tctx.quadraticCurveTo(x, y, x + radius, y);\r\n\t\tctx.closePath();\r\n\t}\r\n}\r\n"]}