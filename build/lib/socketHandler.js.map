{"version":3,"file":"socketHandler.js","sourceRoot":"","sources":["../../src/lib/socketHandler.ts"],"names":[],"mappings":"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","sourcesContent":["// /lib/socketHandler.ts\n\nimport { Roborock } from \"../main\"; // Import main adapter type\n\n// Robot object definition\ninterface Robot {\n\tduid: string;\n\tname: string;\n}\n\n// Message handler type\ntype MessageHandler = (message: any) => Promise<any>;\n\nexport class socketHandler {\n\tprivate adapter: Roborock;\n\n\t// Command routing map\n\tprivate commandHandlers: Map<string, MessageHandler>;\n\n\tconstructor(adapterInstance: Roborock) {\n\t\tthis.adapter = adapterInstance;\n\n\t\t// Initialize command map\n\t\tthis.commandHandlers = new Map<string, MessageHandler>();\n\t\tthis.commandHandlers.set(\"getDeviceList\", () => this.handleGetDeviceList());\n\n\t\tthis.commandHandlers.set(\"app_start\", (msg) => this.handleSimpleCommand(msg.duid, \"app_start\"));\n\t\tthis.commandHandlers.set(\"app_pause\", (msg) => this.handleSimpleCommand(msg.duid, \"app_pause\"));\n\t\tthis.commandHandlers.set(\"app_stop\", (msg) => this.handleSimpleCommand(msg.duid, \"app_stop\"));\n\t\tthis.commandHandlers.set(\"app_charge\", (msg) => this.handleSimpleCommand(msg.duid, \"app_charge\"));\n\t\tthis.commandHandlers.set(\"app_goto_target\", (msg) => this.handleGotoTarget(msg));\n\t\tthis.commandHandlers.set(\"app_zoned_clean\", (msg) => this.handleZonedClean(msg));\n\t}\n\n\t/**\n\t * Handles incoming 'sendTo' messages.\n\t * Routes commands to the appropriate handler using the commandHandlers map.\n\t * @param obj The message object\n\t */\n\tpublic async handleMessage(obj: ioBroker.Message): Promise<void> {\n\t\tif (!obj || !obj.command) {\n\t\t\tthis.adapter.log.warn(\"[SocketHandler] Received invalid message object.\");\n\t\t\treturn;\n\t\t}\n\n\t\t// --- Special Handlers ---\n\t\t// get_obstacle_image has custom logic\n\t\tif (obj.command === \"get_obstacle_image\") {\n\t\t\treturn this.handleGetObstacleImage(obj);\n\t\t}\n\n\t\t// --- Standard Handlers ---\n\t\tconst handler = this.commandHandlers.get(obj.command);\n\n\t\tif (!handler) {\n\t\t\tthis.adapter.log.warn(`[SocketHandler] Unknown command received: ${obj.command}`);\n\t\t\tif (obj.callback) {\n\t\t\t\tthis.adapter.sendTo(obj.from, obj.command, { error: \"Unknown command\" }, obj.callback);\n\t\t\t}\n\t\t\treturn;\n\t\t}\n\n\t\t// Centralized error handling\n\t\ttry {\n\t\t\t// Extract message payload\n\t\t\tconst result = await handler(obj.message);\n\t\t\tif (obj.callback) {\n\t\t\t\tthis.adapter.sendTo(obj.from, obj.command, result, obj.callback);\n\t\t\t}\n\t\t} catch (error: any) {\n\t\t\tthis.adapter.log.error(`[SocketHandler] Error handling command '${obj.command}': ${error.message}`);\n\t\t\tif (obj.callback) {\n\t\t\t\tthis.adapter.sendTo(obj.from, obj.command, { error: error.message || \"Failed\" }, obj.callback);\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Handles 'get_obstacle_image' command.\n\t */\n\tprivate async handleGetObstacleImage(msg: ioBroker.Message): Promise<void> {\n\t\tconst { duid, obstacleId } = msg.message;\n\n\t\tif (!duid || !obstacleId) {\n\t\t\tthis.adapter.log.warn(`[SocketHandler] 'get_obstacle_image' missing duid or obstacleId.`);\n\t\t\tif (msg.callback) {\n\t\t\t\tthis.adapter.sendTo(msg.from, msg.command, { error: \"Missing duid or obstacleId\" }, msg.callback);\n\t\t\t}\n\t\t\treturn;\n\t\t}\n\n\t\t// Use type 0 (full) or 1 (preview)\n\t\tconst imageType = msg.message.type === 0 ? 0 : 1;\n\t\tthis.adapter.log.info(`[SocketHandler] Requesting obstacle image type: ${imageType}`);\n\n\t\ttry {\n\t\t\tif (!this.adapter.requestsHandler) {\n\t\t\t\tthrow new Error(\"RequestHandler is not available\");\n\t\t\t}\n\n\t\t\tconst handler = this.adapter.deviceFeatureHandlers.get(duid);\n\t\t\tif (!handler) {\n\t\t\t\tthrow new Error(`No device handler found for DUID ${duid}`);\n\t\t\t}\n\n\t\t\tconst photoResponse = await handler.getPhoto(obstacleId, imageType);\n\n\t\t\tif (msg.callback) {\n\t\t\t\tthis.adapter.sendTo(msg.from, msg.command, photoResponse, msg.callback);\n\t\t\t}\n\t\t} catch (error: any) {\n\t\t\tthis.adapter.log.error(`[SocketHandler] Failed to get obstacle image ${obstacleId}: ${error.message}`);\n\t\t\tthis.adapter.catchError(error, \"handleGetObstacleImage\", duid);\n\n\t\t\tif (msg.callback) {\n\t\t\t\tthis.adapter.sendTo(msg.from, msg.command, { error: error.message || \"Failed\" }, msg.callback);\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Fetches robot list.\n\t */\n\tprivate async handleGetDeviceList(): Promise<Robot[]> {\n\t\tthis.adapter.log.debug(\"[SocketHandler] Executing handleGetDeviceList...\");\n\t\tlet devices: ioBroker.DeviceObject[];\n\n\t\ttry {\n\t\t\tconst adapterObjects = await this.adapter.getAdapterObjectsAsync();\n\n\t\t\t// Filter for devices in 'Devices' folder\n\t\t\tdevices = Object.values(adapterObjects).filter(\n\t\t\t\t(obj: any): obj is ioBroker.DeviceObject => obj && typeof obj === \"object\" && obj.type === \"device\" && obj._id.startsWith(this.adapter.namespace + \".Devices.\")\n\t\t\t);\n\t\t} catch (e: any) {\n\t\t\tthis.adapter.log.error(`[SocketHandler] Error getting adapter objects: ${e.message}`);\n\t\t\treturn []; // Return empty list on error\n\t\t}\n\n\t\tif (devices.length === 0) {\n\t\t\tthis.adapter.log.warn(\"[SocketHandler] No device objects found under 'Devices' folder.\");\n\t\t\treturn [];\n\t\t}\n\n\t\tconst robotList: Robot[] = devices\n\t\t\t.map((dev) => {\n\t\t\t\t// e.g. \"roborock.0.Devices.ABCDEFG\"\n\t\t\t\tconst idParts = dev._id.split(\".\");\n\t\t\t\tconst duid = idParts.pop();\n\t\t\t\tconst name = dev.common.name ? String(dev.common.name) : \"Unknown Robot\";\n\n\t\t\t\tif (!duid) {\n\t\t\t\t\tthis.adapter.log.warn(`[SocketHandler] Could not parse DUID from _id: ${dev._id}`);\n\t\t\t\t\treturn null;\n\t\t\t\t}\n\t\t\t\treturn { duid, name };\n\t\t\t})\n\t\t\t.filter((robot): robot is Robot => robot !== null); // Filter out any nulls\n\n\t\tthis.adapter.log.debug(`[SocketHandler] Returning robot list: ${JSON.stringify(robotList)}`);\n\t\treturn robotList;\n\t}\n\n\t/**\n\t * Handles simple commands.\n\t */\n\tprivate async handleSimpleCommand(duid: string, command: string): Promise<{ result: string }> {\n\t\tif (!duid) throw new Error(`Invalid message: '${command}' requires a 'duid'.`);\n\t\tthis.adapter.log.info(`[SocketHandler] Received '${command}' for DUID: ${duid}`);\n\n\t\tconst handler = this.adapter.deviceFeatureHandlers.get(duid);\n\t\tif (!handler) throw new Error(`No handler for DUID ${duid}`);\n\n\t\tawait this.adapter.requestsHandler.command(handler, duid, command);\n\t\treturn { result: \"ok\" };\n\t}\n\n\t/**\n\t * Handles 'app_goto_target'.\n\t */\n\tprivate async handleGotoTarget(message: { duid: string; points: [number, number] }): Promise<{ result: string }> {\n\t\tconst { duid, points } = message;\n\t\tif (!duid || !points || !Array.isArray(points) || points.length !== 2) {\n\t\t\tthrow new Error(\"Invalid 'app_goto_target' message: requires 'duid' and 'points' array [x, y]\");\n\t\t}\n\n\t\tthis.adapter.log.info(`[SocketHandler] Received 'app_goto_target' for DUID: ${duid} with points: ${JSON.stringify(points)}`);\n\n\t\tconst handler = this.adapter.deviceFeatureHandlers.get(duid);\n\t\tif (!handler) throw new Error(`No handler for DUID ${duid}`);\n\n\t\tawait this.adapter.requestsHandler.command(handler, duid, \"app_goto_target\", points);\n\t\treturn { result: \"ok\" };\n\t}\n\n\t/**\n\t * Handles 'app_zoned_clean'.\n\t */\n\tprivate async handleZonedClean(message: { duid: string; zones: any[] }): Promise<{ result: string }> {\n\t\tconst { duid, zones } = message;\n\t\tif (!duid || !zones || !Array.isArray(zones)) {\n\t\t\tthrow new Error(\"Invalid 'app_zoned_clean' message: requires 'duid' and 'zones' array\");\n\t\t}\n\n\t\tthis.adapter.log.info(`[SocketHandler] Received 'app_zoned_clean' for DUID: ${duid} with zones: ${JSON.stringify(zones)}`);\n\n\t\tconst handler = this.adapter.deviceFeatureHandlers.get(duid);\n\t\tif (!handler) throw new Error(`No handler for DUID ${duid}`);\n\n\t\tawait this.adapter.requestsHandler.command(handler, duid, \"app_zoned_clean\", zones);\n\t\treturn { result: \"ok\" };\n\t}\n}\n"]}