{"version":3,"file":"cryptoEngine.test.js","sourceRoot":"","sources":["../../src/lib/cryptoEngine.test.ts"],"names":[],"mappings":"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","sourcesContent":["import { cryptoEngine } from \"./cryptoEngine\";\nimport { expect } from \"chai\";\n\ndescribe(\"cryptoEngine L01\", () => {\n\tconst localKey = \"byteTheDust\";\n\tconst timestamp = 1737731337;\n\tconst seq = 42;\n\tconst random = 1337;\n\tconst connectNonce = 1234;\n\tconst ackNonce = 5678;\n\n\tit(\"should encrypt and decrypt L01 payload correctly\", () => {\n\t\tconst payload = Buffer.from(\"Hello Roborock L01\", \"utf-8\");\n\n\t\tconst encrypted = cryptoEngine.encryptL01(payload, localKey, timestamp, seq, random, connectNonce, ackNonce);\n\n\t\texpect(encrypted).to.be.instanceOf(Buffer);\n\t\texpect(encrypted.length).to.be.greaterThan(payload.length); // GCM appends auth tag\n\n\t\tconst decrypted = cryptoEngine.decryptL01(encrypted, localKey, timestamp, seq, random, connectNonce, ackNonce);\n\n\t\texpect(decrypted.toString(\"utf-8\")).to.equal(payload.toString(\"utf-8\"));\n\t});\n\n\tit(\"should throw if nonces are missing\", () => {\n\t\tconst payload = Buffer.from(\"Test Missing Nonces\", \"utf-8\");\n\n\t\texpect(() => cryptoEngine.encryptL01(payload, localKey, timestamp, seq, random, 0 as any, undefined)).to.throw(\"Missing nonces for L01\");\n\n\t\texpect(() => cryptoEngine.decryptL01(payload, localKey, timestamp, seq, random, 0 as any, undefined)).to.throw(\"Missing nonces for L01\");\n\t});\n});\n\ndescribe(\"cryptoEngine L01 - Official Vectors\", () => {\n\tconst localKey = \"b8Hj5mFk3QzT7rLp\";\n\tconst timestamp = 1753606905;\n\tconst sequence = 1;\n\tconst nonce = 304251;\n\tconst connectNonce = 893563;\n\tconst ackNonce = 485592656;\n\n\tconst plainPayload = '{\"dps\":{\"101\":\"{\\\\\"id\\\\\":1806,\\\\\"method\\\\\":\\\\\"get_prop\\\\\",\\\\\"params\\\\\":[\\\\\"get_status\\\\\"]}\"},\"t\":1753606905}';\n\n\tconst encryptedPayload = Uint8Array.from([\n\t\t253, 96, 200, 218, 202, 28, 202, 230, 127, 96, 119, 71, 123, 250, 157, 55, 24, 154, 56, 215, 91, 60, 74, 144, 124, 36, 53, 211, 193, 70, 238, 132, 216, 249, 149, 151,\n\t\t227, 225, 87, 26, 1, 89, 97, 206, 170, 77, 100, 188, 54, 149, 250, 224, 36, 195, 65, 103, 55, 215, 113, 80, 52, 29, 226, 156, 173, 47, 149, 191, 175, 83, 35, 88, 241,\n\t\t43, 191, 248, 159, 20, 15, 239, 91, 30, 226, 132, 195, 171, 254, 59, 131, 165, 119, 145, 10, 114, 5, 109, 171, 77, 90, 117, 177, 130, 209, 160, 203, 161, 69, 227,\n\t\t228, 80, 243, 146, 116, 67,\n\t]);\n\n\tit(\"should encrypt to the known vector\", () => {\n\t\tconst encrypted = cryptoEngine.encryptL01(Buffer.from(plainPayload, \"utf-8\"), localKey, timestamp, sequence, nonce, connectNonce, ackNonce);\n\n\t\texpect(Array.from(encrypted)).to.deep.equal(Array.from(encryptedPayload));\n\t});\n\n\tit(\"should decrypt the known vector\", () => {\n\t\tconst decrypted = cryptoEngine.decryptL01(Buffer.from(encryptedPayload), localKey, timestamp, sequence, nonce, connectNonce, ackNonce);\n\n\t\texpect(decrypted.toString(\"utf-8\")).to.equal(plainPayload);\n\t});\n});\n"]}