{"version":3,"file":"mapDataParser.js","sourceRoot":"","sources":["../../src/lib/mapDataParser.ts"],"names":[],"mappings":"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","sourcesContent":["// src/lib/mapDataParser.ts\r\nimport type { Roborock } from \"../main\";\r\nimport * as crypto from \"crypto\";\r\n\r\n// --------------------\r\n// Constants\r\n// --------------------\r\nconst TYPES = {\r\n\tCHARGER_LOCATION: 1,\r\n\tIMAGE: 2,\r\n\tPATH: 3,\r\n\tGOTO_PATH: 4,\r\n\tGOTO_PREDICTED_PATH: 5,\r\n\tCURRENTLY_CLEANED_ZONES: 6,\r\n\tGOTO_TARGET: 7,\r\n\tROBOT_POSITION: 8,\r\n\tFORBIDDEN_ZONES: 9,\r\n\tVIRTUAL_WALLS: 10,\r\n\tCURRENTLY_CLEANED_BLOCKS: 11,\r\n\tNO_MOP_ZONE: 12,\r\n\tOBSTACLES: 13,\r\n\tIGNORED_OBSTACLES: 14,\r\n\tOBSTACLES2: 15,\r\n\tIGNORED_OBSTACLES2: 16,\r\n\tCARPET_MAP: 17,\r\n\tMOP_PATH: 18,\r\n\tCARPET_FORBIDDEN_ZONE: 19,\r\n\tSMART_ZONE_PATH_TYPE: 20,\r\n\tSMART_ZONE: 21,\r\n\tCUSTOM_CARPET: 22,\r\n\tCL_FORBIDDEN_ZONES: 23,\r\n\tFLOOR_MAP: 24,\r\n\tFURNITURES: 25,\r\n\tDOCK_TYPE: 26,\r\n\tENEMIES: 27,\r\n\tDS_FORBIDDEN_ZONES: 28,\r\n\tSTUCK_POINTS: 29,\r\n\tCLF_FORBIDDEN_ZONES: 30,\r\n\tSMART_DS: 31,\r\n\tFLOOR_DIRECTION: 32,\r\n\tDATE: 33,\r\n\tNONCEDATA: 34,\r\n\tEXT_ZONES: 36,\r\n\tPATROL: 37,\r\n\tPET_PATROL: 38,\r\n\tMODE_CARPET: 39,\r\n\tSTROY_PT: 41,\r\n\tDIRTY_RECT: 42,\r\n\tIGNORE_DIRTY_RECT: 43,\r\n\tBRUSH_PT: 44,\r\n\tDIRTY_NEW: 45,\r\n\tMOP_ERR_PT: 46,\r\n\tERAZER_ZONE: 47,\r\n\tLONG_CARPET: 48,\r\n\tDS_SIDES: 49,\r\n\tSTEERING_PT: 50,\r\n\tSENSOR_INFO: 51,\r\n\tLOW_SPACES: 52,\r\n\tTIDY_ZONES: 53,\r\n\tGARBAGE: 54,\r\n\tZONE_LINES: 55,\r\n\tDIGEST: 1024,\r\n\tUNKNOWN_40: 40,\r\n\tUNKNOWN_56: 56,\r\n};\r\nconst TYPES_REVERSE = Object.fromEntries(Object.entries(TYPES).map(([key, value]) => [value, key]));\r\nconst OFFSETS = {\r\n\tHLENGTH: 0x02,\r\n\tLENGTH: 0x04,\r\n\tTYPE_COUNT: 0x08,\r\n\tTARGET_X: 0x08,\r\n\tANGLE: 0x10,\r\n\tPATH: 0x14,\r\n\tTARGET_Y: 0x0a,\r\n\tBLOCKS: 0x0c,\r\n};\r\n\r\n// --------------------\r\n// Interfaces\r\n// --------------------\r\ninterface MapMetaData {\r\n\theader_length: number;\r\n\tdata_length: number;\r\n\tversion: { major: number; minor: number };\r\n\tmap_index: number;\r\n\tmap_sequence: number;\r\n\tSHA1: string;\r\n\texpectedSHA1: string;\r\n}\r\ninterface PositionBlock {\r\n\tposition: [number, number];\r\n\tangle: number;\r\n}\r\ninterface SegmentInfo {\r\n\tid: number; // The segment ID (e.g., 16)\r\n\tname: string; // The room name (e.g., \"Kitchen\")\r\n\tcenter: [number, number]; // The calculated center coordinates in MM\r\n}\r\ninterface ImageBlock {\r\n\tsegments: {\r\n\t\tcount: number;\r\n\t\tlist: SegmentInfo[];\r\n\t};\r\n\tposition: { top: number; left: number };\r\n\tdimensions: { height: number; width: number };\r\n\tpixels: { floor: number[]; obstacle: number[]; segments: number[] };\r\n}\r\ninterface PathBlock {\r\n\tcurrent_angle: number;\r\n\tpoints: [number, number][];\r\n}\r\ntype Obstacle = [number, number, number, number, number, number, string];\r\ninterface NonceData {\r\n\ttype: number;\r\n\tunixTime: number;\r\n}\r\nexport interface ParsedMapData {\r\n\tmetaData: MapMetaData;\r\n\tROBOT_POSITION?: PositionBlock;\r\n\tCHARGER_LOCATION?: PositionBlock;\r\n\tIMAGE?: ImageBlock;\r\n\tPATH?: PathBlock;\r\n\tGOTO_PATH?: PathBlock;\r\n\tGOTO_PREDICTED_PATH?: PathBlock;\r\n\tCURRENTLY_CLEANED_ZONES?: number[][];\r\n\tGOTO_TARGET?: [number, number];\r\n\tVIRTUAL_WALLS?: number[][];\r\n\tCURRENTLY_CLEANED_BLOCKS?: number[];\r\n\tFORBIDDEN_ZONES?: number[][];\r\n\tNO_MOP_ZONE?: number[][];\r\n\tOBSTACLES2?: Obstacle[];\r\n\tCARPET_MAP?: number[];\r\n\tMOP_PATH?: number[];\r\n\tCARPET_FORBIDDEN_ZONE?: number[][];\r\n\tDS_FORBIDDEN_ZONES?: number[][];\r\n\tCLF_FORBIDDEN_ZONES?: number[][];\r\n\tMODE_CARPET?: number[][];\r\n\tNONCEDATA?: NonceData[];\r\n\tSTROY_PT?: any[];\r\n\tDIRTY_RECT?: any[];\r\n\tIGNORE_DIRTY_RECT?: any[];\r\n\tBRUSH_PT?: any[];\r\n\tDIRTY_NEW?: any[];\r\n\tMOP_ERR_PT?: any[];\r\n\tERAZER_ZONE?: any[];\r\n\tLONG_CARPET?: any[];\r\n\tDS_SIDES?: any[];\r\n\tSTEERING_PT?: any[];\r\n\tSENSOR_INFO?: any[];\r\n\tLOW_SPACES?: any[];\r\n\tTIDY_ZONES?: any[];\r\n\tGARBAGE?: any[];\r\n\tZONE_LINES?: any[];\r\n\tOBSTACLES?: any[];\r\n\tIGNORED_OBSTACLES?: any[];\r\n\tIGNORED_OBSTACLES2?: any[];\r\n\tSMART_ZONE_PATH_TYPE?: number;\r\n\tSMART_ZONE?: any[];\r\n\tCUSTOM_CARPET?: any[];\r\n\tFLOOR_MAP?: number[];\r\n\tFURNITURES?: any[];\r\n\tDOCK_TYPE?: number;\r\n\tENEMIES?: any[];\r\n\tSTUCK_POINTS?: any[];\r\n\tSMART_DS?: any[];\r\n\tFLOOR_DIRECTION?: any[];\r\n\tDATE?: number;\r\n\tEXT_ZONES?: any[];\r\n\tPATROL?: any[];\r\n\tPET_PATROL?: any[];\r\n}\r\n\r\nexport class MapDataParser {\r\n\tadapter: Roborock;\r\n\r\n\tconstructor(adapter: Roborock) {\r\n\t\tthis.adapter = adapter;\r\n\t}\r\n\r\n\t/**\r\n\t * Parses the complete raw map buffer from the robot.\r\n\t */\r\n\tasync parsedata(buf: Buffer, mappedRooms: any[] | null, options: { isHistoryMap: boolean } = { isHistoryMap: false }): Promise<ParsedMapData | {}> {\r\n\t\tif (buf.length < 8) {\r\n\t\t\tthis.adapter.log.warn(`[MapDataParser] Received map buffer is too small (< 8 bytes). Length: ${buf.length}`);\r\n\t\t\treturn {};\r\n\t\t}\r\n\r\n\t\tlet metaData: MapMetaData;\r\n\t\tlet dataPosition = 0;\r\n\t\tlet dataLength = buf.length;\r\n\r\n\t\tif (buf.length >= 20 && buf[0x00] === 0x72 && buf[0x01] === 0x72) {\r\n\t\t\tthis.adapter.log.debug(\"[MapDataParser] Found 'rr' header. Parsing as Standard Map.\");\r\n\t\t\tmetaData = this.parseHeader(buf);\r\n\r\n\t\t\tif (!metaData.header_length) {\r\n\t\t\t\tthis.adapter.log.error(`[MapDataParser] Failed to parse LIVE map header (Invalid structure).`);\r\n\t\t\t\treturn {};\r\n\t\t\t}\r\n\t\t\tif (metaData.SHA1 !== metaData.expectedSHA1) {\r\n\t\t\t\tthis.adapter.log.error(`[MapDataParser] Invalid map hash!`);\r\n\t\t\t\treturn {};\r\n\t\t\t}\r\n\r\n\t\t\tdataPosition = 0x14; // Skip 20-byte header\r\n\t\t\tdataLength = metaData.data_length;\r\n\t\t} else if (options.isHistoryMap) {\r\n\t\t\tthis.adapter.log.debug(\"[MapDataParser] Parsing as History Map (No 'rr' Header).\");\r\n\t\t\tmetaData = { map_index: -1 } as any;\r\n\t\t\tdataPosition = 0;\r\n\t\t\tdataLength = buf.length;\r\n\t\t} else {\r\n\t\t\tthis.adapter.log.warn(\"[MapDataParser] Invalid map header signature (expected 'rr').\");\r\n\t\t\treturn {};\r\n\t\t}\r\n\r\n\t\tconst result: any = { metaData };\r\n\r\n\t\tconst roomIDsAll = this.adapter.http_api.getMatchedRoomIDs(false);\r\n\r\n\t\t// Loop through all blocks\r\n\t\twhile (dataPosition < dataLength) {\r\n\t\t\tif (dataPosition + OFFSETS.LENGTH + 4 > buf.length) {\r\n\t\t\t\tthis.adapter.log.warn(`[MapDataParser] Reached end of buffer prematurely while reading block header.`);\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\r\n\t\t\tconst type = buf.readUInt16LE(dataPosition);\r\n\t\t\tconst hlength = buf.readUInt16LE(dataPosition + OFFSETS.HLENGTH);\r\n\t\t\tconst length = buf.readUInt32LE(dataPosition + OFFSETS.LENGTH);\r\n\r\n\t\t\tif (dataPosition + hlength + length > buf.length) {\r\n\t\t\t\tthis.adapter.log.warn(`[MapDataParser] Block (Type ${type}) claims to be larger than buffer. Stopping parse.`);\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\r\n\t\t\tconst blockBuffer = buf.slice(dataPosition, dataPosition + hlength + length);\r\n\t\t\tconst [offset1, offset2] = this.getTwoByteOffsets(blockBuffer);\r\n\r\n\t\t\tconst typeName = TYPES_REVERSE[type];\r\n\t\t\tif (typeName) {\r\n\t\t\t\ttry {\r\n\t\t\t\t\tswitch (type) {\r\n\t\t\t\t\t\tcase TYPES.ROBOT_POSITION:\r\n\t\t\t\t\t\tcase TYPES.CHARGER_LOCATION: {\r\n\t\t\t\t\t\t\tconst position = this.getXYPositions(blockBuffer, offset1, offset2);\r\n\t\t\t\t\t\t\tconst angle = length >= 12 ? this.getAngle(blockBuffer) : 0;\r\n\t\t\t\t\t\t\tresult[typeName] = { position, angle };\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tcase TYPES.IMAGE: {\r\n\t\t\t\t\t\t\tresult[typeName] = this.parseImageBlock(blockBuffer, buf, dataPosition, length, hlength, mappedRooms, roomIDsAll);\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tcase TYPES.CARPET_MAP: {\r\n\t\t\t\t\t\t\tconst carpets: number[] = [];\r\n\t\t\t\t\t\t\tconst dataStart = dataPosition + offset1;\r\n\t\t\t\t\t\t\tfor (let i = 0; i < length; i++) {\r\n\t\t\t\t\t\t\t\tif (this.getPixelType(buf, dataStart + i) === 1) {\r\n\t\t\t\t\t\t\t\t\tcarpets.push(i);\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tresult[typeName] = carpets;\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tcase TYPES.MOP_PATH: {\r\n\t\t\t\t\t\t\tconst mopPath: number[] = [];\r\n\t\t\t\t\t\t\tconst dataStart = dataPosition + hlength;\r\n\t\t\t\t\t\t\tfor (let i = 0; i < length; i++) {\r\n\t\t\t\t\t\t\t\tmopPath.push(...this.readUInt8(buf, dataStart + i, 0, 1));\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tresult[typeName] = mopPath;\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tcase TYPES.PATH:\r\n\t\t\t\t\t\tcase TYPES.GOTO_PATH:\r\n\t\t\t\t\t\tcase TYPES.GOTO_PREDICTED_PATH: {\r\n\t\t\t\t\t\t\tresult[typeName] = this.parsePathBlock(blockBuffer, buf, dataPosition, length);\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tcase TYPES.GOTO_TARGET:\r\n\t\t\t\t\t\t\tresult[typeName] = this.getGoToTarget(blockBuffer);\r\n\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t\tcase TYPES.CURRENTLY_CLEANED_ZONES:\r\n\t\t\t\t\t\tcase TYPES.VIRTUAL_WALLS: {\r\n\t\t\t\t\t\t\tconst count = this.getCount(blockBuffer);\r\n\t\t\t\t\t\t\tconst zones: number[][] = [];\r\n\t\t\t\t\t\t\tconst dataStart = dataPosition + hlength;\r\n\t\t\t\t\t\t\tfor (let i = 0; i < count; i++) {\r\n\t\t\t\t\t\t\t\tzones.push(this.readUInt16LE(buf, dataStart + i * 8, 0, 4));\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tresult[typeName] = zones;\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tcase TYPES.FORBIDDEN_ZONES:\r\n\t\t\t\t\t\tcase TYPES.NO_MOP_ZONE:\r\n\t\t\t\t\t\tcase TYPES.CARPET_FORBIDDEN_ZONE:\r\n\t\t\t\t\t\tcase TYPES.DS_FORBIDDEN_ZONES:\r\n\t\t\t\t\t\tcase TYPES.CLF_FORBIDDEN_ZONES:\r\n\t\t\t\t\t\tcase TYPES.MODE_CARPET: {\r\n\t\t\t\t\t\t\tconst count = this.getCount(blockBuffer);\r\n\t\t\t\t\t\t\tconst zones: number[][] = [];\r\n\t\t\t\t\t\t\tconst dataStart = dataPosition + hlength;\r\n\t\t\t\t\t\t\tfor (let i = 0; i < count; i++) {\r\n\t\t\t\t\t\t\t\tzones.push(this.getForbiddenZone(buf, dataStart + i * 16, 0));\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tresult[typeName] = zones;\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tcase TYPES.OBSTACLES2:\r\n\t\t\t\t\t\t\tresult[typeName] = this.extractObstacles(blockBuffer, hlength);\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tcase TYPES.CURRENTLY_CLEANED_BLOCKS: {\r\n\t\t\t\t\t\t\tconst count = this.getCount(blockBuffer);\r\n\t\t\t\t\t\t\tconst blocks: number[] = [];\r\n\t\t\t\t\t\t\tfor (let i = 0; i < count; i++) {\r\n\t\t\t\t\t\t\t\tblocks.push(buf.readUInt8(dataPosition + OFFSETS.BLOCKS + i));\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tresult[typeName] = blocks;\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tcase TYPES.NONCEDATA:\r\n\t\t\t\t\t\t\tresult[typeName] = this.getNonceData(blockBuffer);\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tcase TYPES.STROY_PT:\r\n\t\t\t\t\t\t\tresult[typeName] = this.getStroyPt(blockBuffer, hlength);\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tcase TYPES.DIRTY_RECT:\r\n\t\t\t\t\t\tcase TYPES.IGNORE_DIRTY_RECT:\r\n\t\t\t\t\t\t\tresult[typeName] = this.getDirtyRect(blockBuffer, hlength);\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tcase TYPES.BRUSH_PT:\r\n\t\t\t\t\t\t\tresult[typeName] = this.getBrushPt(blockBuffer, hlength);\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tcase TYPES.DIRTY_NEW:\r\n\t\t\t\t\t\t\tresult[typeName] = this.getDirtyNew(blockBuffer, hlength, length);\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tcase TYPES.MOP_ERR_PT:\r\n\t\t\t\t\t\t\tresult[typeName] = this.getMopErrPt(blockBuffer, hlength);\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tcase TYPES.ERAZER_ZONE:\r\n\t\t\t\t\t\tcase TYPES.LOW_SPACES:\r\n\t\t\t\t\t\t\tresult[typeName] = this.getEraserZone(blockBuffer, hlength, length);\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tcase TYPES.LONG_CARPET:\r\n\t\t\t\t\t\t\tresult[typeName] = this.getLongCarpet(blockBuffer, hlength, length);\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tcase TYPES.DS_SIDES:\r\n\t\t\t\t\t\t\tresult[typeName] = this.getDsSides(blockBuffer, hlength, length);\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tcase TYPES.STEERING_PT:\r\n\t\t\t\t\t\t\tresult[typeName] = this.getSteeringPt(blockBuffer, hlength, length);\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tcase TYPES.SENSOR_INFO:\r\n\t\t\t\t\t\t\tresult[typeName] = this.getSensorInfo(blockBuffer, hlength, length);\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tcase TYPES.TIDY_ZONES:\r\n\t\t\t\t\t\t\tresult[typeName] = this.getTidyZones(blockBuffer, hlength, length);\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tcase TYPES.GARBAGE:\r\n\t\t\t\t\t\t\tresult[typeName] = this.getGarbage(blockBuffer, hlength, length);\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tcase TYPES.ZONE_LINES:\r\n\t\t\t\t\t\t\tresult[typeName] = this.getZoneLines(blockBuffer, hlength);\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tcase TYPES.OBSTACLES:\r\n\t\t\t\t\t\tcase TYPES.IGNORED_OBSTACLES:\r\n\t\t\t\t\t\t\tresult[typeName] = this.getObstaclesOld(blockBuffer, hlength);\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tcase TYPES.IGNORED_OBSTACLES2:\r\n\t\t\t\t\t\t\tresult[typeName] = this.getIgnoredObstacles2(blockBuffer, hlength);\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tcase TYPES.SMART_ZONE_PATH_TYPE:\r\n\t\t\t\t\t\t\tresult[typeName] = buf.readUInt8(dataPosition + offset1);\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tcase TYPES.SMART_ZONE:\r\n\t\t\t\t\t\t\tresult[typeName] = this.getSmartZone(blockBuffer, hlength);\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tcase TYPES.CUSTOM_CARPET:\r\n\t\t\t\t\t\tcase TYPES.CL_FORBIDDEN_ZONES:\r\n\t\t\t\t\t\tcase TYPES.SMART_DS:\r\n\t\t\t\t\t\tcase TYPES.EXT_ZONES:\r\n\t\t\t\t\t\t\tresult[typeName] = this.getForbiddenZone(buf, dataPosition + hlength, 0); // Re-use getForbiddenZone as structure is same (16 bytes)\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tcase TYPES.FLOOR_MAP:\r\n\t\t\t\t\t\t\tresult[typeName] = this.readUInt8(buf, dataPosition, hlength, length);\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tcase TYPES.FURNITURES:\r\n\t\t\t\t\t\t\tresult[typeName] = this.getFurnitures(blockBuffer, hlength);\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tcase TYPES.DOCK_TYPE:\r\n\t\t\t\t\t\t\tresult[typeName] = buf.readUInt8(dataPosition + offset1);\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tcase TYPES.ENEMIES:\r\n\t\t\t\t\t\tcase TYPES.STUCK_POINTS:\r\n\t\t\t\t\t\t\tresult[typeName] = this.getEnemies(blockBuffer, hlength);\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tcase TYPES.FLOOR_DIRECTION:\r\n\t\t\t\t\t\t\tresult[typeName] = this.getFloorDirection(blockBuffer, hlength, length);\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tcase TYPES.DATE:\r\n\t\t\t\t\t\t\tresult[typeName] = buf.readUInt32LE(dataPosition + offset1);\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tcase TYPES.PATROL:\r\n\t\t\t\t\t\tcase TYPES.PET_PATROL:\r\n\t\t\t\t\t\t\tresult[typeName] = this.getPatrol(blockBuffer, hlength);\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tcase TYPES.UNKNOWN_40:\r\n\t\t\t\t\t\tcase TYPES.UNKNOWN_56:\r\n\t\t\t\t\t\t\tthis.adapter.log.debug(`[MapDataParser] Received known unknown block type ${type} with length ${length}. Data: ${blockBuffer.toString(\"hex\")}`);\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t} catch (e: any) {\r\n\t\t\t\t\tthis.adapter.log.error(`[MapDataParser] Error parsing block ${typeName} (Type ${type}): ${e.stack}`);\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tthis.adapter.log.warn(`[MapDataParser] Unknown block type: ${type} with length ${length}. Data: ${blockBuffer.toString(\"hex\")}`);\r\n\t\t\t}\r\n\t\t\tdataPosition += length + hlength;\r\n\t\t}\r\n\t\treturn result;\r\n\t}\r\n\r\n\tprivate parseHeader(mapBuf: Buffer): MapMetaData {\r\n\t\treturn {\r\n\t\t\theader_length: mapBuf.readUInt16LE(OFFSETS.HLENGTH),\r\n\t\t\tdata_length: mapBuf.readUInt32LE(OFFSETS.LENGTH),\r\n\t\t\tversion: {\r\n\t\t\t\tmajor: mapBuf.readUInt16LE(0x08),\r\n\t\t\t\tminor: mapBuf.readUInt16LE(0x0a),\r\n\t\t\t},\r\n\t\t\tmap_index: mapBuf.readUInt32LE(0x0c),\r\n\t\t\tmap_sequence: mapBuf.readUInt32LE(0x10),\r\n\t\t\tSHA1: crypto\r\n\t\t\t\t.createHash(\"sha1\")\r\n\t\t\t\t.update(mapBuf.subarray(0, mapBuf.length - 20))\r\n\t\t\t\t.digest(\"hex\"),\r\n\t\t\texpectedSHA1: mapBuf.subarray(mapBuf.length - 20).toString(\"hex\"),\r\n\t\t};\r\n\t}\r\n\r\n\tprivate parseImageBlock(\r\n\t\tblockBuffer: Buffer,\r\n\t\tbuf: Buffer,\r\n\t\tdataPosition: number,\r\n\t\tlength: number,\r\n\t\thlength: number,\r\n\t\tmappedRooms: any[] | null,\r\n\t\troomIDsAll: { id: number; name: string }[]\r\n\t): ImageBlock {\r\n\t\t// MM per pixel (5cm)\r\n\t\tconst MM_PER_PIXEL = 50;\r\n\r\n\t\t// Get unscaled pixel dimensions and offsets\r\n\t\tconst offset = this.getSingleByteOffset(blockBuffer);\r\n\t\tconst { left, top, width: width_px, height: height_px } = this.getMapSizes(blockBuffer, offset);\r\n\r\n\t\tconst parameters: ImageBlock = {\r\n\t\t\tsegments: {\r\n\t\t\t\tcount: hlength > 24 ? this.getCount(blockBuffer) : 0,\r\n\t\t\t\tlist: [],\r\n\t\t\t},\r\n\t\t\tposition: { top, left },\r\n\t\t\tdimensions: { height: height_px, width: width_px },\r\n\t\t\tpixels: { floor: [], obstacle: [], segments: [] },\r\n\t\t};\r\n\r\n\t\tif (height_px <= 0 || width_px <= 0) return parameters;\r\n\r\n\t\t// Create Bounding Boxes for segments\r\n\t\tconst segBB: Record<number, { minX: number; maxX: number; minY: number; maxY: number; count: number }> = {};\r\n\t\tconst segmentIDsInImage: Set<number> = new Set();\r\n\r\n\t\tconst dataStart = dataPosition + offset;\r\n\r\n\t\tfor (let i = 0; i < length; i++) {\r\n\t\t\tconst pixelBytePosition = dataStart + i;\r\n\t\t\tconst pixelType = this.getPixelType(buf, pixelBytePosition);\r\n\r\n\t\t\tif (pixelType === 1) {\r\n\t\t\t\t// Obstacle\r\n\t\t\t\tparameters.pixels.obstacle.push(i);\r\n\t\t\t} else if (pixelType !== 0) {\r\n\t\t\t\t// Floor\r\n\t\t\t\tparameters.pixels.floor.push(i);\r\n\r\n\t\t\t\tconst segmentID = (buf.readUInt8(pixelBytePosition) & 248) >> 3;\r\n\t\t\t\tsegmentIDsInImage.add(segmentID);\r\n\r\n\t\t\t\tparameters.pixels.segments.push(i | (segmentID << 21));\r\n\r\n\t\t\t\t// Calculate UN-SCALED pixel coordinates relative to the data block (0, 0)\r\n\t\t\t\tconst x = i % width_px;\r\n\t\t\t\tconst y = Math.floor(i / width_px);\r\n\r\n\t\t\t\tconst bb = segBB[segmentID];\r\n\t\t\t\tif (!bb) {\r\n\t\t\t\t\tsegBB[segmentID] = { minX: x, maxX: x, minY: y, maxY: y, count: 1 };\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif (x < bb.minX) bb.minX = x;\r\n\t\t\t\t\tif (x > bb.maxX) bb.maxX = x;\r\n\t\t\t\t\tif (y < bb.minY) bb.minY = y;\r\n\t\t\t\t\tif (y > bb.maxY) bb.maxY = y;\r\n\t\t\t\t\tbb.count++;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// --- Process all found segments ---\r\n\t\tfor (const segId of segmentIDsInImage) {\r\n\t\t\tif (segId === 0) continue; // Skip \"no segment\"\r\n\r\n\t\t\tconst bb = segBB[segId];\r\n\t\t\tif (!bb) continue;\r\n\r\n\t\t\tconst centerX_px = Math.round((bb.minX + bb.maxX) / 2);\r\n\t\t\tconst centerY_px = Math.round((bb.minY + bb.maxY) / 2);\r\n\r\n\t\t\t// This logic MUST match the working localCoordsToRobotCoords formula\r\n\t\t\t// x_robot = (center_x_px + offset_x_px) * MM_PER_PIXEL\r\n\t\t\t// y_robot = ((height_px / scale) + top_px - center_y_px) * MM_PER_PIXEL\r\n\r\n\t\t\tconst centerX_robot = Math.round((centerX_px + left) * MM_PER_PIXEL);\r\n\r\n\t\t\t// NOTE: The map creator scales dimensions.height by map_scale, which cancels out:\r\n\t\t\t// (height_px * scale / scale) = height_px\r\n\t\t\tconst centerY_robot = Math.round((centerY_px + top) * MM_PER_PIXEL);\r\n\r\n\t\t\tlet roomName = \"\";\r\n\t\t\tconst mapping = mappedRooms?.find(([id]) => parseInt(id) === segId);\r\n\t\t\tif (mapping) {\r\n\t\t\t\tconst roomApiID = mapping[1];\r\n\t\t\t\tconst roomObj = roomIDsAll.find((r) => String(r.id) === String(roomApiID));\r\n\t\t\t\troomName = roomObj?.name || \"\";\r\n\t\t\t}\r\n\r\n\t\t\tparameters.segments.list.push({\r\n\t\t\t\tid: segId,\r\n\t\t\t\tname: roomName,\r\n\t\t\t\tcenter: [centerX_robot, centerY_robot], // Store correct MM coordinates\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\treturn parameters;\r\n\t}\r\n\r\n\tprivate parsePathBlock(blockBuffer: Buffer, buf: Buffer, dataPosition: number, length: number): PathBlock {\r\n\t\tconst pathData: PathBlock = {\r\n\t\t\tcurrent_angle: this.getAngle(blockBuffer),\r\n\t\t\tpoints: [],\r\n\t\t};\r\n\t\tconst pathDataPosition = dataPosition + OFFSETS.PATH;\r\n\r\n\t\tfor (let i = 0; i < length; i += 4) {\r\n\t\t\tpathData.points.push(this.getPointInPath(buf, pathDataPosition + i));\r\n\t\t}\r\n\r\n\t\tif (pathData.points.length >= 2) {\r\n\t\t\tconst last = pathData.points[pathData.points.length - 1];\r\n\t\t\tconst secondLast = pathData.points[pathData.points.length - 2];\r\n\t\t\tpathData.current_angle = (Math.atan2(last[1] - secondLast[1], last[0] - secondLast[0]) * 180) / Math.PI;\r\n\t\t}\r\n\r\n\t\treturn pathData;\r\n\t}\r\n\r\n\tprivate extractObstacles(buf: Buffer, offset: number): Obstacle[] {\r\n\t\tconst obstacleCount = this.getCount(buf);\r\n\t\tconst obstacles: Obstacle[] = [];\r\n\t\tfor (let i = 0; i < obstacleCount * 28; i += 28) {\r\n\t\t\tconst obstacle: Obstacle = [\r\n\t\t\t\tbuf.readUInt16LE(offset + i),\r\n\t\t\t\tbuf.readUInt16LE(offset + i + 2),\r\n\t\t\t\tbuf.readUInt16LE(offset + i + 4),\r\n\t\t\t\tbuf.readUInt16LE(offset + i + 6),\r\n\t\t\t\tbuf.readUInt16LE(offset + i + 8),\r\n\t\t\t\tbuf.readUInt16LE(offset + i + 10),\r\n\t\t\t\tbuf.toString(\"utf-8\", offset + i + 12, offset + i + 12 + 16),\r\n\t\t\t];\r\n\t\t\tobstacles.push(obstacle);\r\n\t\t}\r\n\t\treturn obstacles;\r\n\t}\r\n\r\n\tprivate getStroyPt(buf: Buffer, offset: number): any[] {\r\n\t\tconst count = this.getCount(buf);\r\n\t\tconst points: any[] = [];\r\n\t\tfor (let i = 0; i < count; i++) {\r\n\t\t\tconst base = offset + i * 8;\r\n\t\t\tpoints.push([\r\n\t\t\t\tbuf.readUInt16LE(base), // x\r\n\t\t\t\tbuf.readUInt16LE(base + 2), // y\r\n\t\t\t\tbuf.readUInt32LE(base + 4) // code\r\n\t\t\t]);\r\n\t\t}\r\n\t\treturn points;\r\n\t}\r\n\r\n\tprivate getDirtyRect(buf: Buffer, offset: number): any[] {\r\n\t\tconst count = this.getCount(buf);\r\n\t\tconst data: any[] = [];\r\n\t\tfor (let i = 0; i < count; i++) {\r\n\t\t\tconst base = offset + i * 18;\r\n\t\t\tdata.push([\r\n\t\t\t\tbuf.readUInt16LE(base), // type\r\n\t\t\t\tbuf.readUInt16LE(base + 2), // x1\r\n\t\t\t\tbuf.readUInt16LE(base + 4), // y1\r\n\t\t\t\tbuf.readUInt16LE(base + 6), // x2\r\n\t\t\t\tbuf.readUInt16LE(base + 8), // y2\r\n\t\t\t\tbuf.readUInt16LE(base + 10), // x3\r\n\t\t\t\tbuf.readUInt16LE(base + 12), // y3\r\n\t\t\t\tbuf.readUInt16LE(base + 14), // x4\r\n\t\t\t\tbuf.readUInt16LE(base + 16) // y4\r\n\t\t\t]);\r\n\t\t}\r\n\t\treturn data;\r\n\t}\r\n\r\n\tprivate getBrushPt(buf: Buffer, offset: number): any[] {\r\n\t\tconst count = this.getCount(buf);\r\n\t\tconst points: any[] = [];\r\n\t\tfor (let i = 0; i < count; i++) {\r\n\t\t\tconst base = offset + i * 4;\r\n\t\t\tpoints.push([\r\n\t\t\t\tbuf.readUInt16LE(base), // x\r\n\t\t\t\tbuf.readUInt16LE(base + 2) // y\r\n\t\t\t]);\r\n\t\t}\r\n\t\treturn points;\r\n\t}\r\n\r\n\tprivate getDirtyNew(buf: Buffer, offset: number, length: number): any[] {\r\n\t\tconst count = this.getCount(buf);\r\n\t\tif (count === 0) return [];\r\n\t\tconst len = length / count;\r\n\t\tconst data: any[] = [];\r\n\t\tfor (let i = 0; i < count; i++) {\r\n\t\t\tconst base = offset + i * len;\r\n\t\t\tconst hasImage = buf.readUInt8(base + 18) !== 0;\r\n\t\t\tdata.push([\r\n\t\t\t\tbuf.readUInt16LE(base), // type\r\n\t\t\t\tbuf.readUInt16LE(base + 2), // x1\r\n\t\t\t\tbuf.readUInt16LE(base + 4), // y1\r\n\t\t\t\tbuf.readUInt16LE(base + 6), // x2\r\n\t\t\t\tbuf.readUInt16LE(base + 8), // y2\r\n\t\t\t\tbuf.readUInt16LE(base + 10), // x3\r\n\t\t\t\tbuf.readUInt16LE(base + 12), // y3\r\n\t\t\t\tbuf.readUInt16LE(base + 14), // x4\r\n\t\t\t\tbuf.readUInt16LE(base + 16), // y4\r\n\t\t\t\thasImage ? buf.toString(\"ascii\", base + 18, base + 18 + 16).replace(/\\0/g, \"\") : \"\" // imageid\r\n\t\t\t]);\r\n\t\t}\r\n\t\treturn data;\r\n\t}\r\n\r\n\tprivate getMopErrPt(buf: Buffer, offset: number): any[] {\r\n\t\tconst count = this.getCount(buf);\r\n\t\tconst points: any[] = [];\r\n\t\tfor (let i = 0; i < count; i++) {\r\n\t\t\tconst base = offset + i * 6;\r\n\t\t\tpoints.push([\r\n\t\t\t\tbuf.readUInt8(base), // errorid\r\n\t\t\t\tbuf.readUInt8(base + 1), // suberrorid\r\n\t\t\t\tbuf.readUInt16LE(base + 2), // x\r\n\t\t\t\tbuf.readUInt16LE(base + 4) // y\r\n\t\t\t]);\r\n\t\t}\r\n\t\treturn points;\r\n\t}\r\n\r\n\tprivate getEraserZone(buf: Buffer, offset: number, length: number): any[] {\r\n\t\tconst count = this.getCount(buf);\r\n\t\tif (count === 0) return [];\r\n\t\tconst len = length / count;\r\n\t\tconst data: any[] = [];\r\n\t\tfor (let i = 0; i < count; i++) {\r\n\t\t\tconst base = offset + i * len;\r\n\t\t\tdata.push([\r\n\t\t\t\tbuf.readUInt32LE(base), // type\r\n\t\t\t\tbuf.readUInt16LE(base + 4), // x1\r\n\t\t\t\tbuf.readUInt16LE(base + 6), // y1\r\n\t\t\t\tbuf.readUInt16LE(base + 8), // x2\r\n\t\t\t\tbuf.readUInt16LE(base + 10), // y2\r\n\t\t\t\tbuf.readUInt16LE(base + 12), // x3\r\n\t\t\t\tbuf.readUInt16LE(base + 14), // y3\r\n\t\t\t\tbuf.readUInt16LE(base + 16), // x4\r\n\t\t\t\tbuf.readUInt16LE(base + 18) // y4\r\n\t\t\t]);\r\n\t\t}\r\n\t\treturn data;\r\n\t}\r\n\r\n\tprivate getLongCarpet(buf: Buffer, offset: number, length: number): any[] {\r\n\t\tconst count = this.getCount(buf);\r\n\t\tif (count === 0) return [];\r\n\t\tconst len = length / count;\r\n\t\tconst data: any[] = [];\r\n\t\tfor (let i = 0; i < count; i++) {\r\n\t\t\tconst base = offset + i * len;\r\n\t\t\tdata.push([\r\n\t\t\t\tbuf.readUInt32LE(base), // id\r\n\t\t\t\tbuf.readUInt32LE(base + 4), // total\r\n\t\t\t\tbuf.readUInt32LE(base + 8) // longhaired\r\n\t\t\t]);\r\n\t\t}\r\n\t\treturn data;\r\n\t}\r\n\r\n\tprivate getDsSides(buf: Buffer, offset: number, length: number): any[] {\r\n\t\tconst count = this.getCount(buf);\r\n\t\tif (count === 0) return [];\r\n\t\tconst len = length / count;\r\n\t\tconst data: any[] = [];\r\n\t\tfor (let i = 0; i < count; i++) {\r\n\t\t\tconst base = offset + i * len;\r\n\t\t\tdata.push([\r\n\t\t\t\tbuf.readUInt8(base), // id\r\n\t\t\t\tbuf.readUInt8(base + 1),\r\n\t\t\t\tbuf.readUInt8(base + 2),\r\n\t\t\t\tbuf.readUInt8(base + 3)\r\n\t\t\t]);\r\n\t\t}\r\n\t\treturn data;\r\n\t}\r\n\r\n\tprivate getSteeringPt(buf: Buffer, offset: number, length: number): any[] {\r\n\t\tconst count = this.getCount(buf);\r\n\t\tif (count === 0) return [];\r\n\t\tconst len = length / count;\r\n\t\tconst data: any[] = [];\r\n\t\tfor (let i = 0; i < count; i++) {\r\n\t\t\tconst base = offset + i * len;\r\n\t\t\tdata.push([\r\n\t\t\t\tbuf.readUInt16LE(base), // x\r\n\t\t\t\tbuf.readUInt16LE(base + 2), // y\r\n\t\t\t\tbuf.readUInt8(base + 4) // type\r\n\t\t\t]);\r\n\t\t}\r\n\t\treturn data;\r\n\t}\r\n\r\n\tprivate getSensorInfo(buf: Buffer, offset: number, length: number): any[] {\r\n\t\tconst count = this.getCount(buf);\r\n\t\tif (count === 0) return [];\r\n\t\tconst len = length / count;\r\n\t\tconst data: any[] = [];\r\n\t\tfor (let i = 0; i < count; i++) {\r\n\t\t\tconst base = offset + i * len;\r\n\t\t\tdata.push([\r\n\t\t\t\tbuf.readUInt16LE(base), // x\r\n\t\t\t\tbuf.readUInt16LE(base + 2), // y\r\n\t\t\t\tbuf.readUInt8(base + 4), // type\r\n\t\t\t\tbuf.readUInt8(base + 5) // status\r\n\t\t\t]);\r\n\t\t}\r\n\t\treturn data;\r\n\t}\r\n\r\n\tprivate getTidyZones(buf: Buffer, offset: number, length: number): any[] {\r\n\t\tconst count = this.getCount(buf);\r\n\t\tif (count === 0) return [];\r\n\t\tconst len = length / count;\r\n\t\tconst data: any[] = [];\r\n\t\tfor (let i = 0; i < count; i++) {\r\n\t\t\tconst base = offset + i * len;\r\n\t\t\tdata.push([\r\n\t\t\t\tbuf.readUInt16LE(base), // id\r\n\t\t\t\tbuf.readUInt16LE(base + 2), // type\r\n\t\t\t\tbuf.readUInt16LE(base + 4), // x1\r\n\t\t\t\tbuf.readUInt16LE(base + 6), // y1\r\n\t\t\t\tbuf.readUInt16LE(base + 8), // x2\r\n\t\t\t\tbuf.readUInt16LE(base + 10), // y2\r\n\t\t\t\tbuf.readUInt16LE(base + 12), // x3\r\n\t\t\t\tbuf.readUInt16LE(base + 14), // y3\r\n\t\t\t\tbuf.readUInt16LE(base + 16), // x4\r\n\t\t\t\tbuf.readUInt16LE(base + 18) // y4\r\n\t\t\t]);\r\n\t\t}\r\n\t\treturn data;\r\n\t}\r\n\r\n\tprivate getGarbage(buf: Buffer, offset: number, length: number): any[] {\r\n\t\tconst count = this.getCount(buf);\r\n\t\tif (count === 0) return [];\r\n\t\tconst len = length / count;\r\n\t\tconst data: any[] = [];\r\n\t\tfor (let i = 0; i < count; i++) {\r\n\t\t\tconst base = offset + i * len;\r\n\t\t\tdata.push([\r\n\t\t\t\tbuf.readUInt16LE(base), // robot x\r\n\t\t\t\tbuf.readUInt16LE(base + 2), // robot y\r\n\t\t\t\tbuf.readUInt16LE(base + 4), // garbage x\r\n\t\t\t\tbuf.readUInt16LE(base + 6), // garbage y\r\n\t\t\t\tbuf.readUInt16LE(base + 8), // tidyzone id\r\n\t\t\t\tbuf.readUInt16LE(base + 10), // garbage id\r\n\t\t\t\tbuf.toString(\"utf-8\", base + 12, base + len) // tag\r\n\t\t\t]);\r\n\t\t}\r\n\t\treturn data;\r\n\t}\r\n\r\n\tprivate getZoneLines(buf: Buffer, offset: number): any[] {\r\n\t\tconst count = this.getCount(buf);\r\n\t\tconst data: any[] = [];\r\n\t\tlet toffset = 0;\r\n\t\tfor (let i = 0; i < count; i++) {\r\n\t\t\tconst base = offset + toffset;\r\n\t\t\tconst id = buf.readUInt16LE(base);\r\n\t\t\tconst num = buf.readUInt16LE(base + 2);\r\n\t\t\tconst ptLen = buf.readUInt16LE(base + 4);\r\n\t\t\tconst points: any[] = [];\r\n\t\t\tfor (let j = 0; j < num; j++) {\r\n\t\t\t\tconst pOff = base + 6 + j * ptLen;\r\n\t\t\t\tpoints.push([\r\n\t\t\t\t\tbuf.readUInt16LE(pOff), // x\r\n\t\t\t\t\tbuf.readUInt16LE(pOff + 2), // y\r\n\t\t\t\t\tbuf.readUIntLE(pOff + 4, ptLen - 4) // type\r\n\t\t\t\t]);\r\n\t\t\t}\r\n\t\t\ttoffset += 6 + num * ptLen;\r\n\t\t\tdata.push({ id, num, ptLen, points });\r\n\t\t}\r\n\t\treturn data;\r\n\t}\r\n\r\n\tprivate getObstaclesOld(buf: Buffer, offset: number): any[] {\r\n\t\tconst count = this.getCount(buf);\r\n\t\tconst obstacles: any[] = [];\r\n\t\tfor (let i = 0; i < count; i++) {\r\n\t\t\tconst base = offset + i * 5;\r\n\t\t\tobstacles.push([\r\n\t\t\t\tbuf.readUInt16LE(base), // x\r\n\t\t\t\tbuf.readUInt16LE(base + 2), // y\r\n\t\t\t\tbuf.readUInt8(base + 4) // type\r\n\t\t\t]);\r\n\t\t}\r\n\t\treturn obstacles;\r\n\t}\r\n\r\n\tprivate getIgnoredObstacles2(buf: Buffer, offset: number): any[] {\r\n\t\tconst count = this.getCount(buf);\r\n\t\tconst obstacles: any[] = [];\r\n\t\tfor (let i = 0; i < count; i++) {\r\n\t\t\tconst base = offset + i * 6;\r\n\t\t\tobstacles.push([\r\n\t\t\t\tbuf.readUInt16LE(base), // x\r\n\t\t\t\tbuf.readUInt16LE(base + 2), // y\r\n\t\t\t\tbuf.readUInt16LE(base + 4) // type\r\n\t\t\t]);\r\n\t\t}\r\n\t\treturn obstacles;\r\n\t}\r\n\r\n\tprivate getSmartZone(buf: Buffer, offset: number): any[] {\r\n\t\tconst count = this.getCount(buf);\r\n\t\tconst zones: any[] = [];\r\n\t\tfor (let i = 0; i < count; i++) {\r\n\t\t\tconst base = offset + i * 18;\r\n\t\t\tzones.push({\r\n\t\t\t\tzid: buf.readUInt16LE(base),\r\n\t\t\t\trange: [\r\n\t\t\t\t\tbuf.readUInt16LE(base + 2),\r\n\t\t\t\t\tbuf.readUInt16LE(base + 4),\r\n\t\t\t\t\tbuf.readUInt16LE(base + 6),\r\n\t\t\t\t\tbuf.readUInt16LE(base + 8)\r\n\t\t\t\t]\r\n\t\t\t});\r\n\t\t}\r\n\t\treturn zones;\r\n\t}\r\n\r\n\tprivate getFurnitures(buf: Buffer, offset: number): any[] {\r\n\t\tconst count = this.getCount(buf);\r\n\t\tconst furnitures: any[] = [];\r\n\t\tfor (let i = 0; i < count; i++) {\r\n\t\t\tconst base = offset + i * 23;\r\n\t\t\tfurnitures.push([\r\n\t\t\t\tbuf.readUInt16LE(base), // x1\r\n\t\t\t\tbuf.readUInt16LE(base + 2), // y1\r\n\t\t\t\tbuf.readUInt16LE(base + 4), // x2\r\n\t\t\t\tbuf.readUInt16LE(base + 6), // y2\r\n\t\t\t\tbuf.readUInt16LE(base + 8), // x3\r\n\t\t\t\tbuf.readUInt16LE(base + 10), // y3\r\n\t\t\t\tbuf.readUInt16LE(base + 12), // x4\r\n\t\t\t\tbuf.readUInt16LE(base + 14), // y4\r\n\t\t\t\tbuf.readUInt16LE(base + 16), // x_real\r\n\t\t\t\tbuf.readUInt8(base + 18), // percent\r\n\t\t\t\tbuf.readUInt8(base + 19), // type\r\n\t\t\t\tbuf.readUInt8(base + 20), // subtype\r\n\t\t\t\tbuf.readUInt8(base + 21), // edit\r\n\t\t\t\tbuf.readUInt8(base + 22) // id\r\n\t\t\t]);\r\n\t\t}\r\n\t\treturn furnitures;\r\n\t}\r\n\r\n\tprivate getEnemies(buf: Buffer, offset: number): any[] {\r\n\t\tconst count = this.getCount(buf);\r\n\t\tconst enemies: any[] = [];\r\n\t\tfor (let i = 0; i < count; i++) {\r\n\t\t\tconst base = offset + i * 6;\r\n\t\t\tenemies.push([\r\n\t\t\t\tbuf.readUInt16LE(base), // x\r\n\t\t\t\tbuf.readUInt16LE(base + 2), // y\r\n\t\t\t\tbuf.readUInt16LE(base + 4) // type\r\n\t\t\t]);\r\n\t\t}\r\n\t\treturn enemies;\r\n\t}\r\n\r\n\tprivate getFloorDirection(buf: Buffer, offset: number, length: number): any[] {\r\n\t\tconst count = length / 3; // No count header? Code says data.length / 3\r\n\t\tconst data: any[] = [];\r\n\t\tfor (let i = 0; i < count; i++) {\r\n\t\t\tconst base = offset + i * 3;\r\n\t\t\tdata.push([\r\n\t\t\t\tbuf.readUInt8(base), // blockid\r\n\t\t\t\tbuf.readUInt16LE(base + 1) // direction\r\n\t\t\t]);\r\n\t\t}\r\n\t\treturn data;\r\n\t}\r\n\r\n\tprivate getPatrol(buf: Buffer, offset: number): any[] {\r\n\t\t// Header structure inside data:\r\n\t\t// taskId: 4 bytes (at offset)\r\n\t\t// num: 1 byte (at offset + 4)\r\n\t\t// points: num * 278 bytes (starting at offset + 5)\r\n\r\n\t\tif (buf.length < offset + 5) {\r\n\t\t\treturn [];\r\n\t\t}\r\n\r\n\t\tconst num = buf.readUInt8(offset + 4);\r\n\t\tconst points: any[] = [];\r\n\t\tconst dataStart = offset + 5;\r\n\t\tconst pointSize = 278; // Fixed size per point based on observation\r\n\r\n\t\tfor (let i = 0; i < num; i++) {\r\n\t\t\tconst base = dataStart + i * pointSize;\r\n\r\n\t\t\t// Ensure we don't read past the buffer\r\n\t\t\tif (base + 4 > buf.length) {\r\n\t\t\t\tthis.adapter.log.warn(`[MapDataParser] getPatrol: Buffer too short for point ${i + 1}/${num}`);\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\r\n\t\t\tpoints.push([\r\n\t\t\t\tbuf.readUInt16LE(base), // x\r\n\t\t\t\tbuf.readUInt16LE(base + 2) // y\r\n\t\t\t]);\r\n\t\t}\r\n\t\treturn points;\r\n\t}\r\n\r\n\t// --------------------\r\n\t// Binary Read Helpers\r\n\t// --------------------\r\n\r\n\tprivate getXYPositions(buf: Buffer, xOffset: number, yOffset: number): [number, number] {\r\n\t\tconst xPosition = buf.readInt32LE(xOffset);\r\n\t\tconst yPosition = buf.readInt32LE(yOffset);\r\n\t\treturn [xPosition, yPosition];\r\n\t}\r\n\r\n\t/** Reads unscaled pixel dimensions and offsets from the image block header. */\r\n\tprivate getMapSizes(buf: Buffer, offset: number): { left: number; top: number; width: number; height: number } {\r\n\t\tconst top = buf.readInt32LE(offset - 0x10); // Unscaled Pixel Offset Y\r\n\t\tconst left = buf.readInt32LE(offset - 0x0c); // Unscaled Pixel Offset X\r\n\t\tconst height = buf.readInt32LE(offset - 0x08); // Unscaled Pixel Height\r\n\t\tconst width = buf.readInt32LE(offset - 0x04); // Unscaled Pixel Width\r\n\t\treturn { left, top, width, height };\r\n\t}\r\n\r\n\tprivate getPointInPath(buf: Buffer, dataPosition: number): [number, number] {\r\n\t\tconst x = buf.readUInt16LE(dataPosition);\r\n\t\tconst y = buf.readUInt16LE(dataPosition + 2);\r\n\t\treturn [x, y];\r\n\t}\r\n\r\n\tprivate getCount(buf: Buffer): number {\r\n\t\treturn buf.readUInt32LE(OFFSETS.TYPE_COUNT);\r\n\t}\r\n\r\n\tprivate getPixelType(buf: Buffer, dataPosition: number): number {\r\n\t\treturn buf.readUInt8(dataPosition) & 0x07;\r\n\t}\r\n\r\n\tprivate getAngle(buf: Buffer): number {\r\n\t\treturn buf.readInt32LE(OFFSETS.ANGLE);\r\n\t}\r\n\r\n\tprivate getGoToTarget(buf: Buffer): [number, number] {\r\n\t\treturn [buf.readUInt16LE(OFFSETS.TARGET_X), buf.readUInt16LE(OFFSETS.TARGET_Y)];\r\n\t}\r\n\r\n\tprivate getForbiddenZone(buf: Buffer, dataPosition: number, offset: number): number[] {\r\n\t\treturn this.readUInt16LE(buf, dataPosition, offset, 8);\r\n\t}\r\n\r\n\tprivate getSingleByteOffset(buf: Buffer): number {\r\n\t\treturn buf.readUInt8(2);\r\n\t}\r\n\r\n\tprivate getTwoByteOffsets(buf: Buffer): [number, number] {\r\n\t\treturn [buf.readUInt8(2), buf.readUInt8(4)];\r\n\t}\r\n\r\n\tprivate getNonceData(buf: Buffer): NonceData[] {\r\n\t\tconst sections: NonceData[] = [];\r\n\t\tfor (let i = 12; i < buf.length; i += 5) {\r\n\t\t\tconst type = buf[i];\r\n\t\t\tconst unixTime = buf.readUInt32LE(i + 1);\r\n\t\t\tsections.push({ type, unixTime });\r\n\t\t}\r\n\t\treturn sections;\r\n\t}\r\n\r\n\tprivate readUInt16LE(buf: Buffer, dataPosition: number, offset: number, count: number): number[] {\r\n\t\tconst result: number[] = [];\r\n\t\tfor (let j = 0; j < count; j++) {\r\n\t\t\tresult.push(buf.readUInt16LE(dataPosition + offset + j * 2));\r\n\t\t}\r\n\t\treturn result;\r\n\t}\r\n\r\n\tprivate readUInt8(buf: Buffer, dataPosition: number, offset: number, count: number): number[] {\r\n\t\tconst array: number[] = [];\r\n\t\tfor (let j = 0; j < count; j++) {\r\n\t\t\tarray.push(buf.readUInt8(offset + dataPosition + j));\r\n\t\t}\r\n\t\treturn array;\r\n\t}\r\n}\r\n"]}