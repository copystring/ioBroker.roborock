{"version":3,"file":"baseVacuumFeatures.js","sourceRoot":"","sources":["../../../../src/lib/features/vacuum/baseVacuumFeatures.ts"],"names":[],"mappings":"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","sourcesContent":["// src/lib/features/vacuum/base_vacuum_features.ts\r\nimport { BaseDeviceFeatures, DeviceModelConfig, FeatureDependencies, CommandSpec } from \"../baseDeviceFeatures\";\r\nimport { Feature } from \"../features.enum\";\r\nimport { z } from \"zod\";\r\n\r\n// --- Zod Schema for Vacuum Status ---\r\nexport const VacuumStatusSchema = z\r\n\t.object({\r\n\t\tstate: z.number().int().optional(),\r\n\t\tfan_power: z.number().int().optional(),\r\n\t\twater_box_mode: z.number().int().optional(),\r\n\t\tmop_mode: z.number().int().optional(),\r\n\t\tdock_type: z.number().int().optional(),\r\n\t\terror_code: z.number().int().optional(),\r\n\t\tbattery: z.number().int().min(0).max(100).optional(),\r\n\t\tclean_time: z.number().int().optional(),\r\n\t\tclean_area: z.number().int().optional(),\r\n\t\tdss: z.number().int().optional(), // Docking station status bits\r\n\t\tmap_status: z.number().int().optional(),\r\n\t\t// Optional string fields that should be valid JSON\r\n\t\tcarpet_mode: z\r\n\t\t\t.string()\r\n\t\t\t.optional()\r\n\t\t\t.refine(\r\n\t\t\t\t(val) => {\r\n\t\t\t\t\tif (val === undefined) return true;\r\n\t\t\t\t\ttry {\r\n\t\t\t\t\t\tJSON.parse(val);\r\n\t\t\t\t\t\treturn true;\r\n\t\t\t\t\t} catch {\r\n\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\t{ message: \"carpet_mode must be a valid JSON string or undefined\" }\r\n\t\t\t),\r\n\t\tcarpet_clean_mode: z\r\n\t\t\t.string()\r\n\t\t\t.optional()\r\n\t\t\t.refine(\r\n\t\t\t\t(val) => {\r\n\t\t\t\t\tif (val === undefined) return true;\r\n\t\t\t\t\ttry {\r\n\t\t\t\t\t\tJSON.parse(val);\r\n\t\t\t\t\t\treturn true;\r\n\t\t\t\t\t} catch {\r\n\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\t{ message: \"carpet_clean_mode must be a valid JSON string or undefined\" }\r\n\t\t\t),\r\n\t\twater_box_custom_mode: z.number().int().optional(), // Added for WaterBox detection\r\n\t\t// Add other relevant vacuum status fields...\r\n\t})\r\n\t.passthrough(); // Allow fields not defined in the schema\r\n\r\nexport abstract class BaseVacuumFeatures extends BaseDeviceFeatures {\r\n\t// --- Vacuum-specific Constants ---\r\n\tprotected static readonly CONSTANTS = {\r\n\t\terrorCodes: {\r\n\t\t\t0: \"No error\",\r\n\t\t\t1: \"Laser sensor fault\",\r\n\t\t\t2: \"Collision sensor fault\",\r\n\t\t\t3: \"Wheel floating\",\r\n\t\t\t4: \"Cliff sensor fault\",\r\n\t\t\t5: \"Main brush blocked\",\r\n\t\t\t6: \"Side brush blocked\",\r\n\t\t\t7: \"Wheel blocked\",\r\n\t\t\t8: \"Device stuck\",\r\n\t\t\t9: \"Dust bin missing\",\r\n\t\t\t10: \"Filter blocked\",\r\n\t\t\t11: \"Magnetic field detected\",\r\n\t\t\t12: \"Low battery\",\r\n\t\t\t13: \"Charging problem\",\r\n\t\t\t14: \"Battery failure\",\r\n\t\t\t15: \"Wall sensor fault\",\r\n\t\t\t16: \"Uneven surface\",\r\n\t\t\t17: \"Side brush failure\",\r\n\t\t\t18: \"Suction fan failure\",\r\n\t\t\t19: \"Unpowered charging station\",\r\n\t\t\t20: \"Unknown Error\",\r\n\t\t\t21: \"Laser pressure sensor problem\",\r\n\t\t\t22: \"Charge sensor problem\",\r\n\t\t\t23: \"Dock problem\",\r\n\t\t\t24: \"No-go zone or invisible wall detected\",\r\n\t\t\t254: \"Bin full\",\r\n\t\t\t255: \"Internal error\",\r\n\t\t\t\"-1\": \"Unknown Error\",\r\n\t\t},\r\n\t\tstateCodes: {\r\n\t\t\t0: \"Unknown\",\r\n\t\t\t1: \"Initiating\",\r\n\t\t\t2: \"Sleeping\",\r\n\t\t\t3: \"Idle\",\r\n\t\t\t4: \"Remote Control\",\r\n\t\t\t5: \"Cleaning\",\r\n\t\t\t6: \"Returning Dock\",\r\n\t\t\t7: \"Manual Mode\",\r\n\t\t\t8: \"Charging\",\r\n\t\t\t9: \"Charging Error\",\r\n\t\t\t10: \"Paused\",\r\n\t\t\t11: \"Spot Cleaning\",\r\n\t\t\t12: \"In Error\",\r\n\t\t\t13: \"Shutting Down\",\r\n\t\t\t14: \"Updating\",\r\n\t\t\t15: \"Docking\",\r\n\t\t\t16: \"Go To\",\r\n\t\t\t17: \"Zone Clean\",\r\n\t\t\t18: \"Room Clean\",\r\n\t\t\t22: \"Emptying dust container\",\r\n\t\t\t23: \"Washing the mop\",\r\n\t\t\t26: \"Going to wash the mop\",\r\n\t\t\t28: \"In call\",\r\n\t\t\t29: \"Mapping\",\r\n\t\t\t100: \"Fully Charged\",\r\n\t\t},\r\n\t\tdockTypes: {\r\n\t\t\t0: \"Charging dock\",\r\n\t\t\t1: \"Auto-Empty Dock\",\r\n\t\t\t2: \"Empty Wash Fill Dock\",\r\n\t\t\t3: \"Empty Wash Fill (Dry) Dock\",\r\n\t\t\t5: \"Auto-Empty Dock (Q8 Max+)\",\r\n\t\t\t7: \"Empty Wash Fill Dry Dock (S8 Pro Ultra)\",\r\n\t\t\t8: \"Empty Wash Fill Dry Dock (Q Revo)\",\r\n\t\t\t9: \"Empty Wash Fill Dry Dock (Q Revo Pro)\",\r\n\t\t},\r\n\t\tbaseCommands: {\r\n\t\t\tapp_start: { type: \"boolean\", def: false },\r\n\t\t\tapp_segment_clean: { type: \"boolean\", def: false },\r\n\t\t\tapp_stop: { type: \"boolean\", def: false },\r\n\t\t\tapp_pause: { type: \"boolean\", def: false },\r\n\t\t\tapp_charge: { type: \"boolean\", def: false },\r\n\t\t\tapp_spot: { type: \"boolean\", def: false },\r\n\t\t\tapp_zoned_clean: { type: \"json\" },\r\n\t\t\tresume_zoned_clean: { type: \"boolean\", def: false },\r\n\t\t\tstop_zoned_clean: { type: \"boolean\", def: false },\r\n\t\t\tresume_segment_clean: { type: \"boolean\", def: false },\r\n\t\t\tstop_segment_clean: { type: \"boolean\", def: false },\r\n\t\t\tset_custom_mode: { type: \"number\", def: 102, states: { 101: \"Quiet\", 102: \"Balanced\", 103: \"Turbo\", 104: \"Max\", 105: \"Off\" } },\r\n\t\t\tfind_me: { type: \"boolean\", def: false },\r\n\t\t\tapp_goto_target: { type: \"json\" },\r\n\t\t},\r\n\t\tdeviceStates: {\r\n\t\t\tdock_type: { type: \"number\", states: {} },\r\n\t\t\terror_code: { type: \"number\", states: {} },\r\n\t\t\tclean_area: { type: \"number\", unit: \"m²\" },\r\n\t\t\tclean_time: { type: \"number\", unit: \"min\" },\r\n\t\t\tbattery: { type: \"number\", unit: \"%\" },\r\n\t\t\tstate: { type: \"number\", states: {} },\r\n\t\t\tfan_power: { type: \"number\", states: { 101: \"Quiet\", 102: \"Balanced\", 103: \"Turbo\", 104: \"Max\", 105: \"Off\" } },\r\n\t\t\tclean_percent: { unit: \"%\" },\r\n\t\t\twater_box_custom_mode: { states: { 200: \"Off\", 201: \"Mild\", 202: \"Moderate\", 203: \"Intense\" } },\r\n\t\t\twater_box_mode: { type: \"number\", states: { 200: \"Off\", 201: \"Mild\", 202: \"Moderate\", 203: \"Intense\" } },\r\n\t\t\tmop_mode: { states: { 300: \"Standard\", 301: \"Deep\", 303: \"Deep+\", 304: \"Fast\" } },\r\n\t\t\tcarpet_mode: {\r\n\t\t\t\tstates: {\r\n\t\t\t\t\t'[{\"enable\":0,\"stall_time\":10,\"current_low\":400,\"current_high\":500,\"current_integral\":450}]': \"off\",\r\n\t\t\t\t\t'[{\"enable\":1,\"stall_time\":10,\"current_low\":400,\"current_high\":500,\"current_integral\":450}]': \"on\",\r\n\t\t\t\t},\r\n\t\t\t},\r\n\t\t\tcarpet_clean_mode: {\r\n\t\t\t\tstates: {\r\n\t\t\t\t\t'{\"carpet_clean_mode\":0}': \"Avoid\",\r\n\t\t\t\t\t'{\"carpet_clean_mode\":1}': \"Rise\",\r\n\t\t\t\t\t'{\"carpet_clean_mode\":2}': \"Ignore\",\r\n\t\t\t\t},\r\n\t\t\t},\r\n\t\t},\r\n\t\tconsumables: {\r\n\t\t\tmain_brush_work_time: { unit: \"h\" },\r\n\t\t\tside_brush_work_time: { unit: \"h\" },\r\n\t\t\tfilter_work_time: { unit: \"h\" },\r\n\t\t\tfilter_element_work_time: { unit: \"h\" },\r\n\t\t\tsensor_dirty_time: { unit: \"h\" },\r\n\t\t\t125: { unit: \"%\" },\r\n\t\t\t126: { unit: \"%\" },\r\n\t\t\t127: { unit: \"%\" },\r\n\t\t\tmain_brush_life: { unit: \"%\" },\r\n\t\t\tside_brush_life: { unit: \"%\" },\r\n\t\t\tfilter_life: { unit: \"%\" },\r\n\t\t},\r\n\t\tresetConsumables: new Set([\r\n\t\t\t// Filled with actual values\r\n\t\t\t\"main_brush_work_time\",\r\n\t\t\t\"side_brush_work_time\",\r\n\t\t\t\"filter_work_time\",\r\n\t\t\t\"filter_element_work_time\",\r\n\t\t\t\"sensor_dirty_time\",\r\n\t\t\t\"dust_collection_work_times\",\r\n\t\t\t\"strainer_work_times\",\r\n\t\t\t\"cleaning_brush_work_times\",\r\n\t\t]),\r\n\t\tcleaningRecords: {\r\n\t\t\t0: { type: \"string\" }, // begin\r\n\t\t\t1: { type: \"string\" }, // end\r\n\t\t\t2: { type: \"number\", unit: \"min\" }, // duration\r\n\t\t\t3: { type: \"number\", unit: \"m²\" }, // area\r\n\t\t\t4: { type: \"number\" }, // error\r\n\t\t\t5: { type: \"number\" }, // complete\r\n\t\t\t6: { type: \"number\" }, // start_type\r\n\t\t\t7: { type: \"number\" }, // clean_type\r\n\t\t\t8: { type: \"number\" }, // finish_reason\r\n\t\t\t9: { type: \"number\" }, // dust_collection_status\r\n\r\n\t\t\t// Mapped from name\r\n\t\t\tbegin: { type: \"string\" },\r\n\t\t\tend: { type: \"string\" },\r\n\t\t\tduration: { type: \"number\", unit: \"min\" },\r\n\t\t\tarea: { type: \"number\", unit: \"m²\" },\r\n\t\t\terror: { type: \"number\" },\r\n\t\t\tcomplete: { type: \"number\" },\r\n\t\t\tstart_type: { type: \"number\" },\r\n\t\t\tclean_type: { type: \"number\" },\r\n\t\t\tfinish_reason: { type: \"number\" },\r\n\t\t\tdust_collection_status: { type: \"number\" },\r\n\r\n\t\t\tcleaned_area: { type: \"number\", unit: \"m²\" },\r\n\t\t\ttask_id: { type: \"number\" },\r\n\t\t\tclean_times: { type: \"number\" },\r\n\t\t\tdirty_replenish: { type: \"number\" },\r\n\t\t\tmanual_replenish: { type: \"number\" },\r\n\t\t\tmap_flag: { type: \"number\" },\r\n\t\t\twash_count: { type: \"number\" },\r\n\t\t\tavoid_count: { type: \"number\" },\r\n\t\t},\r\n\t\tcleaningInfo: {\r\n\t\t\t0: { unit: \"h\" },\r\n\t\t\t1: { unit: \"m²\" },\r\n\t\t\tclean_time: { unit: \"h\" },\r\n\t\t\tclean_area: { unit: \"m²\" },\r\n\t\t},\r\n\t\t// Keep firmwareFeatures map temporarily for getFirmwareFeatureName fallback\r\n\t\tfirmwareFeatures: {\r\n\t\t\t111: \"isSupportFDSEndPoint\",\r\n\t\t\t112: \"isSupportAutoSplitSegments\",\r\n\t\t\t114: \"isSupportOrderSegmentClean\",\r\n\t\t\t116: \"isMapSegmentSupported\",\r\n\t\t\t119: \"isSupportLedStatusSwitch\",\r\n\t\t\t120: \"isMultiFloorSupported\",\r\n\t\t\t122: \"isSupportFetchTimerSummary\",\r\n\t\t\t123: \"isOrderCleanSupported\",\r\n\t\t\t125: \"isRemoteSupported\",\r\n\t\t},\r\n\t};\r\n\r\n\tconstructor(dependencies: FeatureDependencies, duid: string, robotModel: string, config: DeviceModelConfig) {\r\n\t\tsuper(dependencies, duid, robotModel, config);\r\n\t\t// Initialize with Vacuum base commands\r\n\t\tthis.commands = JSON.parse(JSON.stringify(BaseVacuumFeatures.CONSTANTS.baseCommands));\r\n\r\n\t\t// Populate dynamic states map references\r\n\t\tBaseVacuumFeatures.CONSTANTS.deviceStates.dock_type.states = BaseVacuumFeatures.CONSTANTS.dockTypes;\r\n\t\tBaseVacuumFeatures.CONSTANTS.deviceStates.error_code.states = BaseVacuumFeatures.CONSTANTS.errorCodes;\r\n\t\tBaseVacuumFeatures.CONSTANTS.deviceStates.state.states = BaseVacuumFeatures.CONSTANTS.stateCodes;\r\n\r\n\t\tthis.registerFeatures();\r\n\t}\r\n\r\n\t// --- Implementation of abstract methods ---\r\n\tprotected registerFeatures(): void {\r\n\t\tif (BaseDeviceFeatures.featureRegistry.size > 0) return;\r\n\r\n\t\tthis.deps.log.debug(`Registering Vacuum features...`);\r\n\t\tconst reg = BaseDeviceFeatures.featureRegistry;\r\n\r\n\t\t// --- Command Features ---\r\n\t\treg.set(Feature.AutoEmptyDock, this._addAutoEmptyDockCommands);\r\n\t\treg.set(Feature.MopWash, this._addMopWashCommands);\r\n\t\treg.set(Feature.MopDry, this._addMopDryCommands);\r\n\t\treg.set(Feature.WaterBox, this._addWaterBoxCommands);\r\n\t\treg.set(Feature.CleanRouteFastMode, this._addCleanRouteFastModeCommand);\r\n\t\treg.set(Feature.CustomWaterBoxDistance, this._createCustomWaterDistanceState);\r\n\t\treg.set(Feature.FanMaxPlus, this._addFanMaxPlusCommand);\r\n\t\treg.set(Feature.SmartModeCommand, this._addSmartModeCommand);\r\n\r\n\t\t// --- State/Info Features ---\r\n\t\treg.set(Feature.LiveVideo, this._createCameraStates);\r\n\t\treg.set(Feature.MultiFloor, this._createMultiFloorStates);\r\n\r\n\t\t// --- Aliases ---\r\n\t\treg.set(Feature.ShakeMopStrength, this._addWaterBoxCommands);\r\n\t\treg.set(Feature.ElectronicWaterBox, this._addWaterBoxCommands);\r\n\r\n\t\t// --- Placeholders ---\r\n\t\tconst noOp = () => {\r\n\t\t\tthis.deps.log.silly(`[${this.duid}] No-op feature called.`);\r\n\t\t};\r\n\r\n\t\t// List ALL Feature enum keys that DO NOT have a specific implementation registered above\r\n\t\tconst placeholderFeatures: Feature[] = [\r\n\t\t\t// Static Flags (might have no direct action)\r\n\t\t\tFeature.MopForbidden,\r\n\t\t\tFeature.AvoidCarpet,\r\n\t\t\tFeature.Camera,\r\n\t\t\tFeature.VoiceControl,\r\n\r\n\t\t\t// Dynamic Bitfield/FW features (placeholder actions or just flags)\r\n\t\t\tFeature.isShakeMopSetSupported,\r\n\t\t\tFeature.isVideoMonitorSupported,\r\n\t\t\tFeature.isVideoSettingSupported,\r\n\t\t\tFeature.isCarpetSupported,\r\n\t\t\tFeature.isPhotoUploadSupported,\r\n\t\t\tFeature.isAvoidCollisionSupported,\r\n\t\t\tFeature.isCornerCleanModeSupported,\r\n\t\t\tFeature.isSupportSetSwitchMapMode,\r\n\t\t\tFeature.isBackChargeAutoWashSupported,\r\n\t\t\tFeature.isSupportFDSEndPoint,\r\n\t\t\tFeature.isSupportAutoSplitSegments,\r\n\t\t\tFeature.isSupportOrderSegmentClean,\r\n\t\t\tFeature.isMapSegmentSupported,\r\n\t\t\tFeature.isSupportLedStatusSwitch,\r\n\t\t\tFeature.isSupportFetchTimerSummary,\r\n\t\t\tFeature.isOrderCleanSupported,\r\n\t\t\tFeature.isRemoteSupported,\r\n\t\t];\r\n\r\n\t\tplaceholderFeatures.forEach((f) => {\r\n\t\t\t// Register placeholder only if no other implementation was already registered for this key\r\n\t\t\tif (!reg.has(f)) {\r\n\t\t\t\treg.set(f, noOp);\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tthis.deps.log.debug(`Vacuum feature registry size: ${reg.size}`);\r\n\t}\r\n\r\n\tprotected _getDynamicFeatures(): Set<Feature> {\r\n\t\tconst features = new Set<Feature>();\r\n\t\ttry {\r\n\t\t\tconst featureSet = this.deps.http_api.getFeatureSet(this.duid);\r\n\t\t\tconst newFeatureSet = this.deps.http_api.getNewFeatureSet(this.duid);\r\n\t\t\tif (featureSet === undefined) {\r\n\t\t\t\tthis.deps.log.error(`[${this.duid}] _getDynamicFeatures: Could not get featureSet.`);\r\n\t\t\t\treturn features;\r\n\t\t\t}\r\n\r\n\t\t\tconst highFeatureSet = Math.floor(featureSet / 2 ** 32);\r\n\t\t\tconst newFeatureSetInt = newFeatureSet ? parseInt(\"0x\" + newFeatureSet.slice(-8)) : 0;\r\n\r\n\t\t\t// Map Bitfields to 'is...' Enum keys\r\n\t\t\tif (!!((highFeatureSet >> 5) & 1)) features.add(Feature.isWashThenChargeCmdSupported);\r\n\t\t\tif (!!(featureSet & 33554432)) features.add(Feature.isDustCollectionSettingSupported);\r\n\t\t\tif (!!((highFeatureSet >> 15) & 1)) features.add(Feature.isSupportedDrying);\r\n\t\t\tif (!!(featureSet & 262144)) features.add(Feature.isShakeMopSetSupported);\r\n\t\t\tif (!!(featureSet & 8)) features.add(Feature.isVideoMonitorSupported);\r\n\t\t\tif (!!(featureSet & 64)) features.add(Feature.isVideoSettingSupported);\r\n\t\t\tif (!!(featureSet & 512)) features.add(Feature.isCarpetSupported);\r\n\t\t\tif (!!(featureSet & 65536)) features.add(Feature.isPhotoUploadSupported);\r\n\t\t\tif (!!(featureSet & 134217728)) features.add(Feature.isAvoidCollisionSupported);\r\n\t\t\tif (!!(featureSet & 2147483648)) features.add(Feature.isCornerCleanModeSupported);\r\n\t\t\tif (!!(featureSet & 268435456)) features.add(Feature.isSupportSetSwitchMapMode);\r\n\t\t\tif (!!(featureSet & 2147483648)) features.add(Feature.isCustomWaterBoxDistanceSupported);\r\n\t\t\tif (!!(newFeatureSetInt & 4096)) features.add(Feature.isBackChargeAutoWashSupported);\r\n\t\t\tif (!!(newFeatureSetInt & 256)) features.add(Feature.isCleanRouteFastModeSupported);\r\n\r\n\t\t\t// Map FW Features Result to 'is...' Enum keys\r\n\t\t\tconst fwResult = this.deps.http_api.getFwFeaturesResult(this.duid); // Ensure this method exists and returns number[] | undefined\r\n\t\t\tif (fwResult) {\r\n\t\t\t\tif (fwResult.includes(111)) features.add(Feature.isSupportFDSEndPoint);\r\n\t\t\t\tif (fwResult.includes(112)) features.add(Feature.isSupportAutoSplitSegments);\r\n\t\t\t\tif (fwResult.includes(114)) features.add(Feature.isSupportOrderSegmentClean);\r\n\t\t\t\tif (fwResult.includes(116)) features.add(Feature.isMapSegmentSupported);\r\n\t\t\t\tif (fwResult.includes(119)) features.add(Feature.isSupportLedStatusSwitch);\r\n\t\t\t\tif (fwResult.includes(120)) features.add(Feature.isMultiFloorSupported);\r\n\t\t\t\tif (fwResult.includes(122)) features.add(Feature.isSupportFetchTimerSummary);\r\n\t\t\t\tif (fwResult.includes(123)) features.add(Feature.isOrderCleanSupported);\r\n\t\t\t\tif (fwResult.includes(125)) features.add(Feature.isRemoteSupported);\r\n\t\t\t}\r\n\t\t} catch (error: any) {\r\n\t\t\tthis.deps.log.error(`[${this.duid}] Error in _getDynamicFeatures: ${error.message}`);\r\n\t\t}\r\n\t\tthis.deps.log.silly(`[${this.duid}] Detected dynamic vacuum features (raw): ${[...features].join(\", \")}`);\r\n\t\treturn features;\r\n\t}\r\n\r\n\tpublic async detectAndApplyRuntimeFeatures(statusData: Readonly<Record<string, any>>, fwFeatures?: readonly number[]): Promise<boolean> {\r\n\t\tlet changedOverall = false;\r\n\t\tconst runDetection = !this.runtimeDetectionComplete || this.deps.config.forceRuntimeDetectEveryTime; // Check config flag\r\n\r\n\t\tif (!runDetection) {\r\n\t\t\tthis.deps.log.silly(`[${this.duid}] Skipping repeated runtime feature detection.`);\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\tthis.deps.log.debug(`[RuntimeDetect|${this.robotModel}|${this.duid}] Running...`);\r\n\r\n\t\t// --- Validate Status Data ---\r\n\t\tconst validationResult = VacuumStatusSchema.safeParse(statusData);\r\n\t\tif (!validationResult.success) {\r\n\t\t\tthis.deps.log.warn(\r\n\t\t\t\t`[RuntimeDetect|${this.robotModel}|${this.duid}] Received invalid status data. Skipping detection. Errors: ${JSON.stringify(validationResult.error.issues)}`\r\n\t\t\t);\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\tconst validStatus = validationResult.data;\r\n\r\n\t\t// --- Apply dynamic features first (Bitfields/FW) ---\r\n\t\tconst dynamicFeatures = this._getDynamicFeatures(); // Get current dynamic features\r\n\t\tthis.deps.log.silly(`[RuntimeDetect|${this.robotModel}|${this.duid}] Dynamic features from bits/fw: ${[...dynamicFeatures].join(\", \")}`);\r\n\t\tfor (const feature of dynamicFeatures) {\r\n\t\t\tconst mappedFeature = this.mapFeature(feature);\r\n\t\t\tif (mappedFeature) {\r\n\t\t\t\t// Apply only if NOT applied by model specifics already and NOT conflicting\r\n\t\t\t\tif (!this.config.staticFeatures.includes(mappedFeature)) {\r\n\t\t\t\t\tconst applied = await this.applyFeature(mappedFeature);\r\n\t\t\t\t\tif (applied) changedOverall = true;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.deps.log.silly(\r\n\t\t\t\t\t\t`[RuntimeDetect|${this.robotModel}|${this.duid}] Feature '${mappedFeature}' (from '${feature}') defined statically, skipping dynamic application.`\r\n\t\t\t\t\t);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// --- Rules based on validated status data ---\r\n\t\t// Apply features/commands only if they haven't been applied yet\r\n\r\n\t\tlet changedByStatus = false;\r\n\t\t// WaterBox\r\n\t\tif ((validStatus.water_box_mode !== undefined || validStatus.mop_mode !== undefined) && !this.appliedFeatures.has(Feature.WaterBox)) {\r\n\t\t\tthis.deps.log.info(`[RuntimeDetect|${this.robotModel}|${this.duid}] Detected WaterBox feature via status.`);\r\n\t\t\tif (await this.applyFeature(Feature.WaterBox)) changedByStatus = true;\r\n\t\t}\r\n\r\n\t\t// Carpet Mode Commands\r\n\t\tif (validStatus.carpet_mode !== undefined && !this.commands[\"set_carpet_mode\"]) {\r\n\t\t\tthis.deps.log.info(`[RuntimeDetect|${this.robotModel}|${this.duid}] Detected carpet_mode command via status.`);\r\n\t\t\tconst spec: CommandSpec = { type: \"json\", states: BaseVacuumFeatures.CONSTANTS.deviceStates.carpet_mode.states };\r\n\t\t\tthis._addCommand(\"set_carpet_mode\", spec);\r\n\t\t\tchangedByStatus = true;\r\n\t\t}\r\n\t\tif (validStatus.carpet_clean_mode !== undefined && !this.commands[\"set_carpet_clean_mode\"]) {\r\n\t\t\tthis.deps.log.info(`[RuntimeDetect|${this.robotModel}|${this.duid}] Detected carpet_clean_mode command via status.`);\r\n\t\t\tconst spec: CommandSpec = { type: \"json\", states: BaseVacuumFeatures.CONSTANTS.deviceStates.carpet_clean_mode.states };\r\n\t\t\tthis._addCommand(\"set_carpet_clean_mode\", spec);\r\n\t\t\tchangedByStatus = true;\r\n\t\t}\r\n\r\n\t\t// Refine Fan Power (Max+)\r\n\t\tif (validStatus.fan_power === 108 && !this.appliedFeatures.has(Feature.FanMaxPlus)) {\r\n\t\t\t// Apply only if not statically defined\r\n\t\t\tif (!this.config.staticFeatures.includes(Feature.FanMaxPlus)) {\r\n\t\t\t\tthis.deps.log.info(`[RuntimeDetect|${this.robotModel}|${this.duid}] Detected FanMaxPlus state (108).`);\r\n\t\t\t\tif (await this.applyFeature(Feature.FanMaxPlus)) changedByStatus = true;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// MopDry\r\n\t\tif (validStatus.dry_status !== undefined && !this.appliedFeatures.has(Feature.MopDry)) {\r\n\t\t\tthis.deps.log.info(`[RuntimeDetect|${this.robotModel}|${this.duid}] Detected MopDry feature via 'dry_status' key.`);\r\n\t\t\tif (await this.applyFeature(Feature.MopDry)) changedByStatus = true;\r\n\t\t}\r\n\r\n\t\t// AutoEmptyDock\r\n\t\tif (validStatus.dust_collection_status !== undefined && !this.appliedFeatures.has(Feature.AutoEmptyDock)) {\r\n\t\t\tthis.deps.log.info(`[RuntimeDetect|${this.robotModel}|${this.duid}] Detected AutoEmptyDock feature via 'dust_collection_status' key.`);\r\n\t\t\tif (await this.applyFeature(Feature.AutoEmptyDock)) changedByStatus = true;\r\n\t\t}\r\n\r\n\t\t// MopWash\r\n\t\tif (validStatus.wash_status !== undefined && !this.appliedFeatures.has(Feature.MopWash)) {\r\n\t\t\tthis.deps.log.info(`[RuntimeDetect|${this.robotModel}|${this.duid}] Detected MopWash feature via 'wash_status' key.`);\r\n\t\t\tif (await this.applyFeature(Feature.MopWash)) changedByStatus = true;\r\n\t\t}\r\n\r\n\t\t// Add more status-based detection rules here...\r\n\r\n\t\tif (changedByStatus) this.deps.log.info(`[RuntimeDetect|${this.robotModel}|${this.duid}] Features/Commands applied/modified based on status.`);\r\n\t\tthis.runtimeDetectionComplete = true;\r\n\t\treturn changedOverall || changedByStatus; // Return true if anything changed\r\n\t}\r\n\r\n\tpublic async processDockType(dockTypeInput: number | undefined): Promise<void> {\r\n\t\tif (dockTypeInput === undefined) {\r\n\t\t\tthis.deps.log.debug(`[processDockType|${this.duid}] dockTypeInput is undefined, skipping dock processing.`);\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tconst dockTypeSchema = z.number().int().min(0);\r\n\t\tconst validation = dockTypeSchema.safeParse(dockTypeInput);\r\n\t\tif (!validation.success) {\r\n\t\t\tthis.deps.log.warn(`[processDockType|${this.duid}] Invalid dockTypeInput received: ${dockTypeInput}. Errors: ${JSON.stringify(validation.error.issues)}`);\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tconst dockType = validation.data;\r\n\r\n\t\tthis.deps.log.debug(`[${this.duid}] Processing dock type ${dockType} for Vacuum`);\r\n\t\tconst dockFeatureMap: Record<number, Feature[]> = {\r\n\t\t\t1: [Feature.AutoEmptyDock],\r\n\t\t\t2: [Feature.MopWash],\r\n\t\t\t3: [Feature.AutoEmptyDock, Feature.MopWash, Feature.MopDry],\r\n\t\t\t5: [Feature.AutoEmptyDock],\r\n\t\t\t6: [Feature.AutoEmptyDock, Feature.MopWash, Feature.MopDry],\r\n\t\t\t7: [Feature.AutoEmptyDock, Feature.MopWash, Feature.MopDry],\r\n\t\t\t8: [Feature.AutoEmptyDock, Feature.MopWash, Feature.MopDry],\r\n\t\t\t9: [Feature.AutoEmptyDock, Feature.MopWash, Feature.MopDry],\r\n\t\t\t10: [], // Placeholder for future dock types\r\n\t\t\t18: [], // Placeholder for future dock types\r\n\t\t};\r\n\t\tconst features = dockFeatureMap[dockType];\r\n\r\n\t\tif (features) {\r\n\t\t\tthis.deps.log.debug(`[${this.duid}] Applying dock features for type ${dockType}: ${features.join(\", \")}`); // Apply features sequentially to potentially handle dependencies/overwrites correctly\r\n\t\t\tfor (const feature of features) {\r\n\t\t\t\tawait this.applyFeature(feature); // Use applyFeature helper which checks if already applied\r\n\t\t\t}\r\n\t\t} else if (dockType !== 0) {\r\n\t\t\tthis.deps.log.warn(`[processDockType|${this.duid}] Unknown dock type ${dockType} encountered. No features applied. Please report this model and dock type.`);\r\n\t\t}\r\n\t}\r\n\r\n\t// --- Instance Getters for Constants ---\r\n\tpublic getCommonConsumable(attribute: string | number): { unit?: string } | undefined {\r\n\t\treturn BaseVacuumFeatures.CONSTANTS.consumables[attribute as keyof typeof BaseVacuumFeatures.CONSTANTS.consumables];\r\n\t}\r\n\tpublic isResetableConsumable(consumable: string): boolean {\r\n\t\t// Access static constant\r\n\t\treturn BaseVacuumFeatures.CONSTANTS.resetConsumables.has(consumable);\r\n\t}\r\n\tpublic getCommonDeviceStates(attribute: string | number): { states?: Record<any, any>; unit?: string; type?: ioBroker.CommonType | undefined } | undefined {\r\n\t\tconst stateDef = BaseVacuumFeatures.CONSTANTS.deviceStates[attribute as keyof typeof BaseVacuumFeatures.CONSTANTS.deviceStates];\r\n\t\treturn stateDef as { states?: Record<any, any>; unit?: string; type?: ioBroker.CommonType | undefined } | undefined;\r\n\t}\r\n\tpublic getCommonCleaningInfo(attribute: string | number): { unit?: string } | undefined {\r\n\t\treturn BaseVacuumFeatures.CONSTANTS.cleaningInfo[attribute as keyof typeof BaseVacuumFeatures.CONSTANTS.cleaningInfo];\r\n\t}\r\n\tpublic getCommonCleaningRecords(attribute: string | number): Partial<ioBroker.StateCommon> | undefined {\r\n\t\tconst spec = BaseVacuumFeatures.CONSTANTS.cleaningRecords[attribute as keyof typeof BaseVacuumFeatures.CONSTANTS.cleaningRecords];\r\n\t\treturn spec as Partial<ioBroker.StateCommon> | undefined;\r\n\t}\r\n\tpublic getFirmwareFeatureName(featureID: string | number): string {\r\n\t\t// Use the temporarily kept static map for lookup\r\n\t\tconst name = BaseVacuumFeatures.CONSTANTS.firmwareFeatures[featureID as keyof typeof BaseVacuumFeatures.CONSTANTS.firmwareFeatures];\r\n\t\treturn name || `FeatureID_${featureID}`;\r\n\t}\r\n\r\n\t// --- Feature Implementations ---\r\n\r\n\tprotected _addAutoEmptyDockCommands(): void {\r\n\t\tthis._addCommand(\"app_start_collect_dust\", { type: \"boolean\", def: false });\r\n\t\tthis._addCommand(\"app_stop_collect_dust\", { type: \"boolean\", def: false });\r\n\t\tthis._addCommand(\"set_dust_collection_switch_status\", { type: \"json\", def: '{\"status\":1}', states: { '{\"status\":0}': \"Off\", '{\"status\":1}': \"On\" } });\r\n\t\tthis._addCommand(\"set_dust_collection_mode\", {\r\n\t\t\ttype: \"json\",\r\n\t\t\tdef: '{\"mode\":0}',\r\n\t\t\tstates: { '{\"mode\":0}': \"Smart\", '{\"mode\":1}': \"Low\", '{\"mode\":2}': \"Medium\", '{\"mode\":4}': \"Max\" },\r\n\t\t});\r\n\t}\r\n\r\n\tprotected _addMopWashCommands(): void {\r\n\t\tthis._addCommand(\"app_start_wash\", { type: \"boolean\", def: false });\r\n\t\tthis._addCommand(\"app_stop_wash\", { type: \"boolean\", def: false });\r\n\t\tthis._addCommand(\"set_wash_towel_mode\", {\r\n\t\t\ttype: \"json\",\r\n\t\t\tdef: '{\"wash_mode\":2}',\r\n\t\t\tstates: { '{\"wash_mode\":0}': \"Eco\", '{\"wash_mode\":1}': \"Medium\", '{\"wash_mode\":2}': \"Intense\" },\r\n\t\t});\r\n\t\tthis._addCommand(\"set_smart_wash_params\", {\r\n\t\t\ttype: \"json\",\r\n\t\t\tdef: '{\"smart_wash\":0,\"wash_interval\":1800}',\r\n\t\t\tstates: {\r\n\t\t\t\t'{\"smart_wash\":0,\"wash_interval\":600}': \"10 Min\",\r\n\t\t\t\t'{\"smart_wash\":0,\"wash_interval\":900}': \"15 Min\",\r\n\t\t\t\t'{\"smart_wash\":0,\"wash_interval\":1200}': \"20 Min\",\r\n\t\t\t\t'{\"smart_wash\":0,\"wash_interval\":1500}': \"25 Min\",\r\n\t\t\t\t'{\"smart_wash\":0,\"wash_interval\":1800}': \"30 Min\",\r\n\t\t\t\t'{\"smart_wash\":0,\"wash_interval\":2100}': \"35 Min\",\r\n\t\t\t\t'{\"smart_wash\":0,\"wash_interval\":2400}': \"40 Min\",\r\n\t\t\t\t'{\"smart_wash\":0,\"wash_interval\":2700}': \"45 Min\",\r\n\t\t\t\t'{\"smart_wash\":0,\"wash_interval\":3000}': \"50 Min\",\r\n\t\t\t\t'{\"smart_wash\":1,\"wash_interval\":1200}': \"Per room\",\r\n\t\t\t},\r\n\t\t});\r\n\t}\r\n\r\n\tprotected _addMopDryCommands(): void {\r\n\t\tthis._addCommand(\"app_set_dryer_status\", { type: \"string\", def: '{\"status\": 0}', states: { '{\"status\": 1}': \"On\", '{\"status\": 0}': \"Off\" } });\r\n\t\tthis._addCommand(\"app_set_dryer_setting\", {\r\n\t\t\ttype: \"json\",\r\n\t\t\tdef: '{\"on\":{\"dry_time\":10800},\"status\":0}',\r\n\t\t\tstates: {\r\n\t\t\t\t'{\"on\":{\"dry_time\":10800},\"status\":0}': \"Off\",\r\n\t\t\t\t'{\"on\":{\"dry_time\":7200},\"status\":1}': \"2h\",\r\n\t\t\t\t'{\"on\":{\"dry_time\":10800},\"status\":1}': \"3h\",\r\n\t\t\t\t'{\"on\":{\"dry_time\":14400},\"status\":1}': \"4h\",\r\n\t\t\t},\r\n\t\t});\r\n\t}\r\n\r\n\tprotected _addWaterBoxCommands(): void {\r\n\t\tthis._addCommand(\"set_mop_mode\", { type: \"number\", def: 300, states: { 300: \"Standard\", 301: \"Deep\", 303: \"Deep+\" } });\r\n\t\tthis._addCommand(\"set_water_box_custom_mode\", { type: \"number\", def: 201, states: { 200: \"Off\", 201: \"Mild\", 202: \"Moderate\", 203: \"Intense\" } });\r\n\t}\r\n\r\n\tprotected _addCleanRouteFastModeCommand(): void {\r\n\t\tconst mopMode = this.commands.set_mop_mode || { type: \"number\", def: 300, states: {} };\r\n\t\tmopMode.states = { ...BaseVacuumFeatures.CONSTANTS.deviceStates.mop_mode.states, ...mopMode.states, 304: \"Fast\" }; // Merge carefully\r\n\t\tthis._addCommand(\"set_mop_mode\", mopMode);\r\n\t}\r\n\r\n\tprotected async _createCameraStates(): Promise<void> {\r\n\t\tconst ip = this.deps.config.hostname_ip; // Use DI config\r\n\t\tif (!ip) {\r\n\t\t\tthis.deps.log.warn(`[${this.duid}] Cannot create camera states: IP address not configured.`);\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tconst streamTypes = {\r\n\t\t\tstream_html: `http://${ip}:${1984 + this.deps.adapter.instance}/stream.html?src=${this.duid}`,\r\n\t\t\twebrtc_html: `http://${ip}:${1984 + this.deps.adapter.instance}/webrtc.html?src=${this.duid}&media=video`,\r\n\t\t\tstream_mp4: `http://${ip}:${1984 + this.deps.adapter.instance}/api/stream.mp4?src=${this.duid}`,\r\n\t\t\trtsp: `rtsp://${ip}:${8554 + this.deps.adapter.instance}/${this.duid}?video`,\r\n\t\t};\r\n\t\tawait this.deps.ensureFolder(`Devices.${this.duid}.camera`);\r\n\t\tfor (const [name, stream_uri] of Object.entries(streamTypes)) {\r\n\t\t\t// Use _ensureState helper\r\n\t\t\tawait this._ensureState(\"camera\", name, { type: \"string\", role: \"url\", write: false, def: stream_uri });\r\n\t\t}\r\n\t}\r\n\r\n\tprotected async _createMultiFloorStates(): Promise<void> {\r\n\t\tawait this.deps.ensureFolder(`Devices.${this.duid}.floors`);\r\n\t\tfor (const feature of [\"max_multi_map\", \"max_bak_map\", \"multi_map_count\"]) {\r\n\t\t\t// Use _ensureState helper\r\n\t\t\tawait this._ensureState(\"floors\", feature, { type: \"number\", role: \"value\", write: false });\r\n\t\t}\r\n\t}\r\n\r\n\tprotected async _createCustomWaterDistanceState(): Promise<void> {\r\n\t\t// Use _ensureState helper\r\n\t\tawait this._ensureState(\"commands\", \"set_water_box_distance_off\", {\r\n\t\t\ttype: \"number\",\r\n\t\t\trole: \"level\",\r\n\t\t\twrite: true,\r\n\t\t\tdef: 1,\r\n\t\t\tmin: 1,\r\n\t\t\tmax: 30,\r\n\t\t});\r\n\t}\r\n\r\n\tprotected _addFanMaxPlusCommand(): void {\r\n\t\t// Ensure base command exists before modifying\r\n\t\tif (!this.commands.set_custom_mode) {\r\n\t\t\tthis._addCommand(\"set_custom_mode\", JSON.parse(JSON.stringify(BaseVacuumFeatures.CONSTANTS.baseCommands.set_custom_mode)));\r\n\t\t}\r\n\t\t// Safely add state\r\n\t\tif (this.commands.set_custom_mode.states) {\r\n\t\t\tthis.commands.set_custom_mode.states[108] = \"Max+\";\r\n\t\t}\r\n\t}\r\n\r\n\tprotected _addSmartModeCommand(): void {\r\n\t\tthis._addCommand(\"app_set_clean_sequence_type\", {\r\n\t\t\ttype: \"json\",\r\n\t\t\trole: \"value.list\",\r\n\t\t\tdef: '{\"fan_power\":110,\"mop_mode\":306,\"type\":0,\"water_box_mode\":209}',\r\n\t\t\tstates: {\r\n\t\t\t\t'{\"fan_power\":102,\"mop_mode\":300,\"repeat\":1,\"type\":1,\"water_box_mode\":201}': \"Mop and vacuum\",\r\n\t\t\t\t'{\"fan_power\":110,\"mop_mode\":306,\"type\":0,\"water_box_mode\":209}': \"Smart mode\",\r\n\t\t\t},\r\n\t\t});\r\n\t}\r\n}\r\n"]}