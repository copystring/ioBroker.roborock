{"version":3,"file":"baseVacuumFeatures.js","sourceRoot":"","sources":["../../../../src/lib/features/vacuum/baseVacuumFeatures.ts"],"names":[],"mappings":"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","sourcesContent":["import { BaseDeviceFeatures, DeviceModelConfig, FeatureDependencies, CommandSpec } from \"../baseDeviceFeatures\";\r\nimport { Feature } from \"../features.enum\";\r\nimport { z } from \"zod\";\r\nimport { VACUUM_CONSTANTS } from \"./vacuumConstants\";\r\nimport { ProductHelper } from \"../../productHelper\";\r\n\r\n// --- Shared Constants ---\r\nexport const BASE_FAN = { 101: \"Quiet\", 102: \"Balanced\", 103: \"Turbo\", 104: \"Max\" };\r\nexport const BASE_WATER = { 200: \"Off\", 201: \"Mild\", 202: \"Moderate\", 203: \"Intense\" };\r\nexport const BASE_MOP = { 300: \"Standard\", 301: \"Deep\", 303: \"Deep+\" };\r\n\r\nexport interface VacuumProfile {\r\n    name?: string;\r\n    docks?: Record<number, { features: Feature[] }>;\r\n    mappings: {\r\n        fan_power: Record<number, string>;\r\n        water_box_mode?: Record<number, string>;\r\n        mop_mode?: Record<number, string>;\r\n        error_code?: Record<number, string>;\r\n        state?: Record<number, string>;\r\n    };\r\n    features: {\r\n        maxSuctionValue: number;\r\n        ultraWaterValue?: number;\r\n        hasSmartPlan?: boolean;\r\n    };\r\n    cleanMotorModePresets?: Record<string, string>;\r\n}\r\n\r\nexport const DEFAULT_PROFILE: VacuumProfile = {\r\n\tmappings: {\r\n\t\tfan_power: BASE_FAN,\r\n\t\twater_box_mode: BASE_WATER,\r\n\t\tmop_mode: BASE_MOP\r\n\t},\r\n\tfeatures: {\r\n\t\tmaxSuctionValue: 104\r\n\t}\r\n};\r\n\r\n// --- Zod Schema for Vacuum Status ---\r\nexport const VacuumStatusSchema = z\r\n\t.object({\r\n\t\tstate: z.number().int().optional(),\r\n\t\tfan_power: z.number().int().optional(),\r\n\t\twater_box_mode: z.number().int().optional(),\r\n\t\tmop_mode: z.number().int().optional(),\r\n\t\tdock_type: z.number().int().optional(),\r\n\t\terror_code: z.number().int().optional(),\r\n\t\tbattery: z.number().int().min(0).max(100).optional(),\r\n\t\tclean_time: z.number().int().optional(),\r\n\t\tclean_area: z.number().int().optional(),\r\n\t\tdss: z.number().int().optional(), // Docking station status bits\r\n\t\tmap_status: z.number().int().optional(),\r\n\t\t// Optional string fields that should be valid JSON\r\n\t\tcarpet_mode: z\r\n\t\t\t.string()\r\n\t\t\t.optional()\r\n\t\t\t.refine(\r\n\t\t\t\t(val) => {\r\n\t\t\t\t\tif (val === undefined) return true;\r\n\t\t\t\t\ttry {\r\n\t\t\t\t\t\tJSON.parse(val);\r\n\t\t\t\t\t\treturn true;\r\n\t\t\t\t\t} catch {\r\n\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\t{ message: \"carpet_mode must be a valid JSON string or undefined\" }\r\n\t\t\t),\r\n\t\tcarpet_clean_mode: z\r\n\t\t\t.string()\r\n\t\t\t.optional()\r\n\t\t\t.refine(\r\n\t\t\t\t(val) => {\r\n\t\t\t\t\tif (val === undefined) return true;\r\n\t\t\t\t\ttry {\r\n\t\t\t\t\t\tJSON.parse(val);\r\n\t\t\t\t\t\treturn true;\r\n\t\t\t\t\t} catch {\r\n\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\t{ message: \"carpet_clean_mode must be a valid JSON string or undefined\" }\r\n\t\t\t),\r\n\t\twater_box_custom_mode: z.number().int().optional(), // Required for WaterBox feature detection\r\n\t\t// Add other relevant vacuum status fields...\r\n\t})\r\n\t.passthrough(); // Allow fields not defined in the schema\r\n\r\nexport abstract class BaseVacuumFeatures extends BaseDeviceFeatures {\r\n\tprotected profile: VacuumProfile;\r\n\r\n\t// --- Vacuum-specific Constants ---\r\n\tprotected static readonly CONSTANTS = VACUUM_CONSTANTS;\r\n\r\n\tconstructor(\r\n\t\tdependencies: FeatureDependencies,\r\n\t\tduid: string,\r\n\t\trobotModel: string,\r\n\t\tconfig: DeviceModelConfig,\r\n\t\tprofile: VacuumProfile = DEFAULT_PROFILE\r\n\t) {\r\n\t\t// Add default features that should be present on all vacuums\r\n\t\tconst defaultFeatures = [\r\n\t\t\tFeature.NetworkInfo,\r\n\t\t\tFeature.UpdateStatus,\r\n\t\t];\r\n\t\tconst mergedConfig = {\r\n\t\t\t...config,\r\n\t\t\tstaticFeatures: [...defaultFeatures, ...config.staticFeatures]\r\n\t\t};\r\n\r\n\t\tsuper(dependencies, duid, robotModel, mergedConfig);\r\n\t\tthis.profile = profile;\r\n\r\n\t\t// Initialize with Vacuum base commands\r\n\t\tthis.commands = JSON.parse(JSON.stringify(BaseVacuumFeatures.CONSTANTS.baseCommands));\r\n\r\n\t\t// Populate dynamic states map references\r\n\t\tBaseVacuumFeatures.CONSTANTS.deviceStates.dock_type.states = BaseVacuumFeatures.CONSTANTS.dockTypes;\r\n\t\tBaseVacuumFeatures.CONSTANTS.deviceStates.error_code.states = BaseVacuumFeatures.CONSTANTS.errorCodes;\r\n\t\tBaseVacuumFeatures.CONSTANTS.deviceStates.state.states = BaseVacuumFeatures.CONSTANTS.stateCodes;\r\n\r\n\t\tthis.applyCleanMotorModePresets();\r\n\r\n\t\t// Deduplicate static features\r\n\t\tthis.config.staticFeatures = [...new Set(this.config.staticFeatures)];\r\n\t}\r\n\r\n\tprotected applyCleanMotorModePresets(): void {\r\n\t\tconst presets = this.profile.cleanMotorModePresets || {\r\n\t\t\t'{\"fan_power\":102,\"mop_mode\":300,\"water_box_mode\":200}': \"Vacuum\",\r\n\t\t\t'{\"fan_power\":105,\"mop_mode\":300,\"water_box_mode\":202}': \"Mop\",\r\n\t\t\t'{\"fan_power\":102,\"mop_mode\":300,\"water_box_mode\":202}': \"Vac & Mop\"\r\n\t\t};\r\n\r\n\t\tthis.addCommand(\"set_clean_motor_mode\", {\r\n\t\t\ttype: \"json\",\r\n\t\t\tdef: BaseVacuumFeatures.CONSTANTS.baseCommands.set_clean_motor_mode.def,\r\n\t\t\tstates: presets\r\n\t\t});\r\n\t}\r\n\r\n\tprotected getDynamicFeatures(): Set<Feature> {\r\n\t\tconst features = new Set<Feature>();\r\n\t\ttry {\r\n\t\t\tconst featureSet = this.deps.http_api.getFeatureSet(this.duid);\r\n\t\t\tconst newFeatureSet = this.deps.http_api.getNewFeatureSet(this.duid);\r\n\t\t\tif (featureSet === undefined) {\r\n\t\t\t\tthis.deps.log.error(`[${this.duid}] getDynamicFeatures: Could not get featureSet.`);\r\n\t\t\t\treturn features;\r\n\t\t\t}\r\n\r\n\t\t\tconst highFeatureSet = Math.floor(featureSet / 2 ** 32);\r\n\t\t\tconst newFeatureSetInt = newFeatureSet ? parseInt(\"0x\" + newFeatureSet.slice(-8)) : 0;\r\n\r\n\t\t\t// Map Bitfields to 'is...' Enum keys\r\n\t\t\tif (!!((highFeatureSet >> 5) & 1)) features.add(Feature.isWashThenChargeCmdSupported);\r\n\t\t\tif (!!(featureSet & 33554432)) features.add(Feature.isDustCollectionSettingSupported);\r\n\t\t\tif (!!((highFeatureSet >> 15) & 1)) features.add(Feature.isSupportedDrying);\r\n\t\t\tif (!!(featureSet & 262144)) features.add(Feature.isShakeMopSetSupported);\r\n\t\t\tif (!!(featureSet & 8)) features.add(Feature.isVideoMonitorSupported);\r\n\t\t\tif (!!(featureSet & 64)) features.add(Feature.isVideoSettingSupported);\r\n\t\t\tif (!!(featureSet & 512)) features.add(Feature.isCarpetSupported);\r\n\t\t\tif (!!(featureSet & 65536)) features.add(Feature.isPhotoUploadSupported);\r\n\t\t\tif (!!(featureSet & 134217728)) features.add(Feature.isAvoidCollisionSupported);\r\n\t\t\tif (!!(featureSet & 2147483648)) features.add(Feature.isCornerCleanModeSupported);\r\n\t\t\tif (!!(featureSet & 268435456)) features.add(Feature.isSupportSetSwitchMapMode);\r\n\t\t\tif (!!(featureSet & 2147483648)) features.add(Feature.isCustomWaterBoxDistanceSupported);\r\n\t\t\tif (!!(newFeatureSetInt & 4096)) features.add(Feature.isBackChargeAutoWashSupported);\r\n\t\t\tif (!!(newFeatureSetInt & 256)) features.add(Feature.isCleanRouteFastModeSupported);\r\n\r\n\t\t\t// Check firmware features\r\n\t\t\tconst fwResult = this.deps.http_api.getFwFeaturesResult(this.duid);\r\n\t\t\tif (fwResult) {\r\n\t\t\t\tfor (const id of fwResult) {\r\n\t\t\t\t\tconst featureName = BaseVacuumFeatures.CONSTANTS.firmwareFeatures[id as keyof typeof BaseVacuumFeatures.CONSTANTS.firmwareFeatures];\r\n\t\t\t\t\tif (featureName) {\r\n\t\t\t\t\t\tconst featureEnum = Feature[featureName as keyof typeof Feature];\r\n\t\t\t\t\t\tif (featureEnum) {\r\n\t\t\t\t\t\t\tfeatures.add(featureEnum);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Add features from product info\r\n\t\t\tif (this.deps.http_api.productInfo) {\r\n\t\t\t\tconst deduced = ProductHelper.deduceFeatures(this.deps.http_api.productInfo, this.robotModel);\r\n\t\t\t\tfor (const f of deduced) {\r\n\t\t\t\t\tfeatures.add(f);\r\n\t\t\t\t}\r\n\t\t\t\tthis.deps.log.silly(`[${this.duid}] ProductHelper deduced: ${[...deduced].join(\", \")}`);\r\n\t\t\t}\r\n\t\t} catch (error: any) {\r\n\t\t\tthis.deps.log.error(`[${this.duid}] Error in getDynamicFeatures: ${error.message}`);\r\n\t\t}\r\n\t\tthis.deps.log.silly(`[${this.duid}] Detected dynamic vacuum features (raw): ${[...features].join(\", \")}`);\r\n\t\treturn features;\r\n\t}\r\n\r\n\tpublic async detectAndApplyRuntimeFeatures(statusData: Readonly<Record<string, any>>): Promise<boolean> {\r\n\t\tlet changedOverall = false;\r\n\t\tconst runDetection = !this.runtimeDetectionComplete || this.deps.config.forceRuntimeDetectEveryTime; // Check config flag\r\n\t\tconst appliedFeaturesList: string[] = [];\r\n\r\n\t\tif (!runDetection) {\r\n\t\t\tthis.deps.log.silly(`[${this.duid}] Skipping repeated runtime feature detection.`);\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\tthis.deps.log.debug(`[RuntimeDetect|${this.robotModel}|${this.duid}] Running...`);\r\n\r\n\t\t// --- Validate Status Data ---\r\n\t\tconst validationResult = VacuumStatusSchema.safeParse(statusData);\r\n\t\tif (!validationResult.success) {\r\n\t\t\tthis.deps.log.warn(\r\n\t\t\t\t`[RuntimeDetect|${this.robotModel}|${this.duid}] Received invalid status data. Skipping detection. Errors: ${JSON.stringify(validationResult.error.issues)}`\r\n\t\t\t);\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\tconst validStatus = validationResult.data;\r\n\r\n\t\t// --- Apply dynamic features first (Bitfields/FW) ---\r\n\t\tconst dynamicFeatures = this.getDynamicFeatures(); // Get current dynamic features\r\n\t\tthis.deps.log.silly(`[RuntimeDetect|${this.robotModel}|${this.duid}] Dynamic features from bits/fw: ${[...dynamicFeatures].join(\", \")}`);\r\n\t\tfor (const feature of dynamicFeatures) {\r\n\t\t\tconst mappedFeature = this.mapFeature(feature);\r\n\t\t\tif (mappedFeature) {\r\n\t\t\t\t// Apply only if NOT applied by model specifics already and NOT conflicting\r\n\t\t\t\tif (!this.config.staticFeatures.includes(mappedFeature)) {\r\n\t\t\t\t\tconst applied = await this.applyFeature(mappedFeature);\r\n\t\t\t\t\tif (applied) {\r\n\t\t\t\t\t\tchangedOverall = true;\r\n\t\t\t\t\t\tappliedFeaturesList.push(mappedFeature);\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.deps.log.silly(\r\n\t\t\t\t\t\t`[RuntimeDetect|${this.robotModel}|${this.duid}] Feature '${mappedFeature}' (from '${feature}') defined statically, skipping dynamic application.`\r\n\t\t\t\t\t);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// --- Rules based on validated status data ---\r\n\t\t// Apply features/commands only if they haven't been applied yet\r\n\r\n\t\tlet changedByStatus = false;\r\n\t\t// WaterBox\r\n\t\tif ((validStatus.water_box_mode !== undefined || validStatus.mop_mode !== undefined) && !this.appliedFeatures.has(Feature.WaterBox)) {\r\n\t\t\t// this.deps.log.silly(`[RuntimeDetect|${this.robotModel}|${this.duid}] Detected WaterBox feature via status.`);\r\n\t\t\tif (await this.applyFeature(Feature.WaterBox)) {\r\n\t\t\t\tchangedByStatus = true;\r\n\t\t\t\tappliedFeaturesList.push(\"WaterBox\");\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Carpet Mode Commands\r\n\t\tif (validStatus.carpet_mode !== undefined && !this.commands[\"set_carpet_mode\"]) {\r\n\t\t\t// this.deps.log.silly(`[RuntimeDetect|${this.robotModel}|${this.duid}] Detected carpet_mode command via status.`);\r\n\t\t\tconst spec: CommandSpec = { type: \"json\", states: BaseVacuumFeatures.CONSTANTS.deviceStates.carpet_mode.states };\r\n\t\t\tthis.addCommand(\"set_carpet_mode\", spec);\r\n\t\t\tchangedByStatus = true;\r\n\t\t\tappliedFeaturesList.push(\"set_carpet_mode (Command)\");\r\n\t\t}\r\n\t\tif (validStatus.carpet_clean_mode !== undefined && !this.commands[\"set_carpet_clean_mode\"]) {\r\n\t\t\t// this.deps.log.silly(`[RuntimeDetect|${this.robotModel}|${this.duid}] Detected carpet_clean_mode command via status.`);\r\n\t\t\tconst spec: CommandSpec = { type: \"json\", states: BaseVacuumFeatures.CONSTANTS.deviceStates.carpet_clean_mode.states };\r\n\t\t\tthis.addCommand(\"set_carpet_clean_mode\", spec);\r\n\t\t\tchangedByStatus = true;\r\n\t\t\tappliedFeaturesList.push(\"set_carpet_clean_mode (Command)\");\r\n\t\t}\r\n\r\n\t\t// Refine Fan Power (Max+)\r\n\t\tif (validStatus.fan_power === 108 && !this.appliedFeatures.has(Feature.FanMaxPlus)) {\r\n\t\t\t// Apply only if not statically defined\r\n\t\t\tif (!this.config.staticFeatures.includes(Feature.FanMaxPlus)) {\r\n\t\t\t\t// this.deps.log.silly(`[RuntimeDetect|${this.robotModel}|${this.duid}] Detected FanMaxPlus state (108).`);\r\n\t\t\t\tif (await this.applyFeature(Feature.FanMaxPlus)) {\r\n\t\t\t\t\tchangedByStatus = true;\r\n\t\t\t\t\tappliedFeaturesList.push(\"FanMaxPlus\");\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// MopDry\r\n\t\tif (validStatus.dry_status !== undefined && !this.appliedFeatures.has(Feature.MopDry)) {\r\n\t\t\t// this.deps.log.silly(`[RuntimeDetect|${this.robotModel}|${this.duid}] Detected MopDry feature via 'dry_status' key.`);\r\n\t\t\tif (await this.applyFeature(Feature.MopDry)) {\r\n\t\t\t\tchangedByStatus = true;\r\n\t\t\t\tappliedFeaturesList.push(\"MopDry\");\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// AutoEmptyDock\r\n\t\tif (validStatus.dust_collection_status !== undefined && !this.appliedFeatures.has(Feature.AutoEmptyDock)) {\r\n\t\t\t// this.deps.log.silly(`[RuntimeDetect|${this.robotModel}|${this.duid}] Detected AutoEmptyDock feature via 'dust_collection_status' key.`);\r\n\t\t\tif (await this.applyFeature(Feature.AutoEmptyDock)) {\r\n\t\t\t\tchangedByStatus = true;\r\n\t\t\t\tappliedFeaturesList.push(\"AutoEmptyDock\");\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// MopWash\r\n\t\tif (validStatus.wash_status !== undefined && !this.appliedFeatures.has(Feature.MopWash)) {\r\n\r\n\t\t\tif (await this.applyFeature(Feature.MopWash)) {\r\n\t\t\t\tchangedByStatus = true;\r\n\t\t\t\tappliedFeaturesList.push(\"MopWash\");\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Dynamic DockingStationStatus\r\n\t\tconst dssSupportedDockTypes = [1, 2, 3, 6, 7, 8, 9, 10, 14, 15, 16, 17, 18];\r\n\t\tconst hasDssInStatus = validStatus.dss !== undefined;\r\n\t\tconst hasSupportedDock = validStatus.dock_type !== undefined && dssSupportedDockTypes.includes(validStatus.dock_type);\r\n\r\n\t\tif ((hasDssInStatus || hasSupportedDock) && !this.appliedFeatures.has(Feature.DockingStationStatus)) {\r\n\t\t\tif (await this.applyFeature(Feature.DockingStationStatus)) {\r\n\t\t\t\tchangedByStatus = true;\r\n\t\t\t\tappliedFeaturesList.push(\"DockingStationStatus\");\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Ensure Consumables features are applied (standard for all vacuums really, but good to be explicit)\r\n\t\tif (!this.appliedFeatures.has(Feature.Consumables)) {\r\n\t\t\tif (await this.applyFeature(Feature.Consumables)) {\r\n\t\t\t\tchangedByStatus = true;\r\n\t\t\t\tappliedFeaturesList.push(\"Consumables\");\r\n\t\t\t}\r\n\t\t}\r\n\t\t// ResetConsumables is now handled dynamically inside updateConsumables loop,\r\n\t\t// but we might want to register the Feature if we attach commands to it in future.\r\n\t\t// For now, the buttons are created in updateConsumables.\r\n\r\n\t\t// Add more status-based detection rules here...\r\n\r\n\t\tif (changedByStatus || changedOverall) {\r\n\t\t\tthis.deps.log.info(`[RuntimeDetect|${this.robotModel}|${this.duid}] Runtime detection applied new features/commands: ${appliedFeaturesList.join(\", \")}`);\r\n\t\t} else {\r\n\t\t\tthis.deps.log.debug(`[RuntimeDetect|${this.robotModel}|${this.duid}] No new features detected.`);\r\n\t\t}\r\n\t\tthis.runtimeDetectionComplete = true;\r\n\t\treturn changedOverall || changedByStatus; // Return true if anything changed\r\n\t}\r\n\r\n\tprivate lastDockType: number | undefined;\r\n\r\n\tpublic async processDockType(dockTypeInput: number | undefined): Promise<void> {\r\n\t\tif (dockTypeInput === undefined) {\r\n\t\t\tthis.deps.log.debug(`[processDockType|${this.duid}] dockTypeInput is undefined, skipping dock processing.`);\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tconst dockTypeSchema = z.number().int().min(0);\r\n\t\tconst validation = dockTypeSchema.safeParse(dockTypeInput);\r\n\t\tif (!validation.success) {\r\n\t\t\tthis.deps.log.warn(`[processDockType|${this.duid}] Invalid dockTypeInput received: ${dockTypeInput}. Errors: ${JSON.stringify(validation.error.issues)}`);\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tconst dockType = validation.data;\r\n\r\n\t\t// Optimization: Skip if dock type hasn't changed\r\n\t\tif (this.lastDockType === dockType) {\r\n\t\t\tthis.deps.log.silly(`[${this.duid}] Dock type ${dockType} unchanged, skipping processing.`);\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tthis.lastDockType = dockType;\r\n\r\n\t\tthis.deps.log.info(`[${this.duid}] Processing dock type ${dockType} for Vacuum`);\r\n\t\tconst dockFeatureMap: Record<number, Feature[]> = {\r\n\t\t\t1: [Feature.AutoEmptyDock, Feature.DockingStationStatus],\r\n\t\t\t2: [Feature.MopWash, Feature.DockingStationStatus],\r\n\t\t\t3: [Feature.AutoEmptyDock, Feature.MopWash, Feature.MopDry, Feature.DockingStationStatus],\r\n\t\t\t5: [Feature.AutoEmptyDock],\r\n\t\t\t6: [Feature.AutoEmptyDock, Feature.MopWash, Feature.MopDry, Feature.DockingStationStatus],\r\n\t\t\t7: [Feature.AutoEmptyDock, Feature.MopWash, Feature.MopDry, Feature.DockingStationStatus],\r\n\t\t\t8: [Feature.AutoEmptyDock, Feature.MopWash, Feature.MopDry, Feature.DockingStationStatus],\r\n\t\t\t9: [Feature.AutoEmptyDock, Feature.MopWash, Feature.MopDry, Feature.DockingStationStatus],\r\n\t\t\t14: [Feature.AutoEmptyDock, Feature.MopWash, Feature.MopDry, Feature.DockingStationStatus], // Qrevo Master (a117)\r\n\t\t\t15: [Feature.AutoEmptyDock, Feature.MopWash, Feature.MopDry, Feature.DockingStationStatus], // Qrevo S (a104)\r\n\t\t\t16: [Feature.AutoEmptyDock, Feature.MopWash, Feature.MopDry, Feature.DockingStationStatus],\r\n\t\t\t10: [Feature.AutoEmptyDock, Feature.MopWash, Feature.MopDry, Feature.DockingStationStatus], // S7 MaxV/Pro\r\n\t\t\t17: [Feature.AutoEmptyDock, Feature.MopWash, Feature.MopDry, Feature.DockingStationStatus], // Qrevo Curv Series (a159)\r\n\t\t\t18: [Feature.AutoEmptyDock, Feature.MopWash, Feature.MopDry, Feature.DockingStationStatus], // S8 Pro\r\n\t\t};\r\n\t\tconst features = dockFeatureMap[dockType];\r\n\r\n\t\tif (features) {\r\n\t\t\tthis.deps.log.info(`[${this.duid}] Applying dock features for type ${dockType}: ${features.join(\", \")}`); // Apply features sequentially to handle dependencies\r\n\t\t\tfor (const feature of features) {\r\n\t\t\t\tawait this.applyFeature(feature); // applyFeature handles de-duplication\r\n\t\t\t}\r\n\t\t} else if (dockType !== 0) {\r\n\t\t\tthis.deps.log.warn(`[processDockType|${this.duid}] Unknown dock type ${dockType} encountered. No features applied. Please report this model and dock type.`);\r\n\t\t}\r\n\t}\r\n\r\n\t// --- Instance Getters for Constants ---\r\n\tpublic getCommonConsumable(attribute: string | number): { unit?: string } | undefined {\r\n\t\treturn BaseVacuumFeatures.CONSTANTS.consumables[attribute as keyof typeof BaseVacuumFeatures.CONSTANTS.consumables];\r\n\t}\r\n\tpublic isResetableConsumable(consumable: string): boolean {\r\n\t\t// Access static constant\r\n\t\treturn BaseVacuumFeatures.CONSTANTS.resetConsumables.has(consumable);\r\n\t}\r\n\tpublic getCommonDeviceStates(attribute: string | number): { states?: Record<any, any>; unit?: string; type?: ioBroker.CommonType | undefined } | undefined {\r\n\t\tconst stateDef = BaseVacuumFeatures.CONSTANTS.deviceStates[attribute as keyof typeof BaseVacuumFeatures.CONSTANTS.deviceStates];\r\n\t\tif (!stateDef) return undefined;\r\n\r\n\t\tconst result = { ...stateDef } as { states?: Record<any, any>; unit?: string; type?: ioBroker.CommonType | undefined };\r\n\r\n\t\tif (attribute === \"fan_power\" && this.profile.mappings.fan_power) {\r\n\t\t\tresult.states = this.profile.mappings.fan_power;\r\n\t\t} else if (attribute === \"mop_mode\" && this.profile.mappings.mop_mode) {\r\n\t\t\tresult.states = this.profile.mappings.mop_mode;\r\n\t\t} else if (attribute === \"water_box_mode\" && this.profile.mappings.water_box_mode) {\r\n\t\t\tresult.states = this.profile.mappings.water_box_mode;\r\n\t\t} else if (attribute === \"error_code\" && this.profile.mappings.error_code) {\r\n\t\t\tresult.states = this.profile.mappings.error_code;\r\n\t\t} else if (attribute === \"state\" && this.profile.mappings.state) {\r\n\t\t\tresult.states = this.profile.mappings.state;\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n\tpublic getCommonCleaningInfo(attribute: string | number): Partial<ioBroker.StateCommon> | undefined {\r\n\t\treturn BaseVacuumFeatures.CONSTANTS.cleaningInfo[attribute as keyof typeof BaseVacuumFeatures.CONSTANTS.cleaningInfo] as Partial<ioBroker.StateCommon>;\r\n\t}\r\n\tpublic getCommonCleaningRecords(attribute: string | number): Partial<ioBroker.StateCommon> | undefined {\r\n\t\tconst spec = BaseVacuumFeatures.CONSTANTS.cleaningRecords[attribute as keyof typeof BaseVacuumFeatures.CONSTANTS.cleaningRecords];\r\n\t\treturn spec as Partial<ioBroker.StateCommon> | undefined;\r\n\t}\r\n\tpublic getFirmwareFeatureName(featureID: string | number): string {\r\n\t\t// Retrieve feature name from static constants\r\n\t\tconst name = BaseVacuumFeatures.CONSTANTS.firmwareFeatures[featureID as keyof typeof BaseVacuumFeatures.CONSTANTS.firmwareFeatures];\r\n\t\treturn name || `FeatureID_${featureID}`;\r\n\t}\r\n\r\n\t// --- Feature Implementations ---\r\n\t// Converted to methods with decorators\r\n\r\n    @BaseDeviceFeatures.DeviceFeature(Feature.AutoEmptyDock)\r\n\tprotected addAutoEmptyDockCommands(): void {\r\n\t\tthis.addCommand(\"app_start_collect_dust\", { type: \"boolean\", def: false });\r\n\t\tthis.addCommand(\"app_stop_collect_dust\", { type: \"boolean\", def: false });\r\n\t\tthis.addCommand(\"set_dust_collection_switch_status\", { type: \"json\", def: '{\"status\":1}', states: { '{\"status\":0}': \"Off\", '{\"status\":1}': \"On\" } });\r\n\t\tthis.addCommand(\"set_dust_collection_mode\", {\r\n\t\t\ttype: \"json\",\r\n\t\t\tdef: '{\"mode\":0}',\r\n\t\t\tstates: { '{\"mode\":0}': \"Smart\", '{\"mode\":1}': \"Low\", '{\"mode\":2}': \"Medium\", '{\"mode\":4}': \"Max\" },\r\n\t\t});\r\n\t}\r\n\r\n    @BaseDeviceFeatures.DeviceFeature(Feature.MopWash)\r\n    protected addMopWashCommands(): void {\r\n    \tthis.addCommand(\"app_start_wash\", { type: \"boolean\", def: false });\r\n    \tthis.addCommand(\"app_stop_wash\", { type: \"boolean\", def: false });\r\n    \tthis.addCommand(\"set_wash_towel_mode\", {\r\n    \t\ttype: \"json\",\r\n    \t\tdef: '{\"wash_mode\":2}',\r\n    \t\tstates: { '{\"wash_mode\":0}': \"Eco\", '{\"wash_mode\":1}': \"Medium\", '{\"wash_mode\":2}': \"Intense\" },\r\n    \t});\r\n    \tthis.addCommand(\"set_smart_wash_params\", {\r\n    \t\ttype: \"json\",\r\n    \t\tdef: '{\"smart_wash\":0,\"wash_interval\":1800}',\r\n    \t\tstates: {\r\n    \t\t\t'{\"smart_wash\":0,\"wash_interval\":600}': \"10 Min\",\r\n    \t\t\t'{\"smart_wash\":0,\"wash_interval\":900}': \"15 Min\",\r\n    \t\t\t'{\"smart_wash\":0,\"wash_interval\":1200}': \"20 Min\",\r\n    \t\t\t'{\"smart_wash\":0,\"wash_interval\":1500}': \"25 Min\",\r\n    \t\t\t'{\"smart_wash\":0,\"wash_interval\":1800}': \"30 Min\",\r\n    \t\t\t'{\"smart_wash\":0,\"wash_interval\":2100}': \"35 Min\",\r\n    \t\t\t'{\"smart_wash\":0,\"wash_interval\":2400}': \"40 Min\",\r\n    \t\t\t'{\"smart_wash\":0,\"wash_interval\":2700}': \"45 Min\",\r\n    \t\t\t'{\"smart_wash\":0,\"wash_interval\":3000}': \"50 Min\",\r\n    \t\t\t'{\"smart_wash\":1,\"wash_interval\":1200}': \"Per room\",\r\n    \t\t},\r\n    \t});\r\n    }\r\n\r\n    @BaseDeviceFeatures.DeviceFeature(Feature.MopDry)\r\n    protected addMopDryCommands(): void {\r\n    \tthis.addCommand(\"app_set_dryer_status\", { type: \"string\", def: '{\"status\": 0}', states: { '{\"status\": 1}': \"On\", '{\"status\": 0}': \"Off\" } });\r\n    \tthis.addCommand(\"app_set_dryer_setting\", {\r\n    \t\ttype: \"json\",\r\n    \t\tdef: '{\"on\":{\"dry_time\":10800},\"status\":0}',\r\n    \t\tstates: {\r\n    \t\t\t'{\"on\":{\"dry_time\":10800},\"status\":0}': \"Off\",\r\n    \t\t\t'{\"on\":{\"dry_time\":7200},\"status\":1}': \"2h\",\r\n    \t\t\t'{\"on\":{\"dry_time\":10800},\"status\":1}': \"3h\",\r\n    \t\t\t'{\"on\":{\"dry_time\":14400},\"status\":1}': \"4h\",\r\n    \t\t},\r\n    \t});\r\n    }\r\n\r\n    @BaseDeviceFeatures.DeviceFeature(Feature.WaterBox)\r\n    @BaseDeviceFeatures.DeviceFeature(Feature.ShakeMopStrength)\r\n    @BaseDeviceFeatures.DeviceFeature(Feature.ElectronicWaterBox)\r\n    protected addWaterBoxCommands(): void {\r\n    \tconst mopStates = this.profile.mappings.mop_mode || VACUUM_CONSTANTS.deviceStates.mop_mode.states;\r\n    \tthis.addCommand(\"set_mop_mode\", { type: \"number\", def: 300, states: mopStates });\r\n\r\n    \tconst waterStates = this.profile.mappings.water_box_mode || VACUUM_CONSTANTS.deviceStates.water_box_mode.states;\r\n    \tthis.addCommand(\"set_water_box_custom_mode\", { type: \"number\", def: 201, states: waterStates });\r\n    }\r\n\r\n    @BaseDeviceFeatures.DeviceFeature(Feature.CleanRouteFastMode)\r\n    protected addCleanRouteFastModeCommand(): void {\r\n    \tconst mopMode = this.commands.set_mop_mode || { type: \"number\", def: 300, states: {} };\r\n    \tmopMode.states = { ...BaseVacuumFeatures.CONSTANTS.deviceStates.mop_mode.states, ...mopMode.states, 304: \"Fast\" }; // Merge carefully\r\n    \tthis.addCommand(\"set_mop_mode\", mopMode);\r\n    }\r\n\r\n    @BaseDeviceFeatures.DeviceFeature(Feature.SmartPlan)\r\n    protected addSmartPlanFeature(): void {\r\n    \tconst mopMode = this.commands.set_mop_mode || { type: \"number\", def: 300, states: {} };\r\n    \tmopMode.states = { ...mopMode.states, 306: \"SmartPlan\" };\r\n    \tthis.addCommand(\"set_mop_mode\", mopMode);\r\n    }\r\n\r\n    @BaseDeviceFeatures.DeviceFeature(Feature.LiveVideo)\r\n    @BaseDeviceFeatures.DeviceFeature(Feature.Camera)\r\n    protected async createCameraStates(): Promise<void> {\r\n    \tconst ip = this.deps.config.hostname_ip; // Use DI config\r\n    \tif (!ip) {\r\n    \t\tthis.deps.log.warn(`[${this.duid}] Cannot create camera states: IP address not configured.`);\r\n    \t\treturn;\r\n    \t}\r\n    \tconst streamTypes = {\r\n    \t\tstream_html: `http://${ip}:${1984 + this.deps.adapter.instance}/stream.html?src=${this.duid}`,\r\n    \t\twebrtc_html: `http://${ip}:${1984 + this.deps.adapter.instance}/webrtc.html?src=${this.duid}&media=video`,\r\n    \t\tstream_mp4: `http://${ip}:${1984 + this.deps.adapter.instance}/api/stream.mp4?src=${this.duid}`,\r\n    \t\trtsp: `rtsp://${ip}:${8554 + this.deps.adapter.instance}/${this.duid}?video`,\r\n    \t};\r\n    \tawait this.deps.ensureFolder(`Devices.${this.duid}.camera`);\r\n    \tfor (const [name, stream_uri] of Object.entries(streamTypes)) {\r\n    \t\t// Use ensureState helper\r\n    \t\tawait this.ensureState(\"camera\", name, { type: \"string\", role: \"url\", write: false, def: stream_uri });\r\n    \t}\r\n    }\r\n\r\n    @BaseDeviceFeatures.DeviceFeature(Feature.MultiFloor)\r\n    protected async createMultiFloorStates(): Promise<void> {\r\n    \tawait this.deps.ensureFolder(`Devices.${this.duid}.floors`);\r\n    \tfor (const feature of [\"max_multi_map\", \"max_bak_map\", \"multi_map_count\"]) {\r\n    \t\tawait this.ensureState(\"floors\", feature, { ...this.getCommonDeviceStates(feature), write: false });\r\n    \t}\r\n    }\r\n\r\n    public async updateConsumables(data?: any): Promise<void> {\r\n    \tlet resultObj: Record<string, any> | undefined;\r\n\r\n    \tif (data) {\r\n    \t\tresultObj = data;\r\n    \t} else {\r\n    \t\tconst result = await this.deps.adapter.requestsHandler.sendRequest(this.duid, \"get_consumable\", []);\r\n    \t\tif (Array.isArray(result) && result.length > 0 && typeof result[0] === \"object\") {\r\n    \t\t\tresultObj = result[0];\r\n    \t\t} else if (typeof result === \"object\" && result !== null) {\r\n    \t\t\tresultObj = result as Record<string, any>;\r\n    \t\t}\r\n    \t}\r\n\r\n    \tif (resultObj) {\r\n    \t\tawait this.deps.ensureFolder(`Devices.${this.duid}.consumables`);\r\n    \t\tawait this.deps.ensureFolder(`Devices.${this.duid}.resetConsumables`);\r\n\r\n    \t\tfor (const key in resultObj) {\r\n    \t\t\tconst val = resultObj[key];\r\n    \t\t\tconst common = this.getCommonConsumable(key);\r\n    \t\t\tconst fullCommon = common ? { ...common, type: \"number\" as const, role: \"value\" as const, read: true, write: false, name: key }\r\n    \t\t\t\t: { type: \"number\" as const, role: \"value\" as const, read: true, write: false, name: key };\r\n\r\n    \t\t\tawait this.deps.ensureState(`Devices.${this.duid}.consumables.${key}`, fullCommon as ioBroker.StateCommon);\r\n    \t\t\tawait this.deps.adapter.setStateChangedAsync(`Devices.${this.duid}.consumables.${key}`, { val: Number(val), ack: true });\r\n\r\n    \t\t\tif (BaseVacuumFeatures.CONSTANTS.resetConsumables.has(key)) {\r\n    \t\t\t\tawait this.ensureState(\"resetConsumables\", key, {\r\n    \t\t\t\t\ttype: \"boolean\",\r\n    \t\t\t\t\trole: \"button\",\r\n    \t\t\t\t\tdef: false,\r\n    \t\t\t\t\twrite: true,\r\n    \t\t\t\t\tname: `Reset ${key}`\r\n    \t\t\t\t});\r\n    \t\t\t}\r\n    \t\t}\r\n    \t}\r\n    }\r\n\r\n    @BaseDeviceFeatures.DeviceFeature(Feature.AvoidCarpet)\r\n    @BaseDeviceFeatures.DeviceFeature(Feature.isCarpetSupported)\r\n    protected addAvoidCarpetCommands(): void {\r\n    \tthis.addCommand(\"set_carpet_mode\", { type: \"json\", states: BaseVacuumFeatures.CONSTANTS.deviceStates.carpet_mode.states });\r\n    \tthis.addCommand(\"set_carpet_clean_mode\", { type: \"json\", states: BaseVacuumFeatures.CONSTANTS.deviceStates.carpet_clean_mode.states });\r\n    }\r\n\r\n    @BaseDeviceFeatures.DeviceFeature(Feature.isAvoidCollisionSupported)\r\n    protected async addAvoidCollisionStates(): Promise<void> {\r\n    \tawait this.ensureState(\"deviceStatus\", \"collision_avoid_status\", { ...this.getCommonDeviceStates(\"collision_avoid_status\"), write: false });\r\n    \tawait this.ensureState(\"deviceStatus\", \"avoid_count\", { ...this.getCommonDeviceStates(\"avoid_count\"), write: false });\r\n    }\r\n\r\n    @BaseDeviceFeatures.DeviceFeature(Feature.MopForbidden)\r\n    protected async addMopForbiddenStates(): Promise<void> {\r\n    \tawait this.ensureState(\"deviceStatus\", \"mop_forbidden_enable\", { ...this.getCommonDeviceStates(\"mop_forbidden_enable\"), write: false });\r\n    }\r\n\r\n    @BaseDeviceFeatures.DeviceFeature(Feature.VoiceControl)\r\n    protected async addVoiceControlStates(): Promise<void> {\r\n    \tawait this.ensureState(\"deviceStatus\", \"voice_chat_status\", { ...this.getCommonDeviceStates(\"voice_chat_status\"), write: false });\r\n    }\r\n\r\n    @BaseDeviceFeatures.DeviceFeature(Feature.Camera)\r\n    protected async addCameraSettingsStates(): Promise<void> {\r\n    \tawait this.ensureState(\"deviceStatus\", \"camera_status\", { ...this.getCommonDeviceStates(\"camera_status\"), write: false });\r\n    \tawait this.ensureState(\"deviceStatus\", \"distance_off\", { ...this.getCommonDeviceStates(\"distance_off\"), write: false });\r\n    }\r\n\r\n    @BaseDeviceFeatures.DeviceFeature(Feature.isSupportSetSwitchMapMode)\r\n    protected async addSwitchMapModeState(): Promise<void> {\r\n    \tawait this.ensureState(\"deviceStatus\", \"switch_map_mode\", { ...this.getCommonDeviceStates(\"switch_map_mode\"), write: false });\r\n    }\r\n\r\n    @BaseDeviceFeatures.DeviceFeature(Feature.isCornerCleanModeSupported)\r\n    protected async addCornerCleanModeState(): Promise<void> {\r\n    \tawait this.ensureState(\"deviceStatus\", \"corner_clean_mode\", { ...this.getCommonDeviceStates(\"corner_clean_mode\"), write: false });\r\n    }\r\n\r\n\r\n\r\n    // --- State/Info Feature Handlers ---\r\n    @BaseDeviceFeatures.DeviceFeature(Feature.MapFlag)\r\n    protected async addMapFlagState(): Promise<void> { await this.ensureState(\"deviceStatus\", \"map_flag\", { ...this.getCommonDeviceStates(\"map_flag\"), write: false }); }\r\n\r\n    @BaseDeviceFeatures.DeviceFeature(Feature.CommonStatus)\r\n    protected async addCommonStatusState(): Promise<void> { await this.ensureState(\"deviceStatus\", \"common_status\", { ...this.getCommonDeviceStates(\"common_status\"), write: false }); }\r\n\r\n    @BaseDeviceFeatures.DeviceFeature(Feature.DockStatus)\r\n    protected async addDockErrorStatusState(): Promise<void> { await this.ensureState(\"deviceStatus\", \"dock_error_status\", { ...this.getCommonDeviceStates(\"dock_error_status\"), write: false }); }\r\n\r\n    @BaseDeviceFeatures.DeviceFeature(Feature.BackType)\r\n    protected async addBackTypeState(): Promise<void> { await this.ensureState(\"deviceStatus\", \"back_type\", { ...this.getCommonDeviceStates(\"back_type\"), write: false }); }\r\n\r\n    @BaseDeviceFeatures.DeviceFeature(Feature.SwitchStatus)\r\n    protected async addSwitchStatusState(): Promise<void> { await this.ensureState(\"deviceStatus\", \"switch_status\", { ...this.getCommonDeviceStates(\"switch_status\"), write: false }); }\r\n\r\n    @BaseDeviceFeatures.DeviceFeature(Feature.MonitorStatus)\r\n    protected async addMonitorStatusState(): Promise<void> { await this.ensureState(\"deviceStatus\", \"monitor_status\", { ...this.getCommonDeviceStates(\"monitor_status\"), write: false }); }\r\n\r\n    @BaseDeviceFeatures.DeviceFeature(Feature.CleanPercent)\r\n    protected async addCleanPercentState(): Promise<void> { await this.ensureState(\"deviceStatus\", \"clean_percent\", { ...this.getCommonDeviceStates(\"clean_percent\"), write: false }); }\r\n\r\n    @BaseDeviceFeatures.DeviceFeature(Feature.InWarmup)\r\n    protected async addInWarmupState(): Promise<void> { await this.ensureState(\"deviceStatus\", \"in_warmup\", { ...this.getCommonDeviceStates(\"in_warmup\"), write: false }); }\r\n\r\n    @BaseDeviceFeatures.DeviceFeature(Feature.ExitDock)\r\n    protected async addExitDockState(): Promise<void> { await this.ensureState(\"deviceStatus\", \"exit_dock\", { ...this.getCommonDeviceStates(\"exit_dock\"), write: false }); }\r\n\r\n    @BaseDeviceFeatures.DeviceFeature(Feature.ExtraTime)\r\n    protected async addExtraTimeState(): Promise<void> { await this.ensureState(\"deviceStatus\", \"extra_time\", { ...this.getCommonDeviceStates(\"extra_time\"), write: false }); }\r\n\r\n    @BaseDeviceFeatures.DeviceFeature(Feature.LastCleanTime)\r\n    protected async addLastCleanTimeState(): Promise<void> { await this.ensureState(\"deviceStatus\", \"last_clean_t\", { ...this.getCommonDeviceStates(\"last_clean_t\"), write: false }); }\r\n\r\n    @BaseDeviceFeatures.DeviceFeature(Feature.ChargeStatus)\r\n    protected async addChargeStatusState(): Promise<void> { await this.ensureState(\"deviceStatus\", \"charge_status\", { ...this.getCommonDeviceStates(\"charge_status\"), write: false }); }\r\n\r\n    @BaseDeviceFeatures.DeviceFeature(Feature.CleaningInfo)\r\n    protected async addCleaningInfoState(): Promise<void> { await this.ensureState(\"deviceStatus\", \"cleaning_info\", { ...this.getCommonDeviceStates(\"cleaning_info\"), write: false }); }\r\n\r\n    @BaseDeviceFeatures.DeviceFeature(Feature.CleanRepeat)\r\n    protected async addCleanRepeatState(): Promise<void> { await this.ensureState(\"deviceStatus\", \"repeat\", { ...this.getCommonDeviceStates(\"repeat\"), write: false }); }\r\n\r\n    @BaseDeviceFeatures.DeviceFeature(Feature.DockingStationStatus)\r\n    protected async createDockingStationStatusStates(): Promise<void> {\r\n    \ttry {\r\n    \t\tawait this.deps.ensureFolder(`Devices.${this.duid}.dockingStationStatus`);\r\n\r\n    \t\t// Common states mapping for docking station status values (from original implementation)\r\n    \t\tconst commonStates = {\r\n    \t\t\t0: \"UNKNOWN\",\r\n    \t\t\t1: \"ERROR\",\r\n    \t\t\t2: \"OK\"\r\n    \t\t};\r\n\r\n    \t\t// Create all docking station status states (original field names from working code)\r\n    \t\tconst stateDefinitions = [\r\n    \t\t\t{ key: \"cleanFluidStatus\", name: \"Clean Water Tank\" },\r\n    \t\t\t{ key: \"waterBoxFilterStatus\", name: \"Water Box Filter\" },\r\n    \t\t\t{ key: \"dustBagStatus\", name: \"Dust Bag\" },\r\n    \t\t\t{ key: \"dirtyWaterBoxStatus\", name: \"Dirty Water Tank\" },\r\n    \t\t\t{ key: \"clearWaterBoxStatus\", name: \"Clear Water Box\" },\r\n    \t\t\t{ key: \"isUpdownWaterReady\", name: \"Water Ready Status\" }\r\n    \t\t];\r\n\r\n    \t\tfor (const stateDef of stateDefinitions) {\r\n    \t\t\tawait this.ensureState(\"dockingStationStatus\", stateDef.key, {\r\n    \t\t\t\tname: stateDef.name,\r\n    \t\t\t\ttype: \"number\",\r\n    \t\t\t\trole: \"value\",\r\n    \t\t\t\tread: true,\r\n    \t\t\t\twrite: false,\r\n    \t\t\t\tstates: commonStates\r\n    \t\t\t});\r\n    \t\t}\r\n\r\n    \t} catch (error) {\r\n    \t\tthrow error;\r\n    \t}\r\n    }\r\n\r\n    public override async updateFirmwareFeatures(): Promise<void> {\r\n    \ttry {\r\n    \t\tconst result = await this.deps.adapter.requestsHandler.sendRequest(this.duid, \"get_fw_features\", []);\r\n    \t\tif (Array.isArray(result)) {\r\n    \t\t\t// Store in http_api for getDynamicFeatures usage\r\n    \t\t\tthis.deps.http_api.storeFwFeaturesResult(this.duid, result);\r\n\r\n    \t\t\t// Setup states\r\n    \t\t\tawait this.setupFirmwareFeatures(result);\r\n    \t\t}\r\n    \t} catch (e: any) {\r\n    \t\tthis.deps.log.warn(`[${this.duid}] Failed to update firmware features: ${e.message}`);\r\n    \t}\r\n    }\r\n\r\n    protected async setupFirmwareFeatures(features: number[]): Promise<void> {\r\n    \tawait this.deps.ensureFolder(`Devices.${this.duid}.firmwareFeatures`);\r\n\r\n    \t// Loop through all known features from CONSTANTS\r\n    \tfor (const [id, name] of Object.entries(BaseVacuumFeatures.CONSTANTS.firmwareFeatures)) {\r\n    \t\tconst isSupported = features.includes(Number(id));\r\n    \t\tawait this.ensureState(\"firmwareFeatures\", name, {\r\n    \t\t\ttype: \"boolean\",\r\n    \t\t\trole: \"indicator\",\r\n    \t\t\tname: `${name} (ID: ${id})`,\r\n    \t\t\twrite: false\r\n    \t\t});\r\n    \t\tawait this.deps.adapter.setStateChangedAsync(\r\n    \t\t\t`Devices.${this.duid}.firmwareFeatures.${name}`,\r\n    \t\t\t{ val: isSupported, ack: true }\r\n    \t\t);\r\n    \t}\r\n    }\r\n\r\n    // Override updateStatus to process dss breakdown\r\n    public override async updateStatus(): Promise<void> {\r\n    \t// Re-implementing updateStatus for detailed handling\r\n    \ttry {\r\n    \t\tconst result = await this.deps.adapter.requestsHandler.sendRequest(this.duid, \"get_prop\", [\"get_status\"]);\r\n    \t\tlet resultObj: Record<string, any> | undefined;\r\n\r\n    \t\tif (Array.isArray(result) && result.length > 0 && typeof result[0] === \"object\") {\r\n    \t\t\tresultObj = result[0];\r\n    \t\t} else if (typeof result === \"object\" && result !== null) {\r\n    \t\t\tresultObj = result as Record<string, any>;\r\n    \t\t}\r\n\r\n    \t\tif (resultObj) {\r\n    \t\t\t// Prioritize dock_type processing to ensure feature flags are set\r\n    \t\t\tconst dockType = resultObj[\"dock_type\"];\r\n    \t\t\tif (dockType !== undefined) {\r\n    \t\t\t\tawait this.processDockType(Number(dockType));\r\n    \t\t\t}\r\n\r\n    \t\t\t// Handle docking station status separately\r\n    \t\t\tconst dssValue = resultObj[\"dss\"];\r\n    \t\t\tif (dssValue !== undefined) {\r\n    \t\t\t\tdelete resultObj[\"dss\"];\r\n    \t\t\t\tawait this.updateDockingStationStatus(Number(dssValue));\r\n    \t\t\t}\r\n\r\n    \t\t\tawait this.deps.ensureFolder(`Devices.${this.duid}.deviceStatus`);\r\n    \t\t\tfor (const key in resultObj) {\r\n    \t\t\t\tlet val = resultObj[key];\r\n    \t\t\t\tconst common = this.getCommonDeviceStates(key) || { name: key, type: typeof val as ioBroker.CommonType, read: true, write: false };\r\n\r\n    \t\t\t\t// Serialize complex objects\r\n    \t\t\t\tif (typeof val === \"object\" && val !== null) {\r\n    \t\t\t\t\tval = JSON.stringify(val);\r\n    \t\t\t\t}\r\n\r\n    \t\t\t\tif (common.type === \"string\" && typeof val !== \"string\") {\r\n    \t\t\t\t\tval = String(val);\r\n    \t\t\t\t}\r\n\r\n    \t\t\t\tawait this.deps.ensureState(`Devices.${this.duid}.deviceStatus.${key}`, common);\r\n    \t\t\t\tawait this.deps.adapter.setStateChangedAsync(`Devices.${this.duid}.deviceStatus.${key}`, { val: val as ioBroker.StateValue, ack: true });\r\n    \t\t\t}\r\n    \t\t}\r\n    \t} catch (e: any) {\r\n    \t\tthis.deps.log.warn(`[${this.duid}] Failed to update status: ${e.message}`);\r\n    \t}\r\n    }\r\n\r\n    protected async updateDockingStationStatus(dss: number): Promise<void> {\r\n    \t// Guard: Feature must be active\r\n    \tif (!this.appliedFeatures.has(Feature.DockingStationStatus)) {\r\n    \t\treturn;\r\n    \t}\r\n\r\n    \t// Parse 2-bit status fields\r\n    \tconst status = {\r\n    \t\tcleanFluidStatus: (dss >> 10) & 0b11,        // Bits 10-11: Clean water tank status\r\n    \t\twaterBoxFilterStatus: (dss >> 8) & 0b11,     // Bits 8-9: Water box filter\r\n    \t\tdustBagStatus: (dss >> 6) & 0b11,            // Bits 6-7: Dust bag (Staubbeutel)\r\n    \t\tdirtyWaterBoxStatus: (dss >> 4) & 0b11,      // Bits 4-5: Dirty water tank\r\n    \t\tclearWaterBoxStatus: (dss >> 2) & 0b11,      // Bits 2-3: Clear water box\r\n    \t\tisUpdownWaterReady: dss & 0b11,              // Bits 0-1: Water ready status\r\n    \t};\r\n\r\n    \tfor (const [name, val] of Object.entries(status)) {\r\n    \t\tawait this.deps.adapter.setStateChangedAsync(\r\n    \t\t\t`Devices.${this.duid}.dockingStationStatus.${name}`,\r\n    \t\t\t{ val: val, ack: true }\r\n    \t\t);\r\n    \t}\r\n    }\r\n\r\n\r\n    @BaseDeviceFeatures.DeviceFeature(Feature.Rss)\r\n    protected async addRssState(): Promise<void> { await this.ensureState(\"deviceStatus\", \"rss\", { ...this.getCommonDeviceStates(\"rss\"), write: false }); }\r\n\r\n    @BaseDeviceFeatures.DeviceFeature(Feature.RobotStatus)\r\n    protected async addRobotStatusState(): Promise<void> { await this.ensureState(\"deviceStatus\", \"state\", { ...this.getCommonDeviceStates(\"state\"), write: false }); }\r\n\r\n    @BaseDeviceFeatures.DeviceFeature(Feature.Kct)\r\n    protected async addKctState(): Promise<void> { await this.ensureState(\"deviceStatus\", \"kct\", { ...this.getCommonDeviceStates(\"kct\"), write: false }); }\r\n\r\n    @BaseDeviceFeatures.DeviceFeature(Feature.CleanFluid)\r\n    protected async addCleanFluidState(): Promise<void> { await this.ensureState(\"deviceStatus\", \"clean_fluid\", { ...this.getCommonDeviceStates(\"clean_fluid\"), write: false }); }\r\n\r\n    @BaseDeviceFeatures.DeviceFeature(Feature.Rdt)\r\n    protected async addRdtState(): Promise<void> { await this.ensureState(\"deviceStatus\", \"rdt\", { ...this.getCommonDeviceStates(\"rdt\"), write: false }); }\r\n\r\n    @BaseDeviceFeatures.DeviceFeature(Feature.ReplenishMode)\r\n    protected async addReplenishModeState(): Promise<void> { await this.ensureState(\"deviceStatus\", \"replenish_mode\", { ...this.getCommonDeviceStates(\"replenish_mode\"), write: false }); }\r\n\r\n    @BaseDeviceFeatures.DeviceFeature(Feature.CleanedArea)\r\n    protected async addCleanedAreaState(): Promise<void> { await this.ensureState(\"deviceStatus\", \"cleaned_area\", { ...this.getCommonDeviceStates(\"cleaned_area\"), write: false }); }\r\n\r\n    @BaseDeviceFeatures.DeviceFeature(Feature.CleanTimes)\r\n    protected async addCleanTimesState(): Promise<void> { await this.ensureState(\"deviceStatus\", \"clean_times\", { ...this.getCommonDeviceStates(\"clean_times\"), write: false }); }\r\n\r\n    @BaseDeviceFeatures.DeviceFeature(Feature.CustomWaterBoxDistance)\r\n    protected async createCustomWaterDistanceState(): Promise<void> {\r\n\r\n    \tawait this.ensureState(\"commands\", \"set_water_box_distance_off\", {\r\n    \t\ttype: \"number\",\r\n    \t\trole: \"level\",\r\n    \t\twrite: true,\r\n    \t\t...this.getCommonDeviceStates(\"distance_off\"),\r\n    \t\tmin: 1,\r\n    \t\tmax: 30,\r\n    \t});\r\n    }\r\n\r\n    @BaseDeviceFeatures.DeviceFeature(Feature.FanMaxPlus)\r\n    protected addFanMaxPlusCommand(): void {\r\n    \tconst fanStates = this.profile.mappings.fan_power || VACUUM_CONSTANTS.deviceStates.fan_power.states;\r\n    \t// Use set_custom_mode for fan power as per base commands\r\n    \tthis.addCommand(\"set_custom_mode\", { type: \"number\", def: 102, states: fanStates });\r\n    }\r\n\r\n    @BaseDeviceFeatures.DeviceFeature(Feature.NetworkInfo)\r\n    protected async addNetworkInfoStates(): Promise<void> {\r\n    \tawait this.deps.ensureFolder(`Devices.${this.duid}.networkInfo`);\r\n    \tawait this.ensureState(\"networkInfo\", \"ssid\", { type: \"string\", role: \"info.name\", write: false });\r\n    \tawait this.ensureState(\"networkInfo\", \"ip\", { type: \"string\", role: \"info.ip\", write: false });\r\n    \tawait this.ensureState(\"networkInfo\", \"mac\", { type: \"string\", role: \"info.mac\", write: false });\r\n    \tawait this.ensureState(\"networkInfo\", \"bssid\", { type: \"string\", role: \"info.address\", write: false });\r\n    \tawait this.ensureState(\"networkInfo\", \"rssi\", { type: \"number\", role: \"value.rssi\", write: false, unit: \"dBm\" });\r\n    }\r\n\r\n    @BaseDeviceFeatures.DeviceFeature(Feature.UpdateStatus)\r\n    protected async addUpdateStatusStates(): Promise<void> {\r\n    \tawait this.deps.ensureFolder(`Devices.${this.duid}.updateStatus`);\r\n    \tawait this.ensureState(\"updateStatus\", \"checking\", { type: \"boolean\", role: \"indicator\", write: false });\r\n    \tawait this.ensureState(\"updateStatus\", \"available\", { type: \"boolean\", role: \"indicator\", write: false });\r\n    \tawait this.ensureState(\"updateStatus\", \"progress\", { type: \"number\", role: \"value\", write: false, unit: \"%\" });\r\n    \tawait this.ensureState(\"updateStatus\", \"version\", { type: \"string\", role: \"info.firmware\", write: false });\r\n    \tawait this.ensureState(\"updateStatus\", \"description\", { type: \"string\", role: \"text\", write: false });\r\n    }\r\n\r\n    @BaseDeviceFeatures.DeviceFeature(Feature.SmartModeCommand)\r\n    protected addSmartModeCommand(): void {\r\n    \tthis.addCommand(\"app_set_clean_sequence_type\", {\r\n    \t\ttype: \"json\",\r\n    \t\trole: \"value.list\",\r\n    \t\tdef: '{\"fan_power\":110,\"mop_mode\":306,\"type\":0,\"water_box_mode\":209}',\r\n    \t\tstates: {\r\n    \t\t\t'{\"fan_power\":102,\"mop_mode\":300,\"repeat\":1,\"type\":1,\"water_box_mode\":201}': \"Mop and vacuum\",\r\n    \t\t\t'{\"fan_power\":110,\"mop_mode\":306,\"type\":0,\"water_box_mode\":209}': \"Smart mode\",\r\n    \t\t},\r\n    \t});\r\n    }\r\n\r\n    // --- Complex Update Implementations ---\r\n\r\n    private static readonly MAPPED_CLEAN_SUMMARY: Record<string, string> = { 0: \"clean_time\", 1: \"clean_area\", 2: \"clean_count\", 3: \"records\" };\r\n    private static readonly MAPPED_CLEANING_RECORD_ATTRIBUTE: Record<string, string> = {\r\n    \t0: \"begin\",\r\n    \t1: \"end\",\r\n    \t2: \"duration\",\r\n    \t3: \"area\",\r\n    \t4: \"error\",\r\n    \t5: \"complete\",\r\n    \t6: \"start_type\",\r\n    \t7: \"clean_type\",\r\n    \t8: \"finish_reason\",\r\n    \t9: \"dust_collection_status\",\r\n    };\r\n\r\n    public override async updateRoomMapping(): Promise<void> {\r\n    \ttry {\r\n    \t\tconst result = await this.deps.adapter.requestsHandler.sendRequest(this.duid, \"get_room_mapping\", []);\r\n\r\n    \t\tif (!Array.isArray(result) || result.length === 0) {\r\n    \t\t\treturn;\r\n    \t\t}\r\n\r\n    \t\tlet mapStatus = 0;\r\n    \t\tconst mapStatusState = await this.deps.adapter.getStateAsync(`Devices.${this.duid}.deviceStatus.map_status`);\r\n\r\n    \t\tif (mapStatusState && typeof mapStatusState.val === \"number\") {\r\n    \t\t\tmapStatus = mapStatusState.val;\r\n    \t\t} else {\r\n    \t\t\tconst statusRes = await this.deps.adapter.requestsHandler.sendRequest(this.duid, \"get_prop\", [\"get_status\"]);\r\n    \t\t\tif (Array.isArray(statusRes) && statusRes[0] && typeof statusRes[0] === \"object\" && \"map_status\" in statusRes[0]) {\r\n    \t\t\t\tmapStatus = Number((statusRes[0] as any)[\"map_status\"]);\r\n    \t\t\t}\r\n    \t\t}\r\n\r\n    \t\tconst roomFloor = mapStatus >> 2;\r\n    \t\tconst roomIDs = this.deps.http_api.getMatchedRoomIDs(true);\r\n\r\n    \t\tfor (const item of result) {\r\n    \t\t\tif (!Array.isArray(item) || item.length < 2) continue;\r\n    \t\t\tconst shortID = item[0];\r\n    \t\t\tconst roomID = String(item[1]);\r\n\r\n    \t\t\tconst room = roomIDs.find((r) => String(r.id) === roomID);\r\n    \t\t\tconst roomName = room ? room.name : `Room ${shortID}`;\r\n    \t\t\tconst pathName = `${roomFloor}.${shortID}`;\r\n\r\n    \t\t\tawait this.ensureState(\"floors\", pathName, {\r\n    \t\t\t\tname: roomName,\r\n    \t\t\t\ttype: \"boolean\",\r\n    \t\t\t\trole: \"value\",\r\n    \t\t\t\tdef: true,\r\n    \t\t\t\twrite: true,\r\n    \t\t\t\tread: true\r\n    \t\t\t});\r\n\r\n    \t\t\t// Only set to true if not already set? Old code set it always.\r\n    \t\t\t// Start with true (selected)\r\n    \t\t\tawait this.deps.adapter.setStateChangedAsync(`Devices.${this.duid}.floors.${pathName}`, { val: true, ack: true });\r\n    \t\t}\r\n\r\n    \t\tawait this.ensureState(\"floors\", \"cleanCount\", {\r\n    \t\t\tname: \"Clean count\",\r\n    \t\t\ttype: \"number\",\r\n    \t\t\trole: \"value\",\r\n    \t\t\tdef: 1,\r\n    \t\t\tmin: 1,\r\n    \t\t\tmax: 10,\r\n    \t\t\twrite: true,\r\n    \t\t\tread: true\r\n    \t\t});\r\n    \t} catch (e: any) {\r\n    \t\tthis.deps.log.warn(`[${this.duid}] Failed to update room mapping: ${e.message}`);\r\n    \t}\r\n    }\r\n\r\n\r\n\r\n    public override async getCommandParams(method: string, params?: unknown): Promise<unknown> {\r\n    \tif (method === \"app_segment_clean\") {\r\n    \t\ttry {\r\n    \t\t\tthis.deps.log.debug(`[${this.duid}] Generating params for app_segment_clean...`);\r\n    \t\t\tconst roomList: { segments: number[]; repeat: number } = { segments: [], repeat: 1 };\r\n\r\n    \t\t\t// 1. Get current map/floor\r\n    \t\t\tconst mapStatusState = await this.deps.adapter.getStateAsync(`Devices.${this.duid}.deviceStatus.map_status`);\r\n    \t\t\tlet roomFloor = 0;\r\n    \t\t\tif (mapStatusState && typeof mapStatusState.val === \"number\") {\r\n    \t\t\t\troomFloor = mapStatusState.val >> 2;\r\n    \t\t\t} else {\r\n    \t\t\t\tthis.deps.log.warn(`[${this.duid}] app_segment_clean: map_status not available, assuming floor 0.`);\r\n    \t\t\t}\r\n\r\n    \t\t\t// 2. Get Room Mapping (to know which IDs to check)\r\n    \t\t\t// We use the cached/latest mapping from API because looking up folders is harder without knowing IDs\r\n    \t\t\tconst mappedRoomList = (await this.deps.adapter.requestsHandler.sendRequest(this.duid, \"get_room_mapping\", [], { priority: 1 })) as any[];\r\n\r\n    \t\t\tif (Array.isArray(mappedRoomList)) {\r\n    \t\t\t\tfor (const item of mappedRoomList) {\r\n    \t\t\t\t\t// item: [shortID, roomID]\r\n    \t\t\t\t\tif (!Array.isArray(item) || item.length < 1) continue;\r\n    \t\t\t\t\tconst shortID = item[0];\r\n\r\n    \t\t\t\t\t// 3. Check 'floors.floor.shortID' state\r\n    \t\t\t\t\tconst statePath = `Devices.${this.duid}.floors.${roomFloor}.${shortID}`;\r\n    \t\t\t\t\tconst roomState = await this.deps.adapter.getStateAsync(statePath);\r\n\r\n    \t\t\t\t\tif (roomState && roomState.val === true) {\r\n    \t\t\t\t\t\troomList.segments.push(shortID);\r\n    \t\t\t\t\t}\r\n    \t\t\t\t}\r\n    \t\t\t}\r\n\r\n    \t\t\t// 4. Get Repeat Count\r\n    \t\t\tconst cleanCountState = await this.deps.adapter.getStateAsync(`Devices.${this.duid}.floors.cleanCount`);\r\n    \t\t\tif (cleanCountState && typeof cleanCountState.val === \"number\") {\r\n    \t\t\t\troomList.repeat = cleanCountState.val;\r\n    \t\t\t}\r\n\r\n    \t\t\t// 5. Build Final Params\r\n    \t\t\tif (roomList.segments.length === 0) {\r\n    \t\t\t\tthis.deps.log.warn(`[${this.duid}] app_segment_clean: No rooms selected! Command might be ignored by robot.`);\r\n    \t\t\t} else {\r\n    \t\t\t\tthis.deps.log.info(`[${this.duid}] Starting segment clean for rooms: ${roomList.segments.join(\", \")} (Repeat: ${roomList.repeat})`);\r\n    \t\t\t}\r\n\r\n    \t\t\t// Reset count to 1 after start (from legacy behavior)\r\n    \t\t\tawait this.deps.adapter.setStateAsync(`Devices.${this.duid}.floors.cleanCount`, { val: 1, ack: true });\r\n\r\n    \t\t\t// Roborock expects array of objects? Legacy code: [roomList]\r\n    \t\t\treturn [roomList];\r\n\r\n    \t\t} catch (e: any) {\r\n    \t\t\tthis.deps.log.error(`[${this.duid}] Failed to generate params for app_segment_clean: ${e.message}`);\r\n    \t\t\treturn params; // Fallback\r\n    \t\t}\r\n    \t}\r\n    \treturn params;\r\n    }\r\n\r\n    public override async updateCleanSummary(): Promise<void> {\r\n    \ttry {\r\n    \t\tconst result = await this.deps.adapter.requestsHandler.sendRequest(this.duid, \"get_clean_summary\", [], { priority: 0 });\r\n    \t\tconst cleaningAttributes = result as Record<string, unknown>;\r\n\r\n    \t\tfor (const cleaningAttribute in cleaningAttributes) {\r\n    \t\t\tconst mappedAttribute = BaseVacuumFeatures.MAPPED_CLEAN_SUMMARY[cleaningAttribute] || cleaningAttribute;\r\n    \t\t\tconst cleaningAttributeCommon = this.getCommonCleaningInfo(mappedAttribute);\r\n\r\n    \t\t\tif ([\"clean_time\", \"clean_area\", \"clean_count\"].includes(mappedAttribute)) {\r\n    \t\t\t\tif (cleaningAttributeCommon) (cleaningAttributeCommon as ioBroker.StateCommon).type = \"number\";\r\n\r\n    \t\t\t\tawait this.deps.ensureState(`Devices.${this.duid}.cleaningInfo.${mappedAttribute}`, cleaningAttributeCommon || {});\r\n    \t\t\t\tawait this.deps.adapter.setStateChangedAsync(`Devices.${this.duid}.cleaningInfo.${mappedAttribute}`, {\r\n    \t\t\t\t\tval: cleaningAttributes[cleaningAttribute] as ioBroker.StateValue,\r\n    \t\t\t\t\tack: true,\r\n    \t\t\t\t});\r\n    \t\t\t} else if (mappedAttribute == \"records\") {\r\n    \t\t\t\tawait this.deps.ensureFolder(`Devices.${this.duid}.cleaningInfo.records`);\r\n    \t\t\t\tconst recordsList = cleaningAttributes[cleaningAttribute] as Record<string, number>;\r\n    \t\t\t\tconst cleaningRecordsJSON: unknown[] = [];\r\n\r\n    \t\t\t\t// Process records sequentially\r\n    \t\t\t\tfor (const cleaningRecord in recordsList) {\r\n    \t\t\t\t\tconst cleaningRecordID = recordsList[cleaningRecord];\r\n\r\n    \t\t\t\t\ttry {\r\n    \t\t\t\t\t\tawait this.deps.ensureFolder(`Devices.${this.duid}.cleaningInfo.records.${cleaningRecord}`);\r\n\r\n    \t\t\t\t\t\tconst cleaningRecordAttributesArr = (await this.deps.adapter.requestsHandler.sendRequest(this.duid, \"get_clean_record\", [cleaningRecordID], { priority: 0 })) as unknown[];\r\n    \t\t\t\t\t\tconst cleaningRecordAttributes = cleaningRecordAttributesArr[0] as Record<string, unknown>;\r\n\r\n    \t\t\t\t\t\tcleaningRecordsJSON[parseInt(cleaningRecord)] = cleaningRecordAttributes;\r\n\r\n    \t\t\t\t\t\tconst cleaningRecordCommon = this.getCommonCleaningRecords(mappedAttribute);\r\n    \t\t\t\t\t\tif (cleaningRecordCommon) {\r\n    \t\t\t\t\t\t\tfor (const cleaningRecordAttribute in cleaningRecordAttributes) {\r\n    \t\t\t\t\t\t\t\tconst mappedRecordAttribute = BaseVacuumFeatures.MAPPED_CLEANING_RECORD_ATTRIBUTE[cleaningRecordAttribute] || cleaningRecordAttribute;\r\n    \t\t\t\t\t\t\t\tlet val = cleaningRecordAttributes[cleaningRecordAttribute];\r\n\r\n    \t\t\t\t\t\t\t\tif ([\"begin\", \"end\"].includes(mappedRecordAttribute)) {\r\n    \t\t\t\t\t\t\t\t\tval = new Date((val as number) * 1000).toString();\r\n    \t\t\t\t\t\t\t\t} else if (mappedRecordAttribute == \"duration\") {\r\n    \t\t\t\t\t\t\t\t\tval = Math.round((val as number) / 60);\r\n    \t\t\t\t\t\t\t\t}\r\n\r\n    \t\t\t\t\t\t\t\tawait this.deps.ensureState(`Devices.${this.duid}.cleaningInfo.records.${cleaningRecord}.${mappedRecordAttribute}`, cleaningRecordCommon);\r\n    \t\t\t\t\t\t\t\tawait this.deps.adapter.setStateChangedAsync(`Devices.${this.duid}.cleaningInfo.records.${cleaningRecord}.${mappedRecordAttribute}`, {\r\n    \t\t\t\t\t\t\t\t\tval: val as ioBroker.StateValue,\r\n    \t\t\t\t\t\t\t\t\tack: true,\r\n    \t\t\t\t\t\t\t\t});\r\n    \t\t\t\t\t\t\t}\r\n    \t\t\t\t\t\t}\r\n\r\n    \t\t\t\t\t\tif (this.deps.config.enable_map_creation == true) {\r\n    \t\t\t\t\t\t\tconst mapArray = await this.getCleaningRecordMap(recordsList[cleaningRecord]);\r\n    \t\t\t\t\t\t\tif (mapArray) {\r\n    \t\t\t\t\t\t\t\tawait this.deps.ensureState(`Devices.${this.duid}.cleaningInfo.records.${cleaningRecord}.map.mapData`, {\r\n    \t\t\t\t\t\t\t\t\tname: \"Map Data JSON\",\r\n    \t\t\t\t\t\t\t\t\ttype: \"string\",\r\n    \t\t\t\t\t\t\t\t\trole: \"json\",\r\n    \t\t\t\t\t\t\t\t});\r\n    \t\t\t\t\t\t\t\tawait this.deps.adapter.setStateChangedAsync(`Devices.${this.duid}.cleaningInfo.records.${cleaningRecord}.map.mapData`, { val: mapArray.mapData, ack: true });\r\n\r\n    \t\t\t\t\t\t\t\tawait this.deps.ensureState(`Devices.${this.duid}.cleaningInfo.records.${cleaningRecord}.map.mapBase64`, {\r\n    \t\t\t\t\t\t\t\t\tname: \"Map Image (Full, Uncropped)\",\r\n    \t\t\t\t\t\t\t\t\ttype: \"string\",\r\n    \t\t\t\t\t\t\t\t\trole: \"text.png\",\r\n    \t\t\t\t\t\t\t\t});\r\n    \t\t\t\t\t\t\t\tawait this.deps.adapter.setStateChangedAsync(`Devices.${this.duid}.cleaningInfo.records.${cleaningRecord}.map.mapBase64`, { val: mapArray.mapBase64, ack: true });\r\n\r\n    \t\t\t\t\t\t\t\tawait this.deps.ensureState(`Devices.${this.duid}.cleaningInfo.records.${cleaningRecord}.map.mapBase64Truncated`, {\r\n    \t\t\t\t\t\t\t\t\tname: \"Map Image (Full, Cropped)\",\r\n    \t\t\t\t\t\t\t\t\ttype: \"string\",\r\n    \t\t\t\t\t\t\t\t\trole: \"text.png\",\r\n    \t\t\t\t\t\t\t\t});\r\n    \t\t\t\t\t\t\t\tawait this.deps.adapter.setStateChangedAsync(`Devices.${this.duid}.cleaningInfo.records.${cleaningRecord}.map.mapBase64Truncated`, {\r\n    \t\t\t\t\t\t\t\t\tval: mapArray.mapBase64Truncated,\r\n    \t\t\t\t\t\t\t\t\tack: true,\r\n    \t\t\t\t\t\t\t\t});\r\n    \t\t\t\t\t\t\t}\r\n    \t\t\t\t\t\t}\r\n    \t\t\t\t\t} catch (e: any) {\r\n    \t\t\t\t\t\tthis.deps.log.warn(`[${this.duid}] Failed to process cleaning record ${cleaningRecordID}: ${e.message}`);\r\n    \t\t\t\t\t}\r\n    \t\t\t\t}\r\n\r\n    \t\t\t\tawait this.deps.ensureState(`Devices.${this.duid}.cleaningInfo.records.json`, { name: \"Cleaning Records JSON\", type: \"string\", role: \"json\" });\r\n    \t\t\t\tawait this.deps.adapter.setStateChangedAsync(`Devices.${this.duid}.cleaningInfo.records.json`, { val: JSON.stringify(cleaningRecordsJSON), ack: true });\r\n    \t\t\t}\r\n    \t\t}\r\n    \t} catch (e: any) {\r\n    \t\tthis.deps.log.warn(`[${this.duid}] Failed to update clean summary: ${e.message}`);\r\n    \t}\r\n    }\r\n\r\n    private async getCleaningRecordMap(startTime: number): Promise<{ mapBase64CleanUncropped: string; mapBase64: string; mapBase64Truncated: string; mapData: string } | null> {\r\n    \ttry {\r\n    \t\tconst cleaningRecordMap = (await this.deps.adapter.requestsHandler.sendRequest(this.duid, \"get_clean_record_map\", { start_time: startTime }, { priority: 0 })) as Buffer;\r\n\r\n    \t\tif (!Buffer.isBuffer(cleaningRecordMap)) {\r\n    \t\t\treturn null;\r\n    \t\t}\r\n\r\n    \t\t// Check if map is gzipped (starts with 0x1f 0x8b)\r\n    \t\tlet mapBuf: Buffer = cleaningRecordMap;\r\n    \t\tif (cleaningRecordMap[0] === 0x1f && cleaningRecordMap[1] === 0x8b) {\r\n    \t\t\ttry {\r\n    \t\t\t\tconst { promisify } = require(\"util\");\r\n    \t\t\t\tconst { gunzip } = require(\"zlib\");\r\n    \t\t\t\tconst gunzipAsync = promisify(gunzip);\r\n    \t\t\t\tmapBuf = await gunzipAsync(cleaningRecordMap);\r\n    \t\t\t} catch (e) {\r\n    \t\t\t\tthis.deps.log.error(`[${this.duid}] Failed to unzip map data: ${e}`);\r\n    \t\t\t\treturn null;\r\n    \t\t\t}\r\n    \t\t}\r\n\r\n    \t\tconst mapData = await this.deps.adapter.requestsHandler.mapParser.parsedata(mapBuf, null, { isHistoryMap: true });\r\n    \t\tif (!mapData) {\r\n    \t\t\treturn null;\r\n    \t\t}\r\n\r\n    \t\t// Generate images\r\n    \t\tconst [mapBase64CleanUncropped, mapBase64, mapBase64Truncated] = await this.deps.adapter.requestsHandler.mapCreator.canvasMap(mapData);\r\n\r\n    \t\treturn {\r\n    \t\t\tmapBase64CleanUncropped,\r\n    \t\t\tmapBase64,\r\n    \t\t\tmapBase64Truncated,\r\n    \t\t\tmapData: JSON.stringify(mapData),\r\n    \t\t};\r\n    \t} catch (e: any) {\r\n    \t\tthis.deps.log.warn(`[${this.duid}] Failed to get cleaning record map: ${e.message}`);\r\n    \t\treturn null;\r\n    \t}\r\n    }\r\n\r\n    public override async updateMap(): Promise<void> {\r\n    \ttry {\r\n    \t\tconst result = await this.deps.adapter.requestsHandler.sendRequest(this.duid, \"get_map_v1\", [], { priority: 0 });\r\n    \t\tconst map = result as Buffer;\r\n\r\n    \t\tif (!Buffer.isBuffer(map)) {\r\n    \t\t\treturn;\r\n    \t\t}\r\n\r\n    \t\t// Check if map is gzipped\r\n    \t\tlet mapBuf: Buffer = map;\r\n    \t\tif (map[0] === 0x1f && map[1] === 0x8b) {\r\n    \t\t\ttry {\r\n    \t\t\t\tconst { promisify } = require(\"util\");\r\n    \t\t\t\tconst { gunzip } = require(\"zlib\");\r\n    \t\t\t\tconst gunzipAsync = promisify(gunzip);\r\n    \t\t\t\tmapBuf = await gunzipAsync(map);\r\n    \t\t\t} catch (e) {\r\n    \t\t\t\tthis.deps.log.error(`[${this.duid}] Failed to unzip map data: ${e}`);\r\n    \t\t\t\treturn;\r\n    \t\t\t}\r\n    \t\t}\r\n\r\n    \t\tconst mapData = await this.deps.adapter.requestsHandler.mapParser.parsedata(mapBuf, null);\r\n    \t\tif (mapData) {\r\n    \t\t\t// Update map states\r\n    \t\t\tawait this.deps.ensureState(`Devices.${this.duid}.map.mapData`, { name: \"Map Data\", type: \"string\", role: \"json\" });\r\n    \t\t\tawait this.deps.adapter.setStateChangedAsync(`Devices.${this.duid}.map.mapData`, { val: JSON.stringify(mapData), ack: true });\r\n\r\n    \t\t\tconst [, mapBase64] = await this.deps.adapter.requestsHandler.mapCreator.canvasMap(mapData);\r\n    \t\t\tawait this.deps.ensureState(`Devices.${this.duid}.map.mapBase64`, { name: \"Map Image\", type: \"string\", role: \"text.png\" });\r\n    \t\t\tawait this.deps.adapter.setStateChangedAsync(`Devices.${this.duid}.map.mapBase64`, { val: mapBase64, ack: true });\r\n    \t\t}\r\n    \t} catch (e: any) {\r\n    \t\tthis.deps.log.warn(`[${this.duid}] Failed to update map: ${e.message}`);\r\n    \t}\r\n    }\r\n\r\n    public override async updateExtraStatus(): Promise<void> {\r\n    \tconst robotModel = this.deps.adapter.http_api.getRobotModel(this.duid);\r\n    \tswitch (robotModel) {\r\n    \t\tcase \"roborock.vacuum.s4\":\r\n    \t\tcase \"roborock.vacuum.s5\":\r\n    \t\tcase \"roborock.vacuum.s5e\":\r\n    \t\tcase \"roborock.vacuum.a08\":\r\n    \t\tcase \"roborock.vacuum.a10\":\r\n    \t\tcase \"roborock.vacuum.a40\":\r\n    \t\t\t// No extra params needed\r\n    \t\t\tbreak;\r\n    \t\tcase \"roborock.vacuum.s6\":\r\n    \t\tcase \"roborock.vacuum.a72\":\r\n    \t\t\tawait this.requestAndProcess(\"get_carpet_mode\", [], \"deviceStatus\");\r\n    \t\t\tbreak;\r\n    \t\tcase \"roborock.vacuum.a27\":\r\n    \t\t\tawait this.requestAndProcess(\"get_dust_collection_switch_status\", [], \"deviceStatus\");\r\n    \t\t\tawait this.requestAndProcess(\"get_wash_towel_mode\", [], \"deviceStatus\");\r\n    \t\t\tawait this.requestAndProcess(\"get_smart_wash_params\", [], \"deviceStatus\");\r\n    \t\t\tawait this.requestAndProcess(\"app_get_dryer_setting\", [], \"deviceStatus\");\r\n    \t\t\tbreak;\r\n    \t\tdefault:\r\n    \t\t\t// Assume newer models, try to get all\r\n    \t\t\tawait this.requestAndProcess(\"get_carpet_mode\", [], \"deviceStatus\");\r\n    \t\t\tawait this.requestAndProcess(\"get_carpet_clean_mode\", [], \"deviceStatus\");\r\n    \t\t\tawait this.requestAndProcess(\"get_water_box_custom_mode\", [], \"deviceStatus\");\r\n    \t}\r\n    }\r\n\r\n    public override async getPhoto(imgId: string, type: number): Promise<any> {\r\n    \tconst requestParams = {\r\n    \t\tdata_filter: {\r\n    \t\t\timg_id: imgId,\r\n    \t\t\ttype: type,\r\n    \t\t},\r\n    \t};\r\n    \treturn this.deps.adapter.requestsHandler.sendRequest(this.duid, \"get_photo\", requestParams, { priority: 0 });\r\n    }\r\n\r\n    @BaseDeviceFeatures.DeviceFeature(Feature.isShakeMopSetSupported)\r\n    @BaseDeviceFeatures.DeviceFeature(Feature.isVideoMonitorSupported)\r\n    @BaseDeviceFeatures.DeviceFeature(Feature.isVideoSettingSupported)\r\n    @BaseDeviceFeatures.DeviceFeature(Feature.isPhotoUploadSupported)\r\n    @BaseDeviceFeatures.DeviceFeature(Feature.isBackChargeAutoWashSupported)\r\n    public async updateMultiMapsList(): Promise<void> {\r\n    \ttry {\r\n    \t\tconst result = await this.deps.adapter.requestsHandler.sendRequest(this.duid, \"get_multi_maps_list\", []);\r\n    \t\tlet mapInfo: any[] = [];\r\n\r\n    \t\tif (Array.isArray(result) && result[0] && result[0].map_info) {\r\n    \t\t\tmapInfo = result[0].map_info;\r\n    \t\t} else if (typeof result === \"object\" && (result as any).map_info) {\r\n    \t\t\tmapInfo = (result as any).map_info;\r\n    \t\t}\r\n\r\n    \t\tif (mapInfo.length > 0) {\r\n    \t\t\tawait this.deps.ensureFolder(`Devices.${this.duid}.floors`);\r\n\r\n    \t\t\tfor (const map of mapInfo) {\r\n    \t\t\t\tconst mapFlag = map.mapFlag;\r\n    \t\t\t\tconst name = map.name || `Map ${mapFlag}`;\r\n    \t\t\t\tconst formattedTime = map.add_time ? new Date(map.add_time * 1000).toLocaleString() : \"Unknown\";\r\n\r\n    \t\t\t\t// Create folder for this floor (using mapFlag as stable ID)\r\n    \t\t\t\tawait this.deps.ensureFolder(`Devices.${this.duid}.floors.${mapFlag}`);\r\n    \t\t\t\tawait this.deps.adapter.extendObjectAsync(`Devices.${this.duid}.floors.${mapFlag}`, { common: { name } });\r\n\r\n    \t\t\t\t// Create States\r\n    \t\t\t\tawait this.ensureState(`floors.${mapFlag}`, \"name\", { name: \"Floor Name\", type: \"string\", write: false });\r\n    \t\t\t\tawait this.deps.adapter.setStateChangedAsync(`Devices.${this.duid}.floors.${mapFlag}.name`, { val: name, ack: true });\r\n\r\n    \t\t\t\tawait this.ensureState(`floors.${mapFlag}`, \"mapFlag\", { name: \"Map Flag\", type: \"number\", write: false });\r\n    \t\t\t\tawait this.deps.adapter.setStateChangedAsync(`Devices.${this.duid}.floors.${mapFlag}.mapFlag`, { val: mapFlag, ack: true });\r\n\r\n    \t\t\t\tawait this.ensureState(`floors.${mapFlag}`, \"add_time\", { name: \"Created At\", type: \"string\", write: false });\r\n    \t\t\t\tawait this.deps.adapter.setStateChangedAsync(`Devices.${this.duid}.floors.${mapFlag}.add_time`, { val: formattedTime, ack: true });\r\n\r\n    \t\t\t\t// Load Button\r\n    \t\t\t\tawait this.ensureState(`floors.${mapFlag}`, \"load\", { name: \"Load Map\", type: \"boolean\", role: \"button\", write: true, def: false });\r\n    \t\t\t}\r\n    \t\t} else {\r\n    \t\t\t// Fallback to default behavior if no map info (or empty)\r\n    \t\t\tawait super.updateMultiMapsList();\r\n    \t\t}\r\n    \t} catch (e: any) {\r\n    \t\tthis.deps.log.warn(`[${this.duid}] Failed to update floors/multi-maps: ${e.message}`);\r\n    \t}\r\n    }\r\n\r\n    @BaseDeviceFeatures.DeviceFeature(Feature.isSupportFDSEndPoint)\r\n    @BaseDeviceFeatures.DeviceFeature(Feature.isSupportAutoSplitSegments)\r\n    @BaseDeviceFeatures.DeviceFeature(Feature.isSupportOrderSegmentClean)\r\n    @BaseDeviceFeatures.DeviceFeature(Feature.isMapSegmentSupported)\r\n    @BaseDeviceFeatures.DeviceFeature(Feature.isSupportLedStatusSwitch)\r\n    @BaseDeviceFeatures.DeviceFeature(Feature.isSupportFetchTimerSummary)\r\n    @BaseDeviceFeatures.DeviceFeature(Feature.isOrderCleanSupported)\r\n    @BaseDeviceFeatures.DeviceFeature(Feature.isRemoteSupported)\r\n    @BaseDeviceFeatures.DeviceFeature(Feature.isSupportTaskId)\r\n    protected placeholderFeatures(): void {\r\n    \t// No-op: These features are detected but require no specific initialization logic\r\n    \tthis.deps.log.silly(`[${this.duid}] Placeholder feature initialized.`);\r\n    }\r\n}\r\n"]}