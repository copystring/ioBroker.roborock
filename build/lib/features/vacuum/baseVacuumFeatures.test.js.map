{"version":3,"file":"baseVacuumFeatures.test.js","sourceRoot":"","sources":["../../../../src/lib/features/vacuum/baseVacuumFeatures.test.ts"],"names":[],"mappings":"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","sourcesContent":["import { expect } from \"chai\";\r\nimport { BaseDeviceFeatures } from \"../baseDeviceFeatures\";\r\nimport \"./index\"; // Register all models\r\nimport { BaseVacuumFeatures } from \"./baseVacuumFeatures\";\r\n\r\n// Mock dependencies\r\nconst mockDependencies: any = {\r\n\tadapter: {\r\n\t\tlog: {\r\n\t\t\tdebug: () => {},\r\n\t\t\tinfo: () => {},\r\n\t\t\twarn: () => {},\r\n\t\t\terror: () => {},\r\n\t\t\tsilly: () => {},\r\n\t\t},\r\n\t\tconfig: {},\r\n\t\tensureState: () => Promise.resolve(),\r\n\t\tensureFolder: () => Promise.resolve(),\r\n\t},\r\n\tlog: {\r\n\t\tdebug: () => {},\r\n\t\tinfo: () => {},\r\n\t\twarn: () => {},\r\n\t\terror: () => {},\r\n\t\tsilly: () => {},\r\n\t},\r\n};\r\n\r\ndescribe(\"BaseVacuumFeatures - Model Configuration Integrity\", () => {\r\n\tconst registeredModels = BaseDeviceFeatures.getRegisteredModels();\r\n\r\n\tit(\"should have registered models\", () => {\r\n\t\texpect(registeredModels.length).to.be.greaterThan(0);\r\n\t});\r\n\r\n\tit(\"should have valid configuration for all registered models\", () => {\r\n\t\tconst errors: string[] = [];\r\n\t\tregisteredModels.forEach((modelId) => {\r\n\t\t\ttry {\r\n\t\t\t\tconst ModelClass = BaseDeviceFeatures.getRegisteredModelClass(modelId);\r\n\t\t\t\texpect(ModelClass).to.not.be.undefined;\r\n\t\t\t\t// @ts-ignore\r\n\t\t\t\tconst instance = new ModelClass(mockDependencies, \"test_duid\");\r\n\r\n\t\t\t\t// 1. Instance Check\r\n\t\t\t\texpect(instance).to.be.instanceOf(BaseVacuumFeatures);\r\n\r\n\t\t\t\t// 2. Static Features Check\r\n\t\t\t\t// Access protected config via any\r\n\t\t\t\tconst config = (instance as any).config;\r\n\t\t\t\texpect(config).to.exist;\r\n\t\t\t\texpect(config.staticFeatures).to.be.an(\"array\");\r\n\r\n\t\t\t\t// 3. Duplicate Features Check\r\n\t\t\t\tconst features = config.staticFeatures;\r\n\t\t\t\tconst uniqueFeatures = new Set(features);\r\n\t\t\t\tif (features.length !== uniqueFeatures.size) {\r\n\t\t\t\t\tthrow new Error(`Duplicate features found: ${features.filter((item: any, index: number) => features.indexOf(item) !== index)}`);\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// 4. Profile Check\r\n\t\t\t\tconst profile = (instance as any).profile;\r\n\t\t\t\texpect(profile).to.exist;\r\n\t\t\t\texpect(profile.mappings).to.exist;\r\n\t\t\t\texpect(profile.features).to.exist;\r\n\t\t\t} catch (e: any) {\r\n\t\t\t\terrors.push(`Model ${modelId}: ${e.message}`);\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tif (errors.length > 0) {\r\n\t\t\tthrow new Error(`Model configuration errors:\\n${errors.join(\"\\n\")}`);\r\n\t\t}\r\n\t});\r\n});\r\n"]}