{"version":3,"file":"b01VacuumFeatures.js","sourceRoot":"","sources":["../../../../src/lib/features/vacuum/b01VacuumFeatures.ts"],"names":[],"mappings":"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","sourcesContent":["import { V1VacuumFeatures, VacuumProfile } from \"./v1VacuumFeatures\";\r\nimport { FeatureDependencies, DeviceModelConfig } from \"../baseDeviceFeatures\";\r\nimport { Feature } from \"../features.enum\";\r\n\r\nexport class B01VacuumFeatures extends V1VacuumFeatures {\r\n\r\n\tconstructor(\r\n\t\tdependencies: FeatureDependencies,\r\n\t\tduid: string,\r\n\t\trobotModel: string,\r\n\t\tconfig: DeviceModelConfig,\r\n\t\tprofile?: VacuumProfile\r\n\t) {\r\n\t\tsuper(dependencies, duid, robotModel, config, profile);\r\n\t\tthis.deps.adapter.rLog(\"System\", this.duid, \"Info\", \"B01\", undefined, `Constructing B01VacuumFeatures for ${robotModel}`, \"info\");\r\n\t}\r\n\r\n\r\n\r\n\t// Override updateStatus to use strict B01 prop.get\r\n\tpublic override async setupProtocolFeatures(): Promise<void> {\r\n\t\tthis.deps.adapter.rLog(\"System\", this.duid, \"Debug\", \"B01\", undefined, \"Configuring B01 Command Set...\", \"debug\");\r\n\r\n\t\t// 1. Blacklist/Clear static features to prevent auto-re-population\r\n\t\t// B01 devices typically don't use the standard Vacuum features like 'Timers' or 'Consumables' in the same way,\r\n\t\t// or at least we don't want the standard commands for them.\r\n\t\t// We explicitly allow only what we implemented or know works.\r\n\t\tconst allowedFeatures = [\r\n\t\t\tFeature.FirmwareInfo, // Used for FW version\r\n\t\t\tFeature.MultiMap, // Used for floor list\r\n\t\t\tFeature.RoomMapping // Used for room names\r\n\t\t];\r\n\t\tthis.config.staticFeatures = this.config.staticFeatures.filter(f => allowedFeatures.includes(f));\r\n\r\n\r\n\r\n\r\n\t\t// 3. Add B01 Specific Protocol Commands\r\n\t\tconst properties = [\r\n\t\t\t\"wind\", \"water\", \"clean_mode\", \"status\", \"error_code\", \"battery\",\r\n\t\t\t\"clean_time\", \"clean_area\", \"map_status\", \"dock_status\", \"water_box_level_off\", \"dust_collection_status\"\r\n\t\t];\r\n\t\tconst propStates: Record<string, string> = {};\r\n\t\tproperties.forEach(p => propStates[p] = p);\r\n\r\n\t\tthis.addCommand(\"prop.get\", {\r\n\t\t\ttype: \"string\",\r\n\t\t\trole: \"text\",\r\n\t\t\tname: \"Property Get\",\r\n\t\t\tdef: \"status\",\r\n\t\t\tstates: propStates\r\n\t\t});\r\n\r\n\t\tthis.addCommand(\"prop.set\", {\r\n\t\t\ttype: \"json\",\r\n\t\t\trole: \"json\",\r\n\t\t\tname: \"Direct Property Set\",\r\n\t\t\tdef: '{\"status\": 1}',\r\n\t\t\tstates: {\r\n\t\t\t\t'{\"status\": 1}': \"Start Cleaning\",\r\n\t\t\t\t'{\"status\": 2}': \"Pause\",\r\n\t\t\t\t'{\"status\": 3}': \"Stop\",\r\n\t\t\t\t'{\"status\": 4}': \"Return to Dock\",\r\n\t\t\t\t'{\"wind\": 101}': \"Fan: Quiet\",\r\n\t\t\t\t'{\"wind\": 102}': \"Fan: Balanced\",\r\n\t\t\t\t'{\"wind\": 103}': \"Fan: Turbo\",\r\n\t\t\t\t'{\"wind\": 104}': \"Fan: Max\",\r\n\t\t\t\t'{\"water\": 201}': \"Water: Mild\",\r\n\t\t\t\t'{\"water\": 202}': \"Water: Moderate\",\r\n\t\t\t\t'{\"water\": 203}': \"Water: Intense\"\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tthis.addCommand(\"service\", {\r\n\t\t\ttype: \"json\",\r\n\t\t\trole: \"json\",\r\n\t\t\tname: \"Direct Service Call\",\r\n\t\t\tdef: '{\"method\": \"upload_by_maptype\", \"params\": {\"force\": 1, \"map_type\": 0}}',\r\n\t\t\tstates: {\r\n\t\t\t\t'{\"method\": \"upload_by_maptype\", \"params\": {\"force\": 1, \"map_type\": 0}}': \"Update Map\",\r\n\t\t\t\t'{\"method\": \"reset_consumable\", \"params\": {\"main_brush_life\": 100}}': \"Reset Main Brush\",\r\n\t\t\t\t'{\"method\": \"reset_consumable\", \"params\": {\"side_brush_life\": 100}}': \"Reset Side Brush\",\r\n\t\t\t\t'{\"method\": \"reset_consumable\", \"params\": {\"filter_life\": 100}}': \"Reset Filter\",\r\n\t\t\t\t'{\"method\": \"get_custom_voice\", \"params\": {}}': \"Get Custom Voice Info\"\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tconst cmds = Object.keys(this.commands);\r\n\t\tthis.deps.adapter.rLog(\"System\", this.duid, \"Info\", \"B01\", undefined, `B01 Protocol Enforced. Commands in memory: ${cmds.join(\", \")}`, \"info\");\r\n\t}\r\n\r\n\tpublic override async initializeDeviceData(): Promise<void> {\r\n\t\tawait this.updateStatus();\r\n\t\tawait Promise.all([\r\n\t\t\tthis.updateFirmwareFeatures(),\r\n\t\t\tthis.updateMultiMapsList(),\r\n\t\t\tthis.updateRoomMapping(),\r\n\t\t]);\r\n\r\n\t\tawait this.deps.adapter.checkForNewFirmware(this.duid);\r\n\r\n\t\t// Model-specific requests\r\n\t\tawait this.updateExtraStatus();\r\n\r\n\t\t// Initial Map\r\n\t\tawait this.updateMap();\r\n\t}\r\n\r\n\t// Override updateStatus to use strict B01 prop.get\r\n\tpublic override async updateStatus(): Promise<void> {\r\n\t\tconst props = V1VacuumFeatures.CONSTANTS.b01StatusProps;\r\n\t\tlet resultObj: Record<string, any> | undefined;\r\n\r\n\t\ttry {\r\n\t\t\tconst result = await this.deps.adapter.requestsHandler.sendRequest(this.duid, \"prop.get\", { property: props });\r\n\r\n\t\t\tif (Array.isArray(result) && result.length === props.length) {\r\n\t\t\t\tresultObj = {};\r\n\t\t\t\tprops.forEach((key: string, index: number) => {\r\n                    resultObj![key] = result[index];\r\n\t\t\t\t});\r\n\t\t\t} else if (typeof result === \"object\" && result !== null) {\r\n\t\t\t\tresultObj = result;\r\n\t\t\t}\r\n\r\n\t\t\tif (resultObj) {\r\n\t\t\t\tawait this.processStatus(resultObj);\r\n\t\t\t\t// B01: Features are static/protocol-defined, skipping dynamic detection\r\n\t\t\t}\r\n\t\t} catch (e: any) {\r\n\t\t\tthis.deps.adapter.rLog(\"System\", this.duid, \"Warn\", undefined, undefined, `Failed to update status (B01): ${e.message}`, \"warn\");\r\n\t\t}\r\n\t}\r\n\r\n\t// Override updateConsumables to use strict B01 prop.get\r\n\tpublic override async updateConsumables(data?: any): Promise<void> {\r\n\t\tlet resultObj: Record<string, any> | undefined;\r\n\r\n\t\tif (data) {\r\n\t\t\tresultObj = data;\r\n\t\t} else {\r\n    \t\tconst props = V1VacuumFeatures.CONSTANTS.b01SettingsProps;\r\n    \t\tconst result = await this.deps.adapter.requestsHandler.sendRequest(this.duid, \"prop.get\", { property: props });\r\n    \t\tif (Array.isArray(result) && result.length === props.length) {\r\n    \t\t\tresultObj = {};\r\n    \t\t\tprops.forEach((key: string, index: number) => {\r\n    \t\t\t\tresultObj![key] = result[index];\r\n    \t\t\t});\r\n    \t\t} else if (typeof result === \"object\" && result !== null) {\r\n    \t\t\tresultObj = result as Record<string, any>;\r\n    \t\t}\r\n\t\t}\r\n\r\n\t\tif (resultObj) {\r\n\t\t\tawait this.processConsumables(resultObj);\r\n\t\t}\r\n\t}\r\n\r\n\t// Override updateMap to use B01 service call\r\n\tpublic override async updateMap(): Promise<void> {\r\n\t\ttry {\r\n\t\t\t// Trigger map push (Protocol 301)\r\n\t\t\tawait this.deps.adapter.requestsHandler.sendRequest(this.duid, \"service.upload_by_maptype\", {\r\n\t\t\t\tforce: 1,\r\n\t\t\t\tmap_type: 0\r\n\t\t\t});\r\n\t\t\tthis.deps.adapter.rLog(\"System\", this.duid, \"Debug\", \"B01\", undefined, \"Triggered B01 Map update via service.upload_by_maptype\", \"debug\");\r\n\r\n\t\t\t// Pending Request to handle the async 301 push\r\n\t\t\tconst dummyId = -Math.floor(Math.random() * 1000000);\r\n\r\n\t\t\tthis.deps.adapter.pendingRequests.set(dummyId, {\r\n\t\t\t\tmethod: \"get_map_v1\",\r\n\t\t\t\tduid: this.duid,\r\n\t\t\t\tresolve: (data: any) => {\r\n\t\t\t\t\tthis.deps.adapter.pendingRequests.delete(dummyId);\r\n\t\t\t\t\tif (Buffer.isBuffer(data)) {\r\n\t\t\t\t\t\tconst device = this.deps.adapter.http_api.getDevices().find(d => d.duid === this.duid);\r\n\t\t\t\t\t\tconst sn = device?.sn || this.duid;\r\n\r\n\t\t\t\t\t\tthis.mapManager.processMap(data, \"B01\", this.robotModel, sn, this.mappedRooms, this.duid, \"MQTT\")\r\n\t\t\t\t\t\t\t.then(async (res) => {\r\n\t\t\t\t\t\t\t\tif (res) {\r\n\t\t\t\t\t\t\t\t\tconst { mapBase64, mapBase64Truncated, mapData } = res as any;\r\n\t\t\t\t\t\t\t\t\tawait this.deps.ensureState(`Devices.${this.duid}.map.mapBase64`, {\r\n\t\t\t\t\t\t\t\t\t\tname: \"Map Image\",\r\n\t\t\t\t\t\t\t\t\t\ttype: \"string\",\r\n\t\t\t\t\t\t\t\t\t\trole: \"text.png\",\r\n\t\t\t\t\t\t\t\t\t\tread: true,\r\n\t\t\t\t\t\t\t\t\t\twrite: false\r\n\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t\tawait this.deps.adapter.setStateChangedAsync(`Devices.${this.duid}.map.mapBase64`, { val: mapBase64, ack: true });\r\n\r\n\t\t\t\t\t\t\t\t\tawait this.deps.ensureState(`Devices.${this.duid}.map.mapBase64Truncated`, {\r\n\t\t\t\t\t\t\t\t\t\tname: \"Map Image Truncated\",\r\n\t\t\t\t\t\t\t\t\t\ttype: \"string\",\r\n\t\t\t\t\t\t\t\t\t\trole: \"text.png\",\r\n\t\t\t\t\t\t\t\t\t\tread: true,\r\n\t\t\t\t\t\t\t\t\t\twrite: false\r\n\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t\tawait this.deps.adapter.setStateChangedAsync(`Devices.${this.duid}.map.mapBase64Truncated`, { val: mapBase64Truncated, ack: true });\r\n\r\n\t\t\t\t\t\t\t\t\tawait this.deps.ensureState(`Devices.${this.duid}.map.mapData`, {\r\n\t\t\t\t\t\t\t\t\t\tname: \"Map Data\",\r\n\t\t\t\t\t\t\t\t\t\ttype: \"string\",\r\n\t\t\t\t\t\t\t\t\t\trole: \"json\",\r\n\t\t\t\t\t\t\t\t\t\tread: true,\r\n\t\t\t\t\t\t\t\t\t\twrite: false\r\n\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t\tawait this.deps.adapter.setStateChangedAsync(`Devices.${this.duid}.map.mapData`, { val: JSON.stringify(mapData), ack: true });\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}).catch(err => {\r\n\t\t\t\t\t\t\t\tthis.deps.adapter.rLog(\"System\", this.duid, \"Error\", undefined, undefined, `Failed to process B01 map: ${err}`, \"error\");\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\treject: () => { }\r\n\t\t\t});\r\n\r\n\t\t\tthis.deps.adapter.setTimeout(() => {\r\n\t\t\t\tif (this.deps.adapter.pendingRequests.has(dummyId)) {\r\n\t\t\t\t\tthis.deps.adapter.pendingRequests.delete(dummyId);\r\n\t\t\t\t}\r\n\t\t\t}, 15000);\r\n\r\n\t\t} catch (e: any) {\r\n\t\t\tthis.deps.adapter.rLog(\"System\", this.duid, \"Warn\", undefined, undefined, `Failed to trigger B01 map update: ${e.message}`, \"warn\");\r\n\t\t}\r\n\t}\r\n\r\n\tpublic override async updateCleanSummary(): Promise<void> {\r\n\t\ttry {\r\n\t\t\tconst summaryRes = await this.deps.adapter.requestsHandler.sendRequest(this.duid, \"service.get_record_list\", {}, { priority: -10 });\r\n\t\t\tif (summaryRes) {\r\n\t\t\t\tawait this.processCleanSummary(summaryRes);\r\n\t\t\t}\r\n\t\t} catch (e: any) {\r\n\t\t\tthis.deps.adapter.rLog(\"System\", this.duid, \"Warn\", \"B01\", undefined, `Failed to update B01 clean summary: ${e.message}`, \"warn\");\r\n\t\t}\r\n\t}\r\n\r\n\t// Override getCleaningRecordMap to use B01 service call (upload_record_by_url)\r\n\tprotected override async getCleaningRecordMap(startTime: number, recordDetails?: any): Promise<{ mapBase64CleanUncropped: string; mapBase64: string; mapBase64Truncated: string; mapData: string } | null> {\r\n\t\ttry {\r\n\t\t\tlet url = recordDetails?.record_map_url || recordDetails?.url;\r\n\t\t\tif (!url && recordDetails?.detail) {\r\n\t\t\t\tconst detail = typeof recordDetails.detail === \"string\" ? JSON.parse(recordDetails.detail) : recordDetails.detail;\r\n\t\t\t\turl = detail.record_map_url || detail.url;\r\n\t\t\t}\r\n\r\n\t\t\tif (!url) {\r\n\t\t\t\tthis.deps.adapter.rLog(\"System\", this.duid, \"Warn\", \"B01\", undefined, `No URL found in record details for B01 history map (startTime: ${startTime})`, \"warn\");\r\n\t\t\t\treturn null;\r\n\t\t\t}\r\n\r\n\t\t\tconst dummyId = -Math.floor(Math.random() * 1000000);\r\n\r\n\t\t\tconst historyMapPromise = new Promise<{ mapBase64CleanUncropped: string; mapBase64: string; mapBase64Truncated: string; mapData: string } | null>((resolve) => {\r\n\t\t\t\tthis.deps.adapter.pendingRequests.set(dummyId, {\r\n\t\t\t\t\tmethod: \"get_clean_record_map\",\r\n\t\t\t\t\tduid: this.duid,\r\n\t\t\t\t\tresolve: async (data: Buffer) => {\r\n\t\t\t\t\t\tthis.deps.adapter.pendingRequests.delete(dummyId);\r\n\t\t\t\t\t\tif (Buffer.isBuffer(data)) {\r\n\t\t\t\t\t\t\ttry {\r\n\t\t\t\t\t\t\t\tconst devices = this.deps.adapter.http_api.getDevices();\r\n\t\t\t\t\t\t\t\tconst device = devices.find((d: any) => d.duid === this.duid);\r\n\t\t\t\t\t\t\t\tconst serial = device?.sn || this.duid;\r\n\r\n\t\t\t\t\t\t\t\tconst mapRes = await this.deps.adapter.mapManager.processMap(data, \"B01\", this.robotModel, serial, null, this.duid, \"B01History\");\r\n\r\n\t\t\t\t\t\t\t\tif (mapRes) {\r\n\t\t\t\t\t\t\t\t\tresolve({\r\n\t\t\t\t\t\t\t\t\t\tmapBase64CleanUncropped: mapRes.mapBase64Clean || mapRes.mapBase64,\r\n\t\t\t\t\t\t\t\t\t\tmapBase64: mapRes.mapBase64,\r\n\t\t\t\t\t\t\t\t\t\tmapBase64Truncated: mapRes.mapBase64Clean || mapRes.mapBase64,\r\n\t\t\t\t\t\t\t\t\t\tmapData: JSON.stringify(mapRes.mapData),\r\n\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\tthis.deps.adapter.rLog(\"System\", this.duid, \"Warn\", \"B01\", undefined, \"B01 History Map processing returned null.\", \"warn\");\r\n\t\t\t\t\t\t\t\t\tresolve(null);\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t} catch (e: any) {\r\n\t\t\t\t\t\t\t\tthis.deps.adapter.rLog(\"System\", this.duid, \"Error\", \"B01\", undefined, `Failed to process B01 history map: ${e.message}`, \"error\");\r\n\t\t\t\t\t\t\t\tresolve(null);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tresolve(null);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t},\r\n\t\t\t\t\treject: () => {\r\n\t\t\t\t\t\tthis.deps.adapter.pendingRequests.delete(dummyId);\r\n\t\t\t\t\t\tresolve(null);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\r\n\t\t\t\tthis.deps.adapter.setTimeout(() => {\r\n\t\t\t\t\tif (this.deps.adapter.pendingRequests.has(dummyId)) {\r\n\t\t\t\t\t\tthis.deps.adapter.pendingRequests.delete(dummyId);\r\n\t\t\t\t\t\tresolve(null);\r\n\t\t\t\t\t}\r\n\t\t\t\t}, 30000);\r\n\t\t\t});\r\n\r\n\t\t\ttry {\r\n\t\t\t\tawait this.deps.adapter.requestsHandler.sendRequest(this.duid, \"service.upload_record_by_url\", { url }, { priority: -10 });\r\n\t\t\t\tthis.deps.adapter.rLog(\"System\", this.duid, \"Debug\", \"B01\", undefined, `Triggered B01 History Map update for URL: ${url}`, \"debug\");\r\n\t\t\t} catch (e: any) {\r\n\t\t\t\tthis.deps.adapter.pendingRequests.delete(dummyId);\r\n\t\t\t\tthis.deps.adapter.rLog(\"System\", this.duid, \"Warn\", \"B01\", undefined, `Failed to trigger B01 history map upload: ${e.message}`, \"warn\");\r\n\t\t\t\treturn null;\r\n\t\t\t}\r\n\r\n\t\t\treturn historyMapPromise;\r\n\t\t} catch (e: any) {\r\n\t\t\tthis.deps.adapter.rLog(\"System\", this.duid, \"Warn\", undefined, undefined, `Failed to get cleaning record map (B01): ${e.message}`, \"warn\");\r\n\t\t\treturn null;\r\n\t\t}\r\n\t}\r\n\t// Override processCleanSummary to handle B01 specific structure and avoid redundant requests\r\n\tprotected override async processCleanSummary(result: any): Promise<void> {\r\n\t\ttry {\r\n\t\t\t// B01 result structure is { total_time, total_area, total_count, record_list: [ { url, detail: string }, ... ] }\r\n\t\t\tlet summaryData = result;\r\n\t\t\tif (result && result.data) {\r\n\t\t\t\tsummaryData = result.data;\r\n\t\t\t}\r\n\r\n\t\t\tif (!summaryData || !summaryData.record_list) {\r\n\t\t\t\tthis.deps.adapter.rLog(\"System\", this.duid, \"Warn\", \"B01\", undefined, \"Invalid B01 clean summary format\", \"warn\");\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\t// Update Summary States\r\n\t\t\tawait this.updateSummaryState(\"clean_time\", summaryData.total_time);\r\n\t\t\tawait this.updateSummaryState(\"clean_area\", summaryData.total_area);\r\n\t\t\tawait this.updateSummaryState(\"clean_count\", summaryData.total_count);\r\n\r\n\t\t\tawait this.deps.ensureFolder(`Devices.${this.duid}.cleaningInfo.records`);\r\n\t\t\tconst recordList = summaryData.record_list;\r\n\t\t\tconst limit = 20;\r\n\r\n\t\t\trecordList.sort((a: any, b: any) => {\r\n\t\t\t\tconst timeA = this.extractStartTime(a);\r\n\t\t\t\tconst timeB = this.extractStartTime(b);\r\n\t\t\t\treturn timeB - timeA;\r\n\t\t\t});\r\n\r\n\r\n\t\t\tfor (let i = 0; i < Math.min(recordList.length, limit); i++) {\r\n\t\t\t\tconst recordItem = recordList[i];\r\n\t\t\t\tlet detail: any = null;\r\n\r\n\t\t\t\ttry {\r\n\t\t\t\t\tdetail = typeof recordItem.detail === \"string\" ? JSON.parse(recordItem.detail) : recordItem.detail;\r\n\t\t\t\t} catch (e) {\r\n\t\t\t\t\tthis.deps.adapter.rLog(\"System\", this.duid, \"Error\", \"B01\", undefined, `Failed to parse record detail: ${e}`, \"error\");\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (!detail) continue;\r\n\r\n\t\t\t\tconst startTime = detail.record_start_time || detail.begin;\r\n\t\t\t\tconst index = i;\r\n\r\n\t\t\t\tawait this.deps.ensureFolder(`Devices.${this.duid}.cleaningInfo.records.${index}`);\r\n\r\n\t\t\t\tawait this.processRecordAttributes(index, detail);\r\n\r\n\t\t\t\tif (detail.record_map_url || detail.url || recordItem.url) {\r\n\t\t\t\t\tconst mapRes = await this.getCleaningRecordMap(startTime, recordItem);\r\n\t\t\t\t\tif (mapRes) {\r\n\t\t\t\t\t\tawait this.deps.ensureState(`Devices.${this.duid}.cleaningInfo.records.${index}.mapBase64`, {\r\n\t\t\t\t\t\t\tname: \"History Map Base64\",\r\n\t\t\t\t\t\t\ttype: \"string\",\r\n\t\t\t\t\t\t\trole: \"text\",\r\n\t\t\t\t\t\t\tread: true,\r\n\t\t\t\t\t\t\twrite: false\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\tawait this.deps.ensureState(`Devices.${this.duid}.cleaningInfo.records.${index}.mapBase64Truncated`, {\r\n\t\t\t\t\t\t\tname: \"History Map Base64 Truncated\",\r\n\t\t\t\t\t\t\ttype: \"string\",\r\n\t\t\t\t\t\t\trole: \"text\",\r\n\t\t\t\t\t\t\tread: true,\r\n\t\t\t\t\t\t\twrite: false\r\n\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t\tawait this.deps.adapter.setStateChangedAsync(`Devices.${this.duid}.cleaningInfo.records.${index}.mapBase64`, { val: mapRes.mapBase64, ack: true });\r\n\t\t\t\t\t\tawait this.deps.adapter.setStateChangedAsync(`Devices.${this.duid}.cleaningInfo.records.${index}.mapBase64Truncated`, { val: mapRes.mapBase64Truncated, ack: true });\r\n\r\n\t\t\t\t\t\t// Add the map_object state (Combined JSON)\r\n\t\t\t\t\t\tconst combinedObject = {\r\n\t\t\t\t\t\t\t...detail,\r\n\t\t\t\t\t\t\tmapBase64: mapRes.mapBase64,\r\n\t\t\t\t\t\t\tmapBase64Truncated: mapRes.mapBase64Truncated\r\n\t\t\t\t\t\t};\r\n\r\n\t\t\t\t\t\tawait this.deps.ensureState(`Devices.${this.duid}.cleaningInfo.records.${index}.map_object`, {\r\n\t\t\t\t\t\t\tname: \"Combined History Record\",\r\n\t\t\t\t\t\t\ttype: \"string\",\r\n\t\t\t\t\t\t\trole: \"json\",\r\n\t\t\t\t\t\t\tread: true,\r\n\t\t\t\t\t\t\twrite: false\r\n\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t\tawait this.deps.adapter.setStateAsync(`Devices.${this.duid}.cleaningInfo.records.${index}.map_object`, {\r\n\t\t\t\t\t\t\tval: JSON.stringify(combinedObject),\r\n\t\t\t\t\t\t\tack: true\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tconst jsonSummary = {\r\n\t\t\t\tclean_time: Number((summaryData.total_time / 3600).toFixed(2)),\r\n\t\t\t\tclean_area: Number((summaryData.total_area / 1000000).toFixed(2)),\r\n\t\t\t\tclean_count: summaryData.total_count,\r\n\t\t\t\trecords: recordList.map((r: any) => {\r\n\t\t\t\t\ttry {\r\n\t\t\t\t\t\treturn typeof r.detail === \"string\" ? JSON.parse(r.detail) : r.detail;\r\n\t\t\t\t\t} catch { return null; }\r\n\t\t\t\t}).filter((r: any) => r !== null)\r\n\t\t\t};\r\n\r\n\t\t\tawait this.deps.adapter.setStateChangedAsync(`Devices.${this.duid}.cleaningInfo.JSON`, { val: JSON.stringify(jsonSummary), ack: true });\r\n\r\n\r\n\t\t} catch (e: any) {\r\n\t\t\tthis.deps.adapter.rLog(\"System\", this.duid, \"Error\", \"B01\", undefined, `Error processing B01 clean summary: ${e.message}`, \"error\");\r\n\t\t}\r\n\t}\r\n\r\n\tprivate async updateSummaryState(attr: string, value: number): Promise<void> {\r\n\t\tlet val = value;\r\n\t\tif (attr === \"clean_time\") {\r\n\t\t\tval = Number((val / 3600).toFixed(2));\r\n\t\t} else if (attr === \"clean_area\") {\r\n\t\t\tval = Number((val / 1000000).toFixed(2));\r\n\t\t}\r\n\r\n\t\tawait this.deps.ensureState(`Devices.${this.duid}.cleaningInfo.${attr}`, {\r\n\t\t\tname: attr,\r\n\t\t\ttype: \"number\",\r\n\t\t\trole: \"value\",\r\n\t\t\tread: true,\r\n\t\t\twrite: false\r\n\t\t});\r\n\t\tawait this.deps.adapter.setStateChangedAsync(`Devices.${this.duid}.cleaningInfo.${attr}`, { val, ack: true });\r\n\t}\r\n\r\n\r\n\tprivate extractStartTime(record: any): number {\r\n\t\ttry {\r\n\t\t\tconst detail = typeof record.detail === \"string\" ? JSON.parse(record.detail) : record.detail;\r\n\t\t\treturn detail.record_start_time || detail.begin || 0;\r\n\t\t} catch {\r\n\t\t\treturn 0;\r\n\t\t}\r\n\t}\r\n\r\n\tprivate async processRecordAttributes(index: number, detail: any): Promise<void> {\r\n\t\tfor (const key in detail) {\r\n\t\t\tconst val = detail[key];\r\n\t\t\tconst mappedKey = V1VacuumFeatures.MAPPED_CLEAN_SUMMARY[key] || key;\r\n\r\n\t\t\t// Simple type mapping\r\n\t\t\tconst type = typeof val;\r\n\t\t\tif (type !== \"string\" && type !== \"number\" && type !== \"boolean\") continue;\r\n\r\n\t\t\tawait this.deps.ensureState(`Devices.${this.duid}.cleaningInfo.records.${index}.${mappedKey}`, {\r\n\t\t\t\tname: mappedKey,\r\n\t\t\t\ttype: type as any,\r\n\t\t\t\trole: \"value\",\r\n\t\t\t\tread: true,\r\n\t\t\t\twrite: false\r\n\t\t\t});\r\n\t\t\tawait this.deps.adapter.setStateChangedAsync(`Devices.${this.duid}.cleaningInfo.records.${index}.${mappedKey}`, { val, ack: true });\r\n\t\t}\r\n\t}\r\n\r\n\tpublic override async detectAndApplyRuntimeFeatures(statusData: Readonly<Record<string, any>>): Promise<boolean> {\r\n\t\t// B01 features are statically defined, parameter unused but required by signature\r\n\t\tvoid statusData;\r\n\t\treturn false;\r\n\t}\r\n\r\n\tprotected override getDynamicFeatures(): Set<Feature> {\r\n\t\treturn new Set<Feature>(); // B01 does not use bitfield feature flags\r\n\t}\r\n\r\n\tpublic override async processDockType(dockType: number): Promise<void> {\r\n\t\t// B01 dock features are handled via static command definitions, parameter unused but required by signature\r\n\t\tvoid dockType;\r\n\t}\r\n\r\n}\r\n\r\n\r\n\r\n\r\n"]}