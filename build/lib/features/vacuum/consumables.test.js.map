{"version":3,"file":"consumables.test.js","sourceRoot":"","sources":["../../../../src/lib/features/vacuum/consumables.test.ts"],"names":[],"mappings":";;AACA,6DAA0D;AAE1D,wDAAqD;AACrD,+BAA8B;AAE9B,MAAM,mBAAmB,GAAG;IAC3B,cAAc,EAAE,EAAE;CAClB,CAAC;AAEF,QAAQ,CAAC,kCAAkC,EAAE,GAAG,EAAE;IACjD,IAAI,OAAoB,CAAC;IACzB,IAAI,MAA0B,CAAC;IAE/B,UAAU,CAAC,GAAG,EAAE;QACf,OAAO,GAAG,IAAI,yBAAW,EAAE,CAAC;QAC5B,OAAO,CAAC,eAAe,GAAG;YACzB,WAAW,EAAE,KAAK,IAAI,EAAE;gBACvB,OAAO,EAAE,CAAC,CAAC,wGAAwG;YACpH,CAAC;SACD,CAAC;QAEF,MAAM,GAAG,IAAI,KAAM,SAAQ,uCAAkB;YACrC,kBAAkB,KAAK,OAAO,IAAI,CAAC,eAAe,CAAC,CAAC,CAAC;YAClD,kBAAkB,KAAmB,OAAO,IAAI,GAAG,EAAE,CAAC,CAAC,CAAC;YAC3D,KAAK,CAAC,6BAA6B,KAAuB,OAAO,KAAK,CAAC,CAAC,CAAC;YAChF,wBAAwB;YACjB,mBAAmB,CAAC,SAA0B,IAAS,OAAO,KAAK,CAAC,mBAAmB,CAAC,SAAS,CAAC,CAAC,CAAC,CAAC;YACrG,qBAAqB,CAAC,UAAkB,IAAa,OAAO,KAAK,CAAC,qBAAqB,CAAC,UAAU,CAAC,CAAC,CAAC,CAAC;YACtG,qBAAqB,CAAC,SAA0B,IAAS,OAAO,KAAK,CAAC,qBAAqB,CAAC,SAAS,CAAC,CAAC,CAAC,CAAC;YACzG,wBAAwB,CAAC,SAA0B,IAAS,OAAO,KAAK,CAAC,wBAAwB,CAAC,SAAS,CAAC,CAAC,CAAC,CAAC;YAC/G,sBAAsB,CAAC,EAAU,IAAY,OAAO,KAAK,CAAC,sBAAsB,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC;YACvF,qBAAqB,CAAC,SAA0B,IAAS,OAAO,KAAK,CAAC,qBAAqB,CAAC,SAAS,CAAC,CAAC,CAAC,CAAC;SAGhH,CACS,OAAc,EACd,YAAY,EACZ,oBAAoB,EACpB,mBAAmB,CAC5B,CAAC;IACH,CAAC,CAAC,CAAC;IAEH,EAAE,CAAC,uEAAuE,EAAE,KAAK,IAAI,EAAE;QACtF,MAAM,cAAc,GAAG;YACtB,oBAAoB,EAAE,IAAI,EAAE,SAAS;YACrC,gBAAgB,EAAE,IAAI,EAAM,2BAA2B;YACvD,iBAAiB,EAAE,IAAI,EAAK,sEAAsE;YAClG,eAAe,EAAE,EAAE,CAAS,aAAa;SACzC,CAAC;QAEF,MAAM,MAAM,CAAC,iBAAiB,CAAC,cAAc,CAAC,CAAC;QAE/C,4CAA4C;QAC5C,IAAA,aAAM,EAAC,OAAO,CAAC,MAAM,CAAC,qDAAqD,CAAC,EAAE,mCAAmC,CAAC,CAAC,EAAE,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC;QAC/H,IAAA,aAAM,EAAC,OAAO,CAAC,MAAM,CAAC,iDAAiD,CAAC,EAAE,+BAA+B,CAAC,CAAC,EAAE,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC;QAEvH,4BAA4B;QAC5B,IAAA,aAAM,EAAC,OAAO,CAAC,MAAM,CAAC,kDAAkD,CAAC,EAAE,gCAAgC,CAAC,CAAC,EAAE,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC;QAEzH,6BAA6B;QAC7B,IAAA,aAAM,EAAC,OAAO,CAAC,MAAM,CAAC,gDAAgD,CAAC,EAAE,mCAAmC,CAAC,CAAC,EAAE,CAAC,KAAK,CAAC,EAAE,CAAC,CAAC;IAC5H,CAAC,CAAC,CAAC;AACJ,CAAC,CAAC,CAAC","sourcesContent":["\r\nimport { BaseVacuumFeatures } from \"./baseVacuumFeatures\";\r\nimport { Feature } from \"../features.enum\";\r\nimport { MockAdapter } from \"../../mock/MockAdapter\";\r\nimport { expect } from \"chai\";\r\n\r\nconst DefaultDeviceConfig = {\r\n\tstaticFeatures: []\r\n};\r\n\r\ndescribe(\"BaseVacuumFeatures - Consumables\", () => {\r\n\tlet adapter: MockAdapter;\r\n\tlet vacuum: BaseVacuumFeatures;\r\n\r\n\tbeforeEach(() => {\r\n\t\tadapter = new MockAdapter();\r\n\t\tadapter.requestsHandler = {\r\n\t\t\tsendRequest: async () => {\r\n\t\t\t\treturn []; // Default return, preventing crash. updateConsumables with argument doesn't use this if data is passed.\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tvacuum = new class extends BaseVacuumFeatures {\r\n\t\t\tpublic getAppliedFeatures() { return this.appliedFeatures; }\r\n\t\t\tprotected getDynamicFeatures(): Set<Feature> { return new Set(); }\r\n\t\t\tpublic async detectAndApplyRuntimeFeatures(): Promise<boolean> { return false; }\r\n\t\t\t// Stub abstract methods\r\n\t\t\tpublic getCommonConsumable(attribute: string | number): any { return super.getCommonConsumable(attribute); }\r\n\t\t\tpublic isResetableConsumable(consumable: string): boolean { return super.isResetableConsumable(consumable); }\r\n\t\t\tpublic getCommonDeviceStates(attribute: string | number): any { return super.getCommonDeviceStates(attribute); }\r\n\t\t\tpublic getCommonCleaningRecords(attribute: string | number): any { return super.getCommonCleaningRecords(attribute); }\r\n\t\t\tpublic getFirmwareFeatureName(id: number): string { return super.getFirmwareFeatureName(id); }\r\n\t\t\tpublic getCommonCleaningInfo(attribute: string | number): any { return super.getCommonCleaningInfo(attribute); }\r\n\r\n\r\n\t\t}(\r\n            adapter as any,\r\n            \"1234567890\",\r\n            \"roborock.vacuum.s5\",\r\n            DefaultDeviceConfig\r\n\t\t);\r\n\t});\r\n\r\n\tit(\"should convert time-based consumables from seconds to hours (integer)\", async () => {\r\n\t\tconst consumableData = {\r\n\t\t\tmain_brush_work_time: 3600, // 1 hour\r\n\t\t\tfilter_work_time: 7500,     // 2.08 hours -> round to 2\r\n\t\t\tsensor_dirty_time: 1800,    // 0.5 hours -> round to 1 (round half up) or 0? Math.round(0.5) is 1.\r\n\t\t\tside_brush_life: 90         // percentage\r\n\t\t};\r\n\r\n\t\tawait vacuum.updateConsumables(consumableData);\r\n\r\n\t\t// Check converted values (seconds -> hours)\r\n\t\texpect(adapter.states[\"Devices.1234567890.consumables.main_brush_work_time\"], \"main_brush_work_time should be 1h\").to.equal(1);\r\n\t\texpect(adapter.states[\"Devices.1234567890.consumables.filter_work_time\"], \"filter_work_time should be 2h\").to.equal(2);\r\n\r\n\t\t// Math.round(0.5) = 1 in JS\r\n\t\texpect(adapter.states[\"Devices.1234567890.consumables.sensor_dirty_time\"], \"sensor_dirty_time should be 1h\").to.equal(1);\r\n\r\n\t\t// Check non-converted values\r\n\t\texpect(adapter.states[\"Devices.1234567890.consumables.side_brush_life\"], \"side_brush_life should remain 90%\").to.equal(90);\r\n\t});\r\n});\r\n"]}