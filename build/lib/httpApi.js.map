{"version":3,"file":"httpApi.js","sourceRoot":"","sources":["../../src/lib/httpApi.ts"],"names":[],"mappings":"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","sourcesContent":["import axios, { type AxiosInstance, type InternalAxiosRequestConfig } from \"axios\";\nimport * as crypto from \"crypto\";\nimport { Roborock } from \"../main\";\nimport { LoginV4Response, ProductV5Response } from \"./apiTypes\";\nimport { cryptoEngine } from \"./cryptoEngine\";\n\n// Constants\nconst API_V3_SIGN = \"api/v3/key/sign\";\nconst API_V4_LOGIN_CODE = \"api/v4/auth/email/login/code\";\nconst API_V4_LOGIN_PASSWORD = \"api/v4/auth/email/login/pwd\";\nconst API_V4_EMAIL_CODE = \"api/v4/email/code/send\";\nconst API_V5_PRODUCT = \"api/v5/product\";\n\ninterface RegionConfig {\n\tapiBaseUrl: string;\n\tloginCountry: string;\n\tloginCountryCode: string;\n}\n\nconst REGION_CONFIG: Record<string, RegionConfig> = {\n\teu: {\n\t\tapiBaseUrl: \"https://euiot.roborock.com\",\n\t\tloginCountry: \"DE\",\n\t\tloginCountryCode: \"49\",\n\t},\n\tus: {\n\t\tapiBaseUrl: \"https://usiot.roborock.com\",\n\t\tloginCountry: \"US\",\n\t\tloginCountryCode: \"1\",\n\t},\n\tcn: {\n\t\tapiBaseUrl: \"https://cniot.roborock.com\",\n\t\tloginCountry: \"CN\",\n\t\tloginCountryCode: \"86\",\n\t},\n\tasia: {\n\t\tapiBaseUrl: \"https://api.roborock.com\", // Fallback/General based on bundle analysis\n\t\tloginCountry: \"SG\", // Default to Singapore for general Asia\n\t\tloginCountryCode: \"65\",\n\t},\n};\n\n// --------------------\n// Interfaces & Types\n// --------------------\n\ninterface RriotData {\n\tu: string;\n\ts: string;\n\th: string;\n\tk: string;\n\tr: { a: string; m: string };\n}\n\ninterface UserData {\n\ttoken: string;\n\trriot: RriotData;\n}\n\nexport interface Device {\n\tduid: string;\n\tlocalKey: string;\n\tproductId: string;\n\tname?: string;\n\tfeatureSet?: number;\n\tnewFeatureSet?: string;\n\tonline: boolean;\n\tdeviceStatus: any;\n\tpv: string;\n\tsn?: string;\n}\n\ninterface Product {\n\tid: string;\n\tmodel: string;\n\tcategory: string;\n\tname?: string;\n}\n\ninterface Room {\n\tid: number;\n\tname: string;\n}\n\ninterface HomeData {\n\trrHomeId: number;\n\tproducts: Product[];\n\tdevices: Device[];\n\treceivedDevices: Device[];\n\trooms: Room[];\n}\n\n/**\n * Helper to calculate MD5 hex string\n */\nfunction md5hex(str: string): string {\n\treturn crypto.createHash(\"md5\").update(str).digest(\"hex\");\n}\n\nexport class http_api {\n\tadapter: Roborock;\n\tloginApi: AxiosInstance | null = null;\n\trealApi: AxiosInstance | null = null;\n\tuserData: UserData | null = null;\n\thomeData: HomeData | null = null;\n\thomeID: number | null = null;\n\tpublic productInfo: ProductV5Response | null = null;\n\n\tprivate fwFeaturesCache = new Map<string, number[]>();\n\n\tconstructor(adapter: Roborock) {\n\t\tthis.adapter = adapter;\n\t}\n\n\t/**\n\t * Initializes the Login API and attempts to set up the Real API.\n\t * @param clientID The client identifier.\n\t */\n\tasync init(clientID: string): Promise<void> {\n\t\t// Initialize the login API (needed to get access to the real API)\n\t\tconst region = this.adapter.config.region || \"eu\";\n\t\tconst regionConfig = REGION_CONFIG[region] || REGION_CONFIG[\"eu\"];\n\n\t\tthis.adapter.rLog(\"HTTP\", null, \"Info\", \"Cloud\", undefined, `Initializing HTTP API with region: ${region} (${regionConfig.apiBaseUrl})`, \"info\");\n\n\t\tthis.loginApi = axios.create({\n\t\t\tbaseURL: regionConfig.apiBaseUrl,\n\t\t\theaders: {\n\t\t\t\theader_clientid: crypto.createHash(\"md5\").update(this.adapter.config.username).update(clientID).digest().toString(\"base64\"),\n\t\t\t\theader_appversion: \"4.54.02\",\n\t\t\t\theader_clientlang: \"de\",  // Assuming DE based on dump, or use adapter.config.language/system lang\n\t\t\t\theader_phonemodel: \"Pixel 9 Pro XL\", // Using dump value to mimic real device\n\t\t\t\theader_phonesystem: \"Android\",\n\t\t\t},\n\t\t});\n\n\t\t// Attempt to restore session\n\t\tawait this.loadUserData();\n\n\t\tawait this.initializeRealApi();\n\t\tawait this.getHomeID();\n\t}\n\n\t/**\n\t * Restores UserData from state.\n\t */\n\tasync loadUserData(): Promise<void> {\n\t\ttry {\n\t\t\tconst userDataState = await this.adapter.getStateAsync(\"UserData\");\n\t\t\tif (userDataState && userDataState.val) {\n\t\t\t\tconst data = JSON.parse(userDataState.val as string);\n\t\t\t\tif (data && data.token && data.rriot) {\n\t\t\t\t\tthis.userData = data;\n\t\t\t\t\tthis.adapter.rLog(\"HTTP\", null, \"Info\", \"Cloud\", undefined, \"Restored persisted UserData.\", \"info\");\n\t\t\t\t}\n\t\t\t}\n\t\t} catch {\n\t\t\tthis.adapter.rLog(\"HTTP\", null, \"Debug\", \"Cloud\", undefined, \"No previous UserData found or invalid.\", \"debug\");\n\t\t}\n\t}\n\n\t/**\n\t * Logs in (if necessary) and sets up the authenticated \"Real API\" with Hawk authentication.\n\t */\n\tprivate loginCodeResolver: ((code: string) => void) | null = null;\n\n\tpublic submitLoginCode(code: string): void {\n\t\tif (this.loginCodeResolver) {\n\t\t\tthis.loginCodeResolver(code);\n\t\t\tthis.loginCodeResolver = null;\n\t\t}\n\t}\n\n\tasync initializeRealApi(): Promise<void> {\n\t\tthis.adapter.rLog(\"HTTP\", null, \"Debug\", \"Cloud\", undefined, \"Initializing Real API (Hawk Auth)\", \"debug\");\n\n\t\tif (!this.loginApi) {\n\t\t\tthrow new Error(\"loginApi is not initialized. Call init() first.\");\n\t\t}\n\t\tif (!this.userData) {\n\t\t\ttry {\n\t\t\t\tlet usePasswordFlow = this.adapter.config.loginMethod === \"password\" && !!this.adapter.config.password;\n\n\t\t\t\t// 1. Sign Request (Get K) - needed for both password and code login (for password encryption or code verification)\n\t\t\t\t// Use a random 16-char string for 's' (nonce/salt)\n\t\t\t\tconst s = crypto.randomBytes(12).toString(\"base64\").substring(0, 16).replace(/\\+/g, \"X\").replace(/\\//g, \"Y\");\n\t\t\t\tconst signData = await this.signRequest(s);\n\t\t\t\tif (!signData) throw new Error(\"Failed to obtain signature key k\");\n\t\t\t\tconst k = signData.k;\n\n\t\t\t\tif (usePasswordFlow) {\n\t\t\t\t\tthis.adapter.rLog(\"HTTP\", null, \"Info\", \"Cloud\", undefined, \"Starting Password Login Flow...\", \"info\");\n\t\t\t\t\ttry {\n\t\t\t\t\t\tconst loginResult = await this.loginByPassword(this.adapter.config.password, k, s);\n\t\t\t\t\t\tif (loginResult.code === 200) {\n\t\t\t\t\t\t\tthis.userData = loginResult.data!;\n\t\t\t\t\t\t\tthis.adapter.rLog(\"HTTP\", null, \"Info\", \"Cloud\", undefined, \"Login with password successful.\", \"info\");\n\t\t\t\t\t\t} else if (loginResult.code === 2031) {\n\t\t\t\t\t\t\tthis.adapter.rLog(\"HTTP\", null, \"Warn\", \"Cloud\", undefined, \"Password login requires 2FA (Code 2031). Falling back to 2FA flow.\", \"warn\");\n\t\t\t\t\t\t\tusePasswordFlow = false;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tthrow new Error(`Login with password failed: ${JSON.stringify(loginResult)}`);\n\t\t\t\t\t\t}\n\t\t\t\t\t} catch (e: any) {\n\t\t\t\t\t\tthis.adapter.rLog(\"HTTP\", null, \"Error\", \"Cloud\", undefined, `Password login error: ${e.message}`, \"error\");\n\t\t\t\t\t\t// If explicit 2031 (handled above) or other error, we might decide to fallback or fail.\n\t\t\t\t\t\t// Current logic: if it was 2031, usePasswordFlow is set to false, so we fall through to 2FA.\n\t\t\t\t\t\t// If it was another error (e.g. wrong password), we should probably stop?\n\t\t\t\t\t\t// For safety/flexibility, if we flagged 'false' above, we continue. If we threw, we stop.\n\t\t\t\t\t\tif (usePasswordFlow) throw e;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// If not using password flow (or fell back)\n\t\t\t\tif (!this.userData && !usePasswordFlow) {\n\t\t\t\t\tthis.adapter.rLog(\"HTTP\", null, \"Info\", \"Cloud\", undefined, \"Starting Direct 2FA Login Flow...\", \"info\");\n\n\t\t\t\t\t// 1. Request Email Code\n\t\t\t\t\tawait this.requestEmailCode(this.adapter.config.username);\n\n\t\t\t\t\tconst warning = [\n\t\t\t\t\t\t\"********************************************************************************\",\n\t\t\t\t\t\t\"ATTENTION: 2FA Code required!\",\n\t\t\t\t\t\t`An email has been sent to ${this.adapter.config.username}.`,\n\t\t\t\t\t\t\"Please enter the 6-digit code into the state 'roborock.0.loginCode' immediately.\",\n\t\t\t\t\t\t\"********************************************************************************\"\n\t\t\t\t\t].join(\"\\n\");\n\n\t\t\t\t\tthis.adapter.rLog(\"HTTP\", null, \"Error\", \"Cloud\", undefined, warning, \"error\");\n\n\t\t\t\t\t// State at root: roborock.0.loginCode\n\t\t\t\t\tconst stateId = \"loginCode\";\n\t\t\t\t\tawait this.adapter.ensureState(stateId, { name: \"2FA Login Code\", write: true, type: \"string\", def: \"\" });\n\t\t\t\t\tawait this.adapter.setState(stateId, { val: \"\", ack: true });\n\n\t\t\t\t\tawait this.adapter.subscribeStatesAsync(stateId);\n\n\t\t\t\t\t// 2. Wait for Code\n\t\t\t\t\tlet code = \"\";\n\t\t\t\t\ttry {\n\t\t\t\t\t\tcode = await new Promise<string>((resolve, reject) => {\n\t\t\t\t\t\t\tthis.loginCodeResolver = resolve;\n\t\t\t\t\t\t\t// Timeout after 15 minutes\n\t\t\t\t\t\t\tsetTimeout(() => {\n\t\t\t\t\t\t\t\tif (this.loginCodeResolver) {\n\t\t\t\t\t\t\t\t\tthis.loginCodeResolver = null;\n\t\t\t\t\t\t\t\t\treject(new Error(\"Timeout waiting for 2FA code\"));\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}, 15 * 60 * 1000); // 15 min\n\t\t\t\t\t\t});\n\t\t\t\t\t} catch (e: any) {\n\t\t\t\t\t\tthrow e;\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.adapter.rLog(\"HTTP\", null, \"Info\", \"Cloud\", undefined, \"2FA code received. Proceeding with login...\", \"info\");\n\t\t\t\t\tawait this.adapter.unsubscribeStatesAsync(stateId);\n\n\t\t\t\t\t// 3. Login with Code\n\t\t\t\t\t// Reuse k/s from strictly before if possible? No, 'signRequest' was likely called at start.\n\t\t\t\t\t// However, the signature 's' and 'k' might expire or be one-time?\n\t\t\t\t\t// The dump usage implies sign is called before login.\n\t\t\t\t\t// We already called signRequest above. We should be able to reuse 'k' and 's' IF they are not one-time use or time-bound.\n\t\t\t\t\t// Safest is to re-sign if we think it might have expired, but for now reuse.\n\n\t\t\t\t\tconst loginResult = await this.loginWithCode(code, k, s);\n\n\t\t\t\t\tif (loginResult.code === 200) {\n\t\t\t\t\t\tthis.userData = loginResult.data!; // data IS UserData\n\t\t\t\t\t\tawait this.adapter.setState(stateId, { val: \"\", ack: true });\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthrow new Error(`Login with code failed: ${JSON.stringify(loginResult)}`);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (!this.userData) {\n\t\t\t\t\tthrow new Error(\"Login returned empty userdata.\");\n\t\t\t\t}\n\n\t\t\t\tawait this.adapter.setState(\"UserData\", { val: JSON.stringify(this.userData), ack: true });\n\n\t\t\t\t// Load product definitions (V5 API)\n\t\t\t\ttry {\n\t\t\t\t\tthis.productInfo = await this.getProductInfoV5();\n\t\t\t\t\tif (this.productInfo) {\n\t\t\t\t\t\tlet count = 0;\n\t\t\t\t\t\tif (this.productInfo.data && this.productInfo.data.categoryDetailList) {\n\t\t\t\t\t\t\tfor (const cat of this.productInfo.data.categoryDetailList) {\n\t\t\t\t\t\t\t\tif (cat.productList) count += cat.productList.length;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tthis.adapter.rLog(\"HTTP\", null, \"Info\", \"Cloud\", undefined, `V5 Product Info fetched. ${count} products available.`, \"info\");\n\t\t\t\t\t\tawait this.adapter.setState(\"info.productInfo\", { val: JSON.stringify(this.productInfo), ack: true });\n\t\t\t\t\t}\n\t\t\t\t} catch (err) {\n\t\t\t\t\tthis.adapter.rLog(\"HTTP\", null, \"Warn\", \"Cloud\", undefined, `Failed to get product info V5: ${err}`, \"warn\");\n\t\t\t\t}\n\n\t\t\t} catch (error: any) {\n\t\t\t\tthis.adapter.rLog(\"HTTP\", null, \"Error\", \"Cloud\", undefined, `Error in initializeRealApi: ${error.message}`, \"error\");\n\t\t\t\tthrow error;\n\t\t\t}\n\t\t}\n\n\t\tif (!this.userData?.token) {\n\t\t\tthrow new Error(\"Failed to retrieve user token. Check login credentials.\");\n\t\t}\n\n\t\t// Set global auth header for loginApi (though mostly unused after this)\n\t\tthis.loginApi.defaults.headers.common[\"Authorization\"] = this.userData.token;\n\n\t\ttry {\n\t\t\tconst rriot = this.get_rriot();\n\n\t\t\t// Initialize the real API with Hawk Authentication Interceptor\n\t\t\tconst realApi = axios.create({ baseURL: this.userData.rriot.r.a });\n\n\t\t\trealApi.interceptors.request.use((config: InternalAxiosRequestConfig) => {\n\t\t\t\tconst timestamp = Math.floor(Date.now() / 1000);\n\t\t\t\tconst nonce = crypto\n\t\t\t\t\t.randomBytes(6)\n\t\t\t\t\t.toString(\"base64\")\n\t\t\t\t\t.substring(0, 6)\n\t\t\t\t\t.replace(/[+/]/g, (m) => (m === \"+\" ? \"X\" : \"Y\"));\n\n\t\t\t\t// Calculate signature\n\t\t\t\tlet urlPath = \"\";\n\t\t\t\tif (config.url) {\n\t\t\t\t\t// Handle relative URLs correctly by creating a dummy base if needed\n\t\t\t\t\t// or using the instance's baseURL if config.url is relative\n\t\t\t\t\tconst fullUrl = axios.getUri(config);\n\t\t\t\t\ttry {\n\t\t\t\t\t\turlPath = new URL(fullUrl).pathname;\n\t\t\t\t\t} catch {\n\t\t\t\t\t\t// Fallback if URL construction fails\n\t\t\t\t\t\turlPath = config.url;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tconst prestr = [rriot.u, rriot.s, nonce, timestamp, md5hex(urlPath), \"\", \"\"].join(\":\");\n\t\t\t\tconst mac = crypto.createHmac(\"sha256\", rriot.h).update(prestr).digest(\"base64\");\n\n\t\t\t\tconfig.headers[\"Authorization\"] = `Hawk id=\"${rriot.u}\", s=\"${rriot.s}\", ts=\"${timestamp}\", nonce=\"${nonce}\", mac=\"${mac}\"`;\n\n\t\t\t\treturn config;\n\t\t\t});\n\n\t\t\tthis.realApi = realApi;\n\n\t\t\tawait this.adapter.setState(\"info.connection\", { val: true, ack: true });\n\t\t} catch (error: any) {\n\t\t\tthis.adapter.rLog(\"HTTP\", null, \"Error\", \"Cloud\", undefined, `Error in initializeRealApi: ${error.stack}`, \"error\");\n\t\t\tawait this.adapter.setState(\"info.connection\", { val: false, ack: true });\n\t\t}\n\t}\n\n\tasync requestEmailCode(username: string): Promise<void> {\n\t\tif (!this.loginApi) throw new Error(\"loginApi is not initialized.\");\n\n\t\ttry {\n\t\t\t// Match user dump: type=login&email=...&platform=\n\t\t\tconst params = new URLSearchParams();\n\t\t\tparams.append(\"type\", \"login\");\n\t\t\tparams.append(\"email\", username);\n\t\t\tparams.append(\"platform\", \"\"); // empty in dump\n\n\t\t\tconst res = await this.loginApi.post(API_V4_EMAIL_CODE, params.toString());\n\n\t\t\tif (res.data && res.data.code != 200) {\n\t\t\t\tthrow new Error(`Start 2FA failed: ${res.data.msg} (Code: ${res.data.code})`);\n\t\t\t}\n\t\t} catch (error: any) {\n\t\t\tif (error.response && error.response.data) {\n\t\t\t\tthis.adapter.rLog(\"HTTP\", null, \"Error\", \"Cloud\", undefined, `Request email code failed with response: ${JSON.stringify(error.response.data)}`, \"error\");\n\t\t\t}\n\t\t\tthrow error; // Re-throw exact error to be caught by caller\n\t\t}\n\t}\n\n\tasync signRequest(s: string): Promise<{ k: string } | null> {\n\t\tif (!this.loginApi) return null;\n\n\t\ttry {\n\t\t\t// Dump shows POST to sign endpoint without body, params in URL.\n\t\t\t// axios.post(url) works.\n\t\t\tconst res = await this.loginApi.post(`${API_V3_SIGN}?s=${s}`);\n\t\t\treturn res.data.data;\n\t\t} catch (e: any) {\n\t\t\tthis.adapter.rLog(\"HTTP\", null, \"Error\", \"Cloud\", undefined, `SignRequest failed: ${e.message}`, \"error\");\n\t\t\treturn null;\n\t\t}\n\t}\n\n\tasync loginWithCode(code: string, k: string, s: string): Promise<LoginV4Response> {\n\t\tif (!this.loginApi) throw new Error(\"loginApi not initialized\");\n\n\t\t// Dump shows x-mercy headers and specific body\n\t\t// NO HMAC 'h' in body shown in dump for this request!\n\t\t// Headers: x-mercy-k, x-mercy-ks\n\n\t\tconst headers = {\n\t\t\t\"x-mercy-k\": k,\n\t\t\t\"x-mercy-ks\": s\n\t\t\t// content-type application/x-www-form-urlencoded is default for axios with URLSearchParams\n\t\t};\n\n\t\tconst region = this.adapter.config.region || \"eu\";\n\t\tconst regionConfig = REGION_CONFIG[region] || REGION_CONFIG[\"eu\"];\n\n\t\tconst params = new URLSearchParams({\n\t\t\tcountry: regionConfig.loginCountry,\n\t\t\tcountryCode: regionConfig.loginCountryCode,\n\t\t\temail: this.adapter.config.username,\n\t\t\tcode: code,\n\t\t\tmajorVersion: \"14\", // from dump\n\t\t\tminorVersion: \"0\"   // from dump\n\t\t});\n\n\t\ttry {\n\t\t\tconst res = await this.loginApi.post(API_V4_LOGIN_CODE, params.toString(), { headers });\n\t\t\treturn res.data;\n\t\t} catch (e: any) {\n\t\t\tthrow new Error(`Login with code failed: ${e.message}`);\n\t\t}\n\t}\n\n\tasync loginByPassword(password: string, k: string, s: string): Promise<LoginV4Response> {\n\t\tif (!this.loginApi) throw new Error(\"loginApi not initialized\");\n\n\t\tthis.adapter.rLog(\"HTTP\", null, \"->\", \"Cloud\", undefined, `Attempting Password Login for user: ${this.adapter.config.username}`, \"info\");\n\n\t\tconst encryptedPassword = cryptoEngine.encryptPassword(password, k);\n\n\t\tconst headers = {\n\t\t\t\"x-mercy-k\": k,\n\t\t\t\"x-mercy-ks\": s\n\t\t};\n\n\t\tconst params = new URLSearchParams({\n\t\t\temail: this.adapter.config.username,\n\t\t\tpassword: encryptedPassword,\n\t\t\tmajorVersion: \"14\",\n\t\t\tminorVersion: \"0\"\n\t\t});\n\n\t\ttry {\n\t\t\tconst res = await this.loginApi.post(API_V4_LOGIN_PASSWORD, params.toString(), { headers });\n\t\t\treturn res.data;\n\t\t} catch (e: any) {\n\t\t\tif (e.response && e.response.data) {\n\t\t\t\tconst errData = e.response.data;\n\t\t\t\tthis.adapter.rLog(\"HTTP\", null, \"<-\", \"Cloud\", undefined, `Login Failed. Code: ${errData.code}, Msg: ${errData.msg}`, \"error\");\n\t\t\t\treturn errData;\n\t\t\t}\n\t\t\tthrow new Error(`Login with password failed: ${e.message}`);\n\t\t}\n\t}\n\n\tasync getProductInfoV5(): Promise<ProductV5Response | null> {\n\t\tif (!this.loginApi) return null;\n\n\t\ttry {\n\t\t\tconst res = await this.loginApi.get(API_V5_PRODUCT);\n\n\t\t\tif (res.data && res.data.data) {\n\t\t\t\tthis.productInfo = res.data; // Store it\n\t\t\t\treturn res.data;\n\t\t\t}\n\t\t\treturn null;\n\t\t} catch (e: any) {\n\t\t\tthis.adapter.rLog(\"HTTP\", null, \"Warn\", \"Cloud\", undefined, `getProductInfoV5 failed: ${e.message}`, \"warn\");\n\t\t\treturn null;\n\t\t}\n\t}\n\n\tasync ensureProductInfo(): Promise<void> {\n\t\tif (!this.productInfo) {\n\t\t\tthis.adapter.rLog(\"HTTP\", null, \"Debug\", \"Cloud\", undefined, \"ProductInfo not present. Fetching V5 Product Info...\", \"debug\");\n\t\t\tawait this.getProductInfoV5();\n\t\t}\n\t}\n\n\tasync downloadProductImages() {\n\t\tif (!this.adapter.config.downloadRoborockImages) return;\n\t\tawait this.ensureProductInfo();\n\n\t\tif (!this.productInfo?.data?.categoryDetailList) {\n\t\t\tthis.adapter.rLog(\"HTTP\", null, \"Warn\", \"Cloud\", undefined, \"Cannot download images: categoryDetailList missing.\", \"warn\");\n\t\t\treturn;\n\t\t}\n\n\t\tfor (const cat of this.productInfo.data.categoryDetailList) {\n\t\t\tif (!cat.productList) continue;\n\t\t\tfor (const p of cat.productList) {\n\t\t\t\tif (p.picurl) {\n\t\t\t\t\ttry {\n\t\t\t\t\t\tconst safeId = p.model.replace(/\\./g, \"_\");\n\t\t\t\t\t\tconst res = await axios.get(p.picurl, { responseType: \"arraybuffer\" });\n\t\t\t\t\t\tif (res.status === 200) {\n\t\t\t\t\t\t\tconst base64 = Buffer.from(res.data, \"binary\").toString(\"base64\");\n\t\t\t\t\t\t\tconst stateId = `Products.${safeId}.image`;\n\n\t\t\t\t\t\t\tawait this.adapter.setObjectNotExistsAsync(stateId, {\n\t\t\t\t\t\t\t\ttype: \"state\",\n\t\t\t\t\t\t\t\tcommon: {\n\t\t\t\t\t\t\t\t\tname: p.model + \" Image\",\n\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\trole: \"value\",\n\t\t\t\t\t\t\t\t\tread: true,\n\t\t\t\t\t\t\t\t\twrite: false\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tnative: {}\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\tawait this.adapter.setState(stateId, { val: base64, ack: true });\n\t\t\t\t\t\t}\n\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\tthis.adapter.rLog(\"HTTP\", null, \"Warn\", \"Cloud\", undefined, `Failed to download image for ${p.model}: ${e}`, \"warn\");\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Retrieves the Home ID from the API.\n\t */\n\tasync getHomeID(): Promise<void> {\n\t\tif (!this.loginApi) {\n\t\t\tthrow new Error(\"loginApi is not initialized. Call init() first.\");\n\t\t}\n\n\t\ttry {\n\t\t\tconst response = await this.loginApi.get(\"api/v1/getHomeDetail\");\n\t\t\tif (response.data.data) {\n\t\t\t\tthis.adapter.rLog(\"HTTP\", null, \"Debug\", \"Cloud\", undefined, `getHomeDetail: ${JSON.stringify(response.data)}`, \"debug\");\n\t\t\t\tthis.homeID = response.data.data.rrHomeId;\n\t\t\t\tthis.adapter.rLog(\"HTTP\", null, \"Debug\", \"Cloud\", undefined, `this.homeID: ${this.homeID}`, \"debug\");\n\t\t\t} else {\n\t\t\t\tthis.adapter.rLog(\"HTTP\", null, \"Error\", \"Cloud\", undefined, `failed to get getHomeDetail: ${response.data.msg}`, \"error\");\n\t\t\t}\n\t\t} catch (error: any) {\n\t\t\tthis.adapter.rLog(\"HTTP\", null, \"Error\", \"Cloud\", undefined, `Error getting HomeID: ${error.message}`, \"error\");\n\t\t}\n\t}\n\n\t/**\n\t * Downloads the latest Home Data (Devices, Rooms, Products) and stores it in state.\n\t */\n\tasync updateHomeData(): Promise<void> {\n\t\tif (!this.loginApi) throw new Error(\"loginApi is not initialized. Call init() first.\");\n\t\tif (!this.realApi) throw new Error(\"realApi is not initialized. Call initializeRealApi() first\");\n\n\t\tif (this.homeID) {\n\t\t\tthis.adapter.rLog(\"HTTP\", null, \"->\", \"Cloud\", undefined, `Fetching Home Data (HomeID: ${this.homeID})...`, \"debug\");\n\t\t\ttry {\n\t\t\t\t// Fetch home details from V2 API\n\t\t\t\tconst resV2 = await this.realApi.get(`v2/user/homes/${this.homeID}`);\n\t\t\t\tthis.homeData = resV2.data.result;\n\n\t\t\t\t// Fetch home details from V3 API\n\t\t\t\ttry {\n\t\t\t\t\tthis.adapter.rLog(\"HTTP\", null, \"->\", \"Cloud\", undefined, `Attempting to fetch V3 HomeData...`, \"debug\");\n\t\t\t\t\tconst resV3 = await this.realApi.get(`v3/user/homes/${this.homeID}`);\n\n\t\t\t\t\tif (resV3.data.success && resV3.data.result) {\n\t\t\t\t\t\tconst v3Data = resV3.data.result as HomeData;\n\t\t\t\t\t\tthis.adapter.rLog(\"HTTP\", null, \"<-\", \"Cloud\", undefined, `Fetched V3 HomeData. Merging...`, \"debug\");\n\n\t\t\t\t\t\t// Merge arrays ensuring unique items by key\n\t\t\t\t\t\t// Prioritize V3 data (additional) as it contains 'pv' and other new fields.\n\t\t\t\t\t\t// mergeUnique takes (initial, additional). We want V3 to be 'initial' so it wins.\n\t\t\t\t\t\tconst mergeUnique = (priority: any[], secondary: any[], key: string) => {\n\t\t\t\t\t\t\tconst initial = priority || [];\n\t\t\t\t\t\t\tconst additional = secondary || [];\n\t\t\t\t\t\t\tconst map = new Map(initial.map((item) => [item[key], item]));\n\n\t\t\t\t\t\t\tfor (const item of additional) {\n\t\t\t\t\t\t\t\tif (!map.has(item[key])) {\n\t\t\t\t\t\t\t\t\tmap.set(item[key], item);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\treturn Array.from(map.values());\n\t\t\t\t\t\t};\n\n\t\t\t\t\t\tif (this.homeData) {\n\t\t\t\t\t\t\t// Pass v3Data first so it takes precedence\n\t\t\t\t\t\t\tthis.homeData.devices = mergeUnique(v3Data.devices, this.homeData.devices, \"duid\");\n\t\t\t\t\t\t\tthis.homeData.receivedDevices = mergeUnique(v3Data.receivedDevices, this.homeData.receivedDevices, \"duid\");\n\t\t\t\t\t\t\tthis.homeData.products = mergeUnique(v3Data.products, this.homeData.products, \"id\");\n\t\t\t\t\t\t\t// Rooms usually don't need merging (mostly UI), but we can if needed.\n\t\t\t\t\t\t\tthis.homeData.rooms = mergeUnique(v3Data.rooms, this.homeData.rooms, \"id\");\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tthis.homeData = v3Data;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tthis.adapter.rLog(\"HTTP\", null, \"Info\", \"Cloud\", undefined, `V3 Merge complete. Total Devices: ${this.homeData?.devices?.length}`, \"debug\");\n\t\t\t\t\t}\n\t\t\t\t} catch (e3: any) {\n\t\t\t\t\t// V3 might fail on older accounts/regions? Log debug but don't crash main init.\n\t\t\t\t\tthis.adapter.rLog(\"HTTP\", null, \"Warn\", \"Cloud\", undefined, `Failed to fetch V3 HomeData (optional): ${e3.message}`, \"warn\");\n\t\t\t\t}\n\n\t\t\t\tawait this.adapter.setState(\"HomeData\", { val: JSON.stringify(this.homeData), ack: true });\n\t\t\t} catch (e: any) {\n\t\t\t\tthis.adapter.rLog(\"HTTP\", null, \"Error\", \"Cloud\", undefined, `Error updating HomeData: ${e?.stack || e}`, \"error\");\n\t\t\t\tthis.homeData = null;\n\t\t\t}\n\t\t} else {\n\t\t\tthis.adapter.rLog(\"HTTP\", null, \"Error\", \"Cloud\", undefined, `No homeId found`, \"error\");\n\t\t}\n\t}\n\n\t/**\n\t * Returns the RRIOT authentication data.\n\t */\n\tget_rriot(): RriotData {\n\t\tif (!this.userData) {\n\t\t\tthrow new Error(\"this.userData is not initialized. Call updateHomeData() first\");\n\t\t}\n\t\treturn this.userData.rriot;\n\t}\n\n\t/**\n\t * Resolves the numeric Product ID for a given model.\n\t * Tries V3 HomeData first, then V5 ProductInfo.\n\t */\n\tgetProductIdByModel(modelName: string): number | null {\n\t\t// 1. Try V5 ProductInfo\n\t\tif (this.productInfo && this.productInfo.data && Array.isArray(this.productInfo.data.categoryDetailList)) {\n\t\t\tfor (const detail of this.productInfo.data.categoryDetailList) {\n\t\t\t\tif (detail.productList && Array.isArray(detail.productList)) {\n\t\t\t\t\tconst productV5 = detail.productList.find((p) => p.model === modelName);\n\t\t\t\t\tif (productV5) {\n\t\t\t\t\t\treturn Number(productV5.id);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// Log if we have info but can't find model\n\t\tif (this.productInfo) {\n\t\t\tthis.adapter.rLog(\"HTTP\", null, \"Warn\", \"Cloud\", undefined, `Model ${modelName} not found in V5 ProductInfo.`, \"warn\");\n\t\t}\n\n\t\treturn null;\n\t}\n\n\t/**\n\t * Retrieves scenes for the current home.\n\t */\n\tasync getScenes(): Promise<any> {\n\t\tif (!this.loginApi) throw new Error(\"loginApi is not initialized.\");\n\t\tif (!this.realApi) throw new Error(\"realApi is not initialized.\");\n\n\t\treturn await this.realApi.get(`user/scene/home/${this.homeID}`).then((res) => res.data);\n\t}\n\n\t/**\n\t * Executes a specific scene.\n\t */\n\tasync executeScene(sceneID: { val: string | number }): Promise<void> {\n\t\tif (!this.realApi) throw new Error(\"realApi is not initialized.\");\n\n\t\tawait this.realApi.post(`user/scene/${sceneID.val}/execute`);\n\t}\n\n\t/**\n\t * Stores firmware feature IDs in the cache for a specific device.\n\t */\n\tpublic storeFwFeaturesResult(duid: string, featureIds: number[]): void {\n\t\tif (Array.isArray(featureIds)) {\n\t\t\tthis.fwFeaturesCache.set(duid, featureIds);\n\t\t\tthis.adapter.rLog(\"HTTP\", duid, \"Debug\", \"Cloud\", undefined, `Stored FW features result: ${JSON.stringify(featureIds)}`, \"debug\");\n\t\t} else {\n\t\t\tthis.adapter.rLog(\"HTTP\", duid, \"Warn\", \"Cloud\", undefined, `Invalid data received for storing FW features: ${JSON.stringify(featureIds)}`, \"warn\");\n\t\t}\n\t}\n\n\tpublic getFwFeaturesResult(duid: string): number[] | undefined {\n\t\treturn this.fwFeaturesCache.get(duid);\n\t}\n\n\t/**\n\t * Retrieves firmware update status for a device.\n\t */\n\tasync getFirmwareStates(duid: string): Promise<any> {\n\t\ttry {\n\t\t\tif (!this.realApi) throw new Error(\"realApi is not initialized.\");\n\n\t\t\treturn await this.realApi.get(`ota/firmware/${duid}/updatev2`);\n\t\t} catch (error: any) {\n\t\t\tthrow new Error(`Error in getFirmwareStates: ${error.message}`);\n\t\t}\n\t}\n\n\t/**\n\t * Returns the list of products from HomeData.\n\t */\n\tgetProducts(): Product[] {\n\t\tif (!this.homeData) {\n\t\t\tthrow new Error(\"this.homeData is not initialized. Initialize via updateHomeData() first\");\n\t\t}\n\t\treturn this.homeData.products;\n\t}\n\n\t/**\n\t * Returns a combined list of owned and shared devices.\n\t */\n\tgetDevices(): Device[] {\n\t\tif (!this.homeData) {\n\t\t\tthis.adapter.rLog(\"HTTP\", null, \"Warn\", \"Cloud\", undefined, \"homeData not initialized, returning empty devices list\", \"warn\");\n\t\t\treturn [];\n\t\t}\n\t\treturn [...(this.homeData.devices || []), ...(this.homeData.receivedDevices || [])];\n\t}\n\n\tgetReceivedDevices(): Device[] {\n\t\tif (!this.homeData) {\n\t\t\tthrow new Error(\"this.homeData is not initialized. Initialize via updateHomeData() first\");\n\t\t}\n\t\treturn this.homeData.receivedDevices;\n\t}\n\n\t/**\n\t * Checks if a device is a shared device (not owned by the user).\n\t */\n\tisSharedDevice(duid: string): boolean {\n\t\tconst sharedDevices = this.getReceivedDevices();\n\t\treturn sharedDevices.some((device) => device.duid === duid);\n\t}\n\n\t/**\n\t * Matches rooms from HomeData and optionally assigns fallback names.\n\t */\n\tgetMatchedRoomIDs(assignFallbackNames = false): { id: number; name: string }[] {\n\t\tif (!this.homeData || !Array.isArray(this.homeData.rooms)) {\n\t\t\t// Not throwing an error here anymore, just logging warning to prevent crashes if rooms are missing\n\t\t\tthis.adapter.rLog(\"HTTP\", null, \"Warn\", \"Cloud\", undefined, \"getMatchedRoomIDs: this.homeData.rooms is missing or invalid.\", \"warn\");\n\t\t\treturn [];\n\t\t}\n\n\t\tlet unnamedCounter = 1;\n\n\t\tconst matchedRooms = this.homeData.rooms.map((room) => {\n\t\t\tlet name = room.name?.trim();\n\n\t\t\tif (!name && assignFallbackNames) {\n\t\t\t\tname = `Room ${unnamedCounter++}`;\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\tid: room.id,\n\t\t\t\tname: name || \"\",\n\t\t\t};\n\t\t});\n\n\t\tif (assignFallbackNames) {\n\t\t\tthis.adapter.rLog(\"HTTP\", null, \"Info\", \"Cloud\", undefined, `Matched ${matchedRooms.length} rooms (fallback names included)`, \"info\");\n\t\t}\n\n\t\treturn matchedRooms;\n\t}\n\n\t/**\n\t * Maps all devices to their local keys.\n\t */\n\tgetMatchedLocalKeys(): Map<string, string> {\n\t\tif (!this.homeData) {\n\t\t\tthrow new Error(\"this.homeData is not initialized. Initialize via updateHomeData() first\");\n\t\t}\n\n\t\tconst devices = this.getDevices();\n\t\treturn new Map(devices.map((device) => [device.duid, device.localKey]));\n\t}\n\n\t/**\n\t * Finds the model name for a given device DUID.\n\t */\n\tgetRobotModel(duid: string): string | null {\n\t\tif (!duid) {\n\t\t\tthrow new Error(\"Parameter duid missing in function getRobotModel\");\n\t\t}\n\n\t\tconst devices = this.getDevices();\n\t\ttry {\n\t\t\tconst products = this.getProducts();\n\n\t\t\tconst device = devices.find((d) => d.duid === duid);\n\t\t\tif (!device) {\n\t\t\t\tthis.adapter.rLog(\"HTTP\", duid, \"Error\", \"Cloud\", undefined, \"Device not found in local homeData\", \"error\");\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\tconst product = products.find((p) => p.id === device.productId);\n\t\t\treturn product ? product.model : null;\n\t\t} catch (error: any) {\n\t\t\tthis.adapter.rLog(\"HTTP\", duid, \"Error\", \"Cloud\", undefined, `Error in getRobotModel: ${error.message}`, \"error\");\n\t\t\treturn null;\n\t\t}\n\t}\n\n\t/**\n\t * Finds the product category for a given device DUID.\n\t */\n\tgetProductCategory(duid: string): string | null {\n\t\tconst devices = this.getDevices();\n\t\ttry {\n\t\t\tconst products = this.getProducts();\n\n\t\t\tconst device = devices.find((d) => d.duid == duid);\n\t\t\tif (!device) return null;\n\n\t\t\tconst product = products.find((p) => p.id == device.productId);\n\t\t\treturn product ? product.category : null;\n\t\t} catch (error: any) {\n\t\t\tthis.adapter.rLog(\"HTTP\", duid, \"Error\", \"Cloud\", undefined, `Error in getProductCategory: ${error.message}`, \"error\");\n\t\t\treturn null;\n\t\t}\n\t}\n\n\tpublic getFeatureSet(duid: string): number | undefined {\n\t\tconst allDevices = this.getDevices();\n\t\tconst device = allDevices.find((d) => d.duid === duid);\n\t\treturn device?.featureSet;\n\t}\n\n\tpublic getNewFeatureSet(duid: string): string | undefined {\n\t\tconst allDevices = this.getDevices();\n\t\tconst device = allDevices.find((d) => d.duid === duid);\n\t\treturn device?.newFeatureSet;\n\t}\n}\n"]}