{"version":3,"file":"httpApi.js","sourceRoot":"","sources":["../../src/lib/httpApi.ts"],"names":[],"mappings":"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","sourcesContent":["import { Roborock } from \"../main\";\r\nimport axios, { type AxiosInstance, type InternalAxiosRequestConfig } from \"axios\";\r\nimport * as crypto from \"crypto\";\r\n\r\n// Credits to rovo89 for the initial reverse engineering\r\n// https://gist.github.com/rovo89/dff47ed19fca0dfdda77503e66c2b7c7\r\n\r\nconst API_BASE_URL = \"https://euiot.roborock.com\";\r\nconst API_LOGIN_ENDPOINT = \"api/v1/login\";\r\n\r\n// --------------------\r\n// Interfaces & Types\r\n// --------------------\r\n\r\ninterface RriotData {\r\n\tu: string;\r\n\ts: string;\r\n\th: string;\r\n\tk: string;\r\n\tr: { a: string; m: string };\r\n}\r\n\r\ninterface UserData {\r\n\ttoken: string;\r\n\trriot: RriotData;\r\n\t// ... other potential user fields\r\n}\r\n\r\nexport interface Device {\r\n\tduid: string;\r\n\tlocalKey: string;\r\n\tproductId: string;\r\n\tname?: string;\r\n\tfeatureSet?: number;\r\n\tnewFeatureSet?: string;\r\n\tonline: boolean;\r\n\tdeviceStatus: any;\r\n\tpv: string;\r\n}\r\n\r\ninterface Product {\r\n\tid: string;\r\n\tmodel: string;\r\n\tcategory: string;\r\n\tname?: string;\r\n}\r\n\r\ninterface Room {\r\n\tid: number;\r\n\tname: string;\r\n}\r\n\r\ninterface HomeData {\r\n\trrHomeId: number;\r\n\tproducts: Product[];\r\n\tdevices: Device[];\r\n\treceivedDevices: Device[];\r\n\trooms: Room[];\r\n}\r\n\r\n/**\r\n * Helper to calculate MD5 hex string\r\n */\r\nfunction md5hex(str: string): string {\r\n\treturn crypto.createHash(\"md5\").update(str).digest(\"hex\");\r\n}\r\n\r\nexport class http_api {\r\n\tadapter: Roborock;\r\n\tloginApi: AxiosInstance | null;\r\n\trealApi: AxiosInstance | null;\r\n\tuserData: UserData | null;\r\n\thomeData: HomeData | null;\r\n\thomeID: string | null;\r\n\r\n\tprivate fwFeaturesCache = new Map<string, number[]>();\r\n\r\n\tconstructor(adapter: Roborock) {\r\n\t\tthis.adapter = adapter;\r\n\r\n\t\tthis.loginApi = null;\r\n\t\tthis.realApi = null;\r\n\t\tthis.userData = null;\r\n\t\tthis.homeData = null;\r\n\t\tthis.homeID = null;\r\n\t}\r\n\r\n\t/**\r\n\t * Initializes the Login API and attempts to set up the Real API.\r\n\t * @param clientID The client identifier.\r\n\t */\r\n\tasync init(clientID: string): Promise<void> {\r\n\t\t// Initialize the login API (needed to get access to the real API)\r\n\t\tthis.loginApi = axios.create({\r\n\t\t\tbaseURL: API_BASE_URL,\r\n\t\t\theaders: {\r\n\t\t\t\theader_clientid: crypto.createHash(\"md5\").update(this.adapter.config.username).update(clientID).digest().toString(\"base64\"),\r\n\t\t\t},\r\n\t\t});\r\n\r\n\t\tawait this.initializeRealApi();\r\n\t\tawait this.getHomeID();\r\n\t}\r\n\r\n\t/**\r\n\t * Logs in (if necessary) and sets up the authenticated \"Real API\" with Hawk authentication.\r\n\t */\r\n\tasync initializeRealApi(): Promise<void> {\r\n\t\tthis.adapter.log.debug(`initialize http_api`);\r\n\r\n\t\tif (!this.loginApi) {\r\n\t\t\tthrow new Error(\"loginApi is not initialized. Call init() first.\");\r\n\t\t}\r\n\t\tif (!this.userData) {\r\n\t\t\ttry {\r\n\t\t\t\tthis.userData = await this.loginApi\r\n\t\t\t\t\t.post(\r\n\t\t\t\t\t\tAPI_LOGIN_ENDPOINT,\r\n\t\t\t\t\t\tnew URLSearchParams({\r\n\t\t\t\t\t\t\tusername: this.adapter.config.username,\r\n\t\t\t\t\t\t\tpassword: this.adapter.config.password,\r\n\t\t\t\t\t\t\tneedtwostepauth: \"false\",\r\n\t\t\t\t\t\t}).toString()\r\n\t\t\t\t\t)\r\n\t\t\t\t\t.then((res) => res.data.data);\r\n\r\n\t\t\t\tif (!this.userData) {\r\n\t\t\t\t\tthrow new Error(\"Login returned empty userdata.\");\r\n\t\t\t\t}\r\n\r\n\t\t\t\tawait this.adapter.setState(\"UserData\", { val: JSON.stringify(this.userData), ack: true });\r\n\t\t\t} catch (error: any) {\r\n\t\t\t\tthis.adapter.log.error(`Error in getUserData: ${error.message}. This is most likely due to too many reconnects. Emptying UserData & HomeData`);\r\n\r\n\t\t\t\tawait this.adapter.setState(\"HomeData\", { val: null, ack: true });\r\n\t\t\t\tawait this.adapter.setState(\"UserData\", { val: null, ack: true });\r\n\r\n\t\t\t\t// Rethrow or handle gracefully? Rethrowing to stop init.\r\n\t\t\t\tthrow error;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (!this.userData?.token) {\r\n\t\t\tthrow new Error(\"Failed to retrieve user token. Check login credentials.\");\r\n\t\t}\r\n\r\n\t\t// Set global auth header for loginApi (though mostly unused after this)\r\n\t\tthis.loginApi.defaults.headers.common[\"Authorization\"] = this.userData.token;\r\n\r\n\t\ttry {\r\n\t\t\tconst rriot = this.get_rriot();\r\n\r\n\t\t\t// Initialize the real API with Hawk Authentication Interceptor\r\n\t\t\tconst realApi = axios.create({ baseURL: this.userData.rriot.r.a });\r\n\r\n\t\t\trealApi.interceptors.request.use((config: InternalAxiosRequestConfig) => {\r\n\t\t\t\tconst timestamp = Math.floor(Date.now() / 1000);\r\n\t\t\t\tconst nonce = crypto\r\n\t\t\t\t\t.randomBytes(6)\r\n\t\t\t\t\t.toString(\"base64\")\r\n\t\t\t\t\t.substring(0, 6)\r\n\t\t\t\t\t.replace(/[+/]/g, (m) => (m === \"+\" ? \"X\" : \"Y\"));\r\n\r\n\t\t\t\t// Calculate signature\r\n\t\t\t\tlet urlPath = \"\";\r\n\t\t\t\tif (config.url) {\r\n\t\t\t\t\t// Handle relative URLs correctly by creating a dummy base if needed\r\n\t\t\t\t\t// or using the instance's baseURL if config.url is relative\r\n\t\t\t\t\tconst fullUrl = axios.getUri(config);\r\n\t\t\t\t\ttry {\r\n\t\t\t\t\t\turlPath = new URL(fullUrl).pathname;\r\n\t\t\t\t\t} catch {\r\n\t\t\t\t\t\t// Fallback if URL construction fails\r\n\t\t\t\t\t\turlPath = config.url;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tconst prestr = [rriot.u, rriot.s, nonce, timestamp, md5hex(urlPath), \"\", \"\"].join(\":\");\r\n\t\t\t\tconst mac = crypto.createHmac(\"sha256\", rriot.h).update(prestr).digest(\"base64\");\r\n\r\n\t\t\t\tconfig.headers[\"Authorization\"] = `Hawk id=\"${rriot.u}\", s=\"${rriot.s}\", ts=\"${timestamp}\", nonce=\"${nonce}\", mac=\"${mac}\"`;\r\n\r\n\t\t\t\treturn config;\r\n\t\t\t});\r\n\r\n\t\t\tthis.realApi = realApi;\r\n\r\n\t\t\tawait this.adapter.setState(\"info.connection\", { val: true, ack: true });\r\n\t\t} catch (error: any) {\r\n\t\t\tthis.adapter.log.error(`Error in initializeRealApi: ${error.stack}`);\r\n\t\t\tawait this.adapter.setState(\"info.connection\", { val: false, ack: true });\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Retrieves the Home ID from the API.\r\n\t */\r\n\tasync getHomeID(): Promise<void> {\r\n\t\tif (!this.loginApi) {\r\n\t\t\tthrow new Error(\"loginApi is not initialized. Call init() first.\");\r\n\t\t}\r\n\r\n\t\ttry {\r\n\t\t\tconst response = await this.loginApi.get(\"api/v1/getHomeDetail\");\r\n\t\t\tif (response.data.data) {\r\n\t\t\t\tthis.adapter.log.debug(`getHomeDetail: ${JSON.stringify(response.data)}`);\r\n\t\t\t\tthis.homeID = response.data.data.rrHomeId;\r\n\t\t\t\tthis.adapter.log.debug(`this.homeID: ${this.homeID}`);\r\n\t\t\t} else {\r\n\t\t\t\tthis.adapter.log.error(`failed to get getHomeDetail: ${response.data.msg}`);\r\n\t\t\t}\r\n\t\t} catch (error: any) {\r\n\t\t\tthis.adapter.log.error(`Error getting HomeID: ${error.message}`);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Downloads the latest Home Data (Devices, Rooms, Products) and stores it in state.\r\n\t */\r\n\tasync updateHomeData(): Promise<void> {\r\n\t\tif (!this.loginApi) throw new Error(\"loginApi is not initialized. Call init() first.\");\r\n\t\tif (!this.realApi) throw new Error(\"realApi is not initialized. Call initializeRealApi() first\");\r\n\r\n\t\tif (this.homeID) {\r\n\t\t\tthis.adapter.log.debug(`Getting HomeData with homeId: ${this.homeID}`);\r\n\t\t\ttry {\r\n\t\t\t\tconst res = await this.realApi.get(`v2/user/homes/${this.homeID}`);\r\n\t\t\t\tthis.homeData = res.data.result;\r\n\r\n\t\t\t\tawait this.adapter.setState(\"HomeData\", { val: JSON.stringify(this.homeData), ack: true });\r\n\t\t\t} catch (e: any) {\r\n\t\t\t\tthis.adapter.log.error(`Error updating HomeData: ${e?.stack || e}`);\r\n\t\t\t\tthis.homeData = null;\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tthis.adapter.log.error(`No homeId found`);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Returns the RRIOT authentication data.\r\n\t */\r\n\tget_rriot(): RriotData {\r\n\t\tif (!this.userData) {\r\n\t\t\tthrow new Error(\"this.userData is not initialized. Call updateHomeData() first\");\r\n\t\t}\r\n\t\treturn this.userData.rriot;\r\n\t}\r\n\r\n\t/**\r\n\t * Retrieves scenes for the current home.\r\n\t */\r\n\tasync getScenes(): Promise<any> {\r\n\t\tif (!this.loginApi) throw new Error(\"loginApi is not initialized.\");\r\n\t\tif (!this.realApi) throw new Error(\"realApi is not initialized.\");\r\n\r\n\t\treturn await this.realApi.get(`user/scene/home/${this.homeID}`).then((res) => res.data);\r\n\t}\r\n\r\n\t/**\r\n\t * Executes a specific scene.\r\n\t */\r\n\tasync executeScene(sceneID: { val: string | number }): Promise<void> {\r\n\t\tif (!this.realApi) throw new Error(\"realApi is not initialized.\");\r\n\r\n\t\tawait this.realApi.post(`user/scene/${sceneID.val}/execute`);\r\n\t}\r\n\r\n\t/**\r\n\t * Stores firmware feature IDs in the cache for a specific device.\r\n\t */\r\n\tpublic storeFwFeaturesResult(duid: string, featureIds: number[]): void {\r\n\t\tif (Array.isArray(featureIds)) {\r\n\t\t\tthis.fwFeaturesCache.set(duid, featureIds);\r\n\t\t\tthis.adapter.log.debug(`[HTTP_API|${duid}] Stored FW features result: ${JSON.stringify(featureIds)}`);\r\n\t\t} else {\r\n\t\t\tthis.adapter.log.warn(`[HTTP_API|${duid}] Invalid data received for storing FW features: ${JSON.stringify(featureIds)}`);\r\n\t\t}\r\n\t}\r\n\r\n\tpublic getFwFeaturesResult(duid: string): number[] | undefined {\r\n\t\treturn this.fwFeaturesCache.get(duid);\r\n\t}\r\n\r\n\t/**\r\n\t * Retrieves firmware update status for a device.\r\n\t */\r\n\tasync getFirmwareStates(duid: string): Promise<any> {\r\n\t\ttry {\r\n\t\t\tif (!this.realApi) throw new Error(\"realApi is not initialized.\");\r\n\r\n\t\t\treturn await this.realApi.get(`ota/firmware/${duid}/updatev2`);\r\n\t\t} catch (error: any) {\r\n\t\t\tthrow new Error(`Error in getFirmwareStates: ${error.message}`);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Returns the list of products from HomeData.\r\n\t */\r\n\tgetProducts(): Product[] {\r\n\t\tif (!this.homeData) {\r\n\t\t\tthrow new Error(\"this.homeData is not initialized. Initialize via updateHomeData() first\");\r\n\t\t}\r\n\t\treturn this.homeData.products;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns a combined list of owned and shared devices.\r\n\t */\r\n\tgetDevices(): Device[] {\r\n\t\tif (!this.homeData) {\r\n\t\t\tthis.adapter.log.warn(\"homeData not initialized, returning empty devices list\");\r\n\t\t\treturn [];\r\n\t\t}\r\n\t\treturn [...(this.homeData.devices || []), ...(this.homeData.receivedDevices || [])];\r\n\t}\r\n\r\n\tgetReceivedDevices(): Device[] {\r\n\t\tif (!this.homeData) {\r\n\t\t\tthrow new Error(\"this.homeData is not initialized. Initialize via updateHomeData() first\");\r\n\t\t}\r\n\t\treturn this.homeData.receivedDevices;\r\n\t}\r\n\r\n\t/**\r\n\t * Checks if a device is a shared device (not owned by the user).\r\n\t */\r\n\tisSharedDevice(duid: string): boolean {\r\n\t\tconst sharedDevices = this.getReceivedDevices();\r\n\t\treturn sharedDevices.some((device) => device.duid === duid);\r\n\t}\r\n\r\n\t/**\r\n\t * Matches rooms from HomeData and optionally assigns fallback names.\r\n\t */\r\n\tgetMatchedRoomIDs(assignFallbackNames = false): { id: number; name: string }[] {\r\n\t\tif (!this.homeData || !Array.isArray(this.homeData.rooms)) {\r\n\t\t\t// Not throwing an error here anymore, just logging warning to prevent crashes if rooms are missing\r\n\t\t\tthis.adapter.log.warn(\"getMatchedRoomIDs: this.homeData.rooms is missing or invalid.\");\r\n\t\t\treturn [];\r\n\t\t}\r\n\r\n\t\tlet unnamedCounter = 1;\r\n\r\n\t\tconst matchedRooms = this.homeData.rooms.map((room) => {\r\n\t\t\tlet name = room.name?.trim();\r\n\r\n\t\t\tif (!name && assignFallbackNames) {\r\n\t\t\t\tname = `Room ${unnamedCounter++}`;\r\n\t\t\t}\r\n\r\n\t\t\treturn {\r\n\t\t\t\tid: room.id,\r\n\t\t\t\tname: name || \"\",\r\n\t\t\t};\r\n\t\t});\r\n\r\n\t\tif (assignFallbackNames) {\r\n\t\t\tthis.adapter.log.info(`Matched ${matchedRooms.length} rooms (fallback names included)`);\r\n\t\t}\r\n\r\n\t\treturn matchedRooms;\r\n\t}\r\n\r\n\t/**\r\n\t * Maps all devices to their local keys.\r\n\t */\r\n\tgetMatchedLocalKeys(): Map<string, string> {\r\n\t\tif (!this.homeData) {\r\n\t\t\tthrow new Error(\"this.homeData is not initialized. Initialize via updateHomeData() first\");\r\n\t\t}\r\n\r\n\t\tconst devices = this.getDevices();\r\n\t\treturn new Map(devices.map((device) => [device.duid, device.localKey]));\r\n\t}\r\n\r\n\t/**\r\n\t * Finds the model name for a given device DUID.\r\n\t */\r\n\tgetRobotModel(duid: string): string | null {\r\n\t\tif (!duid) {\r\n\t\t\tthrow new Error(\"Parameter duid missing in function getRobotModel\");\r\n\t\t}\r\n\r\n\t\tconst devices = this.getDevices();\r\n\t\ttry {\r\n\t\t\tconst products = this.getProducts();\r\n\r\n\t\t\tconst device = devices.find((d) => d.duid === duid);\r\n\t\t\tif (!device) {\r\n\t\t\t\tthis.adapter.log.error(`device ${duid} not found in devices`);\r\n\t\t\t\treturn null;\r\n\t\t\t}\r\n\r\n\t\t\tconst product = products.find((p) => p.id === device.productId);\r\n\t\t\treturn product ? product.model : null;\r\n\t\t} catch (error: any) {\r\n\t\t\tthis.adapter.log.error(`Error in getRobotModel: ${error.message}`);\r\n\t\t\treturn null;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Finds the product category for a given device DUID.\r\n\t */\r\n\tgetProductCategory(duid: string): string | null {\r\n\t\tconst devices = this.getDevices();\r\n\t\ttry {\r\n\t\t\tconst products = this.getProducts();\r\n\r\n\t\t\tconst device = devices.find((d) => d.duid == duid);\r\n\t\t\tif (!device) return null;\r\n\r\n\t\t\tconst product = products.find((p) => p.id == device.productId);\r\n\t\t\treturn product ? product.category : null;\r\n\t\t} catch (error: any) {\r\n\t\t\tthis.adapter.log.error(`Error in getProductCategory: ${error.message}`);\r\n\t\t\treturn null;\r\n\t\t}\r\n\t}\r\n\r\n\tpublic getFeatureSet(duid: string): number | undefined {\r\n\t\tconst allDevices = this.getDevices();\r\n\t\tconst device = allDevices.find((d) => d.duid === duid);\r\n\t\treturn device?.featureSet;\r\n\t}\r\n\r\n\tpublic getNewFeatureSet(duid: string): string | undefined {\r\n\t\tconst allDevices = this.getDevices();\r\n\t\tconst device = allDevices.find((d) => d.duid === duid);\r\n\t\treturn device?.newFeatureSet;\r\n\t}\r\n}\r\n"]}