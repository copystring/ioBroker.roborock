{"version":3,"file":"main.js","sourceRoot":"","sources":["../src/main.ts"],"names":[],"mappings":"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","sourcesContent":["const utils = require(\"@iobroker/adapter-core\");\r\nimport { randomBytes } from \"crypto\";\r\nimport ws from \"ws\";\r\nimport express from \"express\";\r\nimport { spawn } from \"child_process\";\r\nimport go2rtcPath from \"go2rtc-static\";\r\n\r\nimport { roborock_package_helper } from \"./lib/roborock_package_helper\";\r\nimport { device_features } from \"./lib/device_features\";\r\nimport { requestsHandler } from \"./lib/requestsHandler\";\r\nimport { http_api } from \"./lib/http_api\";\r\nimport { local_api } from \"./lib/local_api\";\r\nimport { mqtt_api } from \"./lib/mqtt_api\";\r\nconst sniffing = require(\"../lib/sniffing\");\r\n\r\nlet socketServer, webserver;\r\n\r\nconst dockingStationStates = [\"cleanFluidStatus\", \"waterBoxFilterStatus\", \"dustBagStatus\", \"dirtyWaterBoxStatus\", \"clearWaterBoxStatus\", \"isUpdownWaterReady\"];\r\n\r\ntype StateObjectOptions = {\r\n\tpath: string;\r\n\tname: string;\r\n\ttype: string;\r\n\tunit?: string;\r\n\tdef?: any;\r\n\trole?: string;\r\n\tread?: boolean;\r\n\twrite?: boolean;\r\n\tstates?: any;\r\n\tnative?: Record<string, any>;\r\n};\r\n\r\ntype DeviceStatus = Record<string, number>;\r\n\r\ninterface SendValue {\r\n\tparameters: any[];\r\n\tcommand: string;\r\n}\r\n\r\ninterface Robot {\r\n\tduid: string;\r\n\tname: string;\r\n}\r\n\r\ninterface StateCommonExtension {\r\n\tmin?: number;\r\n\tmax?: number;\r\n\tunit?: string;\r\n}\r\n\r\nconst A01states = {\r\n\t200: \"Start\",\r\n\t201: \"Status\",\r\n\t202: \"SelfCleanMode\",\r\n\t203: \"SelfCleanLevel\",\r\n\t204: \"WarmLevel\",\r\n\t205: \"CleanMode\",\r\n\t206: \"Suction\",\r\n\t207: \"WaterLevel\",\r\n\t208: \"BrushSpeed\",\r\n\t209: \"Power\",\r\n\t210: \"Preset\",\r\n\t212: \"AutoSelfClean\",\r\n\t213: \"AutoDry\",\r\n\t214: \"MeshLeft\",\r\n\t215: \"BrushLeft\",\r\n\t216: \"Error\",\r\n\t218: \"MeshReset\",\r\n\t219: \"BrushReset\",\r\n\t221: \"Volumn\",\r\n\t222: \"StandLockAutoRun\",\r\n\t223: \"AutoSelfCleanMode\",\r\n\t224: \"AutoDryMode\",\r\n\t225: \"SilentDryDuration\",\r\n\t226: \"SilentModeSwitch\",\r\n\t227: \"SilentModeStartTime\",\r\n\t228: \"SilentModeEndTime\",\r\n\t229: \"RecentCleanTime\",\r\n\t230: \"TotalCleanTime\",\r\n\t235: \"FeatureInfo\",\r\n\t236: \"ResetRobot\",\r\n\t237: \"DryRemainTimeMin\",\r\n\t238: \"Cleanser\",\r\n\t10000: \"QueryDP\",\r\n\t10001: \"CheckIsFCC\",\r\n\t10002: \"AutoDryTimer\",\r\n\t10003: \"SetSoundPackage\",\r\n\t10004: \"SoundPackageInfo\",\r\n\t10005: \"GeneralInfo\",\r\n\t10006: \"PrivacyInfo\",\r\n\t10007: \"UpdateInfo\",\r\n\t10101: \"RPCRequest\",\r\n\t10102: \"RPCResponse\",\r\n};\r\n\r\nexport class Roborock extends utils.Adapter {\r\n\tconstructor(options = {}) {\r\n\t\tsuper({ ...options, name: \"roborock\", useFormatDate: true });\r\n\t\tthis.on(\"ready\", this.onReady.bind(this));\r\n\t\tthis.on(\"stateChange\", this.onStateChange.bind(this));\r\n\t\t// this.on(\"objectChange\", this.onObjectChange.bind(this));\r\n\t\t// this.on(\"message\", this.onMessage.bind(this));\r\n\t\tthis.on(\"unload\", this.onUnload.bind(this));\r\n\r\n\t\tthis.socket = null;\r\n\t\tthis.nonce = randomBytes(16);\r\n\t\tthis.pendingRequests = new Map();\r\n\t\tthis.http_api = new http_api(this);\r\n\t\tthis.local_api = new local_api(this);\r\n\t\tthis.mqtt_api = new mqtt_api(this);\r\n\t\tthis.roborock_package_helper = new roborock_package_helper(this);\r\n\t\tthis.requestsHandler = new requestsHandler(this);\r\n\t\tthis.device_features = new device_features(this);\r\n\t\tthis.sniffing = new sniffing(this);\r\n\r\n\t\tthis.isInitializing = true;\r\n\t}\r\n\r\n\t/**\r\n\t * Is called when databases are connected and adapter received configuration.\r\n\t */\r\n\tasync onReady() {\r\n\t\tif (!this.config.username || !this.config.password) {\r\n\t\t\tthis.log.error(\"Username or password missing!\");\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tthis.sentryInstance = this.getPluginInstance(\"sentry\");\r\n\t\tthis.translations = require(`.././admin/i18n/${this.language || \"en\"}/translations.json`); // fall back to en for test-and-release.yml\r\n\r\n\t\tthis.log.info(`Starting adapter. This might take a few minutes depending on your setup. Please wait.`);\r\n\r\n\t\tawait this.setupBasicObjects();\r\n\r\n\t\ttry {\r\n\t\t\tconst clientID = await this.ensureClientID();\r\n\t\t\tawait this.http_api.init(clientID);\r\n\t\t} catch (error) {\r\n\t\t\tthis.log.error(`Failed to get clientID. ${error.stack}`);\r\n\t\t}\r\n\r\n\t\t// Initialize MQTT API\r\n\t\tawait this.mqtt_api.init();\r\n\r\n\t\tawait this.http_api.updateHomeData();\r\n\t\tconst devices = this.http_api.getDevices();\r\n\t\tthis.log.debug(`Devices from cloud: ${JSON.stringify(devices)}`);\r\n\r\n\t\tawait this.local_api.startUdpDiscovery();\r\n\r\n\t\tfor (const device of devices) {\r\n\t\t\tconst duid = device.duid;\r\n\r\n\t\t\t// need to get network data before processing any other data\r\n\t\t\tconst version = await this.getDeviceProtocolVersion(device.duid);\r\n\t\t\tconst isSharedDevice = this.http_api.isSharedDevice(device.duid);\r\n\r\n\t\t\tif (version != \"A01\" && !isSharedDevice) {\r\n\t\t\t\tconst duid = device.duid;\r\n\r\n\t\t\t\tawait this.requestsHandler.getParameter(duid, \"get_network_info\", []); // this needs to be called first on start of adapter to get the IP adresses of each device\r\n\t\t\t}\r\n\r\n\t\t\tif (device.online) {\r\n\t\t\t\tawait this.local_api.initiateClient(duid);\r\n\r\n\t\t\t\tthis.log.debug(`Device ${duid} is using protocol version ${version}`);\r\n\t\t\t\tawait this.createDeviceObjects(device);\r\n\t\t\t\tswitch (version) {\r\n\t\t\t\t\tcase \"A01\":\r\n\t\t\t\t\t\tawait this.requestsHandler.getStatus(duid);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase \"L01\":\r\n\t\t\t\t\t\tawait this.local_api.initL01(duid);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tdefault:\r\n\t\t\t\t\t\t// get all maps on start of adapter but don't wait for them to finish. Not waiting speeds up the startup process\r\n\t\t\t\t\t\tthis.requestsHandler.getCleanSummary(duid).catch((error) => {\r\n\t\t\t\t\t\t\tthis.catchError(error.stack, \"getCleanSummary\", duid);\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\tthis.requestsHandler.getStatus(duid).catch((error) => {\r\n\t\t\t\t\t\t\tthis.catchError(error.stack, \"getStatus\", duid);\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\tthis.requestsHandler.getMap(duid).catch((error) => {\r\n\t\t\t\t\t\t\tthis.catchError(error.stack, \"getMap\", duid);\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tthis.log.debug(`Device ${duid} is offline. Skipping status update.`);\r\n\t\t\t}\r\n\t\t}\r\n\t\tawait this.processScenes();\r\n\r\n\t\tthis.log.info(`Starting adapter finished. Let's go!!!!!!!`);\r\n\r\n\t\t// handle requests based on interval here. No separate interval needed anywhere\r\n\t\tthis.log.debug(`initializing mainUpdateInterval`);\r\n\t\tlet updateIntervalCount = this.config.updateInterval; // start with update to get data right away\r\n\t\tthis.mainUpdateInterval = this.setInterval(async () => {\r\n\t\t\tupdateIntervalCount++; // this needs to be here in case someone sets the interval to 1 second to avoid running it twice in the beginning\r\n\r\n\t\t\tif (updateIntervalCount >= this.config.updateInterval) {\r\n\t\t\t\tupdateIntervalCount = 0;\r\n\r\n\t\t\t\tawait this.http_api.updateHomeData(); // this is needed to get the online status of the devices and has to run before any other requests. Otherwise requests might be missing homedata and will time out.\r\n\t\t\t\tconst cloudDevices = this.http_api.getDevices();\r\n\t\t\t\tthis.log.debug(`cloudDevices: ${JSON.stringify(cloudDevices)}`);\r\n\t\t\t\tthis.log.debug(`localDevices: ${JSON.stringify(this.local_api.localDevices)}`);\r\n\r\n\t\t\t\tfor (const device of cloudDevices) {\r\n\t\t\t\t\tconst duid = device.duid;\r\n\r\n\t\t\t\t\tif (!device.online) {\r\n\t\t\t\t\t\tthis.log.debug(`Device ${duid} is offline. Skipping status update.`);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tawait this.updateDeviceInfo(duid, cloudDevices);\r\n\t\t\t\t\t\tconst version = await this.getDeviceProtocolVersion(duid);\r\n\r\n\t\t\t\t\t\tswitch (version) {\r\n\t\t\t\t\t\t\tcase \"A01\":\r\n\t\t\t\t\t\t\t\tawait this.requestsHandler.getStatus(duid);\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\tdefault:\r\n\t\t\t\t\t\t\t\ttry {\r\n\t\t\t\t\t\t\t\t\tawait this.requestsHandler.getStatus(duid);\r\n\r\n\t\t\t\t\t\t\t\t\tthis.updateDeviceData(duid);\r\n\t\t\t\t\t\t\t\t\tthis.updateConsumablesPercent(duid);\r\n\r\n\t\t\t\t\t\t\t\t\t// update map when needed\r\n\t\t\t\t\t\t\t\t\tconst isCleaning = this.requestsHandler.isCleaning(duid);\r\n\t\t\t\t\t\t\t\t\tif (isCleaning) this.requestsHandler.getMap(duid);\r\n\t\t\t\t\t\t\t\t} catch (error) {\r\n\t\t\t\t\t\t\t\t\tthis.catchError(error.stack, \"mainUpdateInterval\", duid);\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}, 1000);\r\n\r\n\t\ttry {\r\n\t\t\tawait this.start_go2rtc();\r\n\t\t} catch (error) {\r\n\t\t\tthis.log.error(`Failed to start go2rtc: ${error.stack}`);\r\n\t\t}\r\n\r\n\t\t// Start map creation if enabled\r\n\t\tif (this.config.enable_map_creation) {\r\n\t\t\ttry {\r\n\t\t\t\tthis.startWebserver();\r\n\t\t\t\tawait this.startWebsocketServer();\r\n\t\t\t} catch (error) {\r\n\t\t\t\tthis.adapter.log.error(`Failed to start websocket server: ${error.stack}`);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t *\r\n\t * @returns {Promise<string>}\r\n\t */\r\n\tasync ensureClientID() {\r\n\t\ttry {\r\n\t\t\tconst clientID = await this.getStateAsync(\"clientID\");\r\n\t\t\tif (!clientID || !clientID.val) {\r\n\t\t\t\tconst randomClientID = crypto.randomUUID();\r\n\t\t\t\tawait this.setState(\"clientID\", { val: randomClientID, ack: true });\r\n\t\t\t\tthis.log.info(`Generated and saved new clientID: ${randomClientID}`);\r\n\t\t\t\treturn randomClientID;\r\n\t\t\t} else {\r\n\t\t\t\tthis.log.info(`Loaded existing clientID: ${clientID.val}`);\r\n\t\t\t\treturn clientID.val.toString();\r\n\t\t\t}\r\n\t\t} catch (error) {\r\n\t\t\tthis.log.error(`Error ensuring clientID: ${error.message}`);\r\n\t\t\tthrow error;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @param {Object} device\r\n\t */\r\n\tasync createDeviceObjects(device) {\r\n\t\tconst duid = device.duid;\r\n\t\tconst name = device.name;\r\n\r\n\t\tawait this.device_features.processSupportedFeatures(duid);\r\n\r\n\t\tawait this.setObjectAsync(\"Devices.\" + duid, {\r\n\t\t\ttype: \"device\",\r\n\t\t\tcommon: {\r\n\t\t\t\tname: name,\r\n\t\t\t\tstatusStates: {\r\n\t\t\t\t\tonlineId: `${this.name}.${this.instance}.Devices.${duid}.deviceInfo.online`,\r\n\t\t\t\t},\r\n\t\t\t},\r\n\t\t\tnative: {},\r\n\t\t});\r\n\r\n\t\t// sub to all commands of this robot\r\n\t\tthis.subscribeStates(\"Devices.\" + duid + \".commands.*\");\r\n\t\tthis.subscribeStates(\"Devices.\" + duid + \".resetConsumables.*\");\r\n\t\tthis.subscribeStates(\"Devices.\" + duid + \".programs.startProgram\");\r\n\t\tthis.subscribeStates(\"Devices.\" + duid + \".deviceInfo.online\");\r\n\t\tthis.subscribeStates(\"Devices.\" + duid + \".deviceStatus.state\");\r\n\t}\r\n\r\n\tasync processScenes() {\r\n\t\tconst scenes = await this.http_api.getScenes();\r\n\r\n\t\tif (scenes && scenes?.result) {\r\n\t\t\tconst data = scenes.result;\r\n\r\n\t\t\tconst programs = {};\r\n\t\t\tfor (const program in data) {\r\n\t\t\t\tconst enabled = data[program].enabled;\r\n\t\t\t\tconst programID = data[program].id;\r\n\t\t\t\tconst programName = data[program].name;\r\n\t\t\t\tconst param = data[program].param;\r\n\r\n\t\t\t\tconst duid = JSON.parse(param).action.items[0].entityId;\r\n\r\n\t\t\t\tif (!programs[duid]) {\r\n\t\t\t\t\tprograms[duid] = {};\r\n\t\t\t\t}\r\n\t\t\t\tprograms[duid][programID] = programName;\r\n\r\n\t\t\t\tawait this.setObjectNotExistsAsync(`Devices.${duid}.programs`, {\r\n\t\t\t\t\ttype: \"folder\",\r\n\t\t\t\t\tcommon: {\r\n\t\t\t\t\t\tname: \"Programs\",\r\n\t\t\t\t\t},\r\n\t\t\t\t\tnative: {},\r\n\t\t\t\t});\r\n\r\n\t\t\t\tawait this.setObjectAsync(`Devices.${duid}.programs.${programID}`, {\r\n\t\t\t\t\ttype: \"folder\",\r\n\t\t\t\t\tcommon: {\r\n\t\t\t\t\t\tname: programName,\r\n\t\t\t\t\t},\r\n\t\t\t\t\tnative: {},\r\n\t\t\t\t});\r\n\r\n\t\t\t\tconst enabledPath = `Devices.${duid}.programs.${programID}.enabled`;\r\n\t\t\t\tawait this.createStateObjectHelper({ path: enabledPath, name: \"enabled\", type: \"boolean\", def: null, role: \"value\" });\r\n\t\t\t\tthis.setState(enabledPath, enabled, true);\r\n\r\n\t\t\t\tconst items = JSON.parse(param).action.items;\r\n\t\t\t\tfor (const item in items) {\r\n\t\t\t\t\tfor (const attribute in items[item]) {\r\n\t\t\t\t\t\tconst objectPath = `Devices.${duid}.programs.${programID}.items.${item}.${attribute}`;\r\n\t\t\t\t\t\tlet value = items[item][attribute];\r\n\t\t\t\t\t\tconst typeOfValue = typeof value;\r\n\r\n\t\t\t\t\t\tawait this.createStateObjectHelper({ path: objectPath, name: attribute, type: typeOfValue, def: null, role: \"value\", read: true, write: false });\r\n\r\n\t\t\t\t\t\tif (typeOfValue == \"object\") {\r\n\t\t\t\t\t\t\tvalue = value.toString();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tthis.setState(objectPath, value, true);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tfor (const duid in programs) {\r\n\t\t\t\tconst objectPath = `Devices.${duid}.programs.startProgram`;\r\n\t\t\t\tawait this.createStateObjectHelper({\r\n\t\t\t\t\tpath: objectPath,\r\n\t\t\t\t\tname: \"Start saved program\",\r\n\t\t\t\t\ttype: \"string\",\r\n\t\t\t\t\tdef: Object.keys(programs[duid])[0],\r\n\t\t\t\t\trole: \"value\",\r\n\t\t\t\t\tread: true,\r\n\t\t\t\t\twrite: true,\r\n\t\t\t\t\tstates: programs[duid],\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tstartWebserver() {\r\n\t\tconst app = express();\r\n\t\tapp.use(express.static(\"lib/map\"));\r\n\t\twebserver = app.listen(this.config.webserverPort + this.instance);\r\n\r\n\t\twebserver.on(\"error\", (error) => {\r\n\t\t\t// This code will run if there was an error starting the server\r\n\t\t\tthis.log.error(`Error occurred: ${error}`);\r\n\t\t});\r\n\t}\r\n\tasync stopWebserver() {\r\n\t\twebserver.close();\r\n\t}\r\n\r\n\tasync startWebsocketServer() {\r\n\t\tsocketServer = new ws.Server({ server: webserver, path: \"/ws\" });\r\n\r\n\t\tsocketServer.on(\"connection\", async (socket) => {\r\n\t\t\tthis.socket = socket;\r\n\t\t\tthis.log.debug(`Websocket client connected`);\r\n\r\n\t\t\tsocket.on(\"pong\", () => {\r\n\t\t\t\tthis.socket = socket;\r\n\t\t\t});\r\n\r\n\t\t\tthis.webSocketInterval = this.setInterval(() => {\r\n\t\t\t\tif (!this.socket) {\r\n\t\t\t\t\tthis.log.debug(`Client disconnected. Stopping interval.`);\r\n\t\t\t\t\tthis.clearInterval(this.webSocketInterval);\r\n\t\t\t\t\tsocket.terminate();\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tthis.socket = null;\r\n\t\t\t\tsocket.ping();\r\n\t\t\t}, 1000);\r\n\r\n\t\t\tsocket.on(\"message\", async (message) => {\r\n\t\t\t\tconst data = JSON.parse(message.toString());\r\n\t\t\t\tconst sendValue: SendValue = { parameters: [], command: data.command };\r\n\r\n\t\t\t\tconst devices = this.http_api.getDevices();\r\n\r\n\t\t\t\tswitch (sendValue.command) {\r\n\t\t\t\t\tcase \"app_zoned_clean\":\r\n\t\t\t\t\tcase \"app_goto_target\":\r\n\t\t\t\t\tcase \"app_start\":\r\n\t\t\t\t\tcase \"app_stop\":\r\n\t\t\t\t\tcase \"stop_zoned_clean\":\r\n\t\t\t\t\tcase \"app_pause\":\r\n\t\t\t\t\tcase \"app_charge\":\r\n\t\t\t\t\t\tsendValue.parameters = data[\"parameters\"];\r\n\t\t\t\t\t\tthis.requestsHandler.command(data[\"duid\"], sendValue.command, sendValue.parameters);\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase \"getRobots\":\r\n\t\t\t\t\t\tsendValue.command = \"robotList\";\r\n\r\n\t\t\t\t\t\tfor (const robotID in devices) {\r\n\t\t\t\t\t\t\tconst robot: Robot = { duid: devices[robotID].duid, name: devices[robotID].name };\r\n\t\t\t\t\t\t\tsendValue.parameters.push(robot);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tsocket.send(JSON.stringify(sendValue));\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase \"getMap\":\r\n\t\t\t\t\t\tthis.requestsHandler.getMap(data.duid);\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase \"get_photo\":\r\n\t\t\t\t\t\tthis.requestsHandler.getParameter(data[\"duid\"], \"get_photo\", data[\"attribute\"]);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase \"sniffing_decrypt\":\r\n\t\t\t\t\t\ttry {\r\n\t\t\t\t\t\t\tthis.sniffing.decodeSniffedMessage(data, devices);\r\n\t\t\t\t\t\t} catch (error) {\r\n\t\t\t\t\t\t\tthis.log.error(\"Failed to decode/decrypt sniffing message. \" + error);\r\n\r\n\t\t\t\t\t\t\tif (this.supportsFeature && this.supportsFeature(\"PLUGINS\")) {\r\n\t\t\t\t\t\t\t\tif (this.sentryInstance) {\r\n\t\t\t\t\t\t\t\t\tthis.sentryInstance.getSentryObject().captureException(\"Failed to initialize API. Error: \" + error);\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\tsocket.on(\"close\", () => {\r\n\t\t\t\tthis.log.debug(`Client disconnected`);\r\n\t\t\t\tthis.clearInterval(this.webSocketInterval);\r\n\t\t\t\tthis.socket = null;\r\n\t\t\t});\r\n\r\n\t\t\tsocketServer.on(\"error\", (error) => {\r\n\t\t\t\tthis.log.error(\"WebSocket Server error: \" + error);\r\n\t\t\t});\r\n\t\t});\r\n\t}\r\n\tasync stopWebsocketServer() {\r\n\t\tsocketServer.close();\r\n\t}\r\n\r\n\t/**\r\n\t * @param {string} duid\r\n\t */\r\n\tasync updateDeviceData(duid) {\r\n\t\tconst robotModel = this.http_api.getRobotModel(duid);\r\n\t\tconst version = await this.getDeviceProtocolVersion(duid);\r\n\r\n\t\tif (version != \"A01\") {\r\n\t\t\tconst requestList = [\"get_fw_features\", \"get_multi_maps_list\", \"get_room_mapping\", \"get_consumable\", \"get_server_timer\", \"get_timer\"];\r\n\t\t\tfor (const request of requestList) {\r\n\t\t\t\tthis.requestsHandler.getParameter(duid, request, []);\r\n\t\t\t}\r\n\r\n\t\t\tthis.checkForNewFirmware(duid);\r\n\r\n\t\t\tswitch (robotModel) {\r\n\t\t\t\tcase \"roborock.vacuum.s4\":\r\n\t\t\t\tcase \"roborock.vacuum.s5\":\r\n\t\t\t\tcase \"roborock.vacuum.s5e\":\r\n\t\t\t\tcase \"roborock.vacuum.a08\":\r\n\t\t\t\tcase \"roborock.vacuum.a10\":\r\n\t\t\t\tcase \"roborock.vacuum.a40\":\r\n\t\t\t\t\t//do nothing\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"roborock.vacuum.s6\":\r\n\t\t\t\tcase \"roborock.vacuum.a72\":\r\n\t\t\t\t\tthis.requestsHandler.getParameter(duid, \"get_carpet_mode\", []);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"roborock.vacuum.a27\":\r\n\t\t\t\t\tthis.requestsHandler.getParameter(duid, \"get_dust_collection_switch_status\", {});\r\n\t\t\t\t\tthis.requestsHandler.getParameter(duid, \"get_wash_towel_mode\", {});\r\n\t\t\t\t\tthis.requestsHandler.getParameter(duid, \"get_smart_wash_params\", {});\r\n\t\t\t\t\tthis.requestsHandler.getParameter(duid, \"app_get_dryer_setting\", {});\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tdefault:\r\n\t\t\t\t\tthis.requestsHandler.getParameter(duid, \"get_carpet_mode\", []);\r\n\t\t\t\t\tthis.requestsHandler.getParameter(duid, \"get_carpet_clean_mode\", []);\r\n\t\t\t\t\tthis.requestsHandler.getParameter(duid, \"get_water_box_custom_mode\", []);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tclearTimersAndIntervals() {\r\n\t\tif (this.commandTimeout) {\r\n\t\t\tthis.clearTimeout(this.commandTimeout);\r\n\t\t}\r\n\t\tif (this.mainUpdateInterval) {\r\n\t\t\tthis.clearInterval(this.mainUpdateInterval);\r\n\t\t}\r\n\t\tif (this.requestsHandler) {\r\n\t\t\tthis.requestsHandler.clearQueue();\r\n\t\t}\r\n\r\n\t\tif (this.mainUpdateInterval) {\r\n\t\t\tthis.clearInterval(this.mainUpdateInterval);\r\n\t\t}\r\n\r\n\t\tif (this.webSocketInterval) {\r\n\t\t\tthis.clearInterval(this.webSocketInterval);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @param {string} duid\r\n\t */\r\n\tasync updateConsumablesPercent(duid) {\r\n\t\tconst version = await this.getDeviceProtocolVersion(duid);\r\n\r\n\t\tif (version != \"A01\") {\r\n\t\t\tconst devices = this.http_api.getDevices();\r\n\t\t\tconst device = devices.find((device) => device.duid === duid);\r\n\t\t\tconst status = device.deviceStatus as DeviceStatus;\r\n\r\n\t\t\tfor (const [attribute, value] of Object.entries(status)) {\r\n\t\t\t\tif (attribute == \"125\" || attribute == \"126\" || attribute == \"127\") {\r\n\t\t\t\t\tconst val = value >= 0 && value <= 100 ? value : 0;\r\n\t\t\t\t\tconst commonExtended = this.device_features.getCommonConsumable(attribute);\r\n\t\t\t\t\tawait this.ensureState(`Devices.${duid}.consumables.${attribute}`, { val: val, ack: true }, commonExtended);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @param {string} duid\r\n\t * @param {Array} devices\r\n\t */\r\n\tasync updateDeviceInfo(duid, devices) {\r\n\t\tconst device = devices.find((device) => device.duid === duid);\r\n\r\n\t\tfor (const deviceAttribute in device) {\r\n\t\t\tif (typeof device[deviceAttribute] != \"object\") {\r\n\t\t\t\tconst commonDeviceInfo = deviceAttribute == \"activeTime\" ? { unit: \"h\" } : undefined;\r\n\t\t\t\tlet value;\r\n\t\t\t\tswitch (deviceAttribute) {\r\n\t\t\t\t\tcase \"activeTime\":\r\n\t\t\t\t\t\tvalue = Math.round(device[deviceAttribute] / 1000 / 60 / 60);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase \"createTime\":\r\n\t\t\t\t\t\tvalue = new Date(device[deviceAttribute] * 1000).toLocaleString();\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tdefault:\r\n\t\t\t\t\t\tvalue = device[deviceAttribute];\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tawait this.ensureState(`Devices.${duid}.deviceInfo.${deviceAttribute}`, { val: value, ack: true }, commonDeviceInfo);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @param {string} duid\r\n\t */\r\n\tasync checkForNewFirmware(duid) {\r\n\t\tconst isLocalDevice = this.local_api.isLocalDevice(duid);\r\n\r\n\t\tif (isLocalDevice) {\r\n\t\t\tthis.http_api\r\n\t\t\t\t.getFirmwareStates(duid)\r\n\t\t\t\t.then(async (update) => {\r\n\t\t\t\t\tfor (const state in update.data.result) {\r\n\t\t\t\t\t\tconst value = update.data.result[state];\r\n\r\n\t\t\t\t\t\tthis.ensureState(`Devices.${duid}.updateStatus.${state}`, { val: value, ack: true });\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t\t.catch((error) => {\r\n\t\t\t\t\tthis.log.error(`Failed to check for new firmware ${error.stack}`);\r\n\t\t\t\t});\r\n\t\t}\r\n\t}\r\n\r\n\tgetType(value) {\r\n\t\t// Get the type of the attribute.\r\n\t\tconst type = typeof value.val;\r\n\r\n\t\t// Return the appropriate string representation of the type.\r\n\t\tswitch (type) {\r\n\t\t\tcase \"boolean\":\r\n\t\t\tcase \"number\":\r\n\t\t\t\treturn type;\r\n\t\t\tdefault:\r\n\t\t\t\treturn \"string\";\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @param {string} path\r\n\t * @param {object} value\r\n\t * @param {object} [commonExtended]\r\n\t */\r\n\tasync ensureState(path, value, commonExtended?: StateCommonExtension) {\r\n\t\tif (this.isInitializing) {\r\n\t\t\tconst attribute = path.split(\".\").pop();\r\n\r\n\t\t\tif (!attribute) {\r\n\t\t\t\tthrow new Error(`Invalid path: \"${path}\"`);\r\n\t\t\t}\r\n\r\n\t\t\tconst folderPath = path.split(\".\").slice(0, -1).join(\".\");\r\n\r\n\t\t\tthis.ensureFolder(folderPath);\r\n\r\n\t\t\tconst common = {\r\n\t\t\t\tname: this.translations[attribute],\r\n\t\t\t\ttype: this.getType(value),\r\n\t\t\t\trole: \"value\",\r\n\t\t\t\tread: true,\r\n\t\t\t\twrite: false,\r\n\t\t\t\t...commonExtended,\r\n\t\t\t};\r\n\r\n\t\t\tconst result = await this.setObjectNotExistsAsync(path, {\r\n\t\t\t\ttype: \"state\",\r\n\t\t\t\tcommon: common,\r\n\t\t\t\tnative: {},\r\n\t\t\t});\r\n\r\n\t\t\tif (!result) {\r\n\t\t\t\tconst obj = await this.getObjectAsync(path);\r\n\t\t\t\tif (obj && obj.common) {\r\n\t\t\t\t\tobj.common = common;\r\n\t\t\t\t\tawait this.extendObject(path, obj);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis.setStateChangedAsync(path, value);\r\n\t}\r\n\r\n\t/**\r\n\t * @param {string} path\r\n\t * @param {object} commonExtended\r\n\t */\r\n\tasync ensureCommand(path, commonExtended) {\r\n\t\tif (this.isInitializing) {\r\n\t\t\tconst attribute = path.split(\".\").pop();\r\n\r\n\t\t\tif (!attribute) {\r\n\t\t\t\tthrow new Error(`Invalid path: \"${path}\"`);\r\n\t\t\t}\r\n\r\n\t\t\tconst folderPath = path.split(\".\").slice(0, -1).join(\".\");\r\n\r\n\t\t\tthis.ensureFolder(folderPath);\r\n\r\n\t\t\tconst common = {\r\n\t\t\t\tname: this.translations[attribute],\r\n\t\t\t\trole: \"value\",\r\n\t\t\t\tread: true,\r\n\t\t\t\twrite: true,\r\n\t\t\t\t...commonExtended,\r\n\t\t\t};\r\n\r\n\t\t\tconst result = await this.setObjectNotExistsAsync(path, {\r\n\t\t\t\ttype: \"state\",\r\n\t\t\t\tcommon: common,\r\n\t\t\t\tnative: {},\r\n\t\t\t});\r\n\r\n\t\t\tif (!result) {\r\n\t\t\t\tconst obj = await this.getObjectAsync(path);\r\n\t\t\t\tif (obj && obj.common) {\r\n\t\t\t\t\tobj.common = common;\r\n\t\t\t\t\tawait this.extendObject(path, obj);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tasync ensureFolder(path) {\r\n\t\tif (this.isInitializing) {\r\n\t\t\tconst attribute = path.split(\".\").pop();\r\n\r\n\t\t\tawait this.setObjectNotExistsAsync(path, {\r\n\t\t\t\ttype: \"folder\",\r\n\t\t\t\tcommon: {\r\n\t\t\t\t\tname: this.translations[attribute],\r\n\t\t\t\t},\r\n\t\t\t\tnative: {},\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\r\n\tasync createStateObjectHelper(options: StateObjectOptions) {\r\n\t\tconst { path, name, type, unit, def, role, read, write, states, native } = options;\r\n\r\n\t\tconst common: any = { name, type, role, read, write, unit, states };\r\n\t\tif (def !== undefined && def !== null && def !== \"\") common.def = def;\r\n\r\n\t\tawait this.setObjectNotExistsAsync(path, {\r\n\t\t\ttype: \"state\",\r\n\t\t\tcommon: common,\r\n\t\t\tnative: native,\r\n\t\t});\r\n\t}\r\n\r\n\t/**\r\n\t * @param {string} duid\r\n\t */\r\n\tasync createDockingStationObject(duid) {\r\n\t\tfor (const state of dockingStationStates) {\r\n\t\t\tconst path = `Devices.${duid}.dockingStationStatus.${state}`;\r\n\t\t\tconst name = this.translations[state];\r\n\r\n\t\t\tawait this.setObjectNotExistsAsync(path, {\r\n\t\t\t\ttype: \"state\",\r\n\t\t\t\tcommon: {\r\n\t\t\t\t\tname: name,\r\n\t\t\t\t\ttype: \"number\",\r\n\t\t\t\t\trole: \"value\",\r\n\t\t\t\t\tread: true,\r\n\t\t\t\t\twrite: false,\r\n\t\t\t\t\tstates: { 0: \"UNKNOWN\", 1: \"ERROR\", 2: \"OK\" },\r\n\t\t\t\t},\r\n\t\t\t\tnative: {},\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @param {string} duid\r\n\t */\r\n\tasync createBaseRobotObjects(duid) {\r\n\t\tfor (const name of [\"mapBase64\", \"mapBase64Truncated\", \"mapData\"]) {\r\n\t\t\tconst objectString = `Devices.${duid}.map.${name}`;\r\n\t\t\tawait this.createStateObjectHelper({ path: objectString, name, type: \"string\", def: null, role: \"value\", read: true, write: false });\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @param {string} _duid\r\n\t */\r\n\tasync createBasicVacuumObjects(_duid) {\r\n\t\t// nothing for now\r\n\t}\r\n\r\n\t/**\r\n\t * @param {string} _duid\r\n\t */\r\n\tasync createBasicWashingMachineObjects(_duid) {\r\n\t\t// nothing for now\r\n\t}\r\n\r\n\t/**\r\n\t * @param {string} duid\r\n\t */\r\n\tasync getDeviceProtocolVersion(duid) {\r\n\t\tconst tcpConnected = this.local_api.isConnected(duid);\r\n\r\n\t\tif (tcpConnected) {\r\n\t\t\treturn this.local_api.getLocalProtocolVersion(duid);\r\n\t\t} else {\r\n\t\t\tconst devices = this.http_api.getDevices();\r\n\r\n\t\t\tfor (const device in devices) {\r\n\t\t\t\tif (devices[device].duid == duid) return devices[device].pv;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn \"Error in getRobotVersion. Version not found.\";\r\n\t}\r\n\r\n\tasync setupBasicObjects() {\r\n\t\tawait this.setObjectAsync(\"Devices\", {\r\n\t\t\ttype: \"folder\",\r\n\t\t\tcommon: {\r\n\t\t\t\tname: \"Devices\",\r\n\t\t\t},\r\n\t\t\tnative: {},\r\n\t\t});\r\n\r\n\t\tawait this.setObjectAsync(\"UserData\", {\r\n\t\t\ttype: \"state\",\r\n\t\t\tcommon: {\r\n\t\t\t\tname: \"UserData string\",\r\n\t\t\t\ttype: \"string\",\r\n\t\t\t\trole: \"value\",\r\n\t\t\t\tread: true,\r\n\t\t\t\twrite: false,\r\n\t\t\t},\r\n\t\t\tnative: {},\r\n\t\t});\r\n\r\n\t\tawait this.setObjectAsync(\"HomeData\", {\r\n\t\t\ttype: \"state\",\r\n\t\t\tcommon: {\r\n\t\t\t\tname: \"HomeData string\",\r\n\t\t\t\ttype: \"string\",\r\n\t\t\t\trole: \"value\",\r\n\t\t\t\tread: true,\r\n\t\t\t\twrite: false,\r\n\t\t\t},\r\n\t\t\tnative: {},\r\n\t\t});\r\n\r\n\t\tawait this.setObjectNotExistsAsync(\"clientID\", {\r\n\t\t\ttype: \"state\",\r\n\t\t\tcommon: {\r\n\t\t\t\tname: \"Client ID\",\r\n\t\t\t\ttype: \"string\",\r\n\t\t\t\trole: \"value\",\r\n\t\t\t\tread: true,\r\n\t\t\t\twrite: false,\r\n\t\t\t},\r\n\t\t\tnative: {},\r\n\t\t});\r\n\r\n\t\tawait this.setObjectNotExistsAsync(\"endpoint\", {\r\n\t\t\ttype: \"state\",\r\n\t\t\tcommon: {\r\n\t\t\t\tname: \"MQTT endpoint\",\r\n\t\t\t\ttype: \"string\",\r\n\t\t\t\trole: \"value\",\r\n\t\t\t\tread: true,\r\n\t\t\t\twrite: false,\r\n\t\t\t},\r\n\t\t\tnative: {},\r\n\t\t});\r\n\t}\r\n\r\n\tasync start_go2rtc() {\r\n\t\tconst devices = this.http_api.getDevices();\r\n\r\n\t\tlet cameraCount = 0;\r\n\t\tconst localKeys = this.http_api.getMatchedLocalKeys();\r\n\r\n\t\tconst port = 8554 + this.instance;\r\n\t\tconst rtspPort = 1984 + this.instance;\r\n\t\tconst go2rtcConfig = {\r\n\t\t\tserver: {\r\n\t\t\t\tlisten: `:${port}`,\r\n\t\t\t},\r\n\t\t\trtsp: {\r\n\t\t\t\tlisten: `:${rtspPort}`,\r\n\t\t\t},\r\n\t\t\tstreams: {},\r\n\t\t};\r\n\t\tfor (const device of devices) {\r\n\t\t\tconst duid = device.duid;\r\n\r\n\t\t\tif (localKeys) {\r\n\t\t\t\tconst localKey = localKeys.get(duid);\r\n\r\n\t\t\t\tconst { u, s, k } = this.http_api.get_rriot();\r\n\r\n\t\t\t\tif (this.device_features.getFeatureList(duid).isCameraSupported) {\r\n\t\t\t\t\tcameraCount++;\r\n\t\t\t\t\tgo2rtcConfig.streams[duid] = `roborock://mqtt-eu-3.roborock.com:8883?u=${u}&s=${s}&k=${k}&did=${duid}&key=${localKey}&pin=${this.config.cameraPin}`;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (cameraCount > 0) {\r\n\t\t\tif (go2rtcPath) {\r\n\t\t\t\ttry {\r\n\t\t\t\t\tconst go2rtcProcess = spawn(go2rtcPath.toString(), [\"-config\", JSON.stringify(go2rtcConfig)], { shell: false, detached: false, windowsHide: true });\r\n\r\n\t\t\t\t\tgo2rtcProcess.on(\"error\", (error) => {\r\n\t\t\t\t\t\tthis.log.error(`Error starting go2rtc: ${error.message}`);\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\tgo2rtcProcess.stdout.on(\"data\", (data) => {\r\n\t\t\t\t\t\tthis.log.debug(`go2rtc output: ${data}`);\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\tgo2rtcProcess.stderr.on(\"data\", (data) => {\r\n\t\t\t\t\t\tthis.log.error(`go2rtc error output: ${data}`);\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\tprocess.on(\"exit\", () => {\r\n\t\t\t\t\t\tgo2rtcProcess.kill();\r\n\t\t\t\t\t});\r\n\t\t\t\t} catch (error) {\r\n\t\t\t\t\tthis.log.error(`Failed to start go2rtc: ${error.message}`);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Processes A01 protocol messages and stores the parsed data in a structured format.\r\n\t * @param {string} duid - The device unique identifier.\r\n\t * @param {object} response - The parsed response object.\r\n\t */\r\n\tasync processA01(duid, response) {\r\n\t\tif (!response || !response.dps || typeof response.dps !== \"object\") {\r\n\t\t\tthis.log.warn(`Invalid response from A01 with ${duid}`);\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tfor (const [ID, value] of Object.entries(response.dps)) {\r\n\t\t\tconst folderName = ID.length === 5 ? ID : \"deviceStatus\";\r\n\t\t\tconst basePath = `Devices.${duid}.${folderName}`;\r\n\t\t\tconst stateName = A01states[ID] || ID;\r\n\r\n\t\t\tlet parsedValue = value;\r\n\r\n\t\t\tif (typeof value === \"string\" && value.startsWith(\"{\") && value.endsWith(\"}\")) {\r\n\t\t\t\tparsedValue = JSON.parse(value);\r\n\t\t\t}\r\n\r\n\t\t\tif (typeof parsedValue === \"object\" && parsedValue !== null) {\r\n\t\t\t\tawait this.setObjectNotExistsAsync(basePath, {\r\n\t\t\t\t\ttype: \"channel\",\r\n\t\t\t\t\tcommon: { name: stateName },\r\n\t\t\t\t\tnative: {},\r\n\t\t\t\t});\r\n\r\n\t\t\t\tfor (const [attribute, attrValue] of Object.entries(parsedValue)) {\r\n\t\t\t\t\tif (typeof attrValue === \"object\" && attrValue !== null) {\r\n\t\t\t\t\t\tconst subPath = `${basePath}.${attribute}`;\r\n\t\t\t\t\t\tawait this.setObjectNotExistsAsync(subPath, {\r\n\t\t\t\t\t\t\ttype: \"channel\",\r\n\t\t\t\t\t\t\tcommon: { name: attribute },\r\n\t\t\t\t\t\t\tnative: {},\r\n\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t\tfor (const [subAttribute, subAttrValue] of Object.entries(attrValue)) {\r\n\t\t\t\t\t\t\tif (typeof subAttrValue === \"object\" && subAttrValue !== null) {\r\n\t\t\t\t\t\t\t\tconst subSubPath = `${subPath}.${subAttribute}`;\r\n\t\t\t\t\t\t\t\tawait this.setObjectNotExistsAsync(subSubPath, {\r\n\t\t\t\t\t\t\t\t\ttype: \"channel\",\r\n\t\t\t\t\t\t\t\t\tcommon: { name: subAttribute },\r\n\t\t\t\t\t\t\t\t\tnative: {},\r\n\t\t\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t\t\t\tfor (const [subSubAttribute, subSubAttrValue] of Object.entries(subAttrValue)) {\r\n\t\t\t\t\t\t\t\t\tconst subSubSubPath = `${subSubPath}.${subSubAttribute}`;\r\n\t\t\t\t\t\t\t\t\tawait this.setObjectNotExistsAsync(subSubSubPath, {\r\n\t\t\t\t\t\t\t\t\t\ttype: \"state\",\r\n\t\t\t\t\t\t\t\t\t\tcommon: {\r\n\t\t\t\t\t\t\t\t\t\t\tname: subSubAttribute,\r\n\t\t\t\t\t\t\t\t\t\t\ttype: this.getType(subSubAttrValue),\r\n\t\t\t\t\t\t\t\t\t\t\trole: \"value\",\r\n\t\t\t\t\t\t\t\t\t\t\tread: true,\r\n\t\t\t\t\t\t\t\t\t\t\twrite: false,\r\n\t\t\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t\t\tnative: {},\r\n\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t\tthis.setState(subSubSubPath, { val: subSubAttrValue, ack: true });\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tconst statePath = `${subPath}.${subAttribute}`;\r\n\t\t\t\t\t\t\t\tawait this.setObjectNotExistsAsync(statePath, {\r\n\t\t\t\t\t\t\t\t\ttype: \"state\",\r\n\t\t\t\t\t\t\t\t\tcommon: {\r\n\t\t\t\t\t\t\t\t\t\tname: subAttribute,\r\n\t\t\t\t\t\t\t\t\t\ttype: this.getType(subAttrValue),\r\n\t\t\t\t\t\t\t\t\t\trole: \"value\",\r\n\t\t\t\t\t\t\t\t\t\tread: true,\r\n\t\t\t\t\t\t\t\t\t\twrite: false,\r\n\t\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t\tnative: {},\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\tthis.setState(statePath, { val: subAttrValue, ack: true });\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tconst statePath = `${basePath}.${attribute}`;\r\n\t\t\t\t\t\tawait this.setObjectNotExistsAsync(statePath, {\r\n\t\t\t\t\t\t\ttype: \"state\",\r\n\t\t\t\t\t\t\tcommon: {\r\n\t\t\t\t\t\t\t\tname: attribute,\r\n\t\t\t\t\t\t\t\ttype: this.getType(attrValue),\r\n\t\t\t\t\t\t\t\trole: \"value\",\r\n\t\t\t\t\t\t\t\tread: true,\r\n\t\t\t\t\t\t\t\twrite: false,\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\tnative: {},\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\tthis.setState(statePath, { val: attrValue, ack: true });\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tconst statePath = `${basePath}.${ID}`;\r\n\t\t\t\tawait this.setObjectNotExistsAsync(statePath, {\r\n\t\t\t\t\ttype: \"state\",\r\n\t\t\t\t\tcommon: {\r\n\t\t\t\t\t\tname: stateName,\r\n\t\t\t\t\t\ttype: this.getType(parsedValue),\r\n\t\t\t\t\t\trole: \"value\",\r\n\t\t\t\t\t\tread: true,\r\n\t\t\t\t\t\twrite: false,\r\n\t\t\t\t\t},\r\n\t\t\t\t\tnative: {},\r\n\t\t\t\t});\r\n\t\t\t\tthis.setState(statePath, { val: parsedValue, ack: true });\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Resets the MQTT API instance by cleaning up resources and reinitializing it.\r\n\t */\r\n\tasync resetMqttApi() {\r\n\t\tthis.log.info(\"Resetting MQTT API instance...\");\r\n\t\t// Cleanup the existing MQTT API instance\r\n\t\tif (this.mqtt_api) {\r\n\t\t\tthis.mqtt_api.cleanup();\r\n\t\t\tthis.requestsHandler.clearQueue();\r\n\t\t}\r\n\t\t// Create a new MQTT API instance and initialize it\r\n\t\tthis.mqtt_api = new mqtt_api(this);\r\n\t\tawait this.mqtt_api.init();\r\n\t\tthis.log.info(\"MQTT API instance has been reset.\");\r\n\t}\r\n\r\n\t/**\r\n\t * @param {Error} error\r\n\t * @param {string} [attribute]\r\n\t * @param {string} [duid]\r\n\t */\r\n\tasync catchError(error, attribute, duid) {\r\n\t\tconst robotModel = duid ? this.http_api.getRobotModel(duid) : \"unknown device model\";\r\n\r\n\t\tif (error) {\r\n\t\t\tif (error.toString().includes(\"retry\") || error.toString().includes(\"locating\") || error.toString().includes(\"timed out after 30 seconds\")) {\r\n\t\t\t\tthis.log.warn(`Failed to process ${JSON.stringify(attribute)} on robot ${duid} (${robotModel}): ${error.stack || error}`);\r\n\t\t\t} else {\r\n\t\t\t\tthis.log.error(`Failed to process ${JSON.stringify(attribute)} on robot ${duid} (${robotModel}): ${error.stack || error}`);\r\n\r\n\t\t\t\tif (this.supportsFeature && this.supportsFeature(\"PLUGINS\")) {\r\n\t\t\t\t\tif (this.sentryInstance) {\r\n\t\t\t\t\t\tthis.sentryInstance.getSentryObject().captureException(error);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Is called when adapter shuts down - callback has to be called under any circumstances!\r\n\t * @param {() => void} callback\r\n\t */\r\n\tonUnload(callback) {\r\n\t\ttry {\r\n\t\t\tthis.clearTimersAndIntervals();\r\n\t\t\tthis.local_api.stopUdpDiscovery();\r\n\t\t\tthis.setState(\"info.connection\", { val: false, ack: true });\r\n\r\n\t\t\tcallback();\r\n\t\t} catch (e) {\r\n\t\t\tthis.log.error(`Failed to unload adapter: ${e.stack}`);\r\n\t\t\tcallback();\r\n\t\t}\r\n\t}\r\n\r\n\t// If you need to react to object changes, uncomment the following block and the corresponding line in the constructor.\r\n\t// You also need to subscribe to the objects with `this.subscribeObjects`, similar to `this.subscribeStates`.\r\n\t// /**\r\n\t//  * Is called if a subscribed object changes\r\n\t//  * @param {string} id\r\n\t//  * @param {ioBroker.Object | null | undefined} obj\r\n\t//  */\r\n\t// onObjectChange(id, obj) {\r\n\t// \tif (obj) {\r\n\t// \t\t// The object was changed\r\n\t// \t\tthis.log.info(`object ${id} changed: ${JSON.stringify(obj)}`);\r\n\t// \t} else {\r\n\t// \t\t// The object was deleted\r\n\t// \t\tthis.log.info(`object ${id} deleted`);\r\n\t// \t}\r\n\t// }\r\n\r\n\t/**\r\n\t * Is called if a subscribed state changes\r\n\t * @param {string} id\r\n\t * @param {ioBroker.State | null | undefined} state\r\n\t */\r\n\tasync onStateChange(id, state) {\r\n\t\tif (state) {\r\n\t\t\tconst idParts = id.split(\".\");\r\n\t\t\tconst duid = idParts[3];\r\n\t\t\tconst folder = idParts[4];\r\n\r\n\t\t\tif (state.ack) {\r\n\t\t\t\tif (id.endsWith(\"online\")) {\r\n\t\t\t\t\tthis.log.info(`Device ${duid} is now ${state.val ? \"online\" : \"offline\"}`);\r\n\t\t\t\t} else if (folder == \"deviceStatus\") {\r\n\t\t\t\t\tconst parameter = idParts[5];\r\n\t\t\t\t\tif (parameter == \"state\") {\r\n\t\t\t\t\t\tif (state.val == 8) {\r\n\t\t\t\t\t\t\tthis.requestsHandler.getCleanSummary(duid);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tconst command = idParts[5];\r\n\r\n\t\t\t\tthis.log.debug(`onStateChange: ${command} with value: ${state.val}`);\r\n\t\t\t\tif (state.val == true && typeof state.val == \"boolean\") {\r\n\t\t\t\t\tif (folder == \"resetConsumables\") {\r\n\t\t\t\t\t\tawait this.requestsHandler.command(duid, \"reset_consumable\", command);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tthis.requestsHandler.command(duid, command);\r\n\t\t\t\t\t}\r\n\t\t\t\t} else if (command == \"load_multi_map\") {\r\n\t\t\t\t\tawait this.requestsHandler.command(duid, command, [state.val]);\r\n\t\t\t\t} else if (\r\n\t\t\t\t\tcommand == \"app_start\" ||\r\n\t\t\t\t\tcommand == \"app_segment_clean\" ||\r\n\t\t\t\t\tcommand == \"app_charge\" ||\r\n\t\t\t\t\tcommand == \"app_spot\" ||\r\n\t\t\t\t\tcommand == \"app_zoned_clean\" ||\r\n\t\t\t\t\tcommand == \"app_goto_target\"\r\n\t\t\t\t) {\r\n\t\t\t\t\tswitch (command) {\r\n\t\t\t\t\t\tcase \"app_zoned_clean\":\r\n\t\t\t\t\t\tcase \"app_goto_target\":\r\n\t\t\t\t\t\t\tif (typeof state.val === \"string\") {\r\n\t\t\t\t\t\t\t\ttry {\r\n\t\t\t\t\t\t\t\t\tconst params = JSON.parse(state.val);\r\n\r\n\t\t\t\t\t\t\t\t\tif (command === \"app_zoned_clean\") {\r\n\t\t\t\t\t\t\t\t\t\t// Check if params is an array and contains multiple arrays\r\n\t\t\t\t\t\t\t\t\t\tif (Array.isArray(params) && params.every(Array.isArray)) {\r\n\t\t\t\t\t\t\t\t\t\t\tconst allZonesValid = params.every((zone) => {\r\n\t\t\t\t\t\t\t\t\t\t\t\tconst isCorrectLength = zone.length === 4 || zone.length === 5;\r\n\t\t\t\t\t\t\t\t\t\t\t\tconst areAllNumbers = zone.every((item) => typeof item === \"number\");\r\n\t\t\t\t\t\t\t\t\t\t\t\tconst isValidFifth = zone.length !== 5 || (zone[4] >= 1 && zone[4] <= 3);\r\n\t\t\t\t\t\t\t\t\t\t\t\treturn isCorrectLength && areAllNumbers && isValidFifth;\r\n\t\t\t\t\t\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t\t\t\t\t\t\tif (allZonesValid) {\r\n\t\t\t\t\t\t\t\t\t\t\t\tthis.requestsHandler.command(duid, command, params);\r\n\t\t\t\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\t\t\t\tthis.log.error(\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t`Invalid command parameters for ${command}: ${state.val}. Expected format: [[x1, y1, x2, y2, repeat], [x1, y1, x2, y2, repeat], ...] (where repeat is between 1 and 3)`\r\n\t\t\t\t\t\t\t\t\t\t\t\t);\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\t\t\tthis.log.error(\r\n\t\t\t\t\t\t\t\t\t\t\t\t`Invalid command parameters for ${command}: ${state.val}. Expected format: [[x1, y1, x2, y2, repeat], [x1, y1, x2, y2, repeat], ...] (where repeat is between 1 and 3)`\r\n\t\t\t\t\t\t\t\t\t\t\t);\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t} else if (command === \"app_goto_target\") {\r\n\t\t\t\t\t\t\t\t\t\t// For app_goto_target, params should be an array with exactly two numbers\r\n\t\t\t\t\t\t\t\t\t\tconst isCorrectLength = params.length === 2;\r\n\t\t\t\t\t\t\t\t\t\tconst areAllNumbers = params.every((item) => typeof item === \"number\");\r\n\r\n\t\t\t\t\t\t\t\t\t\tif (isCorrectLength && areAllNumbers) {\r\n\t\t\t\t\t\t\t\t\t\t\tthis.requestsHandler.command(duid, command, params);\r\n\t\t\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\t\t\tthis.log.error(`Invalid command parameters for ${command}: ${state.val}. Expected format: [x, y]`);\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t} catch (error) {\r\n\t\t\t\t\t\t\t\t\tthis.log.error(`Error parsing JSON for ${command}: ${error}`);\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t} else if (command == \"startProgram\") {\r\n\t\t\t\t\tthis.http_api.executeScene(state);\r\n\t\t\t\t} else if (typeof state.val != \"boolean\") {\r\n\t\t\t\t\tthis.requestsHandler.command(duid, command, state.val);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (typeof state.val == \"boolean\") {\r\n\t\t\t\t\tthis.commandTimeout = this.setTimeout(() => {\r\n\t\t\t\t\t\tthis.setState(id, false, true);\r\n\t\t\t\t\t}, 1000);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tthis.log.error(`Error! Missing state onChangeState with ID ${id}!`);\r\n\t\t}\r\n\t}\r\n\r\n\t// If you need to accept messages in your adapter, uncomment the following block and the corresponding line in the constructor.\r\n\t// /**\r\n\t//  * Some message was sent to this instance over message box. Used by email, pushover, text2speech, ...\r\n\t//  * Using this method requires \"common.messagebox\" property to be set to true in io-package.json\r\n\t//  * @param {ioBroker.Message} obj\r\n\t//  */\r\n\t// onMessage(obj) {\r\n\t// \tif (typeof obj === \"object\" && obj.message) {\r\n\t// \t\tif (obj.command === \"send\") {\r\n\t// \t\t\t// e.g. send email or pushover or whatever\r\n\t// \t\t\tthis.log.info(\"send command\");\r\n\r\n\t// \t\t\t// Send response in callback if required\r\n\t// \t\t\tif (obj.callback) this.sendTo(obj.from, obj.command, \"Message received\", obj.callback);\r\n\t// \t\t}\r\n\t// \t}\r\n\t// }\r\n\t// this.log.debug(deviceId);\r\n\t// this.log.debug(id);\r\n\t// this.log.debug(result);\r\n\t// });\r\n\t// }\r\n}\r\n\r\nif (require.main !== module) {\r\n\t// Export the constructor in compact mode\r\n\t/**\r\n\t * @param {Partial<utils.AdapterOptions>} [options={}]\r\n\t */\r\n\tmodule.exports = (options) => new Roborock(options);\r\n} else {\r\n\t// otherwise start the instance directly\r\n\tnew Roborock();\r\n}\r\n"]}